<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VOYA üåç AI | Travel Smarter</title>

    <!-- SEO Meta Tags -->
    <meta name="description"
        content="VOYA AI is your intelligent travel companion. Plan flights, hotels, and AI-powered itineraries in seconds. Travel smarter with personalized recommendations.">
    <meta name="keywords"
        content="AI travel planner, flight search, hotel booking, itinerary generator, travel app, smart travel, VOYA AI">
    <meta name="author" content="VOYA AI">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://voya-ai-company.vercel.app/">

    <!-- Open Graph (Facebook, LinkedIn, Discord) -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://voya-ai-company.vercel.app/">
    <meta property="og:title" content="VOYA AI | Travel Smarter with AI">
    <meta property="og:description"
        content="Plan your perfect journey in seconds. AI-powered flights, hotels, and personalized itineraries.">
    <meta property="og:image" content="https://voya-ai-company.vercel.app/og-preview.png">
    <meta property="og:site_name" content="VOYA AI">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="VOYA AI | Travel Smarter with AI">
    <meta name="twitter:description"
        content="Plan your perfect journey in seconds. AI-powered flights, hotels, and personalized itineraries.">
    <meta name="twitter:image" content="https://voya-ai-company.vercel.app/og-preview.png">

    <!-- Favicon (SVG Globe) -->
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='45' fill='%230f172a'/%3E%3Cellipse cx='50' cy='50' rx='20' ry='45' fill='none' stroke='%23D4AF37' stroke-width='2'/%3E%3Cellipse cx='50' cy='50' rx='45' ry='20' fill='none' stroke='%23D4AF37' stroke-width='2'/%3E%3Ccircle cx='50' cy='50' r='45' fill='none' stroke='%23D4AF37' stroke-width='2'/%3E%3C/svg%3E">

    <!-- Theme Color (Mobile Browser) -->
    <meta name="theme-color" content="#0f172a">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <!-- Structured Data (JSON-LD) -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "SoftwareApplication",
        "name": "VOYA AI",
        "applicationCategory": "TravelApplication",
        "operatingSystem": "Web",
        "description": "AI-powered travel planning app for flights, hotels, and personalized itineraries.",
        "url": "https://voya-ai-company.vercel.app/",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
        },
        "aggregateRating": {
            "@type": "AggregateRating",
            "ratingValue": "4.8",
            "ratingCount": "1200"
        }
    }
    </script>

    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <!-- Mapbox GL JS for Interactive Maps with Directions -->
    <script src='https://api.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.css' rel='stylesheet' />
    <!-- Google Identity Services for OAuth 2.0 -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        :root {
            --primary-bg: #1a1a1a;
            --card-bg: #ffffff;
            --accent-blue: #003580;
            --text-dark: #333333;
            --text-light: #f4f4f4;
            --gray: #666;
            --success: #28a745;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            background-color: var(--primary-bg);
            color: var(--text-light);
            line-height: 1.6;
        }

        header {
            height: 70px;
            background: rgba(0, 0, 0, 0.8);
            padding: 1rem 5%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid #333;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: #fff;
            text-decoration: none;
        }

        nav a {
            color: #ccc;
            text-decoration: none;
            margin: 0 15px;
            font-size: 0.9rem;
            transition: 0.3s;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .btn-signin {
            background: var(--accent-blue);
            color: white;
            border: none;
            padding: 10px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-signin:hover {
            background: #002a66;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 53, 128, 0.4);
        }

        .hero {
            text-align: center;
            padding: 80px 20px 120px;
            background: linear-gradient(to bottom, #1a1a1a, #2c3e50);
        }

        .hero h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            color: #fff;
        }

        .hero p {
            color: #bbb;
            font-size: 1.1rem;
        }

        .container {
            max-width: 1200px;
            margin: 50px auto;
            padding: 0 20px;
        }

        .tabs-nav {
            display: flex;
            align-items: center;
            min-height: 60px;
            background: #fff;
            border-radius: 12px 12px 0 0;
            overflow: hidden;
            border-bottom: 2px solid #eee;
        }

        .tab-btn {
            flex: 1;
            padding: 18px 15px;
            border: none;
            background: white;
            color: var(--gray);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            height: 100%;
            font-size: 0.95rem;
        }

        .tab-btn:hover {
            background: #f0f0f0;
            color: var(--accent-blue);
        }

        .tab-btn.active {
            color: var(--accent-blue);
            border-bottom: 3px solid var(--accent-blue);
            background: #f8f9fa;
        }

        /* Trip Type Toggle Buttons (Google Flights Style) */
        .trip-type-btn {
            padding: 10px 18px;
            border: 2px solid #e0e0e0;
            background: #fff;
            color: #666;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            border-radius: 20px;
            font-size: 0.9rem;
        }

        .trip-type-btn:hover {
            border-color: var(--accent-blue);
            color: var(--accent-blue);
            background: #f8f9fa;
        }

        .trip-type-btn.active {
            border-color: var(--accent-blue);
            background: var(--accent-blue);
            color: #fff;
        }

        .multicity-leg {
            padding: 15px 0;
            border-bottom: 1px solid #eee;
        }

        .multicity-leg:last-child {
            border-bottom: none;
        }

        .tab-content {
            background: white;
            color: var(--text-dark);
            padding: 30px;
            border-radius: 0 0 12px 12px;
            display: none;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .search-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        label {
            font-size: 0.85rem;
            font-weight: bold;
            color: var(--gray);
        }

        .required-indicator {
            color: #dc3545;
            margin-left: 2px;
        }

        .input-error {
            border-color: #dc3545 !important;
            box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.1) !important;
        }

        .error-text {
            color: #dc3545;
            font-size: 0.8rem;
            margin-top: 4px;
        }

        input,
        select,
        textarea {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 3px rgba(0, 53, 128, 0.1);
        }

        .btn-main {
            background: var(--accent-blue);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            transition: 0.2s;
        }

        .btn-main:hover {
            background: #002a66;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 53, 128, 0.3);
        }

        .btn-main:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .results-area {
            margin-top: 30px;
            color: var(--text-dark);
            height: auto;
            overflow: visible;
        }

        .flight-card,
        .hotel-card {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .flight-card:hover,
        .hotel-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        .flight-header,
        .hotel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #ddd;
        }

        .price-tag {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--accent-blue);
        }

        .flight-details,
        .hotel-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .detail-label {
            font-size: 0.85rem;
            color: var(--gray);
            font-weight: 600;
        }

        .detail-value {
            font-size: 1rem;
            color: var(--text-dark);
            font-weight: 500;
        }

        .btn-book {
            background: var(--success);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        .btn-book:hover {
            background: #218838;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
        }

        .error-message {
            background: #fff3cd;
            border: 1px solid #ffc107;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .no-results {
            text-align: center;
            padding: 40px;
            color: var(--gray);
            background: #f8f9fa;
            border-radius: 8px;
            margin-top: 20px;
        }

        /* Itinerary Styles */
        .itinerary-container {
            background: #fff;
            border-radius: 12px;
            padding: 25px;
            margin-top: 20px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
        }

        .itinerary-header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        .itinerary-header h1 {
            color: var(--accent-blue);
            font-size: 1.8rem;
            margin: 0 0 8px 0;
        }

        .itinerary-header p {
            color: var(--gray);
            font-size: 1rem;
            margin: 0;
        }

        .day-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #fff 100%);
            border-left: 4px solid var(--accent-blue);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }

        .day-card h2 {
            color: var(--accent-blue);
            font-size: 1.3rem;
            margin: 0 0 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .day-card h2::before {
            content: 'üìÖ';
        }

        .day-card h3 {
            color: #1a73e8;
            font-size: 1.1rem;
            margin: 15px 0 10px 0;
        }

        .day-card h4 {
            color: #333;
            font-size: 1rem;
            margin: 12px 0 8px 0;
        }

        .day-card p {
            color: #555;
            line-height: 1.7;
            margin: 8px 0;
        }

        .day-card ul {
            margin: 10px 0;
            padding-left: 20px;
        }

        .day-card li {
            color: #444;
            line-height: 1.6;
            margin: 6px 0;
        }

        .tip-card {
            background: linear-gradient(135deg, #fff3cd 0%, #fffbea 100%);
            border-left: 4px solid #ffc107;
            padding: 15px 20px;
            margin: 15px 0;
            border-radius: 6px;
        }

        .budget-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 0.9rem;
        }

        .budget-table th,
        .budget-table td {
            border: 1px solid #ddd;
            padding: 10px 12px;
            text-align: left;
        }

        .budget-table th {
            background: var(--accent-blue);
            color: white;
        }

        .budget-table tr:nth-child(even) {
            background: #f8f9fa;
        }

        .itinerary-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--accent-blue);
            color: var(--accent-blue);
            padding: 10px 20px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-outline:hover {
            background: var(--accent-blue);
            color: white;
        }

        .loader {
            display: none;
            text-align: center;
            padding: 60px 40px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            margin-top: 20px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #e0e0e0;
            border-top: 4px solid var(--accent-blue);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        .loader p {
            color: var(--accent-blue);
            font-weight: 600;
            font-size: 1rem;
            animation: pulse 1.5s ease-in-out infinite;
        }

        .loader-dots {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 15px;
        }

        .loader-dots span {
            width: 10px;
            height: 10px;
            background: var(--accent-blue);
            border-radius: 50%;
            animation: bounce 1.4s infinite ease-in-out both;
        }

        .loader-dots span:nth-child(1) {
            animation-delay: -0.32s;
        }

        .loader-dots span:nth-child(2) {
            animation-delay: -0.16s;
        }

        .loader-dots span:nth-child(3) {
            animation-delay: 0;
        }

        @keyframes bounce {

            0%,
            80%,
            100% {
                transform: scale(0);
            }

            40% {
                transform: scale(1);
            }
        }

        /* ==================== PREMIUM ITINERARY STYLES ==================== */

        .itinerary-container {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f953c6 100%);
            border-radius: 24px;
            padding: 4px;
            margin-top: 30px;
            box-shadow: 0 20px 60px rgba(102, 126, 234, 0.4);
            position: relative;
            overflow: hidden;
        }

        .itinerary-container::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg,
                    transparent,
                    rgba(255, 255, 255, 0.1),
                    transparent);
            animation: shimmer 3s infinite;
            pointer-events: none;
        }

        @keyframes shimmer {
            0% {
                transform: translateX(-100%) translateY(-100%) rotate(45deg);
            }

            100% {
                transform: translateX(100%) translateY(100%) rotate(45deg);
            }
        }

        .itinerary-inner {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 22px;
            padding: 35px;
            position: relative;
        }

        .itinerary-header {
            text-align: center;
            padding: 35px 25px;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            border-radius: 16px;
            margin-bottom: 30px;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .itinerary-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            opacity: 0.3;
        }

        .itinerary-header h1 {
            margin: 0;
            font-size: 2.2rem;
            font-weight: 800;
            letter-spacing: -0.5px;
            position: relative;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .itinerary-header p {
            margin: 12px 0 0;
            opacity: 0.9;
            font-size: 1.1rem;
            font-weight: 400;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .itinerary-header .meta-badge {
            background: rgba(255, 255, 255, 0.15);
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.9rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* ==================== ANIMATED DESTINATION TITLE CARD ==================== */

        .destination-title-card {
            position: relative;
            height: 400px;
            border-radius: 24px;
            overflow: hidden;
            margin-bottom: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .destination-title-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f953c6 50%, #667eea 75%, #764ba2 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            z-index: 1;
        }

        @keyframes gradientShift {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        .destination-title-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background:
                radial-gradient(circle at 20% 50%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(255, 255, 255, 0.05) 0%, transparent 50%);
            animation: float 20s ease-in-out infinite;
            z-index: 2;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-20px);
            }
        }

        .destination-title-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to bottom, rgba(0, 0, 0, 0.3) 0%, rgba(0, 0, 0, 0.6) 100%);
            z-index: 3;
        }

        .destination-title-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            z-index: 4;
            width: 90%;
        }

        .destination-title-content h1 {
            font-size: 4rem;
            font-weight: 900;
            color: white;
            margin: 0 0 20px 0;
            text-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            letter-spacing: -2px;
            animation: titlePulse 3s ease-in-out infinite;
        }

        @keyframes titlePulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.02);
            }
        }

        .destination-title-content .subtitle {
            font-size: 1.5rem;
            color: rgba(255, 255, 255, 0.95);
            font-weight: 500;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .destination-particles {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 2;
            pointer-events: none;
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: white;
            border-radius: 50%;
            opacity: 0.6;
            animation: particleFloat 10s infinite ease-in-out;
        }

        @keyframes particleFloat {

            0%,
            100% {
                transform: translateY(0) translateX(0);
                opacity: 0;
            }

            10% {
                opacity: 0.6;
            }

            90% {
                opacity: 0.6;
            }

            100% {
                transform: translateY(-400px) translateX(50px);
                opacity: 0;
            }
        }

        /* ==================== FULL-PAGE ITINERARY VIEW ==================== */

        .itinerary-fullpage {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #f5f7fa;
            z-index: 9999;
            overflow-y: auto;
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .itinerary-fullpage.active {
            display: block;
            opacity: 1;
        }

        .itinerary-fullpage-nav {
            position: sticky;
            top: 0;
            background: white;
            border-bottom: 1px solid #e0e0e0;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .itinerary-fullpage-nav .back-btn {
            background: transparent;
            border: 2px solid #003580;
            color: #003580;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .itinerary-fullpage-nav .back-btn:hover {
            background: #003580;
            color: white;
            transform: translateX(-5px);
        }

        .itinerary-fullpage-nav .nav-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #1a1a2e;
        }

        .itinerary-fullpage-nav .nav-actions {
            display: flex;
            gap: 10px;
        }

        .itinerary-fullpage-nav .nav-actions button {
            background: #003580;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .itinerary-fullpage-nav .nav-actions button:hover {
            background: #002a66;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 53, 128, 0.3);
        }

        .itinerary-fullpage-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px;
        }

        /* Map stabilization improvements */
        .itinerary-map-container {
            position: relative;
            min-height: 400px;
            background: #f0f0f0;
            border-radius: 16px;
            overflow: hidden;
        }

        .map-loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            flex-direction: column;
            gap: 15px;
        }

        .map-loading-overlay.hidden {
            display: none;
        }

        .map-error-message {
            background: #fff3cd;
            border: 1px solid #ffc107;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin: 20px;
            text-align: center;
        }

        /* ==================== TRIP.COM-STYLE COMPACT STICKY SEARCH BAR ==================== */

        .compact-search-bar {
            position: sticky;
            top: 0;
            background: white;
            border-bottom: 2px solid #e0e0e0;
            padding: 15px 30px;
            z-index: 99;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .compact-search-bar .search-summary {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
            min-width: 300px;
        }

        .compact-search-bar .search-detail {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: #f5f7fa;
            border-radius: 8px;
            font-size: 0.95rem;
        }

        .compact-search-bar .search-detail strong {
            color: #003580;
            font-weight: 600;
        }

        .compact-search-bar .modify-search-btn {
            background: #003580;
            color: white;
            border: none;
            padding: 10px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .compact-search-bar .modify-search-btn:hover {
            background: #002a66;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 53, 128, 0.3);
        }

        /* ==================== SKELETON LOADERS (TRIP.COM STYLE) ==================== */

        .skeleton-container {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .skeleton-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            animation: skeletonPulse 1.5s ease-in-out infinite;
        }

        @keyframes skeletonPulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.6;
            }
        }

        .skeleton-line {
            height: 16px;
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            border-radius: 4px;
            margin-bottom: 12px;
            animation: skeletonShimmer 1.5s ease-in-out infinite;
        }

        @keyframes skeletonShimmer {
            0% {
                background-position: 200% 0;
            }

            100% {
                background-position: -200% 0;
            }
        }

        .skeleton-line.short {
            width: 60%;
        }

        .skeleton-line.medium {
            width: 80%;
        }

        .skeleton-line.long {
            width: 100%;
        }

        .skeleton-image {
            width: 200px;
            height: 150px;
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            border-radius: 8px;
            animation: skeletonShimmer 1.5s ease-in-out infinite;
        }

        .skeleton-flight-card {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .skeleton-hotel-card {
            display: flex;
            gap: 20px;
        }

        /* ==================== SMOOTH FADE-IN ANIMATIONS ==================== */

        .fade-in {
            animation: fadeInUp 0.6s ease-out forwards;
            opacity: 0;
        }

        .fade-in-delay-1 {
            animation-delay: 0.1s;
        }

        .fade-in-delay-2 {
            animation-delay: 0.2s;
        }

        .fade-in-delay-3 {
            animation-delay: 0.3s;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Results container with fade-in */
        .results-loaded {
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }


        /* Day Cards with Timeline */
        .day-cards-container {
            position: relative;
            padding-left: 40px;
        }

        .day-cards-container::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 3px;
            background: linear-gradient(180deg, #667eea 0%, #764ba2 50%, #f953c6 100%);
            border-radius: 3px;
        }

        .day-card {
            background: linear-gradient(145deg, #ffffff 0%, #f8f9ff 100%);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(102, 126, 234, 0.1);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
        }

        .day-card::before {
            content: '';
            position: absolute;
            left: -33px;
            top: 30px;
            width: 18px;
            height: 18px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            border: 4px solid white;
            box-shadow: 0 2px 10px rgba(102, 126, 234, 0.4);
        }

        .day-card:hover {
            transform: translateY(-5px) scale(1.01);
            box-shadow: 0 20px 50px rgba(102, 126, 234, 0.2);
            border-color: rgba(102, 126, 234, 0.3);
        }

        .day-card h2 {
            color: #1a1a2e;
            font-size: 1.4rem;
            font-weight: 700;
            margin: 0 0 18px 0;
            padding-bottom: 15px;
            border-bottom: 2px solid transparent;
            border-image: linear-gradient(90deg, #667eea, #764ba2, transparent) 1;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .day-card h2::before {
            content: '';
            display: none;
        }

        .day-number {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 10px;
            font-size: 0.85rem;
            font-weight: 700;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .day-card h3 {
            color: #667eea;
            font-size: 1.15rem;
            margin: 20px 0 12px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
        }

        .day-card h3::before {
            content: '‚óÜ';
            color: #764ba2;
            font-size: 0.7rem;
        }

        .day-card h4 {
            color: #16213e;
            font-size: 1rem;
            margin: 16px 0 8px 0;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .day-card h4::before {
            content: '‚Ä∫';
            color: #667eea;
            font-weight: bold;
        }

        /* Activity Items */
        .itinerary-container ul {
            list-style: none;
            padding: 0;
            margin: 15px 0;
            display: grid;
            gap: 12px;
        }

        .itinerary-container li {
            background: linear-gradient(135deg, #f8f9ff 0%, #ffffff 100%);
            padding: 16px 20px;
            border-radius: 12px;
            border-left: 4px solid #667eea;
            color: #333;
            font-size: 0.95rem;
            line-height: 1.6;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.04);
            transition: all 0.3s ease;
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .itinerary-container li::before {
            content: '‚úì';
            color: white;
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            width: 22px;
            height: 22px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
            flex-shrink: 0;
            box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3);
        }

        .itinerary-container li:hover {
            transform: translateX(5px);
            border-left-color: #764ba2;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.1);
        }

        .itinerary-container p {
            color: #444;
            line-height: 1.8;
            margin: 12px 0;
            font-size: 0.95rem;
        }

        /* Tip Cards */
        .tip-card {
            background: linear-gradient(135deg, #fff9e6 0%, #fff3cd 100%);
            border-radius: 14px;
            padding: 20px 24px;
            margin: 20px 0;
            border-left: 5px solid #ffc107;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(255, 193, 7, 0.2);
        }

        .tip-card::before {
            content: 'üí°';
            font-size: 1.5rem;
            margin-right: 10px;
        }

        .tip-card::after {
            content: '';
            position: absolute;
            right: -20px;
            top: -20px;
            width: 80px;
            height: 80px;
            background: rgba(255, 193, 7, 0.15);
            border-radius: 50%;
        }

        /* Budget Box Container */
        .budget-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 16px;
            padding: 3px;
            margin: 25px 0;
            box-shadow: 0 10px 40px rgba(102, 126, 234, 0.25);
        }

        .budget-title {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: white;
            margin: 0;
            padding: 18px 24px;
            font-size: 1.2rem;
            font-weight: 700;
            border-radius: 14px 14px 0 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Budget Table */
        .budget-box .budget-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin: 0;
            border-radius: 0 0 14px 14px;
            overflow: hidden;
        }

        .budget-table thead {
            background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
            color: white;
        }

        .budget-table th {
            padding: 16px 20px;
            text-align: center;
            font-weight: 700;
            font-size: 0.9rem;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        .budget-table th:first-child {
            text-align: left;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }

        .budget-table th:nth-child(2) {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }

        .budget-table th:nth-child(3) {
            background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
            color: #1a1a2e;
        }

        .budget-table th:nth-child(4) {
            background: linear-gradient(135deg, #dc3545 0%, #e83e8c 100%);
        }

        .budget-table td {
            padding: 16px 20px;
            border-bottom: 1px solid #f0f0f5;
            background: white;
            color: #333;
            font-size: 0.95rem;
            text-align: center;
            font-weight: 500;
        }

        .budget-table td:first-child {
            text-align: left;
            font-weight: 600;
            color: #1a1a2e;
            background: #f8f9ff;
        }

        .budget-table tr:last-child td {
            border-bottom: none;
        }

        .budget-table tr:last-child td:first-child {
            border-bottom-left-radius: 14px;
        }

        .budget-table tr:last-child td:last-child {
            border-bottom-right-radius: 14px;
        }

        /* Price column colors */
        .budget-table .price-budget {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            color: #155724;
            font-weight: 700;
        }

        .budget-table .price-midrange {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeeba 100%);
            color: #856404;
            font-weight: 700;
        }

        .budget-table .price-luxury {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            color: #721c24;
            font-weight: 700;
        }

        .budget-table tbody tr {
            transition: all 0.3s ease;
        }

        .budget-table tbody tr:hover td {
            filter: brightness(0.98);
        }

        .budget-table tbody tr {
            transition: all 0.3s ease;
        }

        .budget-table tbody tr:hover td {
            background: #f8f9ff;
        }

        /* Section Styling */
        .itinerary-section {
            background: linear-gradient(145deg, #ffffff 0%, #f8f9ff 100%);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.06);
            border: 1px solid rgba(102, 126, 234, 0.1);
        }

        .itinerary-section h2 {
            color: #1a1a2e;
            margin: 0 0 20px 0;
            font-size: 1.4rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* ========== Trip.com Style Itinerary Layout ========== */

        /* Main 2-Column Layout */
        .trip-itinerary-layout {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 24px;
            margin-top: 25px;
        }

        @media (max-width: 900px) {
            .trip-itinerary-layout {
                grid-template-columns: 1fr;
            }
        }

        /* Budget Sidebar */
        .trip-budget-sidebar {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            height: fit-content;
            position: sticky;
            top: 20px;
            border: 1px solid #e8ecf3;
        }

        .trip-budget-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #f0f0f5;
        }

        .trip-budget-header svg {
            width: 24px;
            height: 24px;
            color: #0060FF;
        }

        .trip-budget-header h3 {
            margin: 0;
            font-size: 1rem;
            font-weight: 600;
            color: #1a1a2e;
        }

        .trip-budget-total {
            text-align: center;
            margin-bottom: 24px;
            padding: 20px 16px;
            background: linear-gradient(135deg, #f8f9ff 0%, #f0f4ff 100%);
            border-radius: 16px;
            border: 1px solid rgba(102, 126, 234, 0.1);
        }

        .trip-budget-total .label {
            font-size: 0.82rem;
            color: #888;
            margin-bottom: 8px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .trip-budget-total .amount {
            font-size: 2.4rem;
            font-weight: 900;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f953c6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -1px;
            line-height: 1.1;
            margin-bottom: 6px;
        }

        .trip-budget-total .per-person {
            font-size: 0.8rem;
            color: #999;
            font-weight: 500;
        }

        /* Budget Progress Bar */
        .trip-budget-progress {
            height: 8px;
            background: #f0f0f5;
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .trip-budget-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 50%, #00b4d8 100%);
            border-radius: 10px;
            width: 75%;
        }

        /* Budget Items (Enhanced) */
        .trip-budget-items {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .trip-budget-item {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 14px 16px;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9ff 100%);
            border-radius: 14px;
            transition: all 0.3s ease;
            border: 1px solid rgba(102, 126, 234, 0.08);
            cursor: default;
        }

        .trip-budget-item:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.12);
            border-color: rgba(102, 126, 234, 0.15);
        }

        .trip-budget-item .icon {
            width: 42px;
            height: 42px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .trip-budget-item.transport .icon {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.2);
        }

        .trip-budget-item.attractions .icon {
            background: linear-gradient(135deg, #fff8e1 0%, #ffecb3 100%);
            box-shadow: 0 4px 12px rgba(255, 193, 7, 0.2);
        }

        .trip-budget-item.stay .icon {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.2);
        }

        .trip-budget-item .details {
            flex: 1;
        }

        .trip-budget-item .category {
            font-size: 0.82rem;
            color: #888;
            font-weight: 500;
            margin-bottom: 2px;
        }

        .trip-budget-item .price {
            font-size: 1.05rem;
            font-weight: 800;
            color: #1a1a2e;
            letter-spacing: -0.3px;
        }

        /* AI Assistant Note */
        .trip-ai-note {
            margin-top: 20px;
            padding: 12px;
            background: #f8f9ff;
            border-radius: 10px;
            font-size: 0.8rem;
            color: #666;
            line-height: 1.5;
        }

        .trip-ai-note strong {
            color: #0060FF;
        }

        /* Main Content Area */
        .trip-itinerary-main {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            border: 1px solid #e8ecf3;
        }

        /* Day Tabs Navigation */
        .trip-day-tabs {
            display: flex;
            gap: 8px;
            padding: 16px 20px;
            background: #f8f9ff;
            border-bottom: 1px solid #e8ecf3;
            overflow-x: auto;
            scrollbar-width: none;
        }

        .trip-day-tabs::-webkit-scrollbar {
            display: none;
        }

        .trip-day-tab {
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.3s ease;
            background: white;
            border: 1px solid #e8ecf3;
            color: #666;
        }

        .trip-day-tab:hover {
            background: #f0f0f5;
            border-color: #d0d0d5;
        }

        .trip-day-tab.active {
            background: #0060FF;
            color: white;
            border-color: #0060FF;
        }

        /* Itinerary Title Bar */
        .trip-title-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            border-bottom: 1px solid #f0f0f5;
        }

        .trip-title-bar h2 {
            margin: 0;
            font-size: 1.1rem;
            font-weight: 600;
            color: #1a1a2e;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .trip-year-badge {
            background: linear-gradient(135deg, #0060FF 0%, #00b4d8 100%);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        /* Activity Cards (Premium Design) */
        .trip-activities {
            padding: 0 24px 24px;
            min-height: 400px;
            overflow-y: auto;
        }

        .trip-activity-card {
            display: flex;
            gap: 18px;
            padding: 22px;
            margin: 12px 0;
            background: linear-gradient(135deg, #ffffff 0%, #fafbff 100%);
            border-radius: 16px;
            border: 1px solid rgba(102, 126, 234, 0.08);
            position: relative;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
        }

        .trip-activity-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 35px rgba(102, 126, 234, 0.15);
            border-color: rgba(102, 126, 234, 0.2);
        }

        .trip-activity-card:last-child {
            margin-bottom: 0;
        }

        .trip-activity-number {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, #0060FF 0%, #00b4d8 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 0.95rem;
            flex-shrink: 0;
            box-shadow: 0 6px 20px rgba(0, 96, 255, 0.35);
            transition: transform 0.3s ease;
        }

        .trip-activity-card:hover .trip-activity-number {
            transform: scale(1.1);
        }

        .trip-activity-image {
            width: 130px;
            height: 95px;
            border-radius: 14px;
            overflow: hidden;
            flex-shrink: 0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .trip-activity-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.4s ease;
        }

        .trip-activity-card:hover .trip-activity-image img {
            transform: scale(1.05);
        }

        .trip-activity-placeholder {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f953c6 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2.2rem;
            animation: shimmer 3s ease-in-out infinite;
        }

        @keyframes shimmer {

            0%,
            100% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }
        }

        .trip-activity-content {
            flex: 1;
            min-width: 0;
        }

        .trip-activity-header {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            margin-bottom: 8px;
        }

        .trip-activity-title {
            font-size: 1.05rem;
            font-weight: 700;
            color: #1a1a2e;
            margin: 0;
        }

        .trip-best-badge {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a5a 100%);
            color: white;
            padding: 3px 8px;
            border-radius: 6px;
            font-size: 0.7rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .trip-rating {
            background: linear-gradient(135deg, #ffc107 0%, #ffb300 100%);
            color: #1a1a2e;
            padding: 3px 8px;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .trip-activity-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 8px;
            font-size: 0.85rem;
            color: #888;
        }

        .trip-activity-meta span {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .trip-activity-description {
            font-size: 0.9rem;
            color: #555;
            line-height: 1.6;
            margin: 0;
        }

        /* Transportation Connector */
        .trip-transport {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 0 12px 46px;
            font-size: 0.85rem;
            color: #888;
            position: relative;
        }

        .trip-transport::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #e8ecf3;
        }

        .trip-transport-icon {
            width: 28px;
            height: 28px;
            background: white;
            border: 2px solid #e8ecf3;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            z-index: 1;
        }

        .trip-transport-text {
            color: #0060FF;
            font-weight: 500;
        }

        /* Empty Day Message */
        .trip-empty-day {
            text-align: center;
            padding: 40px 20px;
            color: #888;
        }

        .trip-empty-day svg {
            width: 48px;
            height: 48px;
            margin-bottom: 12px;
            color: #ccc;
        }

        /* ========== Budget Tier Tabs (Premium Design) ========== */
        .trip-tier-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 24px;
            padding: 4px;
            background: linear-gradient(135deg, #f0f4ff 0%, #e8ecf8 100%);
            border-radius: 16px;
        }

        .trip-tier-tab {
            flex: 1;
            padding: 14px 12px;
            text-align: center;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.82rem;
            font-weight: 600;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: none;
            background: transparent;
            color: #666;
            position: relative;
            overflow: hidden;
        }

        .trip-tier-tab::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: white;
            border-radius: 12px;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 0;
        }

        .trip-tier-tab:hover::before {
            opacity: 1;
        }

        .trip-tier-tab:hover {
            transform: translateY(-2px);
            color: #0060FF;
        }

        .trip-tier-tab.active {
            background: linear-gradient(135deg, #0060FF 0%, #00b4d8 100%);
            color: white;
            box-shadow: 0 8px 25px rgba(0, 96, 255, 0.35);
            transform: translateY(-2px);
        }

        .trip-tier-tab.active::before {
            display: none;
        }

        .trip-tier-tab .tier-icon {
            font-size: 1.4rem;
            display: block;
            margin-bottom: 6px;
            position: relative;
            z-index: 1;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
        }

        .trip-tier-tab .tier-name {
            display: block;
            position: relative;
            z-index: 1;
            font-weight: 700;
            margin-bottom: 2px;
        }

        .trip-tier-tab .tier-price {
            font-size: 0.72rem;
            opacity: 0.75;
            position: relative;
            z-index: 1;
            font-weight: 500;
        }

        .trip-tier-tab.active .tier-price {
            opacity: 0.9;
        }

        /* ========== 3-Column Layout with Map ========== */
        .trip-itinerary-layout {
            display: grid;
            grid-template-columns: 280px 1fr 350px;
            gap: 20px;
            margin-top: 25px;
        }

        @media (max-width: 1200px) {
            .trip-itinerary-layout {
                grid-template-columns: 250px 1fr;
            }

            .trip-map-panel {
                display: none;
            }
        }

        @media (max-width: 900px) {
            .trip-itinerary-layout {
                grid-template-columns: 1fr;
            }

            .trip-budget-sidebar {
                order: -1;
            }
        }

        /* ========== Map Panel ========== */
        .trip-map-panel {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid #e8ecf3;
            display: flex;
            flex-direction: column;
            height: 600px;
            position: sticky;
            top: 90px;
        }

        .trip-map-header {
            padding: 16px;
            border-bottom: 1px solid #f0f0f5;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .trip-map-header h3 {
            margin: 0;
            font-size: 1rem;
            font-weight: 600;
            color: #1a1a2e;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .trip-map-filters {
            display: flex;
            gap: 6px;
        }

        .trip-map-filter {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
            cursor: pointer;
            border: 1px solid #e8ecf3;
            background: white;
            color: #666;
            transition: all 0.2s ease;
        }

        .trip-map-filter.active {
            background: #0060FF;
            color: white;
            border-color: #0060FF;
        }

        .trip-map-container {
            flex: 1;
            position: relative;
        }

        #itinerary-map {
            width: 100%;
            height: 100%;
        }

        /* Custom Leaflet Marker Styles */
        .trip-marker {
            background: linear-gradient(135deg, #0060FF 0%, #00b4d8 100%);
            color: white;
            border-radius: 50%;
            width: 32px !important;
            height: 32px !important;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
            border: 3px solid white;
            box-shadow: 0 4px 12px rgba(0, 96, 255, 0.4);
            margin-left: -16px !important;
            margin-top: -16px !important;
        }

        .trip-marker.highlighted {
            transform: scale(1.3);
            box-shadow: 0 6px 20px rgba(0, 96, 255, 0.6);
            z-index: 1000 !important;
        }

        .leaflet-popup-content-wrapper {
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        }

        .leaflet-popup-content {
            margin: 12px 16px;
            font-family: 'Segoe UI', sans-serif;
        }

        .map-popup-title {
            font-weight: 700;
            font-size: 0.95rem;
            color: #1a1a2e;
            margin-bottom: 4px;
        }

        .map-popup-meta {
            font-size: 0.8rem;
            color: #888;
        }

        /* Map Time Badges (like Trip.com) */
        .map-time-badge {
            background: #0060FF;
            color: white;
            padding: 4px 8px;
            border-radius: 8px;
            font-size: 0.7rem;
            font-weight: 600;
            white-space: nowrap;
        }

        /* Action Buttons */
        .itinerary-actions {
            display: flex;
            gap: 15px;
            margin-top: 35px;
            padding-top: 30px;
            border-top: 2px solid #f0f0f5;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn-outline {
            background: white;
            border: 2px solid #667eea;
            color: #667eea;
            padding: 14px 28px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.1);
        }

        .btn-outline:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: transparent;
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .btn-outline i {
            font-size: 1rem;
        }

        .itinerary-actions .btn-main {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 14px 32px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .itinerary-actions .btn-main:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 12px 35px rgba(102, 126, 234, 0.4);
        }

        /* Loader Premium Style */
        .loader {
            display: none;
            text-align: center;
            padding: 80px 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            margin-top: 30px;
            position: relative;
            overflow: hidden;
        }

        .loader::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 25px;
        }

        .loader p {
            color: white;
            font-weight: 600;
            font-size: 1.2rem;
            position: relative;
        }

        .loader-dots {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }

        .loader-dots span {
            width: 12px;
            height: 12px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            animation: bounce 1.4s infinite ease-in-out both;
        }

        .loader-dots span:nth-child(1) {
            animation-delay: -0.32s;
        }

        .loader-dots span:nth-child(2) {
            animation-delay: -0.16s;
        }

        .loader-dots span:nth-child(3) {
            animation-delay: 0;
        }

        /* Activity Item Enhanced */
        .activity-item {
            background: linear-gradient(135deg, #f8f9ff 0%, #ffffff 100%);
            border-radius: 12px;
            padding: 16px 20px;
            margin: 12px 0;
            border-left: 4px solid #28a745;
            display: flex;
            align-items: flex-start;
            gap: 14px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.04);
            transition: all 0.3s ease;
        }

        .activity-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
        }

        .activity-item::before {
            content: '‚úì';
            color: white;
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: bold;
            flex-shrink: 0;
        }

        .activity-item p {
            margin: 0;
            color: #333;
            line-height: 1.6;
        }

        /* Budget Badges */
        .budget-badge {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .budget-badge.budget {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            color: #155724;
        }

        .budget-badge.midrange {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeeba 100%);
            color: #856404;
        }

        .budget-badge.luxury {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            color: #721c24;
        }

        /* Full-Page Search Overlay - Trip.com/Skyscanner Style */
        .search-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #0a1628 0%, #1a2d4a 50%, #0d1929 100%);
            z-index: 10000;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .search-overlay.active {
            display: flex;
            opacity: 1;
        }

        .search-overlay.fade-out {
            opacity: 0;
        }

        /* Starfield background effect */
        .search-overlay::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image:
                radial-gradient(1px 1px at 20% 30%, rgba(255, 255, 255, 0.5) 1px, transparent 0),
                radial-gradient(1px 1px at 40% 70%, rgba(255, 255, 255, 0.4) 1px, transparent 0),
                radial-gradient(1px 1px at 50% 50%, rgba(255, 255, 255, 0.3) 1px, transparent 0),
                radial-gradient(1px 1px at 80% 20%, rgba(255, 255, 255, 0.5) 1px, transparent 0);
            background-size: 200px 200px;
            animation: twinkle 4s infinite;
        }

        @keyframes twinkle {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.7;
            }
        }

        .overlay-content {
            position: relative;
            z-index: 1;
            text-align: center;
            padding: 40px;
            max-width: 700px;
            width: 100%;
        }

        /* Route display with flight path */
        .route-display {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 50px;
        }

        .airport-code {
            font-size: 3.5rem;
            font-weight: 800;
            color: #fff;
            letter-spacing: 2px;
            text-shadow: 0 0 30px rgba(0, 150, 255, 0.5);
        }

        .airport-name {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.6);
            margin-top: 5px;
        }

        .flight-path-container {
            position: relative;
            width: 200px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .flight-path-line {
            position: absolute;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg,
                    transparent 0%,
                    rgba(0, 150, 255, 0.8) 20%,
                    rgba(0, 150, 255, 0.8) 80%,
                    transparent 100%);
        }

        .flight-path-dashes {
            position: absolute;
            width: 100%;
            height: 2px;
            background: repeating-linear-gradient(90deg,
                    transparent,
                    transparent 8px,
                    rgba(255, 255, 255, 0.4) 8px,
                    rgba(255, 255, 255, 0.4) 16px);
            animation: dashMove 1s linear infinite;
        }

        @keyframes dashMove {
            from {
                background-position: 0 0;
            }

            to {
                background-position: 24px 0;
            }
        }

        .airplane-icon {
            position: absolute;
            width: 40px;
            height: 40px;
            left: -20px;
            top: 50%;
            margin-top: -20px;
            animation: flyPlane 3s ease-in-out infinite;
            filter: drop-shadow(0 0 10px rgba(0, 150, 255, 0.8));
        }

        .airplane-icon svg {
            width: 100%;
            height: 100%;
            fill: #fff;
        }

        @keyframes flyPlane {
            0% {
                left: -20px;
                transform: translateY(0) rotate(0deg);
            }

            25% {
                left: calc(25% - 10px);
                transform: translateY(-8px) rotate(-3deg);
            }

            50% {
                left: calc(50% - 20px);
                transform: translateY(-12px) rotate(0deg);
            }

            75% {
                left: calc(75% - 10px);
                transform: translateY(-6px) rotate(3deg);
            }

            100% {
                left: calc(100% - 20px);
                transform: translateY(0) rotate(0deg);
            }
        }

        /* Search info badges */
        .search-info {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }

        .info-badge {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 10px 20px;
            border-radius: 30px;
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .info-badge i {
            color: #00a8ff;
        }

        /* Progress section */
        .search-progress {
            margin-bottom: 40px;
        }

        .progress-bar-container {
            width: 100%;
            max-width: 400px;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin: 0 auto 20px;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #0096ff, #00d4ff, #00ff88);
            background-size: 200% 100%;
            border-radius: 10px;
            width: 0%;
            transition: width 0.3s ease;
            animation: gradientShift 2s linear infinite;
        }

        @keyframes gradientShift {
            0% {
                background-position: 0% 50%;
            }

            100% {
                background-position: 200% 50%;
            }
        }

        .search-status-text {
            font-size: 1.2rem;
            color: #fff;
            font-weight: 500;
            margin-bottom: 8px;
            animation: pulseText 2s ease-in-out infinite;
        }

        @keyframes pulseText {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.7;
            }
        }

        .search-substatus {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.5);
        }

        /* Partner logos carousel */
        .partners-section {
            margin-top: 30px;
        }

        .partners-label {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.5);
            margin-bottom: 15px;
        }

        .partners-logos {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
            animation: fadeInUp 0.5s ease;
        }

        .partner-logo {
            width: 80px;
            height: 40px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            color: #333;
            font-weight: 700;
            opacity: 0;
            animation: logoFade 0.5s ease forwards;
        }

        .partner-logo:nth-child(1) {
            animation-delay: 0.1s;
        }

        .partner-logo:nth-child(2) {
            animation-delay: 0.2s;
        }

        .partner-logo:nth-child(3) {
            animation-delay: 0.3s;
        }

        .partner-logo:nth-child(4) {
            animation-delay: 0.4s;
        }

        .partner-logo:nth-child(5) {
            animation-delay: 0.5s;
        }

        @keyframes logoFade {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Cloud decorations */
        .cloud {
            position: absolute;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 50%;
            filter: blur(40px);
        }

        .cloud-1 {
            width: 300px;
            height: 150px;
            top: 10%;
            left: 5%;
            animation: floatCloud 20s ease-in-out infinite;
        }

        .cloud-2 {
            width: 400px;
            height: 200px;
            bottom: 15%;
            right: 5%;
            animation: floatCloud 25s ease-in-out infinite reverse;
        }

        .cloud-3 {
            width: 250px;
            height: 120px;
            top: 40%;
            right: 15%;
            animation: floatCloud 18s ease-in-out infinite;
        }

        @keyframes floatCloud {

            0%,
            100% {
                transform: translateX(0) translateY(0);
            }

            25% {
                transform: translateX(20px) translateY(-10px);
            }

            50% {
                transform: translateX(0) translateY(10px);
            }

            75% {
                transform: translateX(-20px) translateY(-5px);
            }
        }

        /* Cancel button */
        .overlay-cancel {
            position: absolute;
            top: 30px;
            right: 30px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: rgba(255, 255, 255, 0.7);
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            z-index: 1;
        }

        .overlay-cancel:hover {
            background: rgba(255, 255, 255, 0.2);
            color: #fff;
        }

        /* Airport Autocomplete Styles */
        .airport-input-container {
            position: relative;
            width: 100%;
        }

        .airport-autocomplete {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 250px;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
            display: none;
        }

        .airport-autocomplete.active {
            display: block;
        }

        .airport-item {
            padding: 12px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            border-bottom: 1px solid #f0f0f0;
            transition: background 0.2s ease;
        }

        .airport-item:last-child {
            border-bottom: none;
        }

        .airport-item:hover {
            background: #f5f8ff;
        }

        .airport-item.selected {
            background: #e8f0fe;
        }

        .airport-code {
            font-weight: 700;
            color: var(--accent-blue);
            font-size: 1.1rem;
            min-width: 45px;
        }

        .airport-info {
            flex: 1;
        }

        .airport-name {
            font-weight: 500;
            color: #333;
            font-size: 0.9rem;
        }

        .airport-city {
            font-size: 0.8rem;
            color: #888;
            margin-top: 2px;
        }

        .airport-icon {
            color: #ccc;
            font-size: 1.2rem;
        }

        @media (max-width: 768px) {
            .tabs-nav {
                flex-direction: column;
                min-height: auto;
            }

            .tab-btn {
                width: 100%;
                padding: 15px;
            }

            .search-grid {
                grid-template-columns: 1fr;
            }

            .hero h1 {
                font-size: 2rem;
            }

            .container {
                padding: 0 15px;
            }
        }

        /* ==================== ANTIGRAVITY THEME OVERRIDES ==================== */
        /* Premium Glassmorphism Dark Mode - Cosmic Design */

        /* === COSMIC BACKGROUND FOR FULL-PAGE ITINERARY === */
        .itinerary-fullpage {
            background:
                radial-gradient(ellipse at 20% 0%, rgba(108, 93, 211, 0.4) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 20%, rgba(139, 120, 230, 0.3) 0%, transparent 40%),
                radial-gradient(ellipse at 40% 80%, rgba(147, 51, 234, 0.25) 0%, transparent 50%),
                radial-gradient(ellipse at 90% 90%, rgba(59, 130, 246, 0.2) 0%, transparent 40%),
                linear-gradient(180deg, #0a0a0f 0%, #0d0d14 25%, #0f0f18 50%, #0a0a12 100%) !important;
            background-attachment: fixed !important;
        }

        .itinerary-fullpage.active {
            display: block !important;
            opacity: 1 !important;
        }

        /* === GLASS NAVIGATION BAR === */
        .itinerary-fullpage-nav {
            background: rgba(15, 15, 25, 0.85) !important;
            backdrop-filter: blur(20px) saturate(180%) !important;
            -webkit-backdrop-filter: blur(20px) saturate(180%) !important;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08) !important;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5) !important;
        }

        .itinerary-fullpage-nav .nav-title {
            color: #ffffff !important;
            text-shadow: 0 2px 10px rgba(108, 93, 211, 0.3) !important;
        }

        .itinerary-fullpage-nav .back-btn {
            background: transparent !important;
            border: 2px solid rgba(108, 93, 211, 0.6) !important;
            color: #a78bfa !important;
            backdrop-filter: blur(10px) !important;
        }

        .itinerary-fullpage-nav .back-btn:hover {
            background: linear-gradient(135deg, #6C5DD3 0%, #8B78E6 100%) !important;
            border-color: #8B78E6 !important;
            color: #ffffff !important;
            transform: translateX(-5px) !important;
            box-shadow: 0 4px 20px rgba(108, 93, 211, 0.5) !important;
        }

        .itinerary-fullpage-nav .nav-actions button {
            background: linear-gradient(135deg, #6C5DD3 0%, #8B78E6 100%) !important;
            border: none !important;
            color: #ffffff !important;
            box-shadow: 0 4px 20px rgba(108, 93, 211, 0.4) !important;
        }

        .itinerary-fullpage-nav .nav-actions button:hover {
            background: linear-gradient(135deg, #7c6de3 0%, #9b88f6 100%) !important;
            transform: translateY(-2px) !important;
            box-shadow: 0 8px 30px rgba(108, 93, 211, 0.6) !important;
        }

        /* === GLASS BUDGET SIDEBAR === */
        .trip-budget-sidebar {
            background: rgba(255, 255, 255, 0.03) !important;
            backdrop-filter: blur(20px) saturate(180%) !important;
            -webkit-backdrop-filter: blur(20px) saturate(180%) !important;
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4) !important;
            border-radius: 24px !important;
        }

        .trip-budget-header {
            border-bottom: 1px solid rgba(255, 255, 255, 0.08) !important;
        }

        .trip-budget-header h3 {
            color: #ffffff !important;
        }

        .trip-budget-header svg {
            color: #F7B500 !important;
        }

        .trip-budget-total {
            background: rgba(108, 93, 211, 0.15) !important;
            border: 1px solid rgba(108, 93, 211, 0.25) !important;
            border-radius: 20px !important;
        }

        .trip-budget-total .label {
            color: rgba(255, 255, 255, 0.6) !important;
        }

        .trip-budget-total .amount {
            background: linear-gradient(135deg, #F7B500 0%, #FFCC33 50%, #FFE066 100%) !important;
            -webkit-background-clip: text !important;
            -webkit-text-fill-color: transparent !important;
            background-clip: text !important;
            filter: drop-shadow(0 2px 4px rgba(247, 181, 0, 0.3)) !important;
        }

        .trip-budget-total .per-person {
            color: rgba(255, 255, 255, 0.5) !important;
        }

        .trip-budget-progress {
            background: rgba(255, 255, 255, 0.1) !important;
            border-radius: 10px !important;
        }

        .trip-budget-progress-bar {
            background: linear-gradient(90deg, #6C5DD3 0%, #8B78E6 50%, #F7B500 100%) !important;
        }

        .trip-budget-item {
            background: rgba(255, 255, 255, 0.04) !important;
            border: 1px solid rgba(255, 255, 255, 0.08) !important;
            border-radius: 16px !important;
        }

        .trip-budget-item:hover {
            background: rgba(108, 93, 211, 0.15) !important;
            border-color: rgba(108, 93, 211, 0.3) !important;
            box-shadow: 0 4px 20px rgba(108, 93, 211, 0.2) !important;
        }

        .trip-budget-item .category {
            color: rgba(255, 255, 255, 0.6) !important;
        }

        .trip-budget-item .price {
            color: #F7B500 !important;
        }

        .trip-budget-item .icon {
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3) !important;
        }

        .trip-ai-note {
            background: rgba(108, 93, 211, 0.1) !important;
            border: 1px solid rgba(108, 93, 211, 0.2) !important;
            color: rgba(255, 255, 255, 0.7) !important;
        }

        .trip-ai-note strong {
            color: #a78bfa !important;
        }

        /* === TIER TABS (GLASS DESIGN) === */
        .trip-tier-tabs {
            background: rgba(255, 255, 255, 0.04) !important;
            border: 1px solid rgba(255, 255, 255, 0.08) !important;
            border-radius: 20px !important;
            padding: 6px !important;
        }

        .trip-tier-tab {
            color: rgba(255, 255, 255, 0.6) !important;
            background: transparent !important;
        }

        .trip-tier-tab::before {
            background: rgba(255, 255, 255, 0.06) !important;
            border-radius: 14px !important;
        }

        .trip-tier-tab:hover {
            color: #a78bfa !important;
        }

        .trip-tier-tab.active {
            background: linear-gradient(135deg, #6C5DD3 0%, #8B78E6 100%) !important;
            color: #ffffff !important;
            box-shadow: 0 8px 30px rgba(108, 93, 211, 0.5) !important;
        }

        /* === MAIN ITINERARY PANEL (GLASS) === */
        .trip-itinerary-main {
            background: rgba(255, 255, 255, 0.03) !important;
            backdrop-filter: blur(20px) saturate(180%) !important;
            -webkit-backdrop-filter: blur(20px) saturate(180%) !important;
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4) !important;
            border-radius: 24px !important;
        }

        .trip-day-tabs {
            background: rgba(255, 255, 255, 0.02) !important;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08) !important;
        }

        .trip-day-tab {
            background: rgba(255, 255, 255, 0.04) !important;
            border: 1px solid rgba(255, 255, 255, 0.08) !important;
            color: rgba(255, 255, 255, 0.6) !important;
        }

        .trip-day-tab:hover {
            background: rgba(108, 93, 211, 0.15) !important;
            border-color: rgba(108, 93, 211, 0.3) !important;
            color: #a78bfa !important;
        }

        .trip-day-tab.active {
            background: linear-gradient(135deg, #6C5DD3 0%, #8B78E6 100%) !important;
            color: #ffffff !important;
            border-color: transparent !important;
            box-shadow: 0 4px 15px rgba(108, 93, 211, 0.4) !important;
        }

        .trip-title-bar {
            border-bottom: 1px solid rgba(255, 255, 255, 0.08) !important;
        }

        .trip-title-bar h2 {
            color: #ffffff !important;
        }

        .trip-year-badge {
            background: linear-gradient(135deg, #F7B500 0%, #FFCC33 100%) !important;
            color: #0a0a0f !important;
            font-weight: 700 !important;
        }

        /* === ACTIVITY CARDS (GLASS DESIGN) === */
        .trip-activity-card {
            background: rgba(255, 255, 255, 0.03) !important;
            backdrop-filter: blur(15px) !important;
            -webkit-backdrop-filter: blur(15px) !important;
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3) !important;
            border-radius: 20px !important;
        }

        .trip-activity-card:hover {
            background: rgba(108, 93, 211, 0.08) !important;
            border-color: rgba(108, 93, 211, 0.3) !important;
            box-shadow: 0 12px 40px rgba(108, 93, 211, 0.25) !important;
            transform: translateY(-4px) !important;
        }

        .trip-activity-number {
            background: linear-gradient(135deg, #6C5DD3 0%, #8B78E6 100%) !important;
            box-shadow: 0 6px 25px rgba(108, 93, 211, 0.5) !important;
        }

        .trip-activity-title {
            color: #ffffff !important;
        }

        .trip-activity-meta {
            color: rgba(255, 255, 255, 0.5) !important;
        }

        .trip-activity-meta span {
            color: rgba(255, 255, 255, 0.6) !important;
        }

        .trip-activity-description {
            color: rgba(255, 255, 255, 0.75) !important;
        }

        .trip-best-badge {
            background: linear-gradient(135deg, #F7B500 0%, #FFCC33 100%) !important;
            color: #0a0a0f !important;
        }

        .trip-rating {
            background: linear-gradient(135deg, #F7B500 0%, #FFCC33 100%) !important;
            color: #0a0a0f !important;
        }

        .trip-activity-image {
            border-radius: 16px !important;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4) !important;
        }

        /* === TRANSPORT CONNECTORS === */
        .trip-transport {
            color: rgba(255, 255, 255, 0.5) !important;
        }

        .trip-transport::before {
            background: linear-gradient(180deg, rgba(108, 93, 211, 0.3) 0%, rgba(139, 120, 230, 0.15) 100%) !important;
        }

        .trip-transport-icon {
            background: rgba(20, 20, 35, 0.9) !important;
            border: 2px solid rgba(108, 93, 211, 0.4) !important;
        }

        .trip-transport-text {
            color: #a78bfa !important;
        }

        /* === MAP PANEL (GLASS WITH GLOW) === */
        .trip-map-panel {
            background: rgba(255, 255, 255, 0.03) !important;
            backdrop-filter: blur(20px) saturate(180%) !important;
            -webkit-backdrop-filter: blur(20px) saturate(180%) !important;
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
            box-shadow:
                0 8px 32px rgba(0, 0, 0, 0.4),
                0 0 60px rgba(108, 93, 211, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.05) !important;
            border-radius: 24px !important;
            overflow: hidden !important;
        }

        .trip-map-header {
            background: rgba(255, 255, 255, 0.02) !important;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08) !important;
        }

        .trip-map-header h3 {
            color: #ffffff !important;
        }

        .trip-map-filter {
            background: rgba(255, 255, 255, 0.04) !important;
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
            color: rgba(255, 255, 255, 0.6) !important;
        }

        .trip-map-filter:hover {
            background: rgba(108, 93, 211, 0.2) !important;
            border-color: rgba(108, 93, 211, 0.4) !important;
            color: #a78bfa !important;
        }

        .trip-map-filter.active {
            background: linear-gradient(135deg, #6C5DD3 0%, #8B78E6 100%) !important;
            border-color: transparent !important;
            color: #ffffff !important;
        }

        .trip-map-container {
            border-radius: 0 0 24px 24px !important;
            overflow: hidden !important;
        }

        #itinerary-map {
            border-radius: 0 0 24px 24px !important;
        }

        /* === DAY CARDS (TIMELINE STYLE) === */
        .day-card {
            background: rgba(255, 255, 255, 0.03) !important;
            backdrop-filter: blur(15px) !important;
            -webkit-backdrop-filter: blur(15px) !important;
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3) !important;
            border-radius: 20px !important;
        }

        .day-card:hover {
            background: rgba(108, 93, 211, 0.06) !important;
            border-color: rgba(108, 93, 211, 0.25) !important;
            box-shadow: 0 15px 50px rgba(108, 93, 211, 0.2) !important;
        }

        .day-card h2 {
            color: #ffffff !important;
        }

        .day-card h3 {
            color: #a78bfa !important;
        }

        .day-card h4 {
            color: rgba(255, 255, 255, 0.9) !important;
        }

        .day-card p {
            color: rgba(255, 255, 255, 0.7) !important;
        }

        .day-cards-container::before {
            background: linear-gradient(180deg, #6C5DD3 0%, #8B78E6 50%, #F7B500 100%) !important;
        }

        .day-card::before {
            background: linear-gradient(135deg, #6C5DD3 0%, #8B78E6 100%) !important;
            box-shadow: 0 2px 15px rgba(108, 93, 211, 0.5) !important;
        }

        .day-number {
            background: linear-gradient(135deg, #6C5DD3 0%, #8B78E6 100%) !important;
            box-shadow: 0 4px 20px rgba(108, 93, 211, 0.5) !important;
        }

        /* === ITINERARY LISTS === */
        .itinerary-fullpage li,
        .trip-itinerary-main li {
            background: rgba(255, 255, 255, 0.04) !important;
            border: 1px solid rgba(255, 255, 255, 0.08) !important;
            border-left: 4px solid #6C5DD3 !important;
            color: rgba(255, 255, 255, 0.85) !important;
        }

        .itinerary-fullpage li:hover,
        .trip-itinerary-main li:hover {
            background: rgba(108, 93, 211, 0.1) !important;
            border-color: rgba(108, 93, 211, 0.3) !important;
            border-left-color: #8B78E6 !important;
        }

        .itinerary-fullpage li::before,
        .trip-itinerary-main li::before {
            background: linear-gradient(135deg, #6C5DD3 0%, #8B78E6 100%) !important;
        }

        /* === TIP CARDS === */
        .tip-card {
            background: rgba(247, 181, 0, 0.08) !important;
            border: 1px solid rgba(247, 181, 0, 0.2) !important;
            border-left: 4px solid #F7B500 !important;
            color: rgba(255, 255, 255, 0.85) !important;
            border-radius: 16px !important;
        }

        .tip-card::after {
            background: rgba(247, 181, 0, 0.1) !important;
        }

        /* === BUDGET TABLE === */
        .budget-box {
            background: rgba(108, 93, 211, 0.15) !important;
            border: none !important;
            box-shadow: 0 10px 40px rgba(108, 93, 211, 0.2) !important;
        }

        .budget-title {
            background: rgba(15, 15, 25, 0.9) !important;
            color: #ffffff !important;
        }

        .budget-table th {
            background: rgba(30, 30, 50, 0.9) !important;
            color: #ffffff !important;
        }

        .budget-table td {
            background: rgba(20, 20, 35, 0.9) !important;
            color: rgba(255, 255, 255, 0.85) !important;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05) !important;
        }

        .budget-table td:first-child {
            background: rgba(25, 25, 40, 0.95) !important;
            color: #ffffff !important;
        }

        .budget-table .price-budget {
            background: rgba(40, 167, 69, 0.2) !important;
            color: #4ade80 !important;
        }

        .budget-table .price-midrange {
            background: rgba(247, 181, 0, 0.2) !important;
            color: #F7B500 !important;
        }

        .budget-table .price-luxury {
            background: rgba(239, 68, 68, 0.2) !important;
            color: #f87171 !important;
        }

        /* === COMPACT SEARCH BAR === */
        .compact-search-bar {
            background: rgba(15, 15, 25, 0.9) !important;
            backdrop-filter: blur(20px) !important;
            -webkit-backdrop-filter: blur(20px) !important;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08) !important;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.4) !important;
        }

        .compact-search-bar .search-detail {
            background: rgba(255, 255, 255, 0.06) !important;
            color: rgba(255, 255, 255, 0.8) !important;
            border: 1px solid rgba(255, 255, 255, 0.08) !important;
        }

        .compact-search-bar .search-detail strong {
            color: #F7B500 !important;
        }

        .compact-search-bar .modify-search-btn {
            background: linear-gradient(135deg, #6C5DD3 0%, #8B78E6 100%) !important;
            box-shadow: 0 4px 20px rgba(108, 93, 211, 0.4) !important;
        }

        .compact-search-bar .modify-search-btn:hover {
            box-shadow: 0 6px 25px rgba(108, 93, 211, 0.6) !important;
        }

        /* === CUSTOM SCROLLBAR FOR DARK THEME === */
        .itinerary-fullpage::-webkit-scrollbar {
            width: 10px;
        }

        .itinerary-fullpage::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.02);
        }

        .itinerary-fullpage::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #6C5DD3 0%, #8B78E6 100%);
            border-radius: 10px;
            border: 2px solid rgba(10, 10, 15, 0.8);
        }

        .itinerary-fullpage::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #7c6de3 0%, #9b88f6 100%);
        }

        /* === FLOATING PARTICLES ANIMATION === */
        .itinerary-fullpage::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image:
                radial-gradient(2px 2px at 20px 30px, rgba(255, 255, 255, 0.15), transparent),
                radial-gradient(2px 2px at 40px 70px, rgba(139, 120, 230, 0.2), transparent),
                radial-gradient(1px 1px at 90px 40px, rgba(247, 181, 0, 0.15), transparent),
                radial-gradient(2px 2px at 130px 80px, rgba(255, 255, 255, 0.1), transparent),
                radial-gradient(1px 1px at 160px 120px, rgba(108, 93, 211, 0.2), transparent);
            background-size: 200px 150px;
            animation: particleDrift 60s linear infinite;
            pointer-events: none;
            z-index: 0;
            opacity: 0.5;
        }

        @keyframes particleDrift {
            0% {
                background-position: 0 0;
            }

            100% {
                background-position: 400px 300px;
            }
        }

        .itinerary-fullpage-content {
            position: relative;
            z-index: 1;
        }

        /* === GLOW EFFECTS FOR KEY ELEMENTS === */
        .trip-budget-total .amount {
            text-shadow: 0 0 30px rgba(247, 181, 0, 0.4) !important;
        }

        .trip-activity-number {
            animation: numberGlow 3s ease-in-out infinite alternate;
        }

        @keyframes numberGlow {
            0% {
                box-shadow: 0 6px 25px rgba(108, 93, 211, 0.5);
            }

            100% {
                box-shadow: 0 6px 35px rgba(139, 120, 230, 0.7);
            }
        }

        /* === EMPTY STATE === */
        .trip-empty-day {
            color: rgba(255, 255, 255, 0.5) !important;
            background: rgba(255, 255, 255, 0.02) !important;
            border: 1px dashed rgba(255, 255, 255, 0.1) !important;
            border-radius: 16px !important;
        }

        .trip-empty-day svg {
            color: rgba(108, 93, 211, 0.4) !important;
        }

        /* === LEAFLET MAP POPUP OVERRIDES === */
        .leaflet-popup-content-wrapper {
            background: rgba(20, 20, 35, 0.95) !important;
            backdrop-filter: blur(10px) !important;
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.5) !important;
        }

        .leaflet-popup-tip {
            background: rgba(20, 20, 35, 0.95) !important;
        }

        .map-popup-title {
            color: #ffffff !important;
        }

        .map-popup-meta {
            color: rgba(255, 255, 255, 0.6) !important;
        }

        /* === CUSTOM MAP MARKERS === */
        .trip-marker {
            background: linear-gradient(135deg, #6C5DD3 0%, #8B78E6 100%) !important;
            box-shadow: 0 4px 15px rgba(108, 93, 211, 0.5) !important;
        }

        .trip-marker.highlighted {
            box-shadow: 0 6px 25px rgba(108, 93, 211, 0.8), 0 0 40px rgba(247, 181, 0, 0.3) !important;
        }

        /* ==================== END ANTIGRAVITY THEME ==================== */

        /* ================================================================= */
        /* üèõÔ∏è PORCELAIN & GOLD THEME (CLASSIC LUXURY) */
        /* ================================================================= */

        /* 1. Warm Cream Background (Porcelain) */
        body,
        .itinerary-fullpage,
        .itinerary-fullpage-content {
            background: #FAFAF9 !important;
            /* Stone-50 / Warm White */
            color: #44403C !important;
            /* Warm Grey Text */
        }

        /* 2. Clean White Cards with Gold Borders */
        .trip-activity-card,
        .trip-budget-sidebar,
        .trip-map-panel,
        .compact-search-bar,
        .budget-box,
        .itinerary-container li,
        .day-card {
            background: #FFFFFF !important;
            backdrop-filter: none !important;
            border: 1px solid rgba(212, 175, 55, 0.3) !important;
            /* Champagne Gold 30% */
            box-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.08) !important;
            /* Soft Premium Shadow */
            border-radius: 12px !important;
            /* Slightly sharper corners for classic feel */
            color: #292524 !important;
        }

        /* Hover Effect for Cards */
        .trip-activity-card:hover {
            transform: translateY(-4px) !important;
            box-shadow: 0 20px 50px -10px rgba(212, 175, 55, 0.15) !important;
            border-color: rgba(212, 175, 55, 0.6) !important;
        }

        /* 3. Typography: Elegant Serif Headlines */
        h1,
        h2,
        h3,
        h4,
        .trip-activity-title,
        .nav-title,
        strong,
        .trip-budget-header h3 {
            font-family: 'Playfair Display', serif !important;
            /* Assuming font is available, or fallback to serif */
            color: #1C1917 !important;
            /* Deep Charcoal */
            letter-spacing: -0.02em !important;
            text-shadow: none !important;
        }

        /* Import Google Font if possible via CSS (might not work if blocked, but worth trying) */
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&display=swap');

        /* 4. Champagne Gold Buttons & Accents */
        .btn-main,
        .btn-book,
        #save-trip-btn,
        .modifier-search-btn,
        .trip-budget-total {
            background: linear-gradient(135deg, #D4AF37 0%, #C5A059 100%) !important;
            /* Metallic Gold */
            color: #FFFFFF !important;
            text-transform: uppercase !important;
            letter-spacing: 1px !important;
            font-size: 0.85rem !important;
            font-weight: 600 !important;
            border: none !important;
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3) !important;
        }

        .btn-main:hover,
        .btn-book:hover,
        #save-trip-btn:hover {
            background: linear-gradient(135deg, #E5C158 0%, #D4AF37 100%) !important;
            box-shadow: 0 6px 20px rgba(212, 175, 55, 0.4) !important;
        }

        /* 5. Gold Activity Numbers & Badges */
        .trip-activity-number,
        .trip-day-tab.active,
        .trip-year-badge {
            background: #D4AF37 !important;
            color: #FFFFFF !important;
            box-shadow: 0 4px 12px rgba(212, 175, 55, 0.4) !important;
            font-family: 'Playfair Display', serif !important;
        }

        /* 6. Active Tab Styling */
        .trip-day-tab {
            background: transparent !important;
            border: 1px solid #E7E5E4 !important;
            color: #78716C !important;
        }

        .trip-day-tab:hover {
            color: #D4AF37 !important;
            border-color: #D4AF37 !important;
        }

        /* 7. Map Panel Refinement */
        .trip-map-header {
            background: #F5F5F4 !important;
            border-bottom: 1px solid #E7E5E4 !important;
        }

        .trip-map-filter {
            background: #FFFFFF !important;
            border: 1px solid #D6D3D1 !important;
            color: #57534E !important;
        }

        .trip-map-filter.active {
            background: #D4AF37 !important;
            color: white !important;
            border-color: #D4AF37 !important;
        }

        /* 8. Text & Description Cleanups */
        .trip-activity-description,
        p,
        .trip-transport-text {
            color: #57534E !important;
            /* Stone-600 */
            font-family: system-ui, -apple-system, sans-serif !important;
            /* Clean sans for body */
            line-height: 1.7 !important;
        }

        .trip-transport-icon {
            background: #FAFAF9 !important;
            border-color: #D4AF37 !important;
            color: #D4AF37 !important;
        }

        /* 9. Scrollbar Gold */
        .itinerary-fullpage::-webkit-scrollbar-thumb {
            background: #D4AF37 !important;
            border-radius: 10px;
        }

        .itinerary-fullpage::-webkit-scrollbar-track {
            background: #F5F5F4 !important;
        }

        /* 10. Floating Navigation Bar */
        .itinerary-fullpage-nav {
            background: rgba(255, 255, 255, 0.95) !important;
            backdrop-filter: blur(10px) !important;
            border-bottom: 1px solid rgba(212, 175, 55, 0.2) !important;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.03) !important;
        }

        .itinerary-fullpage-nav .nav-title {
            color: #1C1917 !important;
        }

        /* 11. Landing Page & Header Fixes (White Theme) */
        header,
        .hero {
            background: #FAFAF9 !important;
            border-bottom: 1px solid rgba(212, 175, 55, 0.1) !important;
        }

        .logo {
            color: #1C1917 !important;
            text-shadow: none !important;
            font-family: 'Playfair Display', serif !important;
        }

        .hero h1 {
            color: #1C1917 !important;
            font-family: 'Playfair Display', serif !important;
            text-shadow: none !important;
        }

        .hero p {
            color: #57534E !important;
        }

        /* Navigation Links */
        nav a {
            color: #57534E !important;
        }

        nav a:hover {
            color: #D4AF37 !important;
        }

        /* Sign In Button */
        .btn-signin {
            background: linear-gradient(135deg, #D4AF37 0%, #C5A059 100%) !important;
            color: #FFFFFF !important;
            border: none !important;
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3) !important;
        }

        /* Search Overlay Light Theme */
        .search-overlay {
            background: #FAFAF9 !important;
        }

        .overlay-cancel {
            color: #1C1917 !important;
        }

        .airport-code {
            color: #1C1917 !important;
        }

        .airport-name {
            color: #78716C !important;
        }

        /* Flight Path Animation Colors */
        .flight-path-line {
            background: rgba(212, 175, 55, 0.2) !important;
        }

        .airplane-icon svg {
            fill: #D4AF37 !important;
        }

        /* ================================================================= */
        /* üó∫Ô∏è WIREFRAME LAYOUT OVERRIDES */
        /* ================================================================= */

        /* A. NAVIGATION BAR - Fixed, Dark Glassmorphism */
        header {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            z-index: 1000 !important;
            background: rgba(15, 23, 42, 0.85) !important;
            backdrop-filter: blur(20px) saturate(180%) !important;
            -webkit-backdrop-filter: blur(20px) saturate(180%) !important;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1) !important;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3) !important;
            padding: 0 5% !important;
            height: 70px !important;
        }

        .logo {
            color: #FFFFFF !important;
            font-weight: 700 !important;
            font-size: 1.5rem !important;
            text-shadow: none !important;
        }

        .btn-signin {
            background: linear-gradient(135deg, #D4AF37 0%, #C5A059 100%) !important;
            color: #FFFFFF !important;
            border: none !important;
            padding: 10px 24px !important;
            border-radius: 8px !important;
            font-weight: 600 !important;
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.4) !important;
            transition: all 0.3s ease !important;
        }

        .btn-signin:hover {
            transform: translateY(-2px) !important;
            box-shadow: 0 6px 20px rgba(212, 175, 55, 0.5) !important;
        }

        /* B. HERO SECTION - Deep Blue with Subtle Pattern */
        .hero {
            background:
                /* Subtle globe/map pattern overlay */
                radial-gradient(ellipse at 30% 20%, rgba(59, 130, 246, 0.15) 0%, transparent 50%),
                radial-gradient(ellipse at 70% 60%, rgba(99, 102, 241, 0.1) 0%, transparent 40%),
                radial-gradient(ellipse at 50% 80%, rgba(139, 92, 246, 0.08) 0%, transparent 50%),
                /* Abstract map lines pattern */
                repeating-linear-gradient(90deg,
                    transparent,
                    transparent 100px,
                    rgba(255, 255, 255, 0.02) 100px,
                    rgba(255, 255, 255, 0.02) 101px),
                repeating-linear-gradient(0deg,
                    transparent,
                    transparent 100px,
                    rgba(255, 255, 255, 0.02) 100px,
                    rgba(255, 255, 255, 0.02) 101px),
                /* Deep blue gradient */
                linear-gradient(135deg, #0f172a 0%, #1e3a5f 50%, #0f172a 100%) !important;
            padding: 150px 20px 100px !important;
            /* Extra top padding for fixed navbar */
            text-align: center !important;
            min-height: 45vh !important;
            display: flex !important;
            flex-direction: column !important;
            justify-content: center !important;
            align-items: center !important;
            position: relative !important;
        }

        /* Globe decoration pseudo-element */
        .hero::before {
            content: '' !important;
            position: absolute !important;
            top: 50% !important;
            left: 50% !important;
            transform: translate(-50%, -50%) !important;
            width: 400px !important;
            height: 400px !important;
            border: 1px solid rgba(255, 255, 255, 0.05) !important;
            border-radius: 50% !important;
            pointer-events: none !important;
        }

        .hero::after {
            content: '' !important;
            position: absolute !important;
            top: 50% !important;
            left: 50% !important;
            transform: translate(-50%, -50%) !important;
            width: 300px !important;
            height: 300px !important;
            border: 1px solid rgba(255, 255, 255, 0.03) !important;
            border-radius: 50% !important;
            pointer-events: none !important;
        }

        .hero h1 {
            color: #FFFFFF !important;
            font-family: 'Playfair Display', serif !important;
            font-size: 3.5rem !important;
            font-weight: 700 !important;
            margin-bottom: 15px !important;
            text-shadow: 0 4px 30px rgba(0, 0, 0, 0.3) !important;
            position: relative !important;
            z-index: 1 !important;
        }

        .hero p {
            color: rgba(255, 255, 255, 0.7) !important;
            font-size: 1.2rem !important;
            font-weight: 400 !important;
            position: relative !important;
            z-index: 1 !important;
        }

        /* C. COMMAND CENTER - Centered Card with Elevation */
        .container {
            max-width: 900px !important;
            margin: -60px auto 50px !important;
            /* Overlap with hero */
            padding: 0 20px !important;
            position: relative !important;
            z-index: 10 !important;
        }

        .tabs-nav {
            background: #FFFFFF !important;
            border-radius: 16px 16px 0 0 !important;
            box-shadow: 0 -10px 40px rgba(0, 0, 0, 0.1) !important;
            border-bottom: 2px solid #F5F5F4 !important;
            overflow: hidden !important;
        }

        .tab-btn {
            background: #FFFFFF !important;
            color: #57534E !important;
            font-weight: 600 !important;
            padding: 20px 15px !important;
            border: none !important;
            transition: all 0.3s ease !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            gap: 10px !important;
        }

        .tab-btn:hover {
            background: #FAFAF9 !important;
            color: #D4AF37 !important;
        }

        .tab-btn.active {
            color: #D4AF37 !important;
            background: #FAFAF9 !important;
            border-bottom: 3px solid #D4AF37 !important;
        }

        .tab-btn i,
        .tab-btn svg {
            font-size: 1.1rem !important;
            color: inherit !important;
        }

        .tab-content {
            background: #FFFFFF !important;
            border-radius: 0 0 16px 16px !important;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.12) !important;
            padding: 35px !important;
            border: 1px solid rgba(212, 175, 55, 0.1) !important;
            border-top: none !important;
        }

        /* Responsive adjustments for mobile */
        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2.2rem !important;
            }

            .hero {
                padding: 130px 15px 80px !important;
                min-height: 35vh !important;
            }

            .container {
                margin-top: -40px !important;
            }

            .tab-btn {
                padding: 15px 10px !important;
                font-size: 0.85rem !important;
            }
        }

        /* ================================================================= */
        /* üèõÔ∏è END PORCELAIN & GOLD THEME */
        /* ================================================================= */
    </style>
</head>

<body>

    <!-- Full-Page Search Overlay -->
    <div id="search-overlay" class="search-overlay">
        <!-- Decorative clouds -->
        <div class="cloud cloud-1"></div>
        <div class="cloud cloud-2"></div>
        <div class="cloud cloud-3"></div>

        <!-- Cancel button -->
        <button class="overlay-cancel" onclick="cancelSearch()">
            <i class="fas fa-times"></i> Cancel
        </button>

        <div class="overlay-content">
            <!-- Route display with animated plane -->
            <div class="route-display">
                <div class="airport-info">
                    <div class="airport-code" id="overlay-from">DEL</div>
                    <div class="airport-name" id="overlay-from-name">Departure</div>
                </div>

                <div class="flight-path-container">
                    <div class="flight-path-line"></div>
                    <div class="flight-path-dashes"></div>
                    <div class="airplane-icon">
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path transform="rotate(90 12 12)"
                                d="M21 16v-2l-8-5V3.5c0-.83-.67-1.5-1.5-1.5S10 2.67 10 3.5V9l-8 5v2l8-2.5V19l-2 1.5V22l3.5-1 3.5 1v-1.5L13 19v-5.5l8 2.5z" />
                        </svg>
                    </div>
                </div>

                <div class="airport-info">
                    <div class="airport-code" id="overlay-to">DXB</div>
                    <div class="airport-name" id="overlay-to-name">Arrival</div>
                </div>
            </div>

            <!-- Search info badges -->
            <div class="search-info" id="overlay-info">
                <div class="info-badge">
                    <i class="fas fa-calendar"></i>
                    <span id="overlay-date">Date</span>
                </div>
                <div class="info-badge">
                    <i class="fas fa-users"></i>
                    <span id="overlay-passengers">1 Passenger</span>
                </div>
                <div class="info-badge">
                    <i class="fas fa-chair"></i>
                    <span id="overlay-class">Economy</span>
                </div>
            </div>

            <!-- Progress section -->
            <div class="search-progress">
                <div class="progress-bar-container">
                    <div class="progress-bar-fill" id="progress-bar"></div>
                </div>
                <div class="search-status-text" id="search-status">Searching for best flights...</div>
                <div class="search-substatus" id="search-substatus">Connecting to airlines</div>
            </div>

            <!-- Partner logos -->
            <div class="partners-section">
                <div class="partners-label">Searching 100+ airlines and travel sites</div>
                <div class="partners-logos" id="partners-logos">
                    <div class="partner-logo">Air India</div>
                    <div class="partner-logo">IndiGo</div>
                    <div class="partner-logo">SpiceJet</div>
                    <div class="partner-logo">Emirates</div>
                    <div class="partner-logo">Vistara</div>
                </div>
            </div>
        </div>
    </div>

    <header>
        <a href="#" class="logo">VOYA üåç AI</a>
        <div class="header-actions">
            <!-- Sign In Button (shown when logged out) -->
            <button class="btn-signin" id="signin-btn" onclick="openAuthOverlay()">Sign In</button>
            <!-- User Profile (shown when logged in) -->
            <div class="user-profile" id="user-profile" style="display:none;">
                <div class="user-avatar" id="user-avatar" onclick="toggleUserMenu()"></div>
                <div class="user-menu" id="user-menu">
                    <div class="user-info">
                        <span class="user-name" id="user-name"></span>
                    </div>
                    <div class="menu-divider"></div>
                    <button class="menu-item" onclick="loadMyTrips()">
                        <i class="fas fa-suitcase"></i> My Trips
                    </button>
                    <button class="menu-item" onclick="handleSignOut()">
                        <i class="fas fa-sign-out-alt"></i> Sign Out
                    </button>
                </div>
            </div>
        </div>
    </header>



    <section class="hero">
        <h1>Travel Smarter with AI</h1>
        <p>Plan your perfect journey in seconds</p>
    </section>

    <div class="container">
        <div class="tabs-nav">
            <button class="tab-btn" onclick="openUnifiedOverlay('flights')">
                <i class="fas fa-plane"></i> Flights
            </button>
            <button class="tab-btn" onclick="openUnifiedOverlay('hotels')">
                <i class="fas fa-hotel"></i> Hotels
            </button>
            <button class="tab-btn active" onclick="openUnifiedOverlay('itinerary')">
                <i class="fas fa-robot"></i> AI Itinerary
            </button>
        </div>

        <!-- Flights Tab -->
        <div id="flights" class="tab-content">
            <!-- Trip Type Toggle (Google Flights Style) -->
            <div style="display:flex;gap:10px;margin-bottom:20px;flex-wrap:wrap;">
                <button type="button" class="trip-type-btn active" data-trip="roundtrip"
                    onclick="selectTripType('roundtrip')">
                    <i class="fas fa-exchange-alt"></i> Round Trip
                </button>
                <button type="button" class="trip-type-btn" data-trip="oneway" onclick="selectTripType('oneway')">
                    <i class="fas fa-long-arrow-alt-right"></i> One Way
                </button>
                <button type="button" class="trip-type-btn" data-trip="multicity" onclick="selectTripType('multicity')">
                    <i class="fas fa-route"></i> Multi-city
                </button>
            </div>
            <input type="hidden" id="flight-trip-type" value="roundtrip">

            <!-- Standard Search (One Way / Round Trip) -->
            <div id="standard-search">
                <!-- From / To Row -->
                <div class="search-grid" style="grid-template-columns: 1fr 1fr; margin-bottom: 15px;">
                    <div class="input-group">
                        <label>From <span class="required-indicator">*</span></label>
                        <div class="airport-input-container">
                            <input type="text" id="flight-from" placeholder="City or airport" autocomplete="off"
                                oninput="searchAirport(this, 'from-dropdown')"
                                onfocus="showRecentAirports('from-dropdown')"
                                style="font-size:1.1rem;padding:14px 16px;font-weight:500;">
                            <div id="from-dropdown" class="airport-autocomplete"></div>
                        </div>
                    </div>
                    <div class="input-group">
                        <label>To <span class="required-indicator">*</span></label>
                        <div class="airport-input-container">
                            <input type="text" id="flight-to" placeholder="City or airport" autocomplete="off"
                                oninput="searchAirport(this, 'to-dropdown')" onfocus="showRecentAirports('to-dropdown')"
                                style="font-size:1.1rem;padding:14px 16px;font-weight:500;">
                            <div id="to-dropdown" class="airport-autocomplete"></div>
                        </div>
                    </div>
                </div>
                <!-- Date Row - Separate side by side -->
                <div class="search-grid" style="grid-template-columns: 1fr 1fr; margin-bottom: 20px;">
                    <div class="input-group">
                        <label>Departure <span class="required-indicator">*</span></label>
                        <input type="date" id="flight-depart">
                    </div>
                    <div class="input-group" id="return-date-group">
                        <label>Return</label>
                        <input type="date" id="flight-return">
                    </div>
                </div>
            </div>

            <!-- Multi-city Search -->
            <div id="multicity-search" style="display:none;">
                <div id="multicity-legs">
                    <div class="multicity-leg" data-leg="1">
                        <div class="search-grid">
                            <div class="input-group">
                                <label>Flight 1 - From</label>
                                <input type="text" id="mc-from-1" placeholder="City or airport" autocomplete="off">
                            </div>
                            <div class="input-group">
                                <label>To</label>
                                <input type="text" id="mc-to-1" placeholder="City or airport" autocomplete="off">
                            </div>
                            <div class="input-group">
                                <label>Date</label>
                                <input type="date" id="mc-date-1">
                            </div>
                            <div class="input-group" style="display:flex;align-items:flex-end;">
                                <span style="color:#999;font-size:0.85rem;">Leg 1</span>
                            </div>
                        </div>
                    </div>
                    <div class="multicity-leg" data-leg="2">
                        <div class="search-grid">
                            <div class="input-group">
                                <label>Flight 2 - From</label>
                                <input type="text" id="mc-from-2" placeholder="City or airport" autocomplete="off">
                            </div>
                            <div class="input-group">
                                <label>To</label>
                                <input type="text" id="mc-to-2" placeholder="City or airport" autocomplete="off">
                            </div>
                            <div class="input-group">
                                <label>Date</label>
                                <input type="date" id="mc-date-2">
                            </div>
                            <div class="input-group" style="display:flex;align-items:flex-end;">
                                <button type="button" onclick="addMulticityLeg()"
                                    style="background:var(--accent-blue);color:#fff;border:none;padding:8px 12px;border-radius:6px;cursor:pointer;font-size:0.85rem;">
                                    <i class="fas fa-plus"></i> Add Flight
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <p style="color:#888;font-size:0.85rem;margin-top:10px;">
                    <i class="fas fa-info-circle"></i> Multi-city searches will open Google Flights in a new tab.
                </p>
            </div>

            <!-- Flight Filters -->
            <div class="search-grid" style="margin-bottom: 20px;">
                <div class="input-group">
                    <label>Travel Class</label>
                    <select id="flight-class">
                        <option value="1">Economy</option>
                        <option value="2">Premium Economy</option>
                        <option value="3">Business</option>
                        <option value="4">First Class</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Stops</label>
                    <select id="flight-stops">
                        <option value="0">Any stops</option>
                        <option value="1">Non-stop</option>
                        <option value="2">1 Stop</option>
                        <option value="3">2+ Stops</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Passengers</label>
                    <select id="flight-passengers">
                        <option value="1">1 Adult</option>
                        <option value="2">2 Adults</option>
                        <option value="3">3 Adults</option>
                        <option value="4">4 Adults</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Show</label>
                    <select id="flight-sort">
                        <option value="1">Best</option>
                        <option value="2">Cheapest</option>
                        <option value="3">Fastest</option>
                    </select>
                </div>
            </div>

            <button class="btn-main" onclick="handleFlightSearch()">
                <i class="fas fa-search"></i> Search Flights
            </button>

            <div id="flight-loader" class="loader" role="status" aria-label="Searching for flights">
                <div class="spinner" aria-hidden="true"></div>
                <p>Searching for best flight deals...</p>
                <div class="loader-dots">
                    <span></span><span></span><span></span>
                </div>
            </div>

            <div id="flight-results" class="results-area"></div>
        </div>

        <!-- Hotels Tab -->
        <div id="hotels" class="tab-content">
            <div class="search-grid">
                <div class="input-group" style="grid-column: span 2;">
                    <label>Destination <span class="required-indicator">*</span></label>
                    <input type="text" id="hotel-dest" placeholder="e.g., Dubai, Paris, New York">
                </div>
                <div class="input-group">
                    <label>Check-in <span class="required-indicator">*</span></label>
                    <input type="date" id="hotel-checkin">
                </div>
                <div class="input-group">
                    <label>Check-out <span class="required-indicator">*</span></label>
                    <input type="date" id="hotel-checkout">
                </div>
            </div>

            <!-- Hotel Filters -->
            <div class="search-grid" style="margin-bottom: 20px;">
                <div class="input-group">
                    <label>Guests</label>
                    <select id="hotel-guests">
                        <option value="1">1 Guest</option>
                        <option value="2" selected>2 Guests</option>
                        <option value="3">3 Guests</option>
                        <option value="4">4 Guests</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Rooms</label>
                    <select id="hotel-rooms">
                        <option value="1" selected>1 Room</option>
                        <option value="2">2 Rooms</option>
                        <option value="3">3 Rooms</option>
                    </select>
                </div>

                <div class="input-group">
                    <label>Sort By</label>
                    <select id="hotel-sort">
                        <option value="">Relevance</option>
                        <option value="3">Price (Low to High)</option>
                        <option value="8">Rating (High to Low)</option>
                        <option value="13">Most Reviewed</option>
                    </select>
                </div>
            </div>

            <button class="btn-main" onclick="handleHotelSearch()">
                <i class="fas fa-search"></i> Search Hotels
            </button>

            <div id="hotel-loader" class="loader" role="status" aria-label="Searching for hotels">
                <div class="spinner" aria-hidden="true"></div>
                <p>Finding best hotel deals...</p>
                <div class="loader-dots">
                    <span></span><span></span><span></span>
                </div>
            </div>

            <div id="hotel-results" class="results-area"></div>
        </div>

        <!-- AI Itinerary Tab -->
        <div id="ai-itinerary" class="tab-content" style="display: block;">
            <div class="search-grid">
                <div class="input-group" style="grid-column: span 2;">
                    <label>Destination <span class="required-indicator">*</span></label>
                    <input type="text" id="ai-dest" placeholder="e.g., Japan, Bali, Dubai">
                </div>
                <div class="input-group">
                    <label>Duration</label>
                    <input type="text" id="ai-days" placeholder="e.g. 5 days or 1 week">
                </div>
            </div>
            <div class="input-group" style="margin-bottom: 20px;">
                <label>Preferences</label>
                <textarea id="ai-prefs" rows="3" placeholder="Focus on food and culture..."></textarea>
            </div>
            <button class="btn-main" id="generate-btn" onclick="handleItinerarySearch()">
                <i class="fas fa-magic" id="generate-btn-icon"></i>
                <span id="generate-btn-text">Generate Trip</span>
            </button>

            <div id="ai-loader" class="loader" role="status" aria-label="Generating itinerary">
                <div class="spinner" aria-hidden="true"></div>
                <p>AI is crafting your perfect journey...</p>
                <div class="loader-dots">
                    <span></span><span></span><span></span>
                </div>
            </div>

        </div>
    </div>

    <!-- Nice Places to Visit - Travel Blog Section -->
    <section class="travel-blog-section">
        <div class="blog-container">
            <div class="blog-header">
                <h2>Nice places to visit</h2>
                <a href="javascript:void(0)" class="more-link">More <i class="fas fa-chevron-right"></i></a>
            </div>
            <div class="blog-scroll-container">
                <div class="blog-grid" id="blog-grid">
                    <!-- Blog cards will be populated by JavaScript -->
                </div>
                <button class="blog-scroll-btn right" onclick="scrollBlogCards(1)"><i
                        class="fas fa-chevron-right"></i></button>
            </div>
        </div>
    </section>

    <!-- Full-Page Blog Overlay -->
    <div id="blog-overlay" class="blog-overlay">
        <div class="blog-overlay-header">
            <button class="blog-back-btn" onclick="closeBlogOverlay()">
                <i class="fas fa-arrow-left"></i> Back
            </button>
            <div class="blog-share-actions">
                <button onclick="shareBlogArticle()"><i class="fas fa-share-alt"></i></button>
                <button onclick="saveBlogArticle()"><i class="far fa-bookmark"></i></button>
            </div>
        </div>
        <div class="blog-overlay-content" id="blog-overlay-content">
            <!-- Blog content will be dynamically populated -->
        </div>
    </div>

    <style>
        /* Nice Places to Visit - Travel Blog Styles */
        .travel-blog-section {
            padding: 50px 20px;
            background: linear-gradient(180deg, #FAFAF9 0%, #f0f4f8 100%);
        }

        .blog-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .blog-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 28px;
        }

        .blog-header h2 {
            font-family: 'Playfair Display', serif;
            font-size: 1.8rem;
            font-weight: 700;
            color: #1C1917;
            margin: 0;
            position: relative;
        }

        .blog-header h2::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 0;
            width: 60px;
            height: 3px;
            background: linear-gradient(90deg, #003580, #D4AF37);
            border-radius: 2px;
        }

        .blog-scroll-container {
            position: relative;
        }

        .blog-grid {
            display: flex;
            gap: 24px;
            overflow-x: auto;
            scroll-behavior: smooth;
            padding: 15px 5px 25px;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .blog-grid::-webkit-scrollbar {
            display: none;
        }

        .blog-card {
            flex: 0 0 320px;
            background: #fff;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .blog-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.18);
        }

        .blog-card-image {
            position: relative;
            height: 200px;
            overflow: hidden;
        }

        .blog-card-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }

        .blog-card:hover .blog-card-image img {
            transform: scale(1.1);
        }

        .blog-card-category {
            position: absolute;
            top: 15px;
            left: 15px;
            background: linear-gradient(135deg, #003580 0%, #0060FF 100%);
            color: #fff;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .blog-card-read-time {
            position: absolute;
            bottom: 15px;
            right: 15px;
            background: rgba(0, 0, 0, 0.7);
            color: #fff;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .blog-card-content {
            padding: 20px;
        }

        .blog-card-title {
            margin: 0 0 10px;
            font-size: 1.15rem;
            font-weight: 700;
            color: #1C1917;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .blog-card-excerpt {
            color: #666;
            font-size: 0.9rem;
            line-height: 1.6;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .blog-card-meta {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding-top: 15px;
            border-top: 1px solid #f0f0f0;
            margin-bottom: 2px;
        }

        .blog-card-action {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #f8f9fa;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--accent-blue);
            display: flex;
            align-items: center;
            gap: 5px;
            transition: gap 0.2s;
        }

        .blog-card:hover .blog-card-action {
            gap: 8px;
        }

        .blog-card-author {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .blog-card-author img {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            object-fit: cover;
        }

        .blog-card-author span {
            font-size: 0.85rem;
            color: #666;
            font-weight: 500;
        }

        .blog-card-date {
            font-size: 0.8rem;
            color: #999;
        }

        .blog-scroll-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 48px;
            height: 48px;
            background: #fff;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            color: #003580;
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.15);
            z-index: 10;
            transition: all 0.3s ease;
        }

        .blog-scroll-btn:hover {
            background: #003580;
            color: #fff;
            transform: translateY(-50%) scale(1.1);
        }

        .blog-scroll-btn.right {
            right: -15px;
        }

        /* Full-Page Blog Overlay Styles */
        .blog-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #fff;
            z-index: 15000;
            display: none;
            flex-direction: column;
            opacity: 0;
            transform: translateY(100%);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .blog-overlay.active {
            display: flex;
            opacity: 1;
            transform: translateY(0);
        }

        .blog-overlay-header {
            position: sticky;
            top: 0;
            background: #fff;
            padding: 15px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #eee;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .blog-back-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: #f5f5f5;
            border: none;
            border-radius: 25px;
            font-size: 0.95rem;
            font-weight: 600;
            color: #333;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .blog-back-btn:hover {
            background: #003580;
            color: #fff;
        }

        .blog-share-actions {
            display: flex;
            gap: 10px;
        }

        .blog-share-actions button {
            width: 42px;
            height: 42px;
            border: 1px solid #eee;
            background: #fff;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1rem;
            color: #666;
            transition: all 0.3s ease;
        }

        .blog-share-actions button:hover {
            background: #003580;
            color: #fff;
            border-color: #003580;
        }

        .blog-overlay-content {
            flex: 1;
            overflow-y: auto;
            padding: 0;
        }

        /* Blog Article Styles */
        .blog-article {
            max-width: 800px;
            margin: 0 auto;
            padding: 40px 20px 80px;
        }

        .blog-article-hero {
            width: 100vw;
            margin-left: calc(-50vw + 50%);
            height: 450px;
            position: relative;
            margin-bottom: 40px;
        }

        .blog-article-hero img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .blog-article-hero-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 60px 40px 40px;
            background: linear-gradient(transparent, rgba(0, 0, 0, 0.8));
        }

        .blog-article-hero-overlay h1 {
            color: #fff;
            font-family: 'Playfair Display', serif;
            font-size: 2.5rem;
            font-weight: 700;
            margin: 0;
            max-width: 800px;
            margin: 0 auto;
        }

        .blog-article-meta {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }

        .blog-article-author {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .blog-article-author img {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            border: 3px solid #003580;
        }

        .blog-article-author-info span {
            display: block;
        }

        .blog-article-author-info .author-name {
            font-weight: 700;
            color: #1C1917;
            font-size: 1rem;
        }

        .blog-article-author-info .author-title {
            font-size: 0.85rem;
            color: #666;
        }

        .blog-article-date {
            color: #888;
            font-size: 0.9rem;
        }

        .blog-article-body {
            font-size: 1.1rem;
            line-height: 1.9;
            color: #333;
        }

        .blog-article-body p {
            margin-bottom: 1.5em;
        }

        .blog-article-body h2 {
            font-family: 'Playfair Display', serif;
            font-size: 1.8rem;
            color: #1C1917;
            margin: 2em 0 1em;
        }

        .blog-article-body h3 {
            font-size: 1.4rem;
            color: #003580;
            margin: 1.5em 0 0.8em;
        }

        .blog-article-body img {
            width: 100%;
            border-radius: 16px;
            margin: 2em 0;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
        }

        .blog-article-body blockquote {
            background: linear-gradient(135deg, #f8f9ff 0%, #f0f4ff 100%);
            border-left: 4px solid #003580;
            padding: 25px 30px;
            margin: 2em 0;
            border-radius: 0 16px 16px 0;
            font-style: italic;
            color: #555;
        }

        .blog-article-body ul,
        .blog-article-body ol {
            padding-left: 1.5em;
            margin: 1.5em 0;
        }

        .blog-article-body li {
            margin-bottom: 0.8em;
        }

        .blog-article-tips {
            background: linear-gradient(135deg, #fff9e6 0%, #fff3cd 100%);
            border-radius: 16px;
            padding: 25px;
            margin: 2em 0;
        }

        .blog-article-tips h4 {
            color: #856404;
            margin: 0 0 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .blog-cta-section {
            background: linear-gradient(135deg, #003580 0%, #0060FF 100%);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            margin-top: 3em;
        }

        .blog-cta-section h3 {
            color: #fff;
            font-size: 1.6rem;
            margin: 0 0 15px;
        }

        .blog-cta-section p {
            color: rgba(255, 255, 255, 0.9);
            margin: 0 0 20px;
        }

        .blog-cta-btn {
            background: #D4AF37;
            color: #000;
            border: none;
            padding: 14px 35px;
            border-radius: 30px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .blog-cta-btn:hover {
            background: #fff;
            transform: scale(1.05);
        }

        @media (max-width: 768px) {
            .blog-header h2 {
                font-size: 1.4rem;
            }

            .blog-card {
                flex: 0 0 280px;
            }

            .blog-scroll-btn {
                display: none;
            }

            .blog-article-hero {
                height: 300px;
            }

            .blog-article-hero-overlay h1 {
                font-size: 1.6rem;
            }

            .blog-article {
                padding: 20px 15px 60px;
            }

            .blog-article-body {
                font-size: 1rem;
            }
        }
    </style>

    <script>
        // Travel Blog Data
        const travelBlogs = [
            {
                id: 1,
                title: "London: A Journey Through Time and Tea",
                image: "https://images.unsplash.com/photo-1513635269975-59663e0ac1ad?w=800&h=600&fit=crop",
                category: "Europe",
                excerpt: "Discover the magic of London, from historic landmarks to hidden gems. Experience the perfect blend of tradition and modernity.",
                author: "Sarah Mitchell",
                authorImg: "https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=100&h=100&fit=crop",
                date: "Jan 25, 2026",
                readTime: "8 min read",
                content: `
                    <p>London, a city where history whispers from every cobblestone and modernity gleams from towering glass structures, offers an experience like no other. Whether you're a first-time visitor or a returning traveler, the British capital never fails to surprise and delight.</p>
                    
                    <h2>The Iconic Landmarks</h2>
                    <p>No visit to London is complete without standing in awe before Big Ben and the Houses of Parliament. As the clock strikes the hour, you'll understand why this has been the heart of British democracy for centuries.</p>
                    
                    <img src="https://images.unsplash.com/photo-1529655683826-aba9b3e77383?w=800&h=500&fit=crop" alt="Big Ben at sunset">
                    
                    <p>The Tower of London, a UNESCO World Heritage site, holds nearly 1,000 years of history within its ancient walls. From royal residence to prison, the stories here will captivate you for hours.</p>
                    
                    <h2>Hidden Gems</h2>
                    <p>Beyond the famous attractions lie London's true treasures. Leadenhall Market, with its stunning Victorian architecture, was the inspiration for Diagon Alley in Harry Potter. Borough Market offers a feast for the senses with artisanal foods from around the world.</p>
                    
                    <blockquote>"London is a riddle. Paris is an explanation." ‚Äì G.K. Chesterton</blockquote>
                    
                    <h3>The Tea Experience</h3>
                    <p>Afternoon tea is more than a meal in London ‚Äì it's an institution. From the legendary Claridge's to cozy neighborhood tea rooms, this quintessentially British tradition is a must-try.</p>
                    
                    <div class="blog-article-tips">
                        <h4>üí° Pro Tips</h4>
                        <ul>
                            <li>Get an Oyster card for unlimited travel on the Tube</li>
                            <li>Visit museums early morning to avoid crowds</li>
                            <li>Book afternoon tea at least 2 weeks in advance</li>
                            <li>Don't miss the free walking tours for local insights</li>
                        </ul>
                    </div>
                `
            },
            {
                id: 2,
                title: "Singapore: Where Gardens Meet the Future",
                image: "https://images.unsplash.com/photo-1525625293386-3f8f99389edd?w=800&h=600&fit=crop",
                category: "Asia",
                excerpt: "Experience Singapore's perfect harmony of nature and innovation. From futuristic gardens to hawker centers, this city-state amazes at every turn.",
                author: "James Chen",
                authorImg: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100&h=100&fit=crop",
                date: "Jan 22, 2026",
                readTime: "7 min read",
                content: `
                    <p>Singapore, the Lion City, is proof that you can have it all ‚Äì world-class dining, stunning architecture, lush greenery, and a melting pot of cultures, all in one compact island nation.</p>
                    
                    <h2>Gardens by the Bay</h2>
                    <p>The Supertrees of Gardens by the Bay are more than Instagram-worthy structures ‚Äì they're vertical gardens that regulate temperature and generate solar power. At night, the Garden Rhapsody light show transforms them into a symphony of light and music.</p>
                    
                    <img src="https://images.unsplash.com/photo-1508964942454-1a56651d54ac?w=800&h=500&fit=crop" alt="Gardens by the Bay Supertrees">
                    
                    <h2>The Food Paradise</h2>
                    <p>Singapore's hawker centers are UNESCO-recognized for good reason. For just a few dollars, you can taste some of the world's best food ‚Äì from Hainanese chicken rice to chili crab, each dish tells a story of cultural fusion.</p>
                    
                    <blockquote>"In Singapore, food is almost a religion."</blockquote>
                    
                    <h3>Marina Bay Sands</h3>
                    <p>The iconic three-tower hotel with its rooftop infinity pool has become synonymous with modern Singapore. Even if you're not staying there, the view from the observation deck is worth every penny.</p>
                    
                    <div class="blog-article-tips">
                        <h4>üí° Pro Tips</h4>
                        <ul>
                            <li>Visit hawker centers during off-peak hours (2-5 PM)</li>
                            <li>Take the free light shows at Marina Bay every night</li>
                            <li>Use the MRT ‚Äì it's clean, efficient, and affordable</li>
                            <li>Carry an umbrella ‚Äì tropical showers are sudden</li>
                        </ul>
                    </div>
                `
            },
            {
                id: 3,
                title: "Paris: Beyond the Eiffel Tower",
                image: "https://images.unsplash.com/photo-1499856871958-5b9627545d1a?w=800&h=600&fit=crop",
                category: "Europe",
                excerpt: "Fall in love with the City of Light's lesser-known treasures. From secret passages to neighborhood bistros, discover the real Paris.",
                author: "Marie Dubois",
                authorImg: "https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=100&h=100&fit=crop",
                date: "Jan 20, 2026",
                readTime: "9 min read",
                content: `
                    <p>Paris is not just a city ‚Äì it's a feeling. Beyond the tourist crowds lies a Paris of hidden courtyards, neighborhood boulangeries, and intimate wine bars where locals share their secrets.</p>
                    
                    <h2>The Art of Fl√¢nerie</h2>
                    <p>The French have a word for aimless wandering ‚Äì fl√¢nerie. And Paris is the perfect city for it. Lose yourself in the winding streets of Le Marais, discover the covered passages of the 2nd arrondissement, or follow the Seine as it curves through the city.</p>
                    
                    <img src="https://images.unsplash.com/photo-1502602898657-3e91760cbb34?w=800&h=500&fit=crop" alt="Paris street scene">
                    
                    <h2>Beyond the Louvre</h2>
                    <p>While the Louvre is magnificent, Paris offers countless smaller museums that are equally enchanting. The Mus√©e de l'Orangerie houses Monet's water lilies in oval rooms designed specifically for them ‚Äì an immersive experience unlike any other.</p>
                    
                    <blockquote>"Paris is always a good idea." ‚Äì Audrey Hepburn</blockquote>
                    
                    <h3>The Caf√© Culture</h3>
                    <p>Sitting at a Parisian caf√© is not about the coffee ‚Äì it's about watching the world go by. Order an espresso, grab a terrace seat, and become part of the city's living artwork.</p>
                    
                    <div class="blog-article-tips">
                        <h4>üí° Pro Tips</h4>
                        <ul>
                            <li>Learn basic French phrases ‚Äì locals appreciate the effort</li>
                            <li>Visit major attractions at opening time or late afternoon</li>
                            <li>Book restaurants for dinner ‚Äì Parisians dine late</li>
                            <li>Take the Metro but walk between nearby stations</li>
                        </ul>
                    </div>
                `
            },
            {
                id: 4,
                title: "Dubai: Where Dreams Touch the Sky",
                image: "https://images.unsplash.com/photo-1512453979798-5ea266f8880c?w=800&h=600&fit=crop",
                category: "Middle East",
                excerpt: "From desert adventures to architectural marvels, Dubai redefines what's possible. Experience luxury and adventure in the city of superlatives.",
                author: "Ahmed Hassan",
                authorImg: "https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=100&h=100&fit=crop",
                date: "Jan 18, 2026",
                readTime: "6 min read",
                content: `
                    <p>Dubai is a city that defies expectations. Rising from the desert sands, it has transformed into a playground of architectural wonders, luxury experiences, and cultural discoveries.</p>
                    
                    <h2>The Burj Khalifa</h2>
                    <p>Standing at 828 meters, the Burj Khalifa isn't just the world's tallest building ‚Äì it's a testament to human ambition. The view from the 148th floor observation deck, especially at sunset, is absolutely breathtaking.</p>
                    
                    <img src="https://images.unsplash.com/photo-1518684079-3c830dcef090?w=800&h=500&fit=crop" alt="Dubai skyline">
                    
                    <h2>Desert Adventures</h2>
                    <p>Beyond the gleaming towers lies the vast Arabian desert. A desert safari takes you from dune bashing to camel rides, culminating in a traditional Bedouin camp dinner under the stars.</p>
                    
                    <blockquote>"Dubai is the city of the future, built today."</blockquote>
                    
                    <h3>Old Dubai</h3>
                    <p>The historic Al Fahidi neighborhood offers a glimpse into Dubai's past. Wind-tower architecture, narrow lanes, and traditional souks contrast beautifully with the modern metropolis.</p>
                    
                    <div class="blog-article-tips">
                        <h4>üí° Pro Tips</h4>
                        <ul>
                            <li>Visit between November and March for pleasant weather</li>
                            <li>Dress modestly in public areas and malls</li>
                            <li>Book Burj Khalifa tickets online to skip queues</li>
                            <li>Take the Metro ‚Äì it's the cheapest way to get around</li>
                        </ul>
                    </div>
                `
            },
            {
                id: 5,
                title: "Tokyo: Ancient Temples and Neon Dreams",
                image: "https://images.unsplash.com/photo-1540959733332-eab4deabeeaf?w=800&h=600&fit=crop",
                category: "Asia",
                excerpt: "Navigate Tokyo's fascinating contrasts ‚Äì from serene shrines to electric nightlife. Discover why this city captivates millions of visitors each year.",
                author: "Yuki Tanaka",
                authorImg: "https://images.unsplash.com/photo-1517841905240-472988babdf9?w=100&h=100&fit=crop",
                date: "Jan 15, 2026",
                readTime: "10 min read",
                content: `
                    <p>Tokyo is a city of contrasts that somehow coexist in perfect harmony. Ancient temples sit beside futuristic skyscrapers, and cutting-edge technology blends with centuries-old traditions.</p>
                    
                    <h2>The Soul of Tradition</h2>
                    <p>Begin your day at Senso-ji Temple in Asakusa, Tokyo's oldest temple. The morning light filtering through incense smoke, the sound of prayers, and the peaceful gardens offer a moment of zen in the bustling city.</p>
                    
                    <img src="https://images.unsplash.com/photo-1493976040374-85c8e12f0c0e?w=800&h=500&fit=crop" alt="Senso-ji Temple">
                    
                    <h2>The Pulse of Pop Culture</h2>
                    <p>From Akihabara's anime paradise to Harajuku's fashion revolution, Tokyo's pop culture is infectious. Don't miss the Robot Restaurant in Shinjuku for a truly unique (and delightfully bizarre) experience.</p>
                    
                    <blockquote>"Tokyo is the only city where you can feel completely lost and completely found at the same time."</blockquote>
                    
                    <h3>The Food Scene</h3>
                    <p>Tokyo has more Michelin stars than any other city in the world. But some of the best meals are found in tiny ramen shops and yakitori alleys, where decades of mastery create magic in every bite.</p>
                    
                    <div class="blog-article-tips">
                        <h4>üí° Pro Tips</h4>
                        <ul>
                            <li>Get a Suica card for seamless transportation</li>
                            <li>Visit shrines early morning for peaceful experiences</li>
                            <li>Try convenience store food ‚Äì it's surprisingly excellent</li>
                            <li>Book popular restaurants weeks in advance</li>
                        </ul>
                    </div>
                `
            },
            {
                id: 6,
                title: "Bali: Island of the Gods",
                image: "https://images.unsplash.com/photo-1537996194471-e657df975ab4?w=800&h=600&fit=crop",
                category: "Asia",
                excerpt: "Explore Bali's spiritual temples, emerald rice terraces, and hidden beaches. Find your own slice of paradise in Indonesia's most enchanting island.",
                author: "Wayan Surya",
                authorImg: "https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=100&h=100&fit=crop",
                date: "Jan 12, 2026",
                readTime: "8 min read",
                content: `
                    <p>Bali is more than a tropical paradise ‚Äì it's a spiritual journey. From the moment you arrive, the island's unique energy, vibrant ceremonies, and breathtaking landscapes capture your heart.</p>
                    
                    <h2>The Rice Terraces of Tegallalang</h2>
                    <p>The ancient subak irrigation system has created a landscape of cascading emerald steps. Walking through these terraces in the early morning mist is a meditative experience that connects you to Bali's agricultural heritage.</p>
                    
                    <img src="https://images.unsplash.com/photo-1604999333679-b86d54738315?w=800&h=500&fit=crop" alt="Bali rice terraces">
                    
                    <h2>Temple Treasures</h2>
                    <p>From the cliff-edge Uluwatu Temple to the water gardens of Tirta Empul, Bali's temples are windows into Hindu-Balinese spirituality. Witness a traditional dance performance as the sun sets over the Indian Ocean.</p>
                    
                    <blockquote>"Bali is not just a place, it's a mood, an aspiration, a tropical state of mind."</blockquote>
                    
                    <h3>Beyond Ubud</h3>
                    <p>While Ubud remains the cultural heart, venture to Sidemen for unspoiled rice terraces, or Amed for world-class diving. The real Bali reveals itself to those who explore.</p>
                    
                    <div class="blog-article-tips">
                        <h4>üí° Pro Tips</h4>
                        <ul>
                            <li>Rent a scooter for ultimate freedom (with caution)</li>
                            <li>Visit temples with proper attire ‚Äì sarongs available at entrances</li>
                            <li>Avoid Kuta if you want authentic Bali experiences</li>
                            <li>Stay in Ubud for culture, Seminyak for nightlife</li>
                        </ul>
                    </div>
                `
            }
        ];

        // Render Blog Cards
        function renderBlogCards() {
            const grid = document.getElementById('blog-grid');
            grid.innerHTML = travelBlogs.map(blog => `
                <div class="blog-card" onclick="openBlogArticle(${blog.id})">
                    <div class="blog-card-image">
                        <img src="${blog.image}" alt="${blog.title}" loading="lazy">
                        <span class="blog-card-category">${blog.category}</span>
                        <span class="blog-card-read-time"><i class="far fa-clock"></i> ${blog.readTime}</span>
                    </div>
                    <div class="blog-card-content">
                        <h3 class="blog-card-title">${blog.title}</h3>
                        <p class="blog-card-excerpt">${blog.excerpt}</p>
                        <div class="blog-card-meta">
                            <div class="blog-card-author">
                                <img src="${blog.authorImg}" alt="${blog.author}">
                                <span>${blog.author}</span>
                            </div>
                            <span class="blog-card-date">${blog.date}</span>
                        </div>
                        <div class="blog-card-action">
                            <span class="read-more-btn">Read blog <i class="fas fa-chevron-right"></i></span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Open Blog Article Overlay
        function openBlogArticle(id) {
            const blog = travelBlogs.find(b => b.id === id);
            if (!blog) return;

            const overlay = document.getElementById('blog-overlay');
            const content = document.getElementById('blog-overlay-content');

            content.innerHTML = `
                <div class="blog-article-hero">
                    <img src="${blog.image}" alt="${blog.title}">
                    <div class="blog-article-hero-overlay">
                        <h1>${blog.title}</h1>
                    </div>
                </div>
                <div class="blog-article">
                    <div class="blog-article-meta">
                        <div class="blog-article-author">
                            <img src="${blog.authorImg}" alt="${blog.author}">
                            <div class="blog-article-author-info">
                                <span class="author-name">${blog.author}</span>
                                <span class="author-title">Travel Writer</span>
                            </div>
                        </div>
                        <span class="blog-article-date">${blog.date} ¬∑ ${blog.readTime}</span>
                    </div>
                    <div class="blog-article-body">
                        ${blog.content}
                    </div>
                    <div class="blog-cta-section">
                        <h3>Ready to Explore ${blog.title.split(':')[0]}?</h3>
                        <p>Let VOYA AI create your perfect itinerary</p>
                        <button class="blog-cta-btn" onclick="closeBlogOverlay(); openUnifiedOverlay('itinerary'); document.getElementById('unified-ai-dest').value='${blog.title.split(':')[0]}';">
                            Plan My Trip <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
            `;

            overlay.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // Close Blog Overlay
        function closeBlogOverlay() {
            const overlay = document.getElementById('blog-overlay');
            overlay.classList.remove('active');
            document.body.style.overflow = '';
        }

        // Scroll Blog Cards
        function scrollBlogCards(direction) {
            const grid = document.getElementById('blog-grid');
            const scrollAmount = 350;
            grid.scrollBy({ left: scrollAmount * direction, behavior: 'smooth' });
        }

        // Share Blog Article
        function shareBlogArticle() {
            if (navigator.share) {
                navigator.share({
                    title: 'VOYA Travel Blog',
                    url: window.location.href
                });
            } else {
                showToast('Link copied to clipboard!', 'success');
            }
        }

        // Save Blog Article
        function saveBlogArticle() {
            showToast('Article saved to your reading list!', 'success');
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', renderBlogCards);
    </script>

    <!-- Full-Page Itinerary View -->
    <div id="itinerary-fullpage" class="itinerary-fullpage">
        <div class="itinerary-fullpage-nav">
            <button class="back-btn" onclick="closeFullPageItinerary()">
                <i class="fas fa-arrow-left"></i> Back to Search
            </button>
            <div class="nav-title" id="itinerary-nav-title">Your Itinerary</div>
            <div class="nav-actions">
                <button onclick="downloadItineraryPDF()">
                    <i class="fas fa-download"></i> Download PDF
                </button>
                <button onclick="shareItinerary()">
                    <i class="fas fa-share-alt"></i> Share
                </button>
            </div>
        </div>
        <div class="itinerary-fullpage-content" id="itinerary-fullpage-content">
            <!-- Itinerary content will be dynamically inserted here -->
        </div>
    </div>

    <!-- Full-Page Flights View -->
    <div id="flights-fullpage" class="itinerary-fullpage">
        <div class="itinerary-fullpage-nav">
            <button class="back-btn" onclick="closeFullPageFlights()">
                <i class="fas fa-arrow-left"></i> Back to Search
            </button>
            <div class="nav-title" id="flights-nav-title">Flight Results</div>
            <div class="nav-actions">
                <button onclick="window.print()">
                    <i class="fas fa-print"></i> Print
                </button>
            </div>
        </div>
        <div class="itinerary-fullpage-content" id="flights-fullpage-content">
            <!-- Flight results will be dynamically inserted here -->
        </div>
    </div>

    <!-- Full-Page Hotels View -->
    <div id="hotels-fullpage" class="itinerary-fullpage">
        <div class="itinerary-fullpage-nav">
            <button class="back-btn" onclick="closeFullPageHotels()">
                <i class="fas fa-arrow-left"></i> Back to Search
            </button>
            <div class="nav-title" id="hotels-nav-title">Hotel Results</div>
            <div class="nav-actions">
                <button onclick="window.print()">
                    <i class="fas fa-print"></i> Print
                </button>
            </div>
        </div>
        <div class="itinerary-fullpage-content" id="hotels-fullpage-content">
            <!-- Hotel results will be dynamically inserted here -->
        </div>
    </div>

    <!-- Full-Page Search Overlays -->



    <!-- ==================== UNIFIED TRIP.COM STYLE OVERLAY ==================== -->
    <div id="unified-search-overlay" class="unified-search-overlay">
        <!-- Sticky Header with Tabs -->
        <div class="unified-header">
            <div class="unified-header-inner">
                <div class="unified-logo">
                    <span class="logo-text">VOYA</span>
                    <span class="logo-ai">AI</span>
                </div>
                <div class="unified-tabs">
                    <button class="unified-tab active" data-tab="flights" onclick="switchUnifiedTab('flights')">
                        <i class="fas fa-plane"></i>
                        <span>Flights</span>
                    </button>
                    <button class="unified-tab" data-tab="hotels" onclick="switchUnifiedTab('hotels')">
                        <i class="fas fa-hotel"></i>
                        <span>Hotels</span>
                    </button>
                    <button class="unified-tab" data-tab="itinerary" onclick="switchUnifiedTab('itinerary')">
                        <i class="fas fa-route"></i>
                        <span>AI Itinerary</span>
                    </button>
                </div>
                <button class="unified-close-btn" onclick="closeUnifiedOverlay()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>

        <!-- Compact Search Bar -->
        <div class="unified-search-bar">
            <!-- Flights Search Form -->
            <div id="unified-flights-form" class="unified-form active">
                <div class="unified-form-row">
                    <div class="unified-input-group">
                        <i class="fas fa-plane-departure"></i>
                        <input type="text" id="unified-flight-from" placeholder="From" autocomplete="off">
                    </div>
                    <button class="swap-btn" onclick="swapFlightDestinations()">
                        <i class="fas fa-exchange-alt"></i>
                    </button>
                    <div class="unified-input-group">
                        <i class="fas fa-plane-arrival"></i>
                        <input type="text" id="unified-flight-to" placeholder="To" autocomplete="off">
                    </div>
                    <div class="unified-input-group date">
                        <i class="fas fa-calendar"></i>
                        <input type="date" id="unified-flight-depart">
                        <span class="date-separator">‚Äî</span>
                        <input type="date" id="unified-flight-return">
                    </div>
                    <div class="unified-input-group select">
                        <i class="fas fa-user"></i>
                        <select id="unified-flight-passengers">
                            <option value="1">1 Adult</option>
                            <option value="2">2 Adults</option>
                            <option value="3">3 Adults</option>
                            <option value="4">4 Adults</option>
                        </select>
                    </div>
                    <button class="unified-search-btn" onclick="handleUnifiedFlightSearch()">
                        <i class="fas fa-search"></i>
                        Search
                    </button>
                </div>
            </div>

            <!-- Hotels Search Form -->
            <div id="unified-hotels-form" class="unified-form">
                <div class="unified-form-row">
                    <div class="unified-input-group wide">
                        <i class="fas fa-map-marker-alt"></i>
                        <input type="text" id="unified-hotel-dest" placeholder="Destination">
                    </div>
                    <div class="unified-input-group date">
                        <i class="fas fa-calendar-check"></i>
                        <input type="date" id="unified-hotel-checkin">
                        <span class="date-separator">‚Äî</span>
                        <input type="date" id="unified-hotel-checkout">
                    </div>
                    <div class="unified-input-group select">
                        <i class="fas fa-users"></i>
                        <select id="unified-hotel-guests">
                            <option value="1">1 Guest</option>
                            <option value="2">2 Guests</option>
                            <option value="3">3 Guests</option>
                            <option value="4">4 Guests</option>
                        </select>
                    </div>
                    <div class="unified-input-group select">
                        <i class="fas fa-door-open"></i>
                        <select id="unified-hotel-rooms">
                            <option value="1">1 Room</option>
                            <option value="2">2 Rooms</option>
                            <option value="3">3 Rooms</option>
                        </select>
                    </div>
                    <button class="unified-search-btn" onclick="handleUnifiedHotelSearch()">
                        <i class="fas fa-search"></i>
                        Search
                    </button>
                </div>
            </div>

            <!-- AI Itinerary Search Form -->
            <div id="unified-itinerary-form" class="unified-form">
                <div class="unified-form-row">
                    <div class="unified-input-group wide">
                        <i class="fas fa-globe"></i>
                        <input type="text" id="unified-ai-dest" placeholder="Where do you want to go?">
                    </div>
                    <div class="unified-input-group">
                        <i class="fas fa-clock"></i>
                        <input type="text" id="unified-ai-days" placeholder="Duration (e.g., 5 days)">
                    </div>
                    <div class="unified-input-group select">
                        <i class="fas fa-wallet"></i>
                        <select id="unified-ai-budget">
                            <option value="budget">Budget</option>
                            <option value="midrange" selected>Standard</option>
                            <option value="luxury">Luxury</option>
                        </select>
                    </div>
                    <div class="unified-input-group wide">
                        <i class="fas fa-heart"></i>
                        <input type="text" id="unified-ai-prefs"
                            placeholder="Preferences (e.g., Food, Culture, Adventure...)">
                    </div>
                    <button class="unified-search-btn ai" onclick="handleUnifiedItinerarySearch()">
                        <i class="fas fa-magic"></i>
                        Generate
                    </button>
                </div>
            </div>
        </div>

        <!-- Results Area (Full Page) -->
        <div class="unified-results-wrapper">
            <!-- Left Sidebar - Filters -->
            <div class="unified-sidebar" id="unified-sidebar">
                <!-- Filters will be dynamically populated based on active tab -->
                <div class="sidebar-section" id="unified-filters">
                    <!-- Dynamic filter content -->
                </div>
            </div>

            <!-- Main Results Area -->
            <div class="unified-results" id="unified-results">
                <!-- Skeleton loader -->
                <div id="unified-skeleton" class="unified-skeleton" style="display:none;">
                    <div class="skeleton-card">
                        <div class="skeleton-line long"></div>
                        <div class="skeleton-line medium"></div>
                        <div class="skeleton-line short"></div>
                    </div>
                    <div class="skeleton-card">
                        <div class="skeleton-line long"></div>
                        <div class="skeleton-line medium"></div>
                        <div class="skeleton-line short"></div>
                    </div>
                    <div class="skeleton-card">
                        <div class="skeleton-line long"></div>
                        <div class="skeleton-line medium"></div>
                        <div class="skeleton-line short"></div>
                    </div>
                </div>

                <!-- placeholder when no results -->
                <div id="unified-placeholder" class="unified-placeholder">
                    <i class="fas fa-search"></i>
                    <h3>Start Your Journey</h3>
                    <p>Search for flights, hotels, or let AI plan your perfect itinerary</p>
                </div>

                <!-- Actual results container -->
                <div id="unified-results-content"></div>
            </div>
        </div>
    </div>

    <style>
        /* ==================== UNIFIED TRIP.COM STYLE OVERLAY ==================== */
        .unified-search-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #f5f7fa;
            z-index: 10000;
            display: none;
            flex-direction: column;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .unified-search-overlay.active {
            display: flex;
            opacity: 1;
        }

        /* Header */
        .unified-header {
            background: linear-gradient(135deg, #0f172a 0%, #1a2d4a 100%);
            padding: 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .unified-header-inner {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 30px;
        }

        .unified-logo {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .unified-logo .logo-text {
            font-size: 1.8rem;
            font-weight: 800;
            color: #fff;
            letter-spacing: -1px;
        }

        .unified-logo .logo-ai {
            font-size: 1rem;
            font-weight: 600;
            color: #D4AF37;
            background: rgba(212, 175, 55, 0.1);
            padding: 4px 8px;
            border-radius: 6px;
        }

        .unified-tabs {
            display: flex;
            gap: 8px;
        }

        .unified-tab {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 24px;
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid transparent;
            border-radius: 12px;
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .unified-tab:hover {
            background: rgba(255, 255, 255, 0.12);
            color: #fff;
        }

        .unified-tab.active {
            background: #fff;
            color: #003580;
            border-color: #fff;
        }

        .unified-tab i {
            font-size: 1.1rem;
        }

        .unified-close-btn {
            width: 44px;
            height: 44px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            color: #fff;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .unified-close-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: rotate(90deg);
        }

        /* Search Bar */
        .unified-search-bar {
            background: #fff;
            padding: 20px 30px;
            border-bottom: 1px solid #e0e0e0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .unified-form {
            display: none;
            max-width: 1400px;
            margin: 0 auto;
        }

        .unified-form.active {
            display: block;
        }

        .unified-form-row {
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
        }

        .unified-input-group {
            display: flex;
            align-items: center;
            gap: 10px;
            background: #f5f7fa;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 12px 16px;
            flex: 1;
            min-width: 150px;
            transition: all 0.3s ease;
        }

        .unified-input-group:focus-within {
            border-color: #003580;
            box-shadow: 0 0 0 3px rgba(0, 53, 128, 0.1);
        }

        .unified-input-group.wide {
            flex: 2;
            min-width: 250px;
        }

        .unified-input-group.date {
            min-width: 180px;
            flex: 1.5;
            flex-wrap: wrap;
        }

        .unified-input-group.date input[type="date"] {
            min-width: 110px;
            max-width: 130px;
        }

        .unified-input-group.select {
            min-width: 140px;
            flex: 0.7;
        }

        .unified-input-group i {
            color: #003580;
            font-size: 1rem;
        }

        .unified-input-group input,
        .unified-input-group select {
            border: none;
            background: transparent;
            font-size: 0.95rem;
            font-weight: 500;
            color: #333;
            width: 100%;
            outline: none;
        }

        .unified-input-group input::placeholder {
            color: #999;
        }

        .date-separator {
            color: #ccc;
            font-size: 0.9rem;
        }

        .swap-btn {
            width: 40px;
            height: 40px;
            border: 2px solid #e0e0e0;
            background: #fff;
            border-radius: 50%;
            color: #003580;
            cursor: pointer;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .swap-btn:hover {
            background: #003580;
            color: #fff;
            border-color: #003580;
            transform: rotate(180deg);
        }

        .unified-search-btn {
            background: linear-gradient(135deg, #003580 0%, #00509e 100%);
            color: #fff;
            border: none;
            padding: 14px 32px;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .unified-search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 53, 128, 0.35);
        }

        .unified-search-btn.ai {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .unified-search-btn.ai:hover {
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        /* Results Wrapper */
        .unified-results-wrapper {
            display: flex;
            flex: 1;
            overflow: hidden;
            max-width: 1600px;
            margin: 0 auto;
            width: 100%;
            padding: 20px 30px;
            gap: 24px;
        }

        /* Sidebar */
        .unified-sidebar {
            width: 280px;
            background: #fff;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            height: fit-content;
            max-height: calc(100vh - 200px);
            overflow-y: auto;
            flex-shrink: 0;
        }

        .sidebar-section h4 {
            font-size: 1rem;
            font-weight: 700;
            color: #1a1a2e;
            margin: 0 0 15px 0;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }

        .sidebar-filter {
            margin-bottom: 20px;
        }

        .sidebar-filter label {
            display: block;
            font-size: 0.85rem;
            font-weight: 600;
            color: #666;
            margin-bottom: 8px;
        }

        .sidebar-filter select,
        .sidebar-filter input[type="range"] {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 0.9rem;
        }

        /* Results */
        .unified-results {
            flex: 1;
            overflow-y: auto;
            padding-right: 10px;
        }

        .unified-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 400px;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            color: #999;
        }

        .unified-placeholder i {
            font-size: 4rem;
            margin-bottom: 20px;
            color: #ddd;
        }

        .unified-placeholder h3 {
            font-size: 1.5rem;
            color: #333;
            margin: 0 0 10px 0;
        }

        .unified-placeholder p {
            font-size: 1rem;
            color: #888;
        }

        /* Skeleton */
        .unified-skeleton .skeleton-card {
            background: #fff;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }

        @media (max-width: 1024px) {
            .unified-sidebar {
                display: none;
            }

            .unified-form-row {
                flex-direction: column;
            }

            .unified-input-group {
                width: 100%;
            }

            .unified-tabs {
                gap: 4px;
            }

            .unified-tab span {
                display: none;
            }

            .unified-tab {
                padding: 12px 16px;
            }
        }

        /* Skeleton Animation */
        .skeleton-line {
            height: 14px;
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: skeleton-shimmer 1.5s infinite;
            border-radius: 4px;
            margin-bottom: 12px;
        }

        .skeleton-line.long {
            width: 100%;
        }

        .skeleton-line.medium {
            width: 70%;
        }

        .skeleton-line.short {
            width: 40%;
        }

        @keyframes skeleton-shimmer {
            0% {
                background-position: 200% 0;
            }

            100% {
                background-position: -200% 0;
            }
        }

        /* Fade-in Animation */
        .fade-in {
            animation: fadeInUp 0.5s ease forwards;
            opacity: 0;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Error Message */
        .error-message {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px 30px;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            text-align: center;
        }

        .error-message i {
            font-size: 3rem;
            color: #dc3545;
            margin-bottom: 20px;
        }

        .error-message p {
            color: #666;
            font-size: 1rem;
            max-width: 400px;
        }

        /* Button Styles for Overlay */
        .btn-book {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 0.95rem;
            font-weight: 600;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-book:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }

        .btn-outline {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            background: transparent;
            border: 2px solid #003580;
            border-radius: 10px;
            color: #003580;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-outline:hover {
            background: #003580;
            color: #fff;
        }

        /* Flight/Hotel Card Header */
        .flight-header,
        .hotel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .price-tag {
            font-size: 1.4rem;
            font-weight: 700;
            color: #003580;
        }

        /* Toast notification styles */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            padding: 16px 24px;
            background: #333;
            color: #fff;
            border-radius: 10px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
            z-index: 100000;
            animation: slideInRight 0.3s ease;
        }

        .toast.error {
            background: #dc3545;
        }

        .toast.success {
            background: #28a745;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* ==================== PREMIUM AUTH OVERLAY STYLES ==================== */
        .auth-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.95);
            z-index: 10000;
            display: none;
            animation: authFadeIn 0.4s ease;
        }

        .auth-overlay.active {
            display: flex;
        }

        @keyframes authFadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        /* Split Screen Container */
        .auth-container {
            display: flex;
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden;
        }

        /* Left Side - Hero Image */
        .auth-hero {
            flex: 1;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 60px;
            background:
                linear-gradient(135deg, rgba(102, 126, 234, 0.4) 0%, rgba(118, 75, 162, 0.4) 50%, rgba(15, 52, 96, 0.8) 100%),
                url('https://images.unsplash.com/photo-1506929562872-bb421503ef21?w=1200&q=80') center/cover;
            overflow: hidden;
        }

        .auth-hero::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.3) 0%, rgba(118, 75, 162, 0.5) 100%);
            animation: heroGradientShift 8s ease-in-out infinite;
        }

        @keyframes heroGradientShift {

            0%,
            100% {
                opacity: 0.8;
            }

            50% {
                opacity: 0.4;
            }
        }

        .auth-hero-content {
            position: relative;
            z-index: 2;
            max-width: 500px;
        }

        .auth-hero-logo {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 40px;
        }

        .auth-hero-logo .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: 0 8px 30px rgba(102, 126, 234, 0.4);
        }

        .auth-hero-logo .logo-text {
            font-size: 2rem;
            font-weight: 800;
            color: #fff;
            letter-spacing: -1px;
        }

        .auth-hero-logo .logo-ai {
            background: linear-gradient(135deg, #D4AF37, #FFD700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 1.8rem;
            font-weight: 800;
        }

        .auth-hero-quote {
            font-size: 3.5rem;
            font-weight: 300;
            color: #fff;
            line-height: 1.2;
            margin-bottom: 20px;
            text-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
        }

        .auth-hero-quote span {
            font-weight: 700;
            background: linear-gradient(135deg, #fff 0%, #D4AF37 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .auth-hero-tagline {
            font-size: 1.2rem;
            color: rgba(255, 255, 255, 0.8);
            max-width: 400px;
        }

        .auth-hero-features {
            display: flex;
            gap: 30px;
            margin-top: 50px;
        }

        .auth-hero-feature {
            display: flex;
            align-items: center;
            gap: 10px;
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.95rem;
        }

        .auth-hero-feature i {
            color: #D4AF37;
            font-size: 1.1rem;
        }

        /* Floating Elements Animation */
        .auth-hero-float {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            animation: floatUpDown 6s ease-in-out infinite;
        }

        .auth-hero-float:nth-child(1) {
            width: 100px;
            height: 100px;
            bottom: 15%;
            right: 20%;
            animation-delay: 0s;
        }

        .auth-hero-float:nth-child(2) {
            width: 60px;
            height: 60px;
            bottom: 35%;
            right: 10%;
            animation-delay: 2s;
        }

        .auth-hero-float:nth-child(3) {
            width: 40px;
            height: 40px;
            bottom: 25%;
            right: 35%;
            animation-delay: 4s;
        }

        @keyframes floatUpDown {

            0%,
            100% {
                transform: translateY(0) rotate(0deg);
            }

            50% {
                transform: translateY(-20px) rotate(5deg);
            }
        }

        /* Right Side - Auth Panel */
        .auth-panel {
            width: 480px;
            min-width: 480px;
            height: 100%;
            background: linear-gradient(180deg, rgba(22, 33, 62, 0.98) 0%, rgba(26, 26, 46, 0.99) 100%);
            backdrop-filter: blur(20px);
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 50px;
            position: relative;
            overflow-y: auto;
            box-shadow: -20px 0 60px rgba(0, 0, 0, 0.5);
        }

        .auth-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 3px;
            height: 100%;
            background: linear-gradient(180deg, #667eea 0%, #764ba2 50%, #D4AF37 100%);
        }

        .auth-close {
            position: absolute;
            top: 25px;
            right: 25px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #888;
            width: 44px;
            height: 44px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1.4rem;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .auth-close:hover {
            background: rgba(255, 255, 255, 0.15);
            color: #fff;
            transform: rotate(90deg);
        }

        .auth-header {
            text-align: left;
            margin-bottom: 35px;
        }

        .auth-header h2 {
            color: #fff;
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 10px;
            letter-spacing: -0.5px;
        }

        .auth-header p {
            color: #8892a0;
            font-size: 1rem;
            line-height: 1.5;
        }

        .auth-tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 14px;
            padding: 5px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .auth-tab {
            flex: 1;
            padding: 14px 24px;
            border: none;
            background: transparent;
            color: #6b7280;
            font-weight: 600;
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.3s ease;
            font-size: 0.95rem;
        }

        .auth-tab:hover {
            color: #a5b4fc;
        }

        .auth-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
            animation: authSlideIn 0.4s ease;
        }

        @keyframes authSlideIn {
            from {
                opacity: 0;
                transform: translateX(20px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .auth-input-group {
            margin-bottom: 22px;
            position: relative;
        }

        .auth-input-group label {
            display: block;
            color: #9ca3af;
            font-size: 0.85rem;
            margin-bottom: 10px;
            font-weight: 500;
            letter-spacing: 0.3px;
        }

        .auth-input-wrapper {
            position: relative;
        }

        .auth-input-wrapper i {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: #6b7280;
            font-size: 1rem;
            transition: color 0.3s;
        }

        .auth-input-group input {
            width: 100%;
            padding: 16px 16px 16px 48px;
            border: 2px solid rgba(255, 255, 255, 0.08);
            border-radius: 14px;
            background: rgba(255, 255, 255, 0.04);
            color: #fff;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .auth-input-group input:focus {
            outline: none;
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.08);
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        .auth-input-group input:focus+i,
        .auth-input-wrapper:focus-within i {
            color: #667eea;
        }

        .auth-input-group input::placeholder {
            color: #4b5563;
        }

        .auth-forgot-link {
            display: block;
            text-align: right;
            color: #667eea;
            font-size: 0.85rem;
            text-decoration: none;
            margin-top: -10px;
            margin-bottom: 20px;
            transition: color 0.3s;
        }

        .auth-forgot-link:hover {
            color: #818cf8;
            text-decoration: underline;
        }

        .auth-submit {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .auth-submit::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .auth-submit:hover::before {
            left: 100%;
        }

        .auth-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .auth-submit:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .auth-divider {
            display: flex;
            align-items: center;
            margin: 28px 0;
            color: #4b5563;
            font-size: 0.85rem;
        }

        .auth-divider::before,
        .auth-divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
        }

        .auth-divider span {
            padding: 0 18px;
        }

        .google-signin-btn {
            width: 100%;
            padding: 15px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 14px;
            background: rgba(255, 255, 255, 0.98);
            color: #1f2937;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            transition: all 0.3s ease;
        }

        .google-signin-btn:hover {
            background: #fff;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .google-signin-btn svg {
            width: 22px;
            height: 22px;
        }

        .auth-footer {
            text-align: center;
            margin-top: 30px;
            color: #6b7280;
            font-size: 0.9rem;
        }

        .auth-footer a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
            transition: color 0.3s;
        }

        .auth-footer a:hover {
            color: #818cf8;
            text-decoration: underline;
        }

        .auth-error {
            background: rgba(239, 68, 68, 0.15);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #fca5a5;
            padding: 14px 18px;
            border-radius: 12px;
            margin-bottom: 20px;
            font-size: 0.9rem;
            display: none;
            align-items: center;
            gap: 10px;
        }

        .auth-error::before {
            content: '‚ö†Ô∏è';
        }

        .auth-error.show {
            display: flex;
            animation: authShake 0.5s ease;
        }

        @keyframes authShake {

            0%,
            100% {
                transform: translateX(0);
            }

            20%,
            60% {
                transform: translateX(-8px);
            }

            40%,
            80% {
                transform: translateX(8px);
            }
        }

        .auth-success {
            background: rgba(34, 197, 94, 0.15);
            border: 1px solid rgba(34, 197, 94, 0.3);
            color: #86efac;
            padding: 14px 18px;
            border-radius: 12px;
            margin-bottom: 20px;
            font-size: 0.9rem;
            display: none;
            align-items: center;
            gap: 10px;
        }

        .auth-success::before {
            content: '‚úì';
            font-weight: bold;
        }

        .auth-success.show {
            display: flex;
            animation: authFadeIn 0.3s ease;
        }

        /* Mobile Responsive */
        @media (max-width: 1024px) {
            .auth-hero {
                display: none;
            }

            .auth-panel {
                width: 100%;
                min-width: unset;
                max-width: 500px;
                margin: auto;
                height: auto;
                min-height: 100%;
                border-radius: 0;
            }

            .auth-panel::before {
                display: none;
            }
        }

        @media (max-width: 480px) {
            .auth-panel {
                padding: 30px 25px;
            }

            .auth-header h2 {
                font-size: 1.8rem;
            }

            .auth-hero-quote {
                font-size: 2.5rem;
            }
        }

        /* User profile dropdown */
        .user-profile-dropdown {
            position: relative;
        }

        .user-avatar-btn {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 50px;
            cursor: pointer;
            color: #fff;
            transition: all 0.3s;
        }

        .user-avatar-btn:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .user-avatar-btn img {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            object-fit: cover;
        }

        .user-avatar-btn .user-name {
            font-weight: 500;
            max-width: 120px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .user-dropdown-menu {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 10px;
            background: #1a1a2e;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
            min-width: 200px;
            display: none;
            overflow: hidden;
            z-index: 1001;
        }

        .user-dropdown-menu.show {
            display: block;
            animation: fadeIn 0.2s ease;
        }

        .user-dropdown-menu a,
        .user-dropdown-menu button {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 20px;
            color: #ccc;
            text-decoration: none;
            font-size: 0.95rem;
            border: none;
            background: transparent;
            width: 100%;
            cursor: pointer;
            transition: all 0.2s;
        }

        .user-dropdown-menu a:hover,
        .user-dropdown-menu button:hover {
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
        }

        .user-dropdown-menu button.logout-btn {
            color: #ff6b6b;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
    </style>

    <script>
        // ====================================================================================
        // VOYA AI Frontend - Security Hardened
        // SECURITY: No API keys should EVER be stored in client-side code
        // All API calls go through the secure backend
        // ====================================================================================

        // ==================== MULTI-BACKEND LOAD BALANCING ====================
        // Round-robin between Supabase and Convex, with AWS Lambda as fallback
        const BACKENDS = {
            supabase: 'https://tgrconhncsvfwmdnfsgf.supabase.co/functions/v1/swift-api',
            convex: 'https://lovely-koala-415.eu-west-1.convex.site',
            awsFallback: 'https://v7zixtn6d5c4xae376p7oezlbm0vkdop.lambda-url.eu-north-1.on.aws', // AWS Lambda fallback
            // Legacy aliases
            primary: 'https://tgrconhncsvfwmdnfsgf.supabase.co/functions/v1/swift-api',
            secondary: 'https://lovely-koala-415.eu-west-1.convex.site'
        };

        // Backend order for round-robin (alternates between Supabase and Convex)
        const BACKEND_ORDER = ['supabase', 'convex'];

        // Track which backend to use next (persisted in localStorage)
        let backendToggle = parseInt(localStorage.getItem('voya_backend_toggle') || '0');

        // Health cache to skip unhealthy backends
        const backendHealth = {
            supabase: { healthy: true, lastCheck: 0 },
            convex: { healthy: true, lastCheck: 0 }
        };
        const HEALTH_CHECK_INTERVAL = 5000; // 5 seconds

        /**
         * Get the next API base URL using round-robin
         * Alternates between Supabase and Convex for each request
         * @returns {object} - { name: string, url: string }
         */
        function getNextBackend() {
            const name = BACKEND_ORDER[backendToggle % BACKEND_ORDER.length];
            const url = BACKENDS[name];
            backendToggle++;
            localStorage.setItem('voya_backend_toggle', backendToggle.toString());
            console.log(`üîÑ Backend #${backendToggle}: ${name.toUpperCase()} ‚Üí ${url.split('//')[1].split('.')[0]}...`);
            return { name, url };
        }

        /**
         * Check if a backend should be skipped (was recently unhealthy)
         */
        function isBackendHealthy(name) {
            const cache = backendHealth[name];
            if (!cache) return true;
            if (Date.now() - cache.lastCheck < HEALTH_CHECK_INTERVAL && !cache.healthy) {
                return false;
            }
            return true;
        }

        /**
         * Update health status for a backend
         */
        function updateBackendHealth(name, healthy) {
            backendHealth[name] = { healthy, lastCheck: Date.now() };
        }

        /**
         * Show backend indicator in UI
         */
        function showBackendIndicator(backendName, status = 'active') {
            // Remove existing indicators
            document.querySelectorAll('.backend-indicator').forEach(el => el.remove());

            const indicator = document.createElement('div');
            indicator.className = 'backend-indicator';
            indicator.innerHTML = `
                <span class="backend-dot ${status}"></span>
                <span class="backend-name">${backendName}</span>
            `;
            indicator.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                background: rgba(0,0,0,0.8);
                color: #fff;
                padding: 8px 16px;
                border-radius: 20px;
                font-size: 12px;
                display: flex;
                align-items: center;
                gap: 8px;
                z-index: 9999;
                animation: fadeIn 0.3s ease;
            `;

            const dot = indicator.querySelector('.backend-dot');
            dot.style.cssText = `
                width: 8px;
                height: 8px;
                border-radius: 50%;
                background: ${status === 'active' ? '#4ade80' : status === 'fallback' ? '#fbbf24' : '#ef4444'};
            `;

            document.body.appendChild(indicator);

            // Auto-remove after 3 seconds
            setTimeout(() => {
                indicator.style.opacity = '0';
                indicator.style.transition = 'opacity 0.3s';
                setTimeout(() => indicator.remove(), 300);
            }, 3000);
        }

        /**
         * Make an API request with automatic failover
         * Primary: Round-robin between Supabase and Convex
         * Fallback: AWS Lambda if both fail
         * @param {string} endpoint - API endpoint (e.g., '/api/health')
         * @param {object} options - Fetch options
         * @returns {Promise<Response>} - Fetch response
         */
        async function fetchWithFailover(endpoint, options = {}) {
            const errors = [];

            // üîê Auto-inject Authorization token if available
            const token = localStorage.getItem('voya_token');
            if (token) {
                options.headers = {
                    ...options.headers,
                    'Authorization': `Bearer ${token}`
                };
            }

            // Try primary backends in round-robin order
            for (let attempt = 0; attempt < BACKEND_ORDER.length; attempt++) {
                const { name, url } = getNextBackend();

                // Skip unhealthy backends
                if (!isBackendHealthy(name)) {
                    console.log(`‚è≠Ô∏è Skipping unhealthy backend: ${name}`);
                    continue;
                }

                try {
                    const response = await fetch(`${url}${endpoint}`, options);
                    if (response.ok || response.status < 500) {
                        updateBackendHealth(name, true);
                        showBackendIndicator(name.charAt(0).toUpperCase() + name.slice(1), 'active');
                        return response;
                    }
                    // Server error - mark unhealthy
                    updateBackendHealth(name, false);
                    errors.push({ backend: name, status: response.status });
                    console.warn(`‚ö†Ô∏è ${name} returned ${response.status}, trying next...`);
                } catch (err) {
                    updateBackendHealth(name, false);
                    errors.push({ backend: name, error: err.message });
                    console.warn(`‚ö†Ô∏è ${name} failed: ${err.message}, trying next...`);
                }
            }

            // All primary backends failed - try AWS fallback
            console.log('üÜò All primary backends failed, trying AWS fallback...');
            showBackendIndicator('AWS Fallback', 'fallback');

            try {
                const response = await fetch(`${BACKENDS.awsFallback}${endpoint}`, options);
                console.log(`‚úÖ AWS fallback responded: ${response.status}`);
                return response;
            } catch (fallbackError) {
                errors.push({ backend: 'aws-fallback', error: fallbackError.message });
                console.error('‚ùå AWS fallback also failed:', fallbackError.message);
                showBackendIndicator('All Failed', 'error');
            }

            // All backends failed - return error response
            throw new Error(`All backends unavailable: ${JSON.stringify(errors)}`);
        }

        // Legacy compatibility - uses Supabase as primary
        const API_BASE_URL = BACKENDS.primary;


        // ==================== SECURITY: INPUT VALIDATION UTILITIES ====================

        /**
         * SECURITY: Escape HTML to prevent XSS attacks
         * @param {string} str - String to escape
         * @returns {string} - Escaped string safe for HTML display
         */
        function escapeHtml(str) {
            if (!str) return '';
            const div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML;
        }

        /**
         * SECURITY: Validate airport code (exactly 3 letters A-Z)
         * @param {string} code - Airport code to validate
         * @returns {boolean} - True if valid
         */
        function isValidAirportCode(code) {
            if (!code || typeof code !== 'string') return false;
            return /^[A-Za-z]{3}$/.test(code.trim());
        }

        /**
         * SECURITY: Validate date in YYYY-MM-DD format and not in distant past/future
         * @param {string} dateStr - Date string to validate
         * @returns {boolean} - True if valid
         */
        function isValidDate(dateStr) {
            if (!dateStr || typeof dateStr !== 'string') return false;
            if (!/^\d{4}-\d{2}-\d{2}$/.test(dateStr)) return false;
            const date = new Date(dateStr);
            if (isNaN(date.getTime())) return false;
            // Allow dates within -1 day to +1 year from now
            const minDate = new Date();
            minDate.setDate(minDate.getDate() - 1);
            const maxDate = new Date();
            maxDate.setFullYear(maxDate.getFullYear() + 1);
            return date >= minDate && date <= maxDate;
        }

        /**
         * SECURITY: Sanitize and limit string length
         * @param {string} str - String to sanitize
         * @param {number} maxLength - Maximum allowed length
         * @returns {string} - Sanitized string
         */
        function sanitizeString(str, maxLength = 100) {
            if (!str || typeof str !== 'string') return '';
            return str.trim().slice(0, maxLength);
        }

        /**
         * SECURITY: Handle rate limit (429) responses gracefully
         * @param {Response} response - Fetch response object
         * @returns {string|null} - Error message if rate limited, null otherwise
         */
        function handleRateLimitResponse(response) {
            if (response.status === 429) {
                const retryAfter = response.headers.get('Retry-After') || '60';
                return `Too many requests. Please wait ${retryAfter} seconds before trying again.`;
            }
            return null;
        }

        /**
         * SECURITY: Handle API error responses with user-friendly messages
         * @param {Response} response - Fetch response object
         * @returns {Promise<string>} - User-friendly error message
         */
        async function handleErrorResponse(response) {
            // Check for rate limiting first
            const rateLimitError = handleRateLimitResponse(response);
            if (rateLimitError) return rateLimitError;

            try {
                const data = await response.json();
                if (data.details && Array.isArray(data.details)) {
                    return data.details.join(', ');
                }
                return data.message || data.error || 'An error occurred. Please try again.';
            } catch {
                return 'An unexpected error occurred. Please try again.';
            }
        }

        /**
         * Show a toast notification
         * @param {string} message - Message to display
         * @param {string} type - Toast type: 'error', 'success', or '' for default
         */
        function showToast(message, type = '') {
            // Remove existing toasts
            document.querySelectorAll('.toast').forEach(t => t.remove());

            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `<i class="fas ${type === 'error' ? 'fa-exclamation-circle' : type === 'success' ? 'fa-check-circle' : 'fa-info-circle'}"></i> ${message}`;
            document.body.appendChild(toast);

            // Auto-remove after 4 seconds
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(100px)';
                toast.style.transition = 'all 0.3s ease';
                setTimeout(() => toast.remove(), 300);
            }, 4000);
        }

        /**
         * Escape HTML special characters to prevent XSS
         */
        function escapeHtml(text) {
            if (!text) return '';
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return String(text).replace(/[&<>"']/g, m => map[m]);
        }

        /**
         * Redirect to Google Flights booking page
         */
        function bookFlight(from, to, date) {
            // Build Google Flights URL
            const baseUrl = 'https://www.google.com/travel/flights';
            const params = new URLSearchParams();

            // If we have airport codes, use them
            if (from && to) {
                // Google Flights deep linking format
                const travelUrl = `${baseUrl}?q=flights%20from%20${encodeURIComponent(from)}%20to%20${encodeURIComponent(to)}`;
                window.open(travelUrl, '_blank');
            } else {
                // Fallback to flights homepage
                window.open(baseUrl, '_blank');
            }
            showToast('Opening Google Flights...', 'info');
        }

        function switchTab(event, tabName) {

            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.style.display = 'none');

            const selectedTab = document.getElementById(tabName);
            if (selectedTab) {
                selectedTab.style.display = 'block';
            }

            const buttons = document.querySelectorAll('.tab-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            if (event && event.currentTarget) {
                event.currentTarget.classList.add('active');
            }
        }

        // ==================== UNIFIED TRIP.COM STYLE OVERLAY ====================

        let currentUnifiedTab = 'flights';

        /**
         * Open the unified search overlay
         * @param {string} tab - The tab to open: 'flights', 'hotels', or 'itinerary'
         */
        function openUnifiedOverlay(tab = 'flights') {
            currentUnifiedTab = tab;
            const overlay = document.getElementById('unified-search-overlay');
            overlay.classList.add('active');
            document.body.style.overflow = 'hidden';

            // Switch to the correct tab
            switchUnifiedTab(tab);

            // Set default dates
            setDefaultDates();
        }

        /**
         * Close the unified search overlay
         */
        function closeUnifiedOverlay() {
            const overlay = document.getElementById('unified-search-overlay');
            overlay.classList.remove('active');
            document.body.style.overflow = '';
        }

        /**
         * Handle main form flight search - copies values to unified overlay, opens it, and searches
         */
        function handleFlightSearch() {
            // Copy values from main form to unified overlay
            const from = document.getElementById('flight-from')?.value || '';
            const to = document.getElementById('flight-to')?.value || '';
            const depart = document.getElementById('flight-depart')?.value || '';
            const returnDate = document.getElementById('flight-return')?.value || '';
            const passengers = document.getElementById('flight-passengers')?.value || '1';

            // Set values in unified overlay
            if (document.getElementById('unified-flight-from')) {
                document.getElementById('unified-flight-from').value = from;
            }
            if (document.getElementById('unified-flight-to')) {
                document.getElementById('unified-flight-to').value = to;
            }
            if (document.getElementById('unified-flight-depart')) {
                document.getElementById('unified-flight-depart').value = depart;
            }
            if (document.getElementById('unified-flight-return')) {
                document.getElementById('unified-flight-return').value = returnDate;
            }
            if (document.getElementById('unified-flight-passengers')) {
                document.getElementById('unified-flight-passengers').value = passengers;
            }

            // Open unified overlay with flights tab
            openUnifiedOverlay('flights');

            // Trigger search after a short delay for overlay to open
            setTimeout(() => {
                handleUnifiedFlightSearch();
            }, 300);
        }

        /**
         * Handle main form hotel search - redirects to unified overlay
         * Note: This wraps the original searchHotels for overlay functionality
         */
        function handleHotelSearch() {
            // Copy values from main form to unified overlay
            const dest = document.getElementById('hotel-dest')?.value || '';
            const checkin = document.getElementById('hotel-checkin')?.value || '';
            const checkout = document.getElementById('hotel-checkout')?.value || '';
            const guests = document.getElementById('hotel-guests')?.value || '2';
            const rooms = document.getElementById('hotel-rooms')?.value || '1';

            // Set values in unified overlay
            if (document.getElementById('unified-hotel-dest')) {
                document.getElementById('unified-hotel-dest').value = dest;
            }
            if (document.getElementById('unified-hotel-checkin')) {
                document.getElementById('unified-hotel-checkin').value = checkin;
            }
            if (document.getElementById('unified-hotel-checkout')) {
                document.getElementById('unified-hotel-checkout').value = checkout;
            }
            if (document.getElementById('unified-hotel-guests')) {
                document.getElementById('unified-hotel-guests').value = guests;
            }
            if (document.getElementById('unified-hotel-rooms')) {
                document.getElementById('unified-hotel-rooms').value = rooms;
            }

            // Open unified overlay with hotels tab
            openUnifiedOverlay('hotels');

            // Trigger search after a short delay for overlay to open
            setTimeout(() => {
                handleUnifiedHotelSearch();
            }, 300);
        }

        /**
         * Handle main form AI itinerary search - redirects to unified overlay
         */
        function handleItinerarySearch() {
            // Copy values from main form to unified overlay
            const dest = document.getElementById('ai-dest')?.value || '';
            const days = document.getElementById('ai-days')?.value || '';
            const prefs = document.getElementById('ai-prefs')?.value || '';

            // Set values in unified overlay
            if (document.getElementById('unified-ai-dest')) {
                document.getElementById('unified-ai-dest').value = dest;
            }
            if (document.getElementById('unified-ai-days')) {
                document.getElementById('unified-ai-days').value = days;
            }
            if (document.getElementById('unified-ai-prefs')) {
                document.getElementById('unified-ai-prefs').value = prefs;
            }

            // Open unified overlay with itinerary tab
            openUnifiedOverlay('itinerary');

            // Trigger search after a short delay for overlay to open
            setTimeout(() => {
                handleUnifiedItinerarySearch();
            }, 300);
        }

        // Close unified overlay on Escape key
        document.addEventListener('keydown', function (e) {
            if (e.key === 'Escape') {
                const overlay = document.getElementById('unified-search-overlay');
                if (overlay && overlay.classList.contains('active')) {
                    closeUnifiedOverlay();
                }
            }
        });

        /**
         * Switch between tabs in the unified overlay
         * @param {string} tab - The tab to switch to: 'flights', 'hotels', or 'itinerary'
         */
        function switchUnifiedTab(tab) {
            currentUnifiedTab = tab;

            // Update tab buttons
            document.querySelectorAll('.unified-tab').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.tab === tab) {
                    btn.classList.add('active');
                }
            });

            // Show/hide forms
            document.querySelectorAll('.unified-form').forEach(form => {
                form.classList.remove('active');
            });
            document.getElementById(`unified-${tab}-form`).classList.add('active');

            // Update filters sidebar
            updateUnifiedFilters(tab);

            // Reset placeholder
            resetUnifiedPlaceholder(tab);
        }

        /**
         * Set default dates for date inputs
         */
        function setDefaultDates() {
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            const nextWeek = new Date(today);
            nextWeek.setDate(nextWeek.getDate() + 7);

            const formatDate = (date) => date.toISOString().split('T')[0];

            // Flight dates
            if (!document.getElementById('unified-flight-depart').value) {
                document.getElementById('unified-flight-depart').value = formatDate(tomorrow);
            }
            if (!document.getElementById('unified-flight-return').value) {
                document.getElementById('unified-flight-return').value = formatDate(nextWeek);
            }

            // Hotel dates
            if (!document.getElementById('unified-hotel-checkin').value) {
                document.getElementById('unified-hotel-checkin').value = formatDate(tomorrow);
            }
            if (!document.getElementById('unified-hotel-checkout').value) {
                document.getElementById('unified-hotel-checkout').value = formatDate(nextWeek);
            }
        }

        /**
         * Update the filters sidebar based on the current tab
         */
        function updateUnifiedFilters(tab) {
            const filtersContainer = document.getElementById('unified-filters');
            const sidebarContainer = document.getElementById('unified-sidebar');
            const resultsContainer = document.getElementById('unified-results');

            if (tab === 'flights') {
                sidebarContainer.style.display = 'block';
                resultsContainer.style.flex = '';
                filtersContainer.innerHTML = `
                    <h4><i class="fas fa-filter"></i> Flight Filters</h4>
                    <div class="sidebar-filter">
                        <label>Stops</label>
                        <select id="unified-filter-stops">
                            <option value="0">Any stops</option>
                            <option value="1">Non-stop</option>
                            <option value="2">1 Stop</option>
                            <option value="3">2+ Stops</option>
                        </select>
                    </div>
                    <div class="sidebar-filter">
                        <label>Travel Class</label>
                        <select id="unified-filter-class">
                            <option value="1">Economy</option>
                            <option value="2">Premium Economy</option>
                            <option value="3">Business</option>
                            <option value="4">First Class</option>
                        </select>
                    </div>
                    <div class="sidebar-filter">
                        <label>Sort By</label>
                        <select id="unified-filter-sort">
                            <option value="1">Best</option>
                            <option value="2">Cheapest</option>
                            <option value="3">Fastest</option>
                        </select>
                    </div>
                `;
            } else if (tab === 'hotels') {
                sidebarContainer.style.display = 'block';
                resultsContainer.style.flex = '';
                filtersContainer.innerHTML = `
                    <h4><i class="fas fa-filter"></i> Hotel Filters</h4>
                    <div class="sidebar-filter">
                        <label>Star Rating</label>
                        <select id="unified-filter-stars">
                            <option value="">All Ratings</option>
                            <option value="5">5 Stars</option>
                            <option value="4">4+ Stars</option>
                            <option value="3">3+ Stars</option>
                        </select>
                    </div>
                    <div class="sidebar-filter">
                        <label>Sort By</label>
                        <select id="unified-filter-hotel-sort">
                            <option value="">Relevance</option>
                            <option value="3">Price (Low to High)</option>
                            <option value="8">Rating (High to Low)</option>
                            <option value="13">Most Reviewed</option>
                        </select>
                    </div>
                `;
            } else if (tab === 'itinerary') {
                // Hide sidebar for itinerary tab so content takes full width
                sidebarContainer.style.display = 'none';
                resultsContainer.style.flex = '1';
                filtersContainer.innerHTML = '';
            }
        }

        /**
         * Reset the placeholder based on current tab
         * IMPORTANT: Also destroys any map instances to prevent overlap
         */
        function resetUnifiedPlaceholder(tab) {
            const placeholder = document.getElementById('unified-placeholder');
            const skeleton = document.getElementById('unified-skeleton');
            const content = document.getElementById('unified-results-content');

            // üó∫Ô∏è CRITICAL: Destroy any existing map to prevent overlap
            if (typeof itineraryMap !== 'undefined' && itineraryMap) {
                try {
                    itineraryMap.remove();
                    itineraryMap = null;
                    console.log('üó∫Ô∏è Map destroyed on tab switch');
                } catch (e) {
                    console.warn('Failed to destroy map:', e);
                }
            }

            // Force clear ALL content - remove all child nodes
            while (content.firstChild) {
                content.removeChild(content.firstChild);
            }
            content.innerHTML = '';

            // Show placeholder, hide skeleton
            if (placeholder) placeholder.style.display = 'flex';
            if (skeleton) skeleton.style.display = 'none';

            const icons = { flights: 'fa-plane', hotels: 'fa-hotel', itinerary: 'fa-route' };
            const titles = { flights: 'Search Flights', hotels: 'Find Hotels', itinerary: 'Plan Your Trip' };
            const descs = {
                flights: 'Enter your destinations and travel dates to find the best flight deals',
                hotels: 'Search for hotels in your destination city',
                itinerary: 'Let AI create a personalized itinerary for your adventure'
            };

            if (placeholder) {
                placeholder.innerHTML = `
                    <i class="fas ${icons[tab]}"></i>
                    <h3>${titles[tab]}</h3>
                    <p>${descs[tab]}</p>
                `;
            }
        }

        /**
         * Show loading skeleton
         */
        function showUnifiedSkeleton() {
            document.getElementById('unified-placeholder').style.display = 'none';
            document.getElementById('unified-skeleton').style.display = 'block';
            document.getElementById('unified-results-content').innerHTML = '';
        }

        /**
         * Hide loading skeleton
         */
        function hideUnifiedSkeleton() {
            document.getElementById('unified-skeleton').style.display = 'none';
        }

        /**
         * Swap flight destinations in unified overlay
         */
        function swapFlightDestinations() {
            const fromInput = document.getElementById('unified-flight-from');
            const toInput = document.getElementById('unified-flight-to');
            const temp = fromInput.value;
            fromInput.value = toInput.value;
            toInput.value = temp;
        }

        /**
         * Handle unified flight search
         * Uses FastAPI (Groq + Tavily) as primary, with Supabase/AWS fallback
         */
        async function handleUnifiedFlightSearch() {
            const from = document.getElementById('unified-flight-from').value.trim();
            const to = document.getElementById('unified-flight-to').value.trim();
            const depart = document.getElementById('unified-flight-depart').value;
            const returnDate = document.getElementById('unified-flight-return').value;
            const passengers = document.getElementById('unified-flight-passengers').value;

            // Validation
            if (!from || !to) {
                showToast('Please enter departure and destination cities', 'error');
                return;
            }
            if (!depart) {
                showToast('Please select a departure date', 'error');
                return;
            }

            showUnifiedSkeleton();

            // Get filter values
            const stops = document.getElementById('unified-filter-stops')?.value || '0';
            const travelClass = document.getElementById('unified-filter-class')?.value || '1';
            const sort = document.getElementById('unified-filter-sort')?.value || '1';

            try {
                // Extract airport codes
                const fromCode = extractAirportCode(from);
                const toCode = extractAirportCode(to);

                // Call backend - Groq+Tavily is now PRIMARY within backend, SerpAPI is fallback
                const response = await fetchWithFailover('/api/flights/search', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        departure_id: fromCode,
                        arrival_id: toCode,
                        outbound_date: depart,
                        return_date: returnDate || undefined,
                        adults: parseInt(passengers),
                        travel_class: parseInt(travelClass),
                        stops: parseInt(stops),
                        sort_by: parseInt(sort)
                    })
                });

                hideUnifiedSkeleton();

                if (!response.ok) {
                    throw new Error(await handleErrorResponse(response));
                }

                const data = await response.json();
                // Check if Groq+Tavily was used (source field from backend)
                const usedGroq = data.source === 'groq-tavily';
                displayUnifiedFlightResults(data, usedGroq);

            } catch (error) {
                hideUnifiedSkeleton();
                document.getElementById('unified-results-content').innerHTML = `
                    <div class="error-message">
                        <i class="fas fa-exclamation-circle"></i>
                        <p>${error.message || 'Failed to search flights. Please try again.'}</p>
                    </div>
                `;
            }
        }


        /**
         * Handle unified hotel search
         */
        async function handleUnifiedHotelSearch() {
            const dest = document.getElementById('unified-hotel-dest').value.trim();
            const checkin = document.getElementById('unified-hotel-checkin').value;
            const checkout = document.getElementById('unified-hotel-checkout').value;
            const guests = document.getElementById('unified-hotel-guests').value;
            const rooms = document.getElementById('unified-hotel-rooms').value;

            // Validation
            if (!dest) {
                showToast('Please enter a destination', 'error');
                return;
            }
            if (!checkin || !checkout) {
                showToast('Please select check-in and check-out dates', 'error');
                return;
            }

            showUnifiedSkeleton();

            const sort = document.getElementById('unified-filter-hotel-sort')?.value || '';

            try {
                const response = await fetchWithFailover('/api/hotels/search', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        q: dest,
                        check_in_date: checkin,
                        check_out_date: checkout,
                        adults: String(guests || '1'),
                        sort_by: sort || '3'
                    })
                });

                hideUnifiedSkeleton();

                if (!response.ok) {
                    throw new Error(await handleErrorResponse(response));
                }

                const data = await response.json();
                displayUnifiedHotelResults(data);

            } catch (error) {
                hideUnifiedSkeleton();
                document.getElementById('unified-results-content').innerHTML = `
                    <div class="error-message">
                        <i class="fas fa-exclamation-circle"></i>
                        <p>${error.message || 'Failed to search hotels. Please try again.'}</p>
                    </div>
                `;
            }
        }

        /**
         * Handle unified itinerary generation
         */
        async function handleUnifiedItinerarySearch() {
            const dest = document.getElementById('unified-ai-dest').value.trim();
            const days = document.getElementById('unified-ai-days').value.trim();
            const budget = document.getElementById('unified-ai-budget').value;

            // Validation
            if (!dest) {
                showToast('Please enter a destination', 'error');
                return;
            }

            showUnifiedSkeleton();

            const style = document.getElementById('unified-filter-style')?.value || '';
            const pace = document.getElementById('unified-filter-pace')?.value || 'moderate';
            const userPrefs = document.getElementById('unified-ai-prefs')?.value?.trim() || '';

            // Build preferences string
            const prefs = [`Budget: ${budget}`, `Pace: ${pace}`];
            if (style) prefs.push(`Style: ${style}`);
            if (userPrefs) prefs.push(userPrefs);

            try {
                const response = await fetchWithFailover('/api/itinerary/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        destination: dest,
                        duration: days || '5 days',
                        preferences: prefs.join(', '),
                        budget_tier: budget
                    })
                });

                hideUnifiedSkeleton();

                if (!response.ok) {
                    throw new Error(await handleErrorResponse(response));
                }

                const data = await response.json();

                // Store destination globally for map initialization
                window.currentDestination = dest;

                // Store itinerary data globally for PDF download
                window.currentItineraryData = data;

                displayUnifiedItineraryResults(data);

            } catch (error) {
                hideUnifiedSkeleton();
                document.getElementById('unified-results-content').innerHTML = `
                    <div class="error-message">
                        <i class="fas fa-exclamation-circle"></i>
                        <p>${error.message || 'Failed to generate itinerary. Please try again.'}</p>
                    </div>
                `;
            }
        }

        /**
         * Display flight results in unified overlay
         * @param {Object} data - Flight search response
         * @param {boolean} usedFastAPI - Whether FastAPI (Groq) was used
         */
        function displayUnifiedFlightResults(data, usedFastAPI = false) {
            const container = document.getElementById('unified-results-content');
            const placeholder = document.getElementById('unified-placeholder');
            if (placeholder) placeholder.style.display = 'none'; // Hide placeholder when showing results

            const flights = data.flights || data.best_flights || [];
            const source = data.source || '';

            if (!flights.length) {
                container.innerHTML = `
                    <div class="unified-placeholder">
                        <i class="fas fa-plane-slash"></i>
                        <h3>No Flights Found</h3>
                        <p>Try adjusting your search criteria or dates</p>
                    </div>
                `;
                return;
            }

            // Source badge - show which AI model or data source
            let sourceBadge = '';
            if (source.includes('groq')) {
                sourceBadge = '<span style="background:linear-gradient(135deg,#667eea,#764ba2);color:white;padding:4px 12px;border-radius:20px;font-size:0.75rem;margin-left:10px;">‚ö° Powered by Groq</span>';
            } else if (source.includes('openrouter')) {
                sourceBadge = '<span style="background:linear-gradient(135deg,#f093fb,#f5576c);color:white;padding:4px 12px;border-radius:20px;font-size:0.75rem;margin-left:10px;">üîÑ Powered by OpenRouter</span>';
            } else if (source.includes('ollama')) {
                sourceBadge = '<span style="background:linear-gradient(135deg,#4facfe,#00f2fe);color:white;padding:4px 12px;border-radius:20px;font-size:0.75rem;margin-left:10px;">üè† Powered by Ollama</span>';
            } else if (usedFastAPI) {
                sourceBadge = '<span style="background:linear-gradient(135deg,#667eea,#764ba2);color:white;padding:4px 12px;border-radius:20px;font-size:0.75rem;margin-left:10px;">‚ö° AI-Powered</span>';
            }

            container.innerHTML = `
                <div class="results-header" style="margin-bottom:20px;padding:18px 20px;background:linear-gradient(135deg,#fff,#f8fafc);border-radius:16px;display:flex;align-items:center;justify-content:space-between;box-shadow:0 2px 12px rgba(0,0,0,0.06);">
                    <h3 style="margin:0;color:#1a1a2e;font-size:1.2rem;">${flights.length} Flights Found ${sourceBadge}</h3>
                </div>
                ${flights.map((flight, index) => {
                // Handle both FastAPI format and SerpAPI format
                const outbound = flight.flights?.[0] || flight;
                const returnLeg = flight.flights?.[1] || null;
                const airline = outbound.airline || flight.airline || 'Airline';
                const flightNum = flight.flight_number || outbound.flight_number || '';
                const price = flight.price || outbound.price || 'N/A';
                const tripType = flight.type || (returnLeg ? 'Round trip' : 'One way');

                // Outbound details
                const depTime = outbound.departure_airport?.time || outbound.departure_time || flight.departure_time || '--:--';
                const arrTime = outbound.arrival_airport?.time || outbound.arrival_time || flight.arrival_time || '--:--';
                const depName = outbound.departure_airport?.name || outbound.departure_airport?.id || 'Departure';
                const arrName = outbound.arrival_airport?.name || outbound.arrival_airport?.id || 'Arrival';
                const duration = flight.total_duration || outbound.duration || flight.duration || '--';
                const stops = flight.layovers?.length || 0;

                // Return details (if round trip)
                const retDepTime = returnLeg?.departure_airport?.time || returnLeg?.departure_time || '';
                const retArrTime = returnLeg?.arrival_airport?.time || returnLeg?.arrival_time || '';
                const retDepName = returnLeg?.departure_airport?.name || returnLeg?.departure_airport?.id || '';
                const retArrName = returnLeg?.arrival_airport?.name || returnLeg?.arrival_airport?.id || '';
                const retDuration = returnLeg?.duration || '';
                const retAirline = returnLeg?.airline || airline;
                const retFlightNum = returnLeg?.flight_number || '';

                const bookingLink = flight.booking_link || '';
                const hasBookingLink = bookingLink && bookingLink !== '#' && bookingLink !== 'N/A';

                // Generate airline color based on name
                const hue = airline.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0) % 360;

                return `
                        <div class="flight-card fade-in" style="animation-delay:${index * 0.08}s;background:#fff;border-radius:16px;padding:0;margin-bottom:18px;box-shadow:0 4px 20px rgba(0,0,0,0.08);overflow:hidden;border:1px solid rgba(0,0,0,0.04);">
                            <!-- Airline Header -->
                            <div style="display:flex;justify-content:space-between;align-items:center;padding:16px 20px;background:linear-gradient(135deg,hsl(${hue},60%,50%),hsl(${hue + 30},60%,45%));color:white;">
                                <div style="display:flex;align-items:center;gap:12px;">
                                    <div style="width:44px;height:44px;border-radius:10px;background:rgba(255,255,255,0.2);backdrop-filter:blur(10px);display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:1rem;">
                                        ${airline.substring(0, 2).toUpperCase()}
                                    </div>
                                    <div>
                                        <div style="font-weight:600;font-size:1.1rem;">${escapeHtml(airline)}</div>
                                        <div style="display:flex;align-items:center;gap:8px;">
                                            ${flightNum ? `<span style="font-size:0.8rem;opacity:0.85;">${flightNum}</span>` : ''}
                                            <span style="font-size:0.75rem;background:rgba(255,255,255,0.2);padding:2px 8px;border-radius:10px;">${tripType}</span>
                                        </div>
                                    </div>
                                </div>
                                <div style="text-align:right;">
                                    <div style="font-size:1.6rem;font-weight:700;">‚Çπ${typeof price === 'number' ? price.toLocaleString() : price}</div>
                                    <div style="font-size:0.75rem;opacity:0.85;">per person</div>
                                </div>
                            </div>
                            
                            <!-- Outbound Flight -->
                            <div style="padding:6px 20px 0;">
                                <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px;">
                                    <i class="fas fa-plane-departure" style="color:hsl(${hue},60%,50%);font-size:0.85rem;"></i>
                                    <span style="font-size:0.8rem;font-weight:600;color:hsl(${hue},60%,45%);text-transform:uppercase;letter-spacing:1px;">Outbound</span>
                                </div>
                            </div>
                            <div style="padding:0 20px 16px;display:flex;justify-content:space-between;align-items:center;">
                                <div style="text-align:center;flex:1;">
                                    <div style="font-size:1.6rem;font-weight:700;color:#1a1a2e;">${depTime}</div>
                                    <div style="font-size:0.8rem;color:#666;max-width:100px;margin:0 auto;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">${depName}</div>
                                </div>
                                <div style="flex:1.5;text-align:center;padding:0 10px;">
                                    <div style="font-size:0.8rem;color:#888;font-weight:500;">${duration}${typeof duration === 'number' ? ' min' : ''}</div>
                                    <div style="height:2px;background:linear-gradient(90deg,hsl(${hue},60%,60%),hsl(${hue + 30},60%,55%));margin:8px 0;position:relative;border-radius:2px;">
                                        <i class="fas fa-plane" style="position:absolute;right:-6px;top:-9px;color:hsl(${hue},60%,50%);font-size:1rem;"></i>
                                    </div>
                                    <div style="font-size:0.8rem;color:${stops === 0 ? '#28a745' : '#f39c12'};font-weight:500;">
                                        <i class="fas fa-${stops === 0 ? 'check-circle' : 'clock'}" style="margin-right:4px;"></i>
                                        ${stops === 0 ? 'Non-stop' : stops + ' stop(s)'}
                                    </div>
                                </div>
                                <div style="text-align:center;flex:1;">
                                    <div style="font-size:1.6rem;font-weight:700;color:#1a1a2e;">${arrTime}</div>
                                    <div style="font-size:0.8rem;color:#666;max-width:100px;margin:0 auto;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">${arrName}</div>
                                </div>
                            </div>

                            ${returnLeg ? `
                            <!-- Separator -->
                            <div style="margin:0 20px;border-top:1px dashed #e0e0e0;position:relative;">
                                <div style="position:absolute;top:-12px;left:50%;transform:translateX(-50%);background:#fff;padding:0 12px;">
                                    <i class="fas fa-exchange-alt" style="color:#aaa;font-size:0.85rem;"></i>
                                </div>
                            </div>

                            <!-- Return Flight -->
                            <div style="padding:14px 20px 0;">
                                <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px;">
                                    <i class="fas fa-plane-arrival" style="color:#10b981;font-size:0.85rem;"></i>
                                    <span style="font-size:0.8rem;font-weight:600;color:#10b981;text-transform:uppercase;letter-spacing:1px;">Return</span>
                                    ${retAirline !== airline ? `<span style="font-size:0.75rem;color:#888;">¬∑ ${escapeHtml(retAirline)}</span>` : ''}
                                    ${retFlightNum ? `<span style="font-size:0.75rem;color:#aaa;">${retFlightNum}</span>` : ''}
                                </div>
                            </div>
                            <div style="padding:0 20px 16px;display:flex;justify-content:space-between;align-items:center;">
                                <div style="text-align:center;flex:1;">
                                    <div style="font-size:1.6rem;font-weight:700;color:#1a1a2e;">${retDepTime}</div>
                                    <div style="font-size:0.8rem;color:#666;max-width:100px;margin:0 auto;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">${retDepName}</div>
                                </div>
                                <div style="flex:1.5;text-align:center;padding:0 10px;">
                                    <div style="font-size:0.8rem;color:#888;font-weight:500;">${retDuration}${typeof retDuration === 'number' ? ' min' : ''}</div>
                                    <div style="height:2px;background:linear-gradient(90deg,#10b981,#059669);margin:8px 0;position:relative;border-radius:2px;">
                                        <i class="fas fa-plane" style="position:absolute;left:-6px;top:-9px;color:#10b981;font-size:1rem;transform:scaleX(-1);"></i>
                                    </div>
                                </div>
                                <div style="text-align:center;flex:1;">
                                    <div style="font-size:1.6rem;font-weight:700;color:#1a1a2e;">${retArrTime}</div>
                                    <div style="font-size:0.8rem;color:#666;max-width:100px;margin:0 auto;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">${retArrName}</div>
                                </div>
                            </div>
                            ` : ''}
                            
                            <!-- Book Now Button -->
                            <div style="padding:0 20px 20px;">
                                ${hasBookingLink ? `
                                    <a href="${bookingLink}" target="_blank" rel="noopener noreferrer" style="display:flex;align-items:center;justify-content:center;gap:8px;text-align:center;background:linear-gradient(135deg,#f39c12,#e67e22);text-decoration:none;color:white;padding:14px;border-radius:10px;font-weight:600;font-size:1rem;transition:all 0.3s ease;box-shadow:0 4px 15px rgba(243,156,18,0.3);">
                                        <i class="fas fa-external-link-alt"></i> Book Now
                                    </a>
                                ` : `
                                    <button onclick="searchFlightBooking('${escapeHtml(airline)}', '${flightNum}', '${depTime}')" style="width:100%;display:flex;align-items:center;justify-content:center;gap:8px;background:linear-gradient(135deg,#6c757d,#495057);color:white;padding:14px;border-radius:10px;border:none;font-weight:600;font-size:1rem;cursor:pointer;transition:all 0.3s ease;">
                                        <i class="fas fa-search"></i> Find Booking
                                    </button>
                                `}
                            </div>
                        </div>
                    `;

            }).join('')}
            `;
        }

        /**
         * Display hotel results in unified overlay
         */
        function displayUnifiedHotelResults(data) {
            const container = document.getElementById('unified-results-content');
            const placeholder = document.getElementById('unified-placeholder');
            if (placeholder) placeholder.style.display = 'none'; // Hide placeholder when showing results

            const hotels = data.properties || data.hotels || [];
            const source = data.source || '';
            const sourceBadge = source === 'groq-tavily'
                ? '<span style="background:linear-gradient(135deg,#667eea,#764ba2);color:white;padding:3px 10px;border-radius:20px;font-size:0.75rem;margin-left:10px;"><i class="fas fa-robot"></i> AI-Powered</span>'
                : source === 'serpapi'
                    ? '<span style="background:#1a73e8;color:white;padding:3px 10px;border-radius:20px;font-size:0.75rem;margin-left:10px;"><i class="fas fa-google"></i> Google Hotels</span>'
                    : '';

            if (!hotels.length) {
                container.innerHTML = `
                    <div class="unified-placeholder">
                        <i class="fas fa-hotel"></i>
                        <h3>No Hotels Found</h3>
                        <p>Try adjusting your search criteria or dates</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = `
                <div class="results-header" style="margin-bottom:20px;padding:18px 20px;background:linear-gradient(135deg,#fff,#f8fafc);border-radius:16px;display:flex;align-items:center;justify-content:space-between;box-shadow:0 2px 12px rgba(0,0,0,0.06);">
                    <h3 style="margin:0;color:#1a1a2e;font-size:1.2rem;">${hotels.length} Hotels Found ${sourceBadge}</h3>
                </div>
                <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:20px;">
                    ${hotels.map((hotel, index) => {
                const name = hotel.name || 'Hotel';
                // Handle both AI format (price_per_night) and SerpAPI format (rate_per_night)
                const price = hotel.price_per_night || hotel.rate_per_night?.lowest || hotel.price || 'N/A';
                const currency = hotel.currency || '‚Çπ';
                const rating = hotel.overall_rating || hotel.rating || 0;
                const image = hotel.image_url || hotel.images?.[0]?.thumbnail || hotel.image || 'https://via.placeholder.com/300x200';
                const stars = hotel.stars || hotel.hotel_class || Math.round(rating);
                const location = hotel.location || hotel.address || '';
                const description = hotel.description || '';
                const amenities = hotel.amenities || [];
                const bookingLink = hotel.booking_link || hotel.link || '';
                const hasBookingLink = bookingLink && bookingLink.startsWith('http');

                // Generate hotel color based on name
                const hue = name.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0) % 360;

                return `
                            <div class="hotel-card fade-in" style="animation-delay:${index * 0.1}s;background:#fff;border-radius:16px;overflow:hidden;box-shadow:0 4px 20px rgba(0,0,0,0.08);border:1px solid rgba(0,0,0,0.04);transition:all 0.3s ease;">
                                <div style="position:relative;">
                                    <img src="${image}" alt="${escapeHtml(name)}" style="width:100%;height:180px;object-fit:cover;" onerror="this.src='https://via.placeholder.com/300x200?text=Hotel'">
                                    ${stars ? `<div style="position:absolute;top:12px;left:12px;background:rgba(0,0,0,0.6);backdrop-filter:blur(10px);color:#D4AF37;padding:4px 10px;border-radius:20px;font-size:0.85rem;">${'‚òÖ'.repeat(Math.min(stars, 5))}</div>` : ''}
                                    ${rating ? `<div style="position:absolute;top:12px;right:12px;background:rgba(0,0,0,0.6);backdrop-filter:blur(10px);color:white;padding:4px 10px;border-radius:20px;font-size:0.85rem;"><i class="fas fa-star" style="color:#ffc107;margin-right:4px;"></i>${rating}</div>` : ''}
                                </div>
                                <div style="padding:20px;">
                                    <h4 style="margin:0 0 6px;font-size:1.1rem;color:#1a1a2e;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">${escapeHtml(name)}</h4>
                                    ${location ? `<div style="font-size:0.8rem;color:#888;margin-bottom:10px;"><i class="fas fa-map-marker-alt" style="color:#e74c3c;margin-right:4px;"></i>${escapeHtml(location)}</div>` : ''}
                                    ${description ? `<div style="font-size:0.82rem;color:#666;margin-bottom:12px;line-height:1.4;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;">${escapeHtml(description)}</div>` : ''}
                                    ${amenities.length ? `
                                        <div style="display:flex;flex-wrap:wrap;gap:6px;margin-bottom:14px;">
                                            ${amenities.slice(0, 4).map(a => `<span style="font-size:0.72rem;background:#f0f7ff;color:#003580;padding:3px 8px;border-radius:6px;">${escapeHtml(a)}</span>`).join('')}
                                            ${amenities.length > 4 ? `<span style="font-size:0.72rem;color:#888;">+${amenities.length - 4}</span>` : ''}
                                        </div>
                                    ` : ''}
                                    <div style="display:flex;justify-content:space-between;align-items:center;padding-top:12px;border-top:1px solid #f0f0f0;">
                                        <div>
                                            <span style="font-size:1.4rem;font-weight:700;color:#003580;">${typeof price === 'number' ? currency + price.toLocaleString() : price}</span>
                                            <span style="font-size:0.8rem;color:#888;">/night</span>
                                        </div>
                                        ${hasBookingLink ? `
                                            <a href="${bookingLink}" target="_blank" rel="noopener noreferrer" style="display:flex;align-items:center;gap:6px;padding:10px 20px;background:linear-gradient(135deg,#003580,#0056b3);text-decoration:none;color:white;border-radius:10px;font-weight:600;font-size:0.9rem;transition:all 0.3s ease;box-shadow:0 4px 15px rgba(0,53,128,0.3);">
                                                <i class="fas fa-external-link-alt"></i> Book Now
                                            </a>
                                        ` : `
                                            <button onclick="searchHotelBooking('${escapeHtml(name)}')" style="padding:10px 20px;background:linear-gradient(135deg,#28a745,#20c997);color:white;border:none;border-radius:10px;font-weight:600;font-size:0.9rem;cursor:pointer;transition:all 0.3s ease;">Book Now</button>
                                        `}
                                    </div>
                                </div>
                            </div>
                        `;
            }).join('')}
                </div>
            `;
        }

        /**
         * Open Google search for flight booking (fallback when no direct link)
         */
        function searchFlightBooking(airline, flightNum, time) {
            const query = encodeURIComponent(`${airline} ${flightNum} ${time} book flight`);
            window.open(`https://www.google.com/search?q=${query}`, '_blank');
        }

        /**
         * Open Google search for hotel booking (fallback when no direct link)
         */
        function searchHotelBooking(hotelName) {
            const query = encodeURIComponent(`${hotelName} book hotel room`);
            window.open(`https://www.google.com/search?q=${query}`, '_blank');
        }

        /**
         * Display itinerary results in unified overlay
         * Handles both new JSON format (with GeoJSON) and legacy text format
         */
        function displayUnifiedItineraryResults(data) {
            const container = document.getElementById('unified-results-content');
            const placeholder = document.getElementById('unified-placeholder');
            if (placeholder) placeholder.style.display = 'none'; // Hide placeholder when showing results
            if (!container) return;

            let rawItinerary = data.itinerary || data.html || data;
            const format = data.format || 'text';

            console.log('displayUnifiedItineraryResults - format:', format, 'type:', typeof rawItinerary);

            // Try to parse if it's a JSON string
            if (typeof rawItinerary === 'string') {
                // Check if it looks like JSON (starts with {)
                const trimmed = rawItinerary.trim();
                if (trimmed.startsWith('{') || trimmed.startsWith('[')) {
                    try {
                        // Try to extract JSON from markdown code blocks first
                        const jsonMatch = trimmed.match(/```(?:json)?\s*([\s\S]*?)```/);
                        if (jsonMatch) {
                            rawItinerary = JSON.parse(jsonMatch[1].trim());
                        } else {
                            rawItinerary = JSON.parse(trimmed);
                        }
                        console.log('Parsed JSON successfully:', rawItinerary);
                    } catch (e) {
                        console.log('JSON parse failed, treating as text:', e.message);
                    }
                }
            }

            // Handle new JSON format with GeoJSON map_data
            if (typeof rawItinerary === 'object' && rawItinerary !== null && rawItinerary.map_data) {
                console.log('Rendering structured itinerary with map_data');
                renderStructuredItinerary(container, rawItinerary, data);
            } else if (typeof rawItinerary === 'object' && rawItinerary !== null && rawItinerary.itinerary_summary) {
                // Object with itinerary_summary but maybe no map_data
                console.log('Rendering structured itinerary (no map_data)');
                renderStructuredItinerary(container, rawItinerary, data);
            } else if (typeof rawItinerary === 'string') {
                // Legacy text format - convert markdown to HTML
                console.log('Rendering text itinerary');
                renderTextItinerary(container, rawItinerary);
            } else {
                // Fallback - show as formatted JSON or placeholder
                console.log('Fallback - unknown format');
                container.innerHTML = `
                    <div class="unified-placeholder">
                        <i class="fas fa-check-circle" style="color:#28a745;"></i>
                        <h3>Itinerary Generated!</h3>
                        <p>Your personalized travel plan is ready</p>
                    </div>

                    </div>
                `;
            }
        }

        /**
         * Render structured JSON itinerary with GeoJSON map data
         */
        function renderStructuredItinerary(container, itinerary, responseData) {
            const { itinerary_summary, map_data, travel_advice, estimated_cost } = itinerary;
            const features = map_data?.features || [];

            console.log('renderStructuredItinerary - map_data:', map_data);
            console.log('renderStructuredItinerary - features count:', features.length);
            console.log('renderStructuredItinerary - estimated_cost:', estimated_cost);

            // Group features by day
            const dayGroups = {};
            features.forEach(feature => {
                const day = feature.properties?.day_number || 1;
                if (!dayGroups[day]) dayGroups[day] = [];
                dayGroups[day].push(feature);
            });


            // Category icons and colors
            const categoryStyles = {
                food: { icon: 'fas fa-utensils', color: '#e74c3c' },
                culture: { icon: 'fas fa-landmark', color: '#9b59b6' },
                nature: { icon: 'fas fa-tree', color: '#27ae60' },
                shopping: { icon: 'fas fa-shopping-bag', color: '#f39c12' },
                entertainment: { icon: 'fas fa-star', color: '#3498db' },
                default: { icon: 'fas fa-map-marker-alt', color: '#ff6b35' }
            };

            // Build day cards HTML
            let daysHTML = '';
            Object.keys(dayGroups).sort((a, b) => parseInt(a) - parseInt(b)).forEach(dayNum => {
                const dayFeatures = dayGroups[dayNum];
                daysHTML += `
                    <div style="background:#fff;border-radius:16px;margin-bottom:25px;box-shadow:0 4px 20px rgba(0,0,0,0.08);overflow:hidden;">
                        <div style="background:linear-gradient(135deg,#ff6b35 0%,#f45c22 100%);padding:20px 25px;">
                            <div style="display:flex;align-items:center;gap:18px;">
                                <div style="width:55px;height:55px;background:rgba(255,255,255,0.25);border-radius:50%;display:flex;align-items:center;justify-content:center;flex-shrink:0;">
                                    <span style="font-size:1.6rem;font-weight:700;color:#fff;">${dayNum}</span>
                                </div>
                                <div>
                                    <h3 style="margin:0;color:#fff;font-size:1.5rem;font-weight:600;">Day ${dayNum}</h3>
                                    <p style="margin:5px 0 0;color:rgba(255,255,255,0.9);font-size:0.95rem;">${dayFeatures.length} activities planned</p>
                                </div>
                            </div>
                        </div>
                        <div style="padding:25px;">
                            ${dayFeatures.map((feature, idx) => {
                    const props = feature.properties || {};
                    const cat = (props.category || 'default').toLowerCase();
                    const style = categoryStyles[cat] || categoryStyles.default;
                    return `
                                    <div style="display:flex;gap:15px;align-items:flex-start;margin-bottom:${idx === dayFeatures.length - 1 ? '0' : '20px'};padding-bottom:${idx === dayFeatures.length - 1 ? '0' : '20px'};border-bottom:${idx === dayFeatures.length - 1 ? 'none' : '1px solid #eee'};">
                                        <div style="width:44px;height:44px;background:${style.color}15;border-radius:12px;display:flex;align-items:center;justify-content:center;flex-shrink:0;">
                                            <i class="${style.icon}" style="color:${style.color};font-size:1.1rem;"></i>
                                        </div>
                                        <div style="flex:1;">
                                            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
                                                <h4 style="margin:0;color:#1a1a2e;font-size:1.05rem;font-weight:600;">${escapeHtml(props.name || 'Activity')}</h4>
                                                <span style="font-size:0.85rem;color:#666;background:#f5f5f5;padding:4px 12px;border-radius:20px;">
                                                    <i class="fas fa-clock" style="margin-right:5px;"></i>${props.arrival_time || 'Flexible'}
                                                </span>
                                            </div>
                                            <p style="margin:0;color:#555;font-size:0.95rem;line-height:1.6;">${escapeHtml(props.activity_description || '')}</p>
                                            <span style="display:inline-block;margin-top:10px;font-size:0.75rem;padding:4px 10px;background:${style.color}20;color:${style.color};border-radius:12px;text-transform:capitalize;">${cat}</span>
                                        </div>
                                    </div>
                                `;
                }).join('')}
                        </div>
                    </div>
                `;
            });

            // Travel advice section
            let adviceHTML = '';
            if (travel_advice && travel_advice.length > 0) {
                adviceHTML = `
                    <div style="background:#f0f9ff;border-radius:16px;padding:25px;margin-bottom:25px;border:1px solid #e0f2fe;">
                        <div style="display:flex;align-items:flex-start;gap:15px;">
                            <span style="font-size:1.5rem;">üí°</span>
                            <div style="flex:1;">
                                <h4 style="margin:0 0 15px 0;color:#0369a1;font-size:1.2rem;">Travel Tips</h4>
                                <ul style="margin:0;padding:0;list-style:none;">
                                    ${travel_advice.map(tip => `
                                        <li style="margin-bottom:10px;padding-left:25px;position:relative;color:#374151;font-size:0.95rem;line-height:1.6;">
                                            <span style="position:absolute;left:0;color:#10b981;font-size:1.1rem;">‚úì</span>
                                            ${escapeHtml(tip)}
                                        </li>
                                    `).join('')}
                                </ul>
                            </div>
                        </div>
                    </div>
                `;
            }

            // Cost estimate section
            let costEstimateHTML = '';
            if (estimated_cost) {
                const breakdown = estimated_cost.breakdown || {};
                costEstimateHTML = `
                    <div style="background:linear-gradient(135deg,#059669 0%,#10b981 100%);border-radius:16px;padding:25px;margin-bottom:25px;color:#fff;box-shadow:0 4px 15px rgba(16,185,129,0.3);">
                        <div style="display:flex;align-items:center;gap:12px;margin-bottom:20px;">
                            <i class="fas fa-dollar-sign" style="font-size:1.8rem;background:rgba(255,255,255,0.2);padding:12px;border-radius:50%;"></i>
                            <div>
                                <h4 style="margin:0;font-size:1.3rem;font-weight:700;">Estimated Trip Cost</h4>
                                <p style="margin:5px 0 0;opacity:0.9;font-size:0.9rem;">Based on your selected budget tier</p>
                            </div>
                        </div>
                        <div style="display:flex;gap:30px;flex-wrap:wrap;margin-bottom:20px;">
                            <div style="flex:1;min-width:120px;">
                                <p style="margin:0;font-size:0.85rem;opacity:0.85;">Total Estimate</p>
                                <p style="margin:5px 0 0;font-size:1.8rem;font-weight:700;">${estimated_cost.total || 'N/A'}</p>
                            </div>
                            <div style="flex:1;min-width:120px;">
                                <p style="margin:0;font-size:0.85rem;opacity:0.85;">Per Day</p>
                                <p style="margin:5px 0 0;font-size:1.4rem;font-weight:600;">${estimated_cost.per_day || 'N/A'}</p>
                            </div>
                        </div>
                        <div style="background:rgba(255,255,255,0.15);border-radius:12px;padding:15px;">
                            <p style="margin:0 0 12px;font-size:0.9rem;font-weight:600;">Cost Breakdown</p>
                            <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:12px;">
                                <div style="display:flex;align-items:center;gap:8px;">
                                    <i class="fas fa-bed" style="width:20px;"></i>
                                    <span style="font-size:0.85rem;">${breakdown.accommodation || 'N/A'}</span>
                                </div>
                                <div style="display:flex;align-items:center;gap:8px;">
                                    <i class="fas fa-utensils" style="width:20px;"></i>
                                    <span style="font-size:0.85rem;">${breakdown.food || 'N/A'}</span>
                                </div>
                                <div style="display:flex;align-items:center;gap:8px;">
                                    <i class="fas fa-ticket-alt" style="width:20px;"></i>
                                    <span style="font-size:0.85rem;">${breakdown.activities || 'N/A'}</span>
                                </div>
                                <div style="display:flex;align-items:center;gap:8px;">
                                    <i class="fas fa-subway" style="width:20px;"></i>
                                    <span style="font-size:0.85rem;">${breakdown.transportation || 'N/A'}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            container.innerHTML = `
                <div class="itinerary-wrapper" style="display:flex;gap:25px;align-items:start;flex-wrap:wrap;">
                    <!-- Itinerary Content (Left) -->
                    <div class="itinerary-container" style="flex:1;min-width:350px;background:#fff;border-radius:16px;padding:30px;box-shadow:0 4px 20px rgba(0,0,0,0.08);">
                        <div class="itinerary-header" style="text-align:center;margin-bottom:30px;padding-bottom:20px;border-bottom:2px solid #f0f0f0;">
                            <h2 style="color:#1a1a2e;margin:0 0 10px 0;font-size:1.8rem;">
                                <i class="fas fa-map-marked-alt" style="color:#ff6b35;margin-right:10px;"></i>
                                Your Travel Itinerary
                            </h2>
                            <p style="color:#666;margin:0;">Generated with AI-powered travel planning</p>
                        </div>
                        
                        ${itinerary_summary ? `
                            <div style="background:#fef7ed;border:2px solid #fed7aa;padding:25px;border-radius:16px;margin-bottom:25px;">
                                <div style="display:flex;align-items:flex-start;gap:15px;">
                                    <i class="fas fa-info-circle" style="font-size:1.5rem;color:#ea580c;margin-top:3px;"></i>
                                    <p style="margin:0;font-size:1rem;line-height:1.8;color:#374151;">${escapeHtml(itinerary_summary)}</p>
                                </div>
                            </div>
                        ` : ''}
                        
                        <div class="itinerary-content">
                            ${daysHTML}
                        </div>
                        
                        ${costEstimateHTML}
                        
                        ${adviceHTML}
                    </div>


                    <!-- Map Container (Right - Sticky) -->
                    <div class="map-container-wrapper" style="flex:1;min-width:350px;min-height:500px;height:calc(100vh - 120px);max-height:700px;position:sticky;top:100px;align-self:flex-start;">
                        <div id="itinerary-map" style="width:100%;height:100%;min-height:500px;border-radius:16px;box-shadow:0 4px 20px rgba(0,0,0,0.15);overflow:hidden;"></div>
                    </div>
                </div>


                
                <div class="itinerary-actions" style="margin-top:20px;display:flex;gap:15px;justify-content:center;">
                    <button class="btn-outline" onclick="downloadItineraryPDF()">
                        <i class="fas fa-download"></i> Download PDF
                    </button>
                    <button class="btn-outline" onclick="shareItinerary()">
                        <i class="fas fa-share-alt"></i> Share
                    </button>
                    <button class="btn-outline" onclick="toggleMap()" id="btn-toggle-map" style="display:none;">
                        <i class="fas fa-map"></i> Toggle Map
                    </button>
                </div>
            `;

            // Initialize Mapbox with GeoJSON data - use longer timeout to ensure DOM is ready
            // Get destination from global state (set during itinerary generation), or fallback to input fields
            const destName = window.currentDestination ||
                document.getElementById('unified-ai-dest')?.value ||
                document.getElementById('ai-dest')?.value ||
                document.getElementById('unified-itinerary-dest')?.value ||
                '';

            console.log('Scheduling map initialization with map_data:', map_data, 'destination:', destName);
            setTimeout(() => {
                console.log('Calling initializeMapboxWithGeoJSON now');
                initializeMapboxWithGeoJSON(map_data, destName);
            }, 300);
        }

        /**
         * SIMPLE MAP INITIALIZATION - Always geocodes activity names
         */
        async function initializeMapWithDestination(container, destination, mapData = null) {
            console.log('üó∫Ô∏è Map init for:', destination);

            // Day colors 
            const DAY_COLORS = ['#3498db', '#27ae60', '#9b59b6', '#e67e22', '#e91e63', '#00bcd4', '#ff5722'];

            // Force container height
            container.style.cssText = 'min-height:450px;height:500px;width:100%;';
            container.innerHTML = '<div style="display:flex;align-items:center;justify-content:center;height:100%;background:#e8f4f8;border-radius:16px;"><p style="color:#0369a1;"><i class="fas fa-spinner fa-spin"></i> Loading map...</p></div>';

            // Set token
            mapboxgl.accessToken = 'pk.eyJ1Ijoidm95YTIzMiIsImEiOiJjbWw2amN0a2wwZHAyM2ZyMHR3bWthamt2In0.weBsgObWVo4j33JNKpSTCA';

            try {
                // 1. Geocode destination
                const destRes = await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(destination)}.json?access_token=${mapboxgl.accessToken}&limit=1`);
                const destData = await destRes.json();
                if (!destData.features?.length) throw new Error('Cannot geocode destination');

                const [destLng, destLat] = destData.features[0].center;
                console.log('‚úÖ Destination:', destination, [destLng, destLat]);

                // 2. Create map
                container.innerHTML = '';
                container.id = 'itinerary-map';

                const map = new mapboxgl.Map({
                    container: 'itinerary-map',
                    style: 'mapbox://styles/mapbox/streets-v12',
                    center: [destLng, destLat],
                    zoom: 11
                });
                map.addControl(new mapboxgl.NavigationControl(), 'top-right');

                // 3. On load, add destination marker and activity markers
                map.on('load', async () => {
                    console.log('‚úÖ Map loaded');

                    // Destination marker (orange)
                    new mapboxgl.Marker({ color: '#ff6b35' })
                        .setLngLat([destLng, destLat])
                        .setPopup(new mapboxgl.Popup().setHTML(`<b>${destination}</b>`))
                        .addTo(map);

                    // If no activity data, we're done
                    if (!mapData?.features?.length) {
                        console.log('No activity data, showing destination only');
                        return;
                    }

                    const bounds = new mapboxgl.LngLatBounds();
                    bounds.extend([destLng, destLat]);
                    const markersByDay = {};

                    // 4. Process each activity - ALWAYS geocode by name
                    for (let i = 0; i < mapData.features.length; i++) {
                        const feature = mapData.features[i];
                        const props = feature.properties || {};
                        const name = props.name || props.activity_name || `Activity ${i + 1}`;
                        const dayNum = parseInt(props.day_number) || parseInt(props.day) || 1;

                        // ALWAYS geocode the activity name with destination context
                        const searchQuery = `${name}, ${destination}`;
                        console.log(`üîç Geocoding: "${searchQuery}"`);

                        let coords = [destLng + (i * 0.003), destLat + (i * 0.003)]; // Default offset

                        try {
                            const actRes = await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(searchQuery)}.json?access_token=${mapboxgl.accessToken}&limit=1&proximity=${destLng},${destLat}`);
                            const actData = await actRes.json();
                            if (actData.features?.length) {
                                coords = actData.features[0].center;
                                console.log(`‚úÖ Found: ${name} at [${coords[0].toFixed(4)}, ${coords[1].toFixed(4)}]`);
                            } else {
                                console.warn(`‚ö†Ô∏è Not found: ${name}, using offset`);
                            }
                        } catch (e) {
                            console.warn(`‚ö†Ô∏è Geocode error for ${name}:`, e.message);
                        }

                        // Get day color
                        const color = DAY_COLORS[(dayNum - 1) % DAY_COLORS.length];

                        // Track by day for routes
                        if (!markersByDay[dayNum]) markersByDay[dayNum] = [];
                        markersByDay[dayNum].push({ coords, name, props });

                        // Create marker element
                        const el = document.createElement('div');
                        el.innerHTML = `<div style="background:${color};color:#fff;width:26px;height:26px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:10px;border:2px solid #fff;box-shadow:0 2px 4px rgba(0,0,0,0.3);">${dayNum}.${markersByDay[dayNum].length}</div>`;

                        new mapboxgl.Marker(el)
                            .setLngLat(coords)
                            .setPopup(new mapboxgl.Popup().setHTML(`<div style="padding:5px;"><span style="background:${color};color:#fff;padding:2px 6px;border-radius:8px;font-size:11px;">Day ${dayNum}</span><br><b>${name}</b><br><small>${props.arrival_time || ''}</small></div>`))
                            .addTo(map);

                        bounds.extend(coords);
                    }

                    // 5. Draw routes for each day
                    Object.keys(markersByDay).forEach(day => {
                        const dayMarkers = markersByDay[day];
                        if (dayMarkers.length < 2) return;

                        const color = DAY_COLORS[(day - 1) % DAY_COLORS.length];
                        const routeCoords = dayMarkers.map(m => m.coords);

                        map.addSource(`route-${day}`, {
                            type: 'geojson',
                            data: { type: 'Feature', geometry: { type: 'LineString', coordinates: routeCoords } }
                        });

                        // Different dash patterns per day
                        const dashPatterns = [
                            [],          // Day 1: Solid
                            [10, 5],     // Day 2: Dashed
                            [2, 4],      // Day 3: Dotted
                            [10, 5, 2, 5], // Day 4: Dash-dot
                            [15, 10],    // Day 5: Long dash
                            [5, 3],      // Day 6: Short dash
                            [20, 5, 5, 5] // Day 7: Dash-dot-dot
                        ];
                        const dashArray = dashPatterns[(day - 1) % dashPatterns.length];

                        map.addLayer({
                            id: `route-${day}`,
                            type: 'line',
                            source: `route-${day}`,
                            layout: {
                                'line-join': 'round',
                                'line-cap': 'round'
                            },
                            paint: {
                                'line-color': color,
                                'line-width': 4,
                                'line-opacity': 0.85,
                                'line-dasharray': dashArray.length > 0 ? dashArray : [1, 0]
                            }
                        });

                        console.log(`üìç Route Day ${day}: ${routeCoords.length} points, color ${color}, pattern: ${dashArray.length > 0 ? 'dashed' : 'solid'}`);
                    });

                    // 6. Fit bounds
                    if (!bounds.isEmpty()) {
                        map.fitBounds(bounds, { padding: 50, maxZoom: 13 });
                    }
                });

                window.itineraryMapInstance = map;

            } catch (err) {
                console.error('‚ùå Map error:', err);
                container.innerHTML = `<div style="display:flex;align-items:center;justify-content:center;height:100%;background:linear-gradient(135deg,#667eea,#764ba2);border-radius:16px;color:#fff;flex-direction:column;gap:10px;"><i class="fas fa-globe-americas" style="font-size:2.5rem;"></i><h3 style="margin:0;">${destination}</h3></div>`;
            }
        }



        /**
         * Initialize Mapbox map with GeoJSON feature collection
         */
        function initializeMapboxWithGeoJSON(mapData, destinationName) {
            console.log('initializeMapboxWithGeoJSON called with:', mapData, 'destination:', destinationName);

            const mapContainer = document.getElementById('itinerary-map');
            if (!mapContainer) {
                console.error('Map container #itinerary-map not found');
                return;
            }

            // Check if Mapbox is available
            if (typeof mapboxgl === 'undefined') {
                console.error('Mapbox GL JS not loaded - mapboxgl is undefined');
                mapContainer.innerHTML = '<div style="display:flex;align-items:center;justify-content:center;height:100%;background:#f5f5f5;border-radius:16px;"><p style="color:#666;">Map library not loaded</p></div>';
                return;
            }

            // Set access token
            if (!mapboxgl.accessToken) {
                mapboxgl.accessToken = 'pk.eyJ1Ijoidm95YTIzMiIsImEiOiJjbWw2amN0a2wwZHAyM2ZyMHR3bWthamt2In0.weBsgObWVo4j33JNKpSTCA';
            }

            // Get the destination for fallback geocoding
            const destination = destinationName ||
                window.currentDestination ||
                document.getElementById('unified-ai-dest')?.value ||
                document.getElementById('ai-dest')?.value ||
                document.getElementById('unified-itinerary-dest')?.value ||
                'Paris';

            // Check if we have valid features with backend-geocoded coordinates
            const hasValidFeatures = mapData && mapData.features && mapData.features.length > 0 &&
                mapData.features.some(f => {
                    if (!f.geometry || !f.geometry.coordinates) return false;
                    const [lng, lat] = f.geometry.coordinates;
                    return typeof lng === 'number' && typeof lat === 'number' &&
                        !isNaN(lng) && !isNaN(lat) &&
                        lng >= -180 && lng <= 180 && lat >= -90 && lat <= 90 &&
                        !(lng === 0 && lat === 0); // Reject placeholder [0,0]
                });

            // If features have valid (non-zero) geocoded coordinates from the backend, use them directly
            // Otherwise fall back to destination geocoding
            if (!hasValidFeatures) {
                console.log('No valid geocoded features ‚Äî falling back to destination geocoding for:', destination);
                initializeMapWithDestination(mapContainer, destination, mapData);
                return;
            }

            console.log('Using', mapData.features.filter(f => {
                const c = f.geometry?.coordinates;
                return c && typeof c[0] === 'number' && !(c[0] === 0 && c[1] === 0);
            }).length, 'geocoded features for map');
            console.log('Map data features count:', mapData.features.length);

            try {
                // Calculate bounds from all features
                const bounds = new mapboxgl.LngLatBounds();
                let validCoords = 0;

                mapData.features.forEach(feature => {
                    if (feature.geometry && feature.geometry.coordinates) {
                        const [lng, lat] = feature.geometry.coordinates;
                        // Validate coordinates are in valid range
                        if (lng >= -180 && lng <= 180 && lat >= -90 && lat <= 90) {
                            bounds.extend([lng, lat]);
                            validCoords++;
                        }
                    }
                });

                if (validCoords === 0) {
                    console.warn('No valid coordinates found in features, using destination fallback');
                    initializeMapWithDestination(mapContainer, destination);
                    return;
                }

                // Create map
                const map = new mapboxgl.Map({
                    container: 'itinerary-map',
                    style: 'mapbox://styles/mapbox/streets-v12',
                    bounds: bounds,
                    fitBoundsOptions: { padding: 50 }
                });

                map.addControl(new mapboxgl.NavigationControl(), 'top-right');

                // Category colors for markers
                const categoryColors = {
                    food: '#e74c3c',
                    culture: '#9b59b6',
                    nature: '#27ae60',
                    shopping: '#f39c12',
                    entertainment: '#3498db',
                    default: '#ff6b35'
                };


                // Add markers for each feature
                map.on('load', () => {
                    mapData.features.forEach((feature, index) => {
                        const coords = feature.geometry?.coordinates;
                        if (!coords || coords.length < 2) return;

                        const props = feature.properties || {};
                        const cat = (props.category || 'default').toLowerCase();
                        const color = categoryColors[cat] || categoryColors.default;

                        // Create marker element
                        const el = document.createElement('div');
                        el.className = 'itinerary-marker';
                        el.innerHTML = `<span style="display:flex;align-items:center;justify-content:center;width:32px;height:32px;background:${color};border-radius:50%;color:#fff;font-weight:700;font-size:0.85rem;box-shadow:0 2px 8px rgba(0,0,0,0.3);border:2px solid #fff;">${props.day_number || index + 1}</span>`;

                        // Create popup
                        const popup = new mapboxgl.Popup({ offset: 25 }).setHTML(`
                            <div style="padding:10px;max-width:250px;">
                                <h4 style="margin:0 0 8px 0;color:#1a1a2e;font-size:1rem;">${escapeHtml(props.name || 'Activity')}</h4>
                                <p style="margin:0 0 5px 0;color:#666;font-size:0.85rem;"><i class="fas fa-clock" style="margin-right:5px;"></i>${props.arrival_time || 'Flexible'}</p>
                                <p style="margin:0;color:#444;font-size:0.9rem;line-height:1.4;">${escapeHtml(props.activity_description || '')}</p>
                            </div>
                        `);

                        // Add marker to map
                        new mapboxgl.Marker(el)
                            .setLngLat(coords)
                            .setPopup(popup)
                            .addTo(map);
                    });

                    // Draw route line if there are multiple features
                    if (mapData.features.length > 1) {
                        const coordinates = mapData.features
                            .filter(f => f.geometry?.coordinates)
                            .map(f => f.geometry.coordinates);

                        map.addSource('route', {
                            'type': 'geojson',
                            'data': {
                                'type': 'Feature',
                                'properties': {},
                                'geometry': {
                                    'type': 'LineString',
                                    'coordinates': coordinates
                                }
                            }
                        });

                        map.addLayer({
                            'id': 'route',
                            'type': 'line',
                            'source': 'route',
                            'layout': {
                                'line-join': 'round',
                                'line-cap': 'round'
                            },
                            'paint': {
                                'line-color': '#ff6b35',
                                'line-width': 3,
                                'line-opacity': 0.7,
                                'line-dasharray': [2, 2]
                            }
                        });
                    }
                });

                // Store map reference globally
                window.itineraryMapInstance = map;
            } catch (err) {
                console.error('Error initializing Mapbox:', err);
                mapContainer.innerHTML = '<div style="display:flex;align-items:center;justify-content:center;height:100%;background:#f5f5f5;border-radius:16px;"><p style="color:#666;">Map unavailable</p></div>';
            }
        }

        /**
         * Render legacy text-based itinerary (markdown)
         */
        function renderTextItinerary(container, rawItinerary) {
            const formattedHTML = convertItineraryToHTML(rawItinerary);

            container.innerHTML = `
                <div class="itinerary-wrapper" style="display:flex;gap:25px;align-items:start;flex-wrap:wrap;">
                    <!-- Itinerary Content (Left) -->
                    <div class="itinerary-container" style="flex:1;min-width:350px;background:#fff;border-radius:16px;padding:30px;box-shadow:0 4px 20px rgba(0,0,0,0.08);">
                        <div class="itinerary-header" style="text-align:center;margin-bottom:30px;padding-bottom:20px;border-bottom:2px solid #f0f0f0;">
                            <h2 style="color:#1a1a2e;margin:0 0 10px 0;font-size:1.8rem;">
                                <i class="fas fa-map-marked-alt" style="color:#ff6b35;margin-right:10px;"></i>
                                Your Travel Itinerary
                            </h2>
                            <p style="color:#666;margin:0;">Generated with AI-powered travel planning</p>
                        </div>
                        <div class="itinerary-content">
                            ${formattedHTML}
                        </div>
                    </div>

                    <!-- Map Container (Right/Sticky) -->
                    <div class="map-container-wrapper" style="flex:1;min-width:350px;position:sticky;top:20px;height:calc(100vh - 40px);">
                        <div id="itinerary-map" style="width:100%;height:100%;border-radius:16px;box-shadow:0 4px 20px rgba(0,0,0,0.15);z-index:1;"></div>
                    </div>
                </div>
                
                <div class="itinerary-actions" style="margin-top:20px;display:flex;gap:15px;justify-content:center;">
                    <button class="btn-outline" onclick="downloadItineraryPDF()">
                        <i class="fas fa-download"></i> Download PDF
                    </button>
                    <button class="btn-outline" onclick="shareItinerary()">
                        <i class="fas fa-share-alt"></i> Share
                    </button>
                    <button class="btn-outline" onclick="toggleMap()" id="btn-toggle-map" style="display:none;">
                        <i class="fas fa-map"></i> Toggle Map
                    </button>
                </div>
            `;

            // Initialize map using legacy text parsing
            setTimeout(() => {
                const destination = document.getElementById('unified-ai-dest')?.value || 'Unknown';
                const parsedData = parseItineraryContent(rawItinerary);
                if (parsedData && parsedData.length > 0) {
                    initializeItineraryMap(destination, parsedData);
                }
            }, 100);
        }

        /**
         * Parse text itinerary content to extract activities and locations
         * Returns array of activity objects for map display
         */
        function parseItineraryContent(rawItinerary) {
            if (!rawItinerary || typeof rawItinerary !== 'string') return [];

            const activities = [];

            // Try to find day sections
            const dayPattern = /Day\s+(\d+)[:\s]*([\s\S]*?)(?=Day\s+\d+[:\s]|$)/gi;
            let dayMatch;

            while ((dayMatch = dayPattern.exec(rawItinerary)) !== null) {
                const dayNumber = parseInt(dayMatch[1]);
                const dayContent = dayMatch[2].trim();

                // Extract location names from the day content
                // Look for patterns like "Visit X", "Explore X", "Head to X", etc.
                const locationPatterns = [
                    /(?:Visit|Explore|Head to|Go to|Stop at|Check out|Experience|Discover|See|Tour)\s+(?:the\s+)?([A-Z][^.!?\n]{3,40})/gi,
                    /(?:at|in)\s+(?:the\s+)?([A-Z][A-Za-z\s&'-]{3,40}(?:Temple|Shrine|Museum|Park|Garden|Market|Tower|Palace|Castle|Beach|Restaurant|District|Area))/gi,
                    /\b([A-Z][A-Za-z\s&'-]{3,30}(?:Temple|Shrine|Museum|Park|Garden|Market|Tower|Palace|Castle|Beach|Station|Tower))\b/g
                ];

                for (const pattern of locationPatterns) {
                    let match;
                    while ((match = pattern.exec(dayContent)) !== null) {
                        const locationName = match[1].trim().replace(/[.,;:]$/, '');
                        if (locationName.length > 3 && locationName.length < 50) {
                            // Avoid duplicates
                            if (!activities.find(a => a.name?.toLowerCase() === locationName.toLowerCase())) {
                                activities.push({
                                    name: locationName,
                                    day: dayNumber,
                                    category: guessCategory(locationName)
                                });
                            }
                        }
                    }
                }
            }

            // If no activities found via patterns, try to extract any capitalized proper nouns
            if (activities.length === 0) {
                const properNounPattern = /\b([A-Z][a-z]+(?:\s+[A-Z][a-z]+)+)\b/g;
                let match;
                let count = 0;
                while ((match = properNounPattern.exec(rawItinerary)) !== null && count < 8) {
                    const name = match[1].trim();
                    // Filter out common non-location words
                    const excludeWords = ['Day One', 'Day Two', 'Day Three', 'Morning Visit', 'Afternoon Visit', 'Evening Visit'];
                    if (!excludeWords.some(w => name.includes(w)) && name.length > 4) {
                        activities.push({
                            name: name,
                            day: 1,
                            category: 'default'
                        });
                        count++;
                    }
                }
            }

            return activities;
        }

        /**
         * Guess activity category based on location name
         */
        function guessCategory(locationName) {
            const lower = locationName.toLowerCase();
            if (/temple|shrine|church|mosque|cathedral|monastery/i.test(lower)) return 'culture';
            if (/museum|gallery|palace|castle|memorial|monument/i.test(lower)) return 'culture';
            if (/park|garden|beach|mountain|forest|lake|river|falls|nature/i.test(lower)) return 'nature';
            if (/market|mall|shopping|bazaar|store|outlet/i.test(lower)) return 'shopping';
            if (/restaurant|cafe|food|street\s*food|ramen|sushi|dining/i.test(lower)) return 'food';
            if (/bar|club|theater|cinema|entertainment|arcade|show/i.test(lower)) return 'entertainment';
            return 'default';
        }


        /**
         * Strip ALL markdown characters from text - COMPREHENSIVE VERSION

         */
        function stripAllMarkdown(text) {
            if (!text) return '';
            return text
                // Headers
                .replace(/#{1,6}\s*/g, '')
                // Bold/italic with asterisks
                .replace(/\*\*\*(.+?)\*\*\*/g, '$1')
                .replace(/\*\*(.+?)\*\*/g, '$1')
                .replace(/\*([^*\n]+)\*/g, '$1')
                // Bold/italic with underscores
                .replace(/___(.+?)___/g, '$1')
                .replace(/__(.+?)__/g, '$1')
                .replace(/_([^_\n]+)_/g, '$1')
                // Code blocks and inline code
                .replace(/```[\s\S]*?```/g, '')
                .replace(/`([^`]+)`/g, '$1')
                // Links and images
                .replace(/!\[([^\]]*)\]\([^)]+\)/g, '$1')
                .replace(/\[([^\]]+)\]\([^)]+\)/g, '$1')
                // Bullet points and list markers
                .replace(/^[\s]*[-*‚Ä¢+]\s+/gm, '')
                .replace(/^\s*\d+\.\s+/gm, '')
                // Blockquotes
                .replace(/^>\s*/gm, '')
                // Horizontal rules
                .replace(/^[-*_]{3,}$/gm, '')
                .replace(/---+/g, '')
                // Table separators and pipes (for markdown tables)
                .replace(/\|/g, ' ')
                .replace(/^[-:\s|]+$/gm, '')
                // Extra cleanup
                .replace(/\s{2,}/g, ' ')
                .replace(/\n{3,}/g, '\n\n')
                .trim();
        }

        /**
         * Convert markdown itinerary to styled HTML with day cards
         * SIMPLIFIED VERSION - focuses on clean output
         */
        function convertItineraryToHTML(markdown) {
            if (!markdown) return '<p>No content available</p>';

            // First, fully clean the markdown to identify structure
            let html = '';
            const content = markdown;

            // Find all "Day X" patterns (various formats)
            const dayPattern = /(?:#{1,3}\s*)?(?:\*\*)?[Dd]ay\s*(\d+)[:\s\-‚Äì‚Äî]*([^\n]*)/g;
            const dayMatches = [...content.matchAll(dayPattern)];

            // Extract intro text (before first day mention)
            const firstDayPos = content.search(/(?:#{1,3}\s*)?(?:\*\*)?[Dd]ay\s*\d+/);
            if (firstDayPos > 30) {
                const introText = stripAllMarkdown(content.substring(0, firstDayPos));
                if (introText.length > 20) {
                    html += `
                        <div style="background:#fef7ed;border:2px solid #fed7aa;padding:25px;border-radius:16px;margin-bottom:25px;">
                            <div style="display:flex;align-items:flex-start;gap:15px;">
                                <i class="fas fa-info-circle" style="font-size:1.5rem;color:#ea580c;margin-top:3px;"></i>
                                <p style="margin:0;font-size:1rem;line-height:1.8;color:#374151;">${introText}</p>
                            </div>
                        </div>
                    `;
                }
            }

            // If no days found, just format everything cleanly
            if (dayMatches.length === 0) {
                const cleanContent = stripAllMarkdown(content);
                return `<div style="line-height:1.8;color:#333;padding:20px;">${formatAsParagraphs(cleanContent)}</div>`;
            }

            // Process each day
            for (let i = 0; i < dayMatches.length; i++) {
                const dayNum = dayMatches[i][1];
                const dayTitle = stripAllMarkdown(dayMatches[i][2] || '').replace(/\*+/g, '').trim();

                // Extract day content (from this day marker to next day marker or end)
                const startPos = dayMatches[i].index + dayMatches[i][0].length;
                const endPos = dayMatches[i + 1]?.index || content.length;
                const rawDayContent = content.substring(startPos, endPos);

                // Clean the day content completely
                const cleanDayContent = stripAllMarkdown(rawDayContent);

                html += `
                    <div style="background:#fff;border-radius:16px;margin-bottom:25px;box-shadow:0 4px 20px rgba(0,0,0,0.08);overflow:hidden;">
                        <div style="background:linear-gradient(135deg,#ff6b35 0%,#f45c22 100%);padding:20px 25px;">
                            <div style="display:flex;align-items:center;gap:18px;">
                                <div style="width:55px;height:55px;background:rgba(255,255,255,0.25);border-radius:50%;display:flex;align-items:center;justify-content:center;flex-shrink:0;">
                                    <span style="font-size:1.6rem;font-weight:700;color:#fff;">${dayNum}</span>
                                </div>
                                <div>
                                    <h3 style="margin:0;color:#fff;font-size:1.5rem;font-weight:600;">Day ${dayNum}</h3>
                                    ${dayTitle.length > 3 ? `<p style="margin:8px 0 0 0;color:rgba(255,255,255,0.95);font-size:1.05rem;">${dayTitle}</p>` : ''}
                                </div>
                            </div>
                        </div>
                        <div style="padding:25px;">
                            ${formatDayActivities(cleanDayContent)}
                        </div>
                    </div>
                `;
            }

            // Look for additional info sections (tips, costs, etc.) after all days
            const lastDayEnd = dayMatches[dayMatches.length - 1]?.index || 0;
            const lastDayContent = content.substring(lastDayEnd);
            const tipPattern = /(?:#{1,3}\s*)?(?:\*\*)?(Tips|Estimated Costs|Pro Tips|Budget|Transportation|Notes)[:\s\*]*/gi;
            if (tipPattern.test(lastDayContent)) {
                const tipSection = stripAllMarkdown(lastDayContent.substring(lastDayContent.search(tipPattern)));
                if (tipSection.length > 30) {
                    html += `
                        <div style="background:#f0f9ff;border-radius:16px;padding:25px;margin-bottom:25px;border:1px solid #e0f2fe;">
                            <div style="display:flex;align-items:flex-start;gap:15px;">
                                <span style="font-size:1.5rem;">üí°</span>
                                <div>
                                    <h4 style="margin:0 0 15px 0;color:#0369a1;font-size:1.2rem;">Tips & Information</h4>
                                    <div style="color:#444;line-height:1.7;">${formatAsParagraphs(tipSection)}</div>
                                </div>
                            </div>
                        </div>
                    `;
                }
            }

            return html;
        }

        /**
         * Format day activities into organized sections
         */
        function formatDayActivities(content) {
            if (!content || content.length < 5) return '<p style="color:#666;">No activities planned</p>';

            // Split content by time markers (Morning, Afternoon, Evening, etc.)
            const timePatterns = ['Morning', 'Afternoon', 'Evening', 'Night', 'Lunch', 'Dinner', 'Breakfast'];
            let html = '';
            let remainingContent = content;
            let foundSections = false;

            // Try to find and split by time-of-day sections
            for (const timeName of timePatterns) {
                const regex = new RegExp(`(${timeName}[^:]*:?)\\s*`, 'gi');
                const match = remainingContent.match(regex);
                if (match) {
                    foundSections = true;
                    const parts = remainingContent.split(regex);

                    for (let i = 0; i < parts.length; i++) {
                        const part = parts[i]?.trim();
                        if (!part) continue;

                        // Check if this is a time header
                        if (timePatterns.some(t => part.toLowerCase().includes(t.toLowerCase()))) {
                            const nextContent = parts[i + 1]?.trim();
                            if (nextContent && nextContent.length > 10) {
                                const icon = getTimeIcon(part);
                                html += `
                                    <div style="margin-bottom:20px;padding:20px;background:#ffffff;border-radius:12px;border:1px solid #e5e7eb;box-shadow:0 2px 8px rgba(0,0,0,0.06);">
                                        <div style="display:flex;align-items:center;gap:12px;margin-bottom:15px;padding-bottom:12px;border-bottom:2px solid #ff6b35;">
                                            <span style="font-size:1.5rem;">${icon}</span>
                                            <h4 style="margin:0;color:#1f2937;font-size:1.15rem;font-weight:700;text-transform:uppercase;letter-spacing:0.5px;">${part.replace(/:/g, '')}</h4>
                                        </div>
                                        <div style="color:#374151;line-height:1.9;font-size:1rem;">
                                            ${formatAsParagraphs(nextContent)}
                                        </div>
                                    </div>
                                `;
                                i++; // Skip the content part as we've used it
                            }
                        }
                    }
                }
            }

            // If no time sections found, just format as paragraphs
            if (!foundSections || html === '') {
                html = `<div style="color:#374151;line-height:1.9;font-size:0.95rem;">${formatAsParagraphs(content)}</div>`;
            }

            return html;
        }

        /**
         * Get emoji icon for time of day
         */
        function getTimeIcon(timeText) {
            const lower = timeText.toLowerCase();
            if (lower.includes('morning') || lower.includes('breakfast')) return '‚òÄÔ∏è';
            if (lower.includes('lunch')) return 'üçΩÔ∏è';
            if (lower.includes('afternoon')) return 'üå§Ô∏è';
            if (lower.includes('dinner')) return 'üç∑';
            if (lower.includes('evening')) return 'üåô';
            if (lower.includes('night')) return '‚≠ê';
            return 'üìç';
        }

        /**
         * Format clean text as nice paragraphs with bullet points for lists
         */
        function formatAsParagraphs(text) {
            if (!text) return '';

            // Split by sentences
            const sentences = text.split(/(?<=[.!?])\s+/).filter(s => s.trim().length > 3);

            if (sentences.length >= 5) {
                // Many sentences - format as checklist with visible text
                return `<ul style="margin:0;padding:0;list-style:none;">
                    ${sentences.map(s => `
                        <li style="margin-bottom:12px;padding-left:30px;position:relative;color:#374151;font-size:0.95rem;line-height:1.8;">
                            <span style="position:absolute;left:0;color:#10b981;font-size:1.1rem;font-weight:bold;">‚úì</span>
                            ${s.trim()}
                        </li>
                    `).join('')}
                </ul>`;
            } else if (sentences.length >= 2) {
                // Few sentences - format as paragraph
                return `<p style="margin:0;line-height:1.9;color:#374151;font-size:0.95rem;">${sentences.join(' ')}</p>`;
            } else {
                // Single sentence
                return `<p style="margin:0;color:#374151;font-size:0.95rem;line-height:1.8;">${text}</p>`;
            }
        }

        /**
         * Format day content (alias for backwards compatibility)
         */
        function formatDayContent(content) {
            return formatDayActivities(stripAllMarkdown(content));
        }

        /**
         * Format clean content (alias)
         */
        function formatCleanContent(text) {
            return formatAsParagraphs(stripAllMarkdown(text));
        }

        /**
         * Format inline markdown - just strip it
         */
        function formatInlineMarkdown(text) {
            return stripAllMarkdown(text);
        }

        // ==================== INTERACTIVE MAP INTEGRATION ====================
        // Mapbox GL JS implementation for itinerary map

        let itineraryMap = null;

        /**
         * Initialize the itinerary map with Mapbox GL JS
         * @param {string} destination - The destination name
         * @param {Array} activities - Array of parsed activities with location names
         */
        async function initializeItineraryMap(destination, activities) {
            const mapContainer = document.getElementById('itinerary-map');
            if (!mapContainer) {
                console.warn('Map container not found');
                return;
            }

            // Check if Mapbox is available
            if (typeof mapboxgl === 'undefined') {
                console.warn('Mapbox GL JS not loaded');
                mapContainer.innerHTML = '<div style="display:flex;align-items:center;justify-content:center;height:100%;background:#f5f5f5;border-radius:16px;"><p style="color:#666;">Map loading...</p></div>';
                return;
            }

            // Set access token
            mapboxgl.accessToken = 'pk.eyJ1Ijoidm95YTIzMiIsImEiOiJjbWw2amN0a2wwZHAyM2ZyMHR3bWthamt2In0.weBsgObWVo4j33JNKpSTCA';

            try {
                // Geocode the destination to get initial center
                const destCoords = await geocodeLocation(destination);
                if (!destCoords) {
                    mapContainer.innerHTML = '<div style="display:flex;align-items:center;justify-content:center;height:100%;background:#f5f5f5;border-radius:16px;"><p style="color:#666;">Could not load map for this destination</p></div>';
                    return;
                }

                // Remove existing map if any
                if (itineraryMap) {
                    itineraryMap.remove();
                    itineraryMap = null;
                }

                // Create map
                itineraryMap = new mapboxgl.Map({
                    container: 'itinerary-map',
                    style: 'mapbox://styles/mapbox/streets-v12',
                    center: [destCoords.lng, destCoords.lat],
                    zoom: 12
                });

                itineraryMap.addControl(new mapboxgl.NavigationControl(), 'top-right');

                // Wait for map to load
                itineraryMap.on('load', async () => {
                    const markers = [];
                    const bounds = new mapboxgl.LngLatBounds();
                    bounds.extend([destCoords.lng, destCoords.lat]);

                    // Category colors
                    const categoryColors = {
                        food: '#e74c3c',
                        culture: '#9b59b6',
                        nature: '#27ae60',
                        shopping: '#f39c12',
                        entertainment: '#3498db',
                        default: '#ff6b35'
                    };

                    // Add markers for each activity
                    for (let i = 0; i < activities.length; i++) {
                        const activity = activities[i];
                        const activityLocation = activity.location || activity.name || activity;

                        // Geocode activity location
                        const coords = await geocodeLocation(`${activityLocation}, ${destination}`);
                        if (!coords) continue;

                        // Determine marker color based on category
                        const category = (activity.category || 'default').toLowerCase();
                        const color = categoryColors[category] || categoryColors.default;

                        // Create custom marker element
                        const el = document.createElement('div');
                        el.className = 'itinerary-marker';
                        el.innerHTML = `<span style="display:flex;align-items:center;justify-content:center;width:32px;height:32px;background:${color};border-radius:50%;color:#fff;font-weight:700;font-size:0.85rem;box-shadow:0 2px 8px rgba(0,0,0,0.3);border:2px solid #fff;">${i + 1}</span>`;

                        // Create popup
                        const popupContent = `
                            <div style="padding:10px;max-width:220px;">
                                <h4 style="margin:0 0 8px 0;color:#1a1a2e;font-size:1rem;">${escapeHtml(activity.name || activityLocation)}</h4>
                                ${activity.time ? `<p style="margin:0 0 5px 0;color:#666;font-size:0.85rem;"><i class="fas fa-clock" style="margin-right:5px;"></i>${activity.time}</p>` : ''}
                                ${activity.description ? `<p style="margin:0;color:#444;font-size:0.9rem;line-height:1.4;">${escapeHtml(activity.description.substring(0, 100))}${activity.description.length > 100 ? '...' : ''}</p>` : ''}
                            </div>
                        `;

                        const popup = new mapboxgl.Popup({ offset: 25 }).setHTML(popupContent);

                        // Add marker to map
                        const marker = new mapboxgl.Marker(el)
                            .setLngLat([coords.lng, coords.lat])
                            .setPopup(popup)
                            .addTo(itineraryMap);

                        markers.push({ coords: [coords.lng, coords.lat], marker });
                        bounds.extend([coords.lng, coords.lat]);
                    }

                    // Fit map to show all markers
                    if (markers.length > 0) {
                        itineraryMap.fitBounds(bounds, { padding: 50, maxZoom: 14 });

                        // Draw route line connecting markers
                        if (markers.length > 1) {
                            const routeCoords = markers.map(m => m.coords);

                            if (!itineraryMap.getSource('route')) {
                                itineraryMap.addSource('route', {
                                    'type': 'geojson',
                                    'data': {
                                        'type': 'Feature',
                                        'properties': {},
                                        'geometry': {
                                            'type': 'LineString',
                                            'coordinates': routeCoords
                                        }
                                    }
                                });

                                itineraryMap.addLayer({
                                    'id': 'route',
                                    'type': 'line',
                                    'source': 'route',
                                    'layout': {
                                        'line-join': 'round',
                                        'line-cap': 'round'
                                    },
                                    'paint': {
                                        'line-color': '#ff6b35',
                                        'line-width': 3,
                                        'line-opacity': 0.7,
                                        'line-dasharray': [2, 2]
                                    }
                                });
                            }
                        }
                    }
                });

            } catch (err) {
                console.error('Error initializing map:', err);
                mapContainer.innerHTML = '<div style="display:flex;align-items:center;justify-content:center;height:100%;background:#f5f5f5;border-radius:16px;"><p style="color:#666;">Map unavailable</p></div>';
            }
        }

        /**
         * Geocode a location name to coordinates using Mapbox Geocoding API
         */
        async function geocodeLocation(locationName) {
            if (!locationName) return null;

            try {
                const query = encodeURIComponent(locationName);
                const response = await fetch(
                    `https://api.mapbox.com/geocoding/v5/mapbox.places/${query}.json?access_token=${mapboxgl.accessToken}&limit=1`
                );

                if (!response.ok) return null;

                const data = await response.json();
                if (data.features && data.features.length > 0) {
                    const [lng, lat] = data.features[0].center;
                    return { lng, lat };
                }
            } catch (err) {
                console.error('Geocoding error:', err);
            }
            return null;
        }

        /**
         * NOTE: initializeMapboxWithGeoJSON is defined above (line ~8081)
         * It properly geocodes all activity locations using Mapbox API
         * A duplicate version was removed that used raw AI coordinates without geocoding
         */


        /**
         * Toggle map visibility (for mobile)
         */
        function toggleMap() {
            const mapWrapper = document.querySelector('.map-container-wrapper');
            const itinContainer = document.querySelector('.itinerary-container');
            const btn = document.getElementById('btn-toggle-map');

            if (!mapWrapper || !itinContainer) return;

            if (mapWrapper.style.display === 'none' || getComputedStyle(mapWrapper).display === 'none') {
                mapWrapper.style.display = 'block';
                itinContainer.style.flex = '1'; // Share space
                if (btn) btn.innerHTML = '<i class="fas fa-map"></i> Hide Map';
            } else {
                mapWrapper.style.display = 'none';
                itinContainer.style.flex = '100%'; // Full width
                if (btn) btn.innerHTML = '<i class="fas fa-map"></i> Show Map';
            }

            // Trigger Mapbox resize instead of Leaflet's invalidateSize
            if (itineraryMap) setTimeout(() => itineraryMap.resize(), 100);
        }


        /**
         * Extract airport code from input (handles "City (CODE)" format)
         */
        function extractAirportCode(input) {
            const match = input.match(/\\(([A-Z]{3})\\)/);
            if (match) return match[1];
            return input.toUpperCase().slice(0, 3);
        }

        // ==================== TRIP TYPE SELECTION ====================

        /**
         * Select trip type: oneway, roundtrip, or multicity
         * Updates UI to show/hide relevant fields
         */
        function selectTripType(tripType) {
            // Update hidden input
            document.getElementById('flight-trip-type').value = tripType;

            // Update button states
            document.querySelectorAll('.trip-type-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.trip === tripType) {
                    btn.classList.add('active');
                }
            });

            // Show/hide relevant sections
            const standardSearch = document.getElementById('standard-search');
            const multicitySearch = document.getElementById('multicity-search');
            const returnDateGroup = document.getElementById('return-date-group');

            if (tripType === 'multicity') {
                standardSearch.style.display = 'none';
                multicitySearch.style.display = 'block';
            } else {
                standardSearch.style.display = 'block';
                multicitySearch.style.display = 'none';

                // Show/hide return date based on trip type
                if (tripType === 'oneway') {
                    returnDateGroup.style.display = 'none';
                    document.getElementById('flight-return').value = ''; // Clear return date
                } else {
                    returnDateGroup.style.display = 'block';
                }
            }
        }

        /**
         * Add a new flight leg for multi-city search
         */
        let multicityLegCount = 2;
        function addMulticityLeg() {
            if (multicityLegCount >= 5) {
                alert('Maximum 5 flight legs allowed');
                return;
            }

            multicityLegCount++;
            const legsContainer = document.getElementById('multicity-legs');

            const newLeg = document.createElement('div');
            newLeg.className = 'multicity-leg';
            newLeg.dataset.leg = multicityLegCount;
            newLeg.innerHTML = `
                <div class="search-grid">
                    <div class="input-group">
                        <label>Flight ${multicityLegCount} - From</label>
                        <input type="text" id="mc-from-${multicityLegCount}" placeholder="City or airport" autocomplete="off">
                    </div>
                    <div class="input-group">
                        <label>To</label>
                        <input type="text" id="mc-to-${multicityLegCount}" placeholder="City or airport" autocomplete="off">
                    </div>
                    <div class="input-group">
                        <label>Date</label>
                        <input type="date" id="mc-date-${multicityLegCount}">
                    </div>
                    <div class="input-group" style="display:flex;align-items:flex-end;">
                        <button type="button" onclick="removeMulticityLeg(${multicityLegCount})" style="background:#dc3545;color:#fff;border:none;padding:8px 12px;border-radius:6px;cursor:pointer;font-size:0.85rem;">
                            <i class="fas fa-times"></i> Remove
                        </button>
                    </div>
                </div>
            `;
            legsContainer.appendChild(newLeg);
        }

        /**
         * Remove a multi-city leg
         */
        function removeMulticityLeg(legNum) {
            const leg = document.querySelector(`.multicity-leg[data-leg="${legNum}"]`);
            if (leg) {
                leg.remove();
            }
        }

        /**
         * Search multi-city flights (opens Google Flights)
         */
        function searchMulticity() {
            // Collect all multi-city legs
            const legs = [];
            document.querySelectorAll('.multicity-leg').forEach(leg => {
                const legNum = leg.dataset.leg;
                const from = document.getElementById(`mc-from-${legNum}`)?.value?.trim().toUpperCase() || '';
                const to = document.getElementById(`mc-to-${legNum}`)?.value?.trim().toUpperCase() || '';
                const date = document.getElementById(`mc-date-${legNum}`)?.value || '';

                if (from && to && date) {
                    legs.push({ from, to, date });
                }
            });

            if (legs.length < 2) {
                alert('Please fill in at least 2 flight legs for multi-city search');
                return;
            }

            // Build Google Flights multi-city URL
            // Format: /m/<from>.<to>.<date>/<from>.<to>.<date>...
            const flightLegs = legs.map(l => `${l.from}.${l.to}.${l.date.replace(/-/g, '')}`).join('/');
            const googleFlightsUrl = `https://www.google.com/travel/flights?hl=en&tfs=/m/${flightLegs}`;

            window.open(googleFlightsUrl, '_blank');
        }

        /**
         * Handle flight search button click - routes to appropriate search function
         */
        function handleFlightSearch() {
            const tripType = document.getElementById('flight-trip-type').value;

            if (tripType === 'multicity') {
                searchMulticity();
            } else {
                searchFlights();
            }
        }

        // Comprehensive Airports Database (300+ airports worldwide)
        const airports = [
            // INDIA - All Major Airports
            { code: 'DEL', name: 'Indira Gandhi Intl', city: 'New Delhi', country: 'India' }, { code: 'BOM', name: 'Chhatrapati Shivaji Intl', city: 'Mumbai', country: 'India' }, { code: 'BLR', name: 'Kempegowda Intl', city: 'Bangalore', country: 'India' }, { code: 'MAA', name: 'Chennai Intl', city: 'Chennai', country: 'India' }, { code: 'CCU', name: 'Netaji Subhash Chandra Bose Intl', city: 'Kolkata', country: 'India' }, { code: 'HYD', name: 'Rajiv Gandhi Intl', city: 'Hyderabad', country: 'India' }, { code: 'COK', name: 'Cochin Intl', city: 'Kochi', country: 'India' }, { code: 'GOI', name: 'Goa Intl (Dabolim)', city: 'Goa', country: 'India' }, { code: 'AMD', name: 'Sardar Vallabhbhai Patel Intl', city: 'Ahmedabad', country: 'India' }, { code: 'PNQ', name: 'Pune Airport', city: 'Pune', country: 'India' }, { code: 'JAI', name: 'Jaipur Intl', city: 'Jaipur', country: 'India' }, { code: 'LKO', name: 'Chaudhary Charan Singh Intl', city: 'Lucknow', country: 'India' }, { code: 'GAU', name: 'Lokpriya Gopinath Bordoloi Intl', city: 'Guwahati', country: 'India' }, { code: 'SXR', name: 'Sheikh ul-Alam Intl', city: 'Srinagar', country: 'India' }, { code: 'IXC', name: 'Chandigarh Intl', city: 'Chandigarh', country: 'India' }, { code: 'TRV', name: 'Trivandrum Intl', city: 'Thiruvananthapuram', country: 'India' }, { code: 'VNS', name: 'Lal Bahadur Shastri Intl', city: 'Varanasi', country: 'India' }, { code: 'IXB', name: 'Bagdogra Airport', city: 'Siliguri', country: 'India' }, { code: 'IXM', name: 'Madurai Airport', city: 'Madurai', country: 'India' }, { code: 'IXE', name: 'Mangalore Intl', city: 'Mangalore', country: 'India' }, { code: 'NAG', name: 'Dr. Babasaheb Ambedkar Intl', city: 'Nagpur', country: 'India' }, { code: 'PAT', name: 'Jay Prakash Narayan Intl', city: 'Patna', country: 'India' }, { code: 'BBI', name: 'Biju Patnaik Intl', city: 'Bhubaneswar', country: 'India' }, { code: 'IXR', name: 'Birsa Munda Airport', city: 'Ranchi', country: 'India' }, { code: 'RAJ', name: 'Rajkot Airport', city: 'Rajkot', country: 'India' }, { code: 'BDQ', name: 'Vadodara Airport', city: 'Vadodara', country: 'India' }, { code: 'STV', name: 'Surat Airport', city: 'Surat', country: 'India' }, { code: 'IDR', name: 'Devi Ahilyabai Holkar Airport', city: 'Indore', country: 'India' }, { code: 'BHO', name: 'Raja Bhoj Airport', city: 'Bhopal', country: 'India' }, { code: 'RPR', name: 'Swami Vivekananda Airport', city: 'Raipur', country: 'India' }, { code: 'VTZ', name: 'Visakhapatnam Airport', city: 'Visakhapatnam', country: 'India' }, { code: 'CJB', name: 'Coimbatore Intl', city: 'Coimbatore', country: 'India' }, { code: 'TRZ', name: 'Tiruchirappalli Intl', city: 'Tiruchirappalli', country: 'India' }, { code: 'IXA', name: 'Agartala Airport', city: 'Agartala', country: 'India' }, { code: 'IMF', name: 'Imphal Airport', city: 'Imphal', country: 'India' }, { code: 'DIB', name: 'Dibrugarh Airport', city: 'Dibrugarh', country: 'India' }, { code: 'JDH', name: 'Jodhpur Airport', city: 'Jodhpur', country: 'India' }, { code: 'UDR', name: 'Maharana Pratap Airport', city: 'Udaipur', country: 'India' }, { code: 'IXJ', name: 'Jammu Airport', city: 'Jammu', country: 'India' }, { code: 'ATQ', name: 'Sri Guru Ram Dass Jee Intl', city: 'Amritsar', country: 'India' }, { code: 'DED', name: 'Jolly Grant Airport', city: 'Dehradun', country: 'India' }, { code: 'IXL', name: 'Kushok Bakula Rimpochee Airport', city: 'Leh', country: 'India' }, { code: 'GOX', name: 'Manohar Intl (Mopa)', city: 'North Goa', country: 'India' },
            // UAE & MIDDLE EAST
            { code: 'DXB', name: 'Dubai Intl', city: 'Dubai', country: 'UAE' }, { code: 'AUH', name: 'Abu Dhabi Intl', city: 'Abu Dhabi', country: 'UAE' }, { code: 'SHJ', name: 'Sharjah Intl', city: 'Sharjah', country: 'UAE' }, { code: 'DWC', name: 'Al Maktoum Intl', city: 'Dubai', country: 'UAE' }, { code: 'DOH', name: 'Hamad Intl', city: 'Doha', country: 'Qatar' }, { code: 'MCT', name: 'Muscat Intl', city: 'Muscat', country: 'Oman' }, { code: 'SLL', name: 'Salalah Airport', city: 'Salalah', country: 'Oman' }, { code: 'BAH', name: 'Bahrain Intl', city: 'Manama', country: 'Bahrain' }, { code: 'KWI', name: 'Kuwait Intl', city: 'Kuwait City', country: 'Kuwait' }, { code: 'RUH', name: 'King Khalid Intl', city: 'Riyadh', country: 'Saudi Arabia' }, { code: 'JED', name: 'King Abdulaziz Intl', city: 'Jeddah', country: 'Saudi Arabia' }, { code: 'DMM', name: 'King Fahd Intl', city: 'Dammam', country: 'Saudi Arabia' }, { code: 'MED', name: 'Prince Mohammad Bin Abdulaziz Intl', city: 'Medina', country: 'Saudi Arabia' }, { code: 'TLV', name: 'Ben Gurion Intl', city: 'Tel Aviv', country: 'Israel' }, { code: 'AMM', name: 'Queen Alia Intl', city: 'Amman', country: 'Jordan' }, { code: 'BEY', name: 'Beirut Rafic Hariri Intl', city: 'Beirut', country: 'Lebanon' }, { code: 'BGW', name: 'Baghdad Intl', city: 'Baghdad', country: 'Iraq' }, { code: 'IKA', name: 'Imam Khomeini Intl', city: 'Tehran', country: 'Iran' },
            // SOUTHEAST ASIA
            { code: 'SIN', name: 'Singapore Changi', city: 'Singapore', country: 'Singapore' }, { code: 'BKK', name: 'Suvarnabhumi', city: 'Bangkok', country: 'Thailand' }, { code: 'DMK', name: 'Don Mueang Intl', city: 'Bangkok', country: 'Thailand' }, { code: 'HKT', name: 'Phuket Intl', city: 'Phuket', country: 'Thailand' }, { code: 'CNX', name: 'Chiang Mai Intl', city: 'Chiang Mai', country: 'Thailand' }, { code: 'KUL', name: 'Kuala Lumpur Intl', city: 'Kuala Lumpur', country: 'Malaysia' }, { code: 'PEN', name: 'Penang Intl', city: 'Penang', country: 'Malaysia' }, { code: 'LGK', name: 'Langkawi Intl', city: 'Langkawi', country: 'Malaysia' }, { code: 'BKI', name: 'Kota Kinabalu Intl', city: 'Kota Kinabalu', country: 'Malaysia' }, { code: 'KCH', name: 'Kuching Intl', city: 'Kuching', country: 'Malaysia' }, { code: 'CGK', name: 'Soekarno-Hatta Intl', city: 'Jakarta', country: 'Indonesia' }, { code: 'DPS', name: 'Ngurah Rai Intl', city: 'Bali', country: 'Indonesia' }, { code: 'SUB', name: 'Juanda Intl', city: 'Surabaya', country: 'Indonesia' }, { code: 'YIA', name: 'Yogyakarta Intl', city: 'Yogyakarta', country: 'Indonesia' }, { code: 'UPG', name: 'Sultan Hasanuddin Intl', city: 'Makassar', country: 'Indonesia' }, { code: 'MNL', name: 'Ninoy Aquino Intl', city: 'Manila', country: 'Philippines' }, { code: 'CEB', name: 'Mactan-Cebu Intl', city: 'Cebu', country: 'Philippines' }, { code: 'CRK', name: 'Clark Intl', city: 'Angeles', country: 'Philippines' }, { code: 'SGN', name: 'Tan Son Nhat Intl', city: 'Ho Chi Minh City', country: 'Vietnam' }, { code: 'HAN', name: 'Noi Bai Intl', city: 'Hanoi', country: 'Vietnam' }, { code: 'DAD', name: 'Da Nang Intl', city: 'Da Nang', country: 'Vietnam' }, { code: 'CXR', name: 'Cam Ranh Intl', city: 'Nha Trang', country: 'Vietnam' }, { code: 'PQC', name: 'Phu Quoc Intl', city: 'Phu Quoc', country: 'Vietnam' }, { code: 'RGN', name: 'Yangon Intl', city: 'Yangon', country: 'Myanmar' }, { code: 'REP', name: 'Siem Reap Intl', city: 'Siem Reap', country: 'Cambodia' }, { code: 'PNH', name: 'Phnom Penh Intl', city: 'Phnom Penh', country: 'Cambodia' }, { code: 'VTE', name: 'Wattay Intl', city: 'Vientiane', country: 'Laos' }, { code: 'BWN', name: 'Brunei Intl', city: 'Bandar Seri Begawan', country: 'Brunei' },
            // EAST ASIA
            { code: 'HKG', name: 'Hong Kong Intl', city: 'Hong Kong', country: 'China' }, { code: 'PEK', name: 'Beijing Capital Intl', city: 'Beijing', country: 'China' }, { code: 'PKX', name: 'Beijing Daxing Intl', city: 'Beijing', country: 'China' }, { code: 'PVG', name: 'Shanghai Pudong Intl', city: 'Shanghai', country: 'China' }, { code: 'SHA', name: 'Shanghai Hongqiao Intl', city: 'Shanghai', country: 'China' }, { code: 'CAN', name: 'Guangzhou Baiyun Intl', city: 'Guangzhou', country: 'China' }, { code: 'SZX', name: 'Shenzhen Bao an Intl', city: 'Shenzhen', country: 'China' }, { code: 'CTU', name: 'Chengdu Shuangliu Intl', city: 'Chengdu', country: 'China' }, { code: 'CKG', name: 'Chongqing Jiangbei Intl', city: 'Chongqing', country: 'China' }, { code: 'XIY', name: 'Xi an Xianyang Intl', city: 'Xi an', country: 'China' }, { code: 'KMG', name: 'Kunming Changshui Intl', city: 'Kunming', country: 'China' }, { code: 'HGH', name: 'Hangzhou Xiaoshan Intl', city: 'Hangzhou', country: 'China' }, { code: 'NKG', name: 'Nanjing Lukou Intl', city: 'Nanjing', country: 'China' }, { code: 'WUH', name: 'Wuhan Tianhe Intl', city: 'Wuhan', country: 'China' }, { code: 'TSN', name: 'Tianjin Binhai Intl', city: 'Tianjin', country: 'China' }, { code: 'SYX', name: 'Sanya Phoenix Intl', city: 'Sanya', country: 'China' }, { code: 'TAO', name: 'Qingdao Jiaodong Intl', city: 'Qingdao', country: 'China' }, { code: 'DLC', name: 'Dalian Zhoushuizi Intl', city: 'Dalian', country: 'China' }, { code: 'XMN', name: 'Xiamen Gaoqi Intl', city: 'Xiamen', country: 'China' }, { code: 'FOC', name: 'Fuzhou Changle Intl', city: 'Fuzhou', country: 'China' }, { code: 'MFM', name: 'Macau Intl', city: 'Macau', country: 'China' }, { code: 'TPE', name: 'Taiwan Taoyuan Intl', city: 'Taipei', country: 'Taiwan' }, { code: 'TSA', name: 'Taipei Songshan', city: 'Taipei', country: 'Taiwan' }, { code: 'KHH', name: 'Kaohsiung Intl', city: 'Kaohsiung', country: 'Taiwan' }, { code: 'NRT', name: 'Narita Intl', city: 'Tokyo', country: 'Japan' }, { code: 'HND', name: 'Tokyo Haneda', city: 'Tokyo', country: 'Japan' }, { code: 'KIX', name: 'Kansai Intl', city: 'Osaka', country: 'Japan' }, { code: 'ITM', name: 'Osaka Itami', city: 'Osaka', country: 'Japan' }, { code: 'NGO', name: 'Chubu Centrair Intl', city: 'Nagoya', country: 'Japan' }, { code: 'FUK', name: 'Fukuoka Airport', city: 'Fukuoka', country: 'Japan' }, { code: 'CTS', name: 'New Chitose', city: 'Sapporo', country: 'Japan' }, { code: 'OKA', name: 'Naha Airport', city: 'Okinawa', country: 'Japan' }, { code: 'ICN', name: 'Incheon Intl', city: 'Seoul', country: 'South Korea' }, { code: 'GMP', name: 'Gimpo Intl', city: 'Seoul', country: 'South Korea' }, { code: 'PUS', name: 'Gimhae Intl', city: 'Busan', country: 'South Korea' }, { code: 'CJU', name: 'Jeju Intl', city: 'Jeju', country: 'South Korea' }, { code: 'ULN', name: 'Chinggis Khaan Intl', city: 'Ulaanbaatar', country: 'Mongolia' },
            // EUROPE
            { code: 'LHR', name: 'Heathrow', city: 'London', country: 'UK' }, { code: 'LGW', name: 'Gatwick', city: 'London', country: 'UK' }, { code: 'STN', name: 'Stansted', city: 'London', country: 'UK' }, { code: 'LTN', name: 'Luton', city: 'London', country: 'UK' }, { code: 'MAN', name: 'Manchester', city: 'Manchester', country: 'UK' }, { code: 'EDI', name: 'Edinburgh', city: 'Edinburgh', country: 'UK' }, { code: 'BHX', name: 'Birmingham', city: 'Birmingham', country: 'UK' }, { code: 'GLA', name: 'Glasgow', city: 'Glasgow', country: 'UK' }, { code: 'BRS', name: 'Bristol', city: 'Bristol', country: 'UK' }, { code: 'NCL', name: 'Newcastle', city: 'Newcastle', country: 'UK' }, { code: 'CDG', name: 'Charles de Gaulle', city: 'Paris', country: 'France' }, { code: 'ORY', name: 'Paris Orly', city: 'Paris', country: 'France' }, { code: 'NCE', name: 'Nice Cote d Azur', city: 'Nice', country: 'France' }, { code: 'LYS', name: 'Lyon Saint-Exupery', city: 'Lyon', country: 'France' }, { code: 'MRS', name: 'Marseille Provence', city: 'Marseille', country: 'France' }, { code: 'TLS', name: 'Toulouse Blagnac', city: 'Toulouse', country: 'France' }, { code: 'FRA', name: 'Frankfurt', city: 'Frankfurt', country: 'Germany' }, { code: 'MUC', name: 'Munich', city: 'Munich', country: 'Germany' }, { code: 'DUS', name: 'Dusseldorf', city: 'Dusseldorf', country: 'Germany' }, { code: 'TXL', name: 'Berlin Tegel', city: 'Berlin', country: 'Germany' }, { code: 'BER', name: 'Berlin Brandenburg', city: 'Berlin', country: 'Germany' }, { code: 'HAM', name: 'Hamburg', city: 'Hamburg', country: 'Germany' }, { code: 'CGN', name: 'Cologne Bonn', city: 'Cologne', country: 'Germany' }, { code: 'STR', name: 'Stuttgart', city: 'Stuttgart', country: 'Germany' }, { code: 'AMS', name: 'Amsterdam Schiphol', city: 'Amsterdam', country: 'Netherlands' }, { code: 'BRU', name: 'Brussels', city: 'Brussels', country: 'Belgium' }, { code: 'FCO', name: 'Rome Fiumicino', city: 'Rome', country: 'Italy' }, { code: 'MXP', name: 'Milan Malpensa', city: 'Milan', country: 'Italy' }, { code: 'LIN', name: 'Milan Linate', city: 'Milan', country: 'Italy' }, { code: 'VCE', name: 'Venice Marco Polo', city: 'Venice', country: 'Italy' }, { code: 'NAP', name: 'Naples', city: 'Naples', country: 'Italy' }, { code: 'BGY', name: 'Milan Bergamo', city: 'Bergamo', country: 'Italy' }, { code: 'MAD', name: 'Madrid Barajas', city: 'Madrid', country: 'Spain' }, { code: 'BCN', name: 'Barcelona El Prat', city: 'Barcelona', country: 'Spain' }, { code: 'PMI', name: 'Palma de Mallorca', city: 'Palma', country: 'Spain' }, { code: 'AGP', name: 'Malaga', city: 'Malaga', country: 'Spain' }, { code: 'ALC', name: 'Alicante', city: 'Alicante', country: 'Spain' }, { code: 'VLC', name: 'Valencia', city: 'Valencia', country: 'Spain' }, { code: 'SVQ', name: 'Seville', city: 'Seville', country: 'Spain' }, { code: 'IBZ', name: 'Ibiza', city: 'Ibiza', country: 'Spain' }, { code: 'TFS', name: 'Tenerife South', city: 'Tenerife', country: 'Spain' }, { code: 'LPA', name: 'Gran Canaria', city: 'Las Palmas', country: 'Spain' }, { code: 'LIS', name: 'Lisbon Portela', city: 'Lisbon', country: 'Portugal' }, { code: 'OPO', name: 'Porto', city: 'Porto', country: 'Portugal' }, { code: 'FAO', name: 'Faro', city: 'Faro', country: 'Portugal' }, { code: 'ATH', name: 'Athens Intl', city: 'Athens', country: 'Greece' }, { code: 'SKG', name: 'Thessaloniki', city: 'Thessaloniki', country: 'Greece' }, { code: 'HER', name: 'Heraklion', city: 'Crete', country: 'Greece' }, { code: 'RHO', name: 'Rhodes', city: 'Rhodes', country: 'Greece' }, { code: 'JMK', name: 'Mykonos', city: 'Mykonos', country: 'Greece' }, { code: 'JTR', name: 'Santorini', city: 'Santorini', country: 'Greece' }, { code: 'IST', name: 'Istanbul', city: 'Istanbul', country: 'Turkey' }, { code: 'SAW', name: 'Sabiha Gokcen', city: 'Istanbul', country: 'Turkey' }, { code: 'AYT', name: 'Antalya', city: 'Antalya', country: 'Turkey' }, { code: 'ADB', name: 'Izmir Adnan Menderes', city: 'Izmir', country: 'Turkey' }, { code: 'ESB', name: 'Ankara Esenboga', city: 'Ankara', country: 'Turkey' }, { code: 'DLM', name: 'Dalaman', city: 'Dalaman', country: 'Turkey' }, { code: 'BJV', name: 'Bodrum Milas', city: 'Bodrum', country: 'Turkey' }, { code: 'ZRH', name: 'Zurich', city: 'Zurich', country: 'Switzerland' }, { code: 'GVA', name: 'Geneva', city: 'Geneva', country: 'Switzerland' }, { code: 'BSL', name: 'Basel', city: 'Basel', country: 'Switzerland' }, { code: 'VIE', name: 'Vienna', city: 'Vienna', country: 'Austria' }, { code: 'SZG', name: 'Salzburg', city: 'Salzburg', country: 'Austria' }, { code: 'INN', name: 'Innsbruck', city: 'Innsbruck', country: 'Austria' }, { code: 'CPH', name: 'Copenhagen', city: 'Copenhagen', country: 'Denmark' }, { code: 'OSL', name: 'Oslo Gardermoen', city: 'Oslo', country: 'Norway' }, { code: 'BGO', name: 'Bergen', city: 'Bergen', country: 'Norway' }, { code: 'ARN', name: 'Stockholm Arlanda', city: 'Stockholm', country: 'Sweden' }, { code: 'GOT', name: 'Gothenburg Landvetter', city: 'Gothenburg', country: 'Sweden' }, { code: 'HEL', name: 'Helsinki Vantaa', city: 'Helsinki', country: 'Finland' }, { code: 'DUB', name: 'Dublin', city: 'Dublin', country: 'Ireland' }, { code: 'SNN', name: 'Shannon', city: 'Shannon', country: 'Ireland' }, { code: 'ORK', name: 'Cork', city: 'Cork', country: 'Ireland' }, { code: 'PRG', name: 'Prague Vaclav Havel', city: 'Prague', country: 'Czech Republic' }, { code: 'WAW', name: 'Warsaw Chopin', city: 'Warsaw', country: 'Poland' }, { code: 'KRK', name: 'Krakow', city: 'Krakow', country: 'Poland' }, { code: 'BUD', name: 'Budapest Ferenc Liszt', city: 'Budapest', country: 'Hungary' }, { code: 'OTP', name: 'Bucharest Henri Coanda', city: 'Bucharest', country: 'Romania' }, { code: 'SOF', name: 'Sofia', city: 'Sofia', country: 'Bulgaria' }, { code: 'ZAG', name: 'Zagreb', city: 'Zagreb', country: 'Croatia' }, { code: 'SPU', name: 'Split', city: 'Split', country: 'Croatia' }, { code: 'DBV', name: 'Dubrovnik', city: 'Dubrovnik', country: 'Croatia' }, { code: 'BEG', name: 'Belgrade Nikola Tesla', city: 'Belgrade', country: 'Serbia' }, { code: 'LJU', name: 'Ljubljana', city: 'Ljubljana', country: 'Slovenia' }, { code: 'TIA', name: 'Tirana', city: 'Tirana', country: 'Albania' }, { code: 'SKP', name: 'Skopje', city: 'Skopje', country: 'North Macedonia' }, { code: 'KBP', name: 'Kyiv Boryspil', city: 'Kyiv', country: 'Ukraine' }, { code: 'SVO', name: 'Moscow Sheremetyevo', city: 'Moscow', country: 'Russia' }, { code: 'DME', name: 'Moscow Domodedovo', city: 'Moscow', country: 'Russia' }, { code: 'LED', name: 'St Petersburg Pulkovo', city: 'St Petersburg', country: 'Russia' }, { code: 'RIX', name: 'Riga', city: 'Riga', country: 'Latvia' }, { code: 'VNO', name: 'Vilnius', city: 'Vilnius', country: 'Lithuania' }, { code: 'TLL', name: 'Tallinn', city: 'Tallinn', country: 'Estonia' }, { code: 'KEF', name: 'Keflavik', city: 'Reykjavik', country: 'Iceland' },
            // NORTH AMERICA - USA
            { code: 'JFK', name: 'John F Kennedy Intl', city: 'New York', country: 'USA' }, { code: 'EWR', name: 'Newark Liberty Intl', city: 'Newark', country: 'USA' }, { code: 'LGA', name: 'LaGuardia', city: 'New York', country: 'USA' }, { code: 'LAX', name: 'Los Angeles Intl', city: 'Los Angeles', country: 'USA' }, { code: 'SFO', name: 'San Francisco Intl', city: 'San Francisco', country: 'USA' }, { code: 'ORD', name: 'O Hare Intl', city: 'Chicago', country: 'USA' }, { code: 'MDW', name: 'Midway Intl', city: 'Chicago', country: 'USA' }, { code: 'ATL', name: 'Hartsfield-Jackson Atlanta Intl', city: 'Atlanta', country: 'USA' }, { code: 'DFW', name: 'Dallas Fort Worth Intl', city: 'Dallas', country: 'USA' }, { code: 'DEN', name: 'Denver Intl', city: 'Denver', country: 'USA' }, { code: 'SEA', name: 'Seattle-Tacoma Intl', city: 'Seattle', country: 'USA' }, { code: 'MIA', name: 'Miami Intl', city: 'Miami', country: 'USA' }, { code: 'FLL', name: 'Fort Lauderdale-Hollywood Intl', city: 'Fort Lauderdale', country: 'USA' }, { code: 'MCO', name: 'Orlando Intl', city: 'Orlando', country: 'USA' }, { code: 'TPA', name: 'Tampa Intl', city: 'Tampa', country: 'USA' }, { code: 'BOS', name: 'Boston Logan Intl', city: 'Boston', country: 'USA' }, { code: 'PHL', name: 'Philadelphia Intl', city: 'Philadelphia', country: 'USA' }, { code: 'IAD', name: 'Washington Dulles Intl', city: 'Washington DC', country: 'USA' }, { code: 'DCA', name: 'Ronald Reagan Washington National', city: 'Washington DC', country: 'USA' }, { code: 'BWI', name: 'Baltimore Washington Intl', city: 'Baltimore', country: 'USA' }, { code: 'DTW', name: 'Detroit Metro Wayne County', city: 'Detroit', country: 'USA' }, { code: 'MSP', name: 'Minneapolis-St Paul Intl', city: 'Minneapolis', country: 'USA' }, { code: 'CLT', name: 'Charlotte Douglas Intl', city: 'Charlotte', country: 'USA' }, { code: 'PHX', name: 'Phoenix Sky Harbor Intl', city: 'Phoenix', country: 'USA' }, { code: 'LAS', name: 'Harry Reid Intl', city: 'Las Vegas', country: 'USA' }, { code: 'SAN', name: 'San Diego Intl', city: 'San Diego', country: 'USA' }, { code: 'SJC', name: 'San Jose Intl', city: 'San Jose', country: 'USA' }, { code: 'OAK', name: 'Oakland Intl', city: 'Oakland', country: 'USA' }, { code: 'PDX', name: 'Portland Intl', city: 'Portland', country: 'USA' }, { code: 'SLC', name: 'Salt Lake City Intl', city: 'Salt Lake City', country: 'USA' }, { code: 'AUS', name: 'Austin-Bergstrom Intl', city: 'Austin', country: 'USA' }, { code: 'IAH', name: 'George Bush Intercontinental', city: 'Houston', country: 'USA' }, { code: 'HOU', name: 'William P Hobby', city: 'Houston', country: 'USA' }, { code: 'MSY', name: 'Louis Armstrong New Orleans Intl', city: 'New Orleans', country: 'USA' }, { code: 'RDU', name: 'Raleigh-Durham Intl', city: 'Raleigh', country: 'USA' }, { code: 'BNA', name: 'Nashville Intl', city: 'Nashville', country: 'USA' }, { code: 'STL', name: 'St Louis Lambert Intl', city: 'St Louis', country: 'USA' }, { code: 'MCI', name: 'Kansas City Intl', city: 'Kansas City', country: 'USA' }, { code: 'IND', name: 'Indianapolis Intl', city: 'Indianapolis', country: 'USA' }, { code: 'CMH', name: 'John Glenn Columbus Intl', city: 'Columbus', country: 'USA' }, { code: 'CLE', name: 'Cleveland Hopkins Intl', city: 'Cleveland', country: 'USA' }, { code: 'PIT', name: 'Pittsburgh Intl', city: 'Pittsburgh', country: 'USA' }, { code: 'CVG', name: 'Cincinnati Northern Kentucky Intl', city: 'Cincinnati', country: 'USA' }, { code: 'MKE', name: 'General Mitchell Intl', city: 'Milwaukee', country: 'USA' }, { code: 'SMF', name: 'Sacramento Intl', city: 'Sacramento', country: 'USA' }, { code: 'SNA', name: 'John Wayne Airport', city: 'Orange County', country: 'USA' }, { code: 'BUR', name: 'Hollywood Burbank', city: 'Burbank', country: 'USA' }, { code: 'HNL', name: 'Daniel K Inouye Intl', city: 'Honolulu', country: 'USA' }, { code: 'OGG', name: 'Kahului', city: 'Maui', country: 'USA' }, { code: 'ANC', name: 'Ted Stevens Anchorage Intl', city: 'Anchorage', country: 'USA' },
            // CANADA
            { code: 'YYZ', name: 'Toronto Pearson Intl', city: 'Toronto', country: 'Canada' }, { code: 'YVR', name: 'Vancouver Intl', city: 'Vancouver', country: 'Canada' }, { code: 'YUL', name: 'Montreal Trudeau Intl', city: 'Montreal', country: 'Canada' }, { code: 'YYC', name: 'Calgary Intl', city: 'Calgary', country: 'Canada' }, { code: 'YEG', name: 'Edmonton Intl', city: 'Edmonton', country: 'Canada' }, { code: 'YOW', name: 'Ottawa Macdonald-Cartier Intl', city: 'Ottawa', country: 'Canada' }, { code: 'YWG', name: 'Winnipeg Richardson Intl', city: 'Winnipeg', country: 'Canada' }, { code: 'YHZ', name: 'Halifax Stanfield Intl', city: 'Halifax', country: 'Canada' }, { code: 'YQB', name: 'Quebec Jean Lesage Intl', city: 'Quebec City', country: 'Canada' }, { code: 'YXE', name: 'Saskatoon John G Diefenbaker Intl', city: 'Saskatoon', country: 'Canada' }, { code: 'YQR', name: 'Regina Intl', city: 'Regina', country: 'Canada' }, { code: 'YYJ', name: 'Victoria Intl', city: 'Victoria', country: 'Canada' }, { code: 'YKA', name: 'Kamloops', city: 'Kamloops', country: 'Canada' }, { code: 'YXX', name: 'Abbotsford Intl', city: 'Abbotsford', country: 'Canada' },
            // MEXICO & CENTRAL AMERICA
            { code: 'MEX', name: 'Mexico City Intl', city: 'Mexico City', country: 'Mexico' }, { code: 'CUN', name: 'Cancun Intl', city: 'Cancun', country: 'Mexico' }, { code: 'GDL', name: 'Guadalajara Intl', city: 'Guadalajara', country: 'Mexico' }, { code: 'SJD', name: 'Los Cabos Intl', city: 'San Jose del Cabo', country: 'Mexico' }, { code: 'PVR', name: 'Puerto Vallarta Intl', city: 'Puerto Vallarta', country: 'Mexico' }, { code: 'MTY', name: 'Monterrey Intl', city: 'Monterrey', country: 'Mexico' }, { code: 'TIJ', name: 'Tijuana Intl', city: 'Tijuana', country: 'Mexico' }, { code: 'PTY', name: 'Tocumen Intl', city: 'Panama City', country: 'Panama' }, { code: 'SJO', name: 'Juan Santamaria Intl', city: 'San Jose', country: 'Costa Rica' }, { code: 'LIR', name: 'Daniel Oduber Quiros Intl', city: 'Liberia', country: 'Costa Rica' }, { code: 'SAL', name: 'El Salvador Intl', city: 'San Salvador', country: 'El Salvador' }, { code: 'GUA', name: 'La Aurora Intl', city: 'Guatemala City', country: 'Guatemala' }, { code: 'MGA', name: 'Augusto C Sandino Intl', city: 'Managua', country: 'Nicaragua' }, { code: 'TGU', name: 'Toncontin Intl', city: 'Tegucigalpa', country: 'Honduras' }, { code: 'BZE', name: 'Philip S W Goldson Intl', city: 'Belize City', country: 'Belize' },
            // CARIBBEAN
            { code: 'MBJ', name: 'Sangster Intl', city: 'Montego Bay', country: 'Jamaica' }, { code: 'KIN', name: 'Norman Manley Intl', city: 'Kingston', country: 'Jamaica' }, { code: 'NAS', name: 'Lynden Pindling Intl', city: 'Nassau', country: 'Bahamas' }, { code: 'PUJ', name: 'Punta Cana Intl', city: 'Punta Cana', country: 'Dominican Republic' }, { code: 'SDQ', name: 'Las Americas Intl', city: 'Santo Domingo', country: 'Dominican Republic' }, { code: 'SJU', name: 'Luis Munoz Marin Intl', city: 'San Juan', country: 'Puerto Rico' }, { code: 'HAV', name: 'Jose Marti Intl', city: 'Havana', country: 'Cuba' }, { code: 'AUA', name: 'Queen Beatrix Intl', city: 'Oranjestad', country: 'Aruba' }, { code: 'CUR', name: 'Curacao Intl', city: 'Willemstad', country: 'Curacao' }, { code: 'SXM', name: 'Princess Juliana Intl', city: 'St Maarten', country: 'Sint Maarten' }, { code: 'BGI', name: 'Grantley Adams Intl', city: 'Bridgetown', country: 'Barbados' }, { code: 'POS', name: 'Piarco Intl', city: 'Port of Spain', country: 'Trinidad and Tobago' }, { code: 'GCM', name: 'Owen Roberts Intl', city: 'Grand Cayman', country: 'Cayman Islands' }, { code: 'UVF', name: 'Hewanorra Intl', city: 'St Lucia', country: 'Saint Lucia' }, { code: 'ANU', name: 'V C Bird Intl', city: 'St Johns', country: 'Antigua and Barbuda' }, { code: 'TAB', name: 'Tobago A N R Robinson Intl', city: 'Tobago', country: 'Trinidad and Tobago' },
            // SOUTH AMERICA
            { code: 'GRU', name: 'Sao Paulo Guarulhos Intl', city: 'Sao Paulo', country: 'Brazil' }, { code: 'GIG', name: 'Rio de Janeiro Galeao Intl', city: 'Rio de Janeiro', country: 'Brazil' }, { code: 'BSB', name: 'Brasilia Intl', city: 'Brasilia', country: 'Brazil' }, { code: 'CNF', name: 'Belo Horizonte Confins Intl', city: 'Belo Horizonte', country: 'Brazil' }, { code: 'SSA', name: 'Salvador Intl', city: 'Salvador', country: 'Brazil' }, { code: 'REC', name: 'Recife Guararapes Intl', city: 'Recife', country: 'Brazil' }, { code: 'FOR', name: 'Fortaleza Pinto Martins Intl', city: 'Fortaleza', country: 'Brazil' }, { code: 'POA', name: 'Porto Alegre Salgado Filho Intl', city: 'Porto Alegre', country: 'Brazil' }, { code: 'CWB', name: 'Curitiba Afonso Pena Intl', city: 'Curitiba', country: 'Brazil' }, { code: 'MAO', name: 'Eduardo Gomes Intl', city: 'Manaus', country: 'Brazil' }, { code: 'FLN', name: 'Florianopolis Intl', city: 'Florianopolis', country: 'Brazil' }, { code: 'VCP', name: 'Viracopos Intl', city: 'Campinas', country: 'Brazil' }, { code: 'EZE', name: 'Buenos Aires Ezeiza Intl', city: 'Buenos Aires', country: 'Argentina' }, { code: 'AEP', name: 'Buenos Aires Aeroparque', city: 'Buenos Aires', country: 'Argentina' }, { code: 'COR', name: 'Cordoba Intl', city: 'Cordoba', country: 'Argentina' }, { code: 'MDZ', name: 'Mendoza Intl', city: 'Mendoza', country: 'Argentina' }, { code: 'IGR', name: 'Iguazu Intl', city: 'Puerto Iguazu', country: 'Argentina' }, { code: 'BRC', name: 'San Carlos de Bariloche', city: 'Bariloche', country: 'Argentina' }, { code: 'SCL', name: 'Santiago Arturo Merino Benitez Intl', city: 'Santiago', country: 'Chile' }, { code: 'LIM', name: 'Lima Jorge Chavez Intl', city: 'Lima', country: 'Peru' }, { code: 'CUZ', name: 'Alejandro Velasco Astete Intl', city: 'Cusco', country: 'Peru' }, { code: 'BOG', name: 'Bogota El Dorado Intl', city: 'Bogota', country: 'Colombia' }, { code: 'MDE', name: 'Medellin Jose Maria Cordova Intl', city: 'Medellin', country: 'Colombia' }, { code: 'CTG', name: 'Cartagena Rafael Nunez Intl', city: 'Cartagena', country: 'Colombia' }, { code: 'CLO', name: 'Cali Alfonso Bonilla Aragon Intl', city: 'Cali', country: 'Colombia' }, { code: 'UIO', name: 'Quito Mariscal Sucre Intl', city: 'Quito', country: 'Ecuador' }, { code: 'GYE', name: 'Guayaquil Jose Joaquin de Olmedo Intl', city: 'Guayaquil', country: 'Ecuador' }, { code: 'GPS', name: 'Galapagos Seymour', city: 'Galapagos', country: 'Ecuador' }, { code: 'CCS', name: 'Caracas Simon Bolivar Intl', city: 'Caracas', country: 'Venezuela' }, { code: 'LPB', name: 'La Paz El Alto Intl', city: 'La Paz', country: 'Bolivia' }, { code: 'VVI', name: 'Santa Cruz Viru Viru Intl', city: 'Santa Cruz', country: 'Bolivia' }, { code: 'ASU', name: 'Asuncion Silvio Pettirossi Intl', city: 'Asuncion', country: 'Paraguay' }, { code: 'MVD', name: 'Montevideo Carrasco Intl', city: 'Montevideo', country: 'Uruguay' }, { code: 'PBM', name: 'Paramaribo Johan Adolf Pengel Intl', city: 'Paramaribo', country: 'Suriname' }, { code: 'GEO', name: 'Georgetown Cheddi Jagan Intl', city: 'Georgetown', country: 'Guyana' },
            // AFRICA
            { code: 'JNB', name: 'O R Tambo Intl', city: 'Johannesburg', country: 'South Africa' }, { code: 'CPT', name: 'Cape Town Intl', city: 'Cape Town', country: 'South Africa' }, { code: 'DUR', name: 'King Shaka Intl', city: 'Durban', country: 'South Africa' }, { code: 'CAI', name: 'Cairo Intl', city: 'Cairo', country: 'Egypt' }, { code: 'HRG', name: 'Hurghada Intl', city: 'Hurghada', country: 'Egypt' }, { code: 'SSH', name: 'Sharm El Sheikh Intl', city: 'Sharm El Sheikh', country: 'Egypt' }, { code: 'LXR', name: 'Luxor Intl', city: 'Luxor', country: 'Egypt' }, { code: 'ALG', name: 'Algiers Houari Boumediene', city: 'Algiers', country: 'Algeria' }, { code: 'CMN', name: 'Casablanca Mohammed V Intl', city: 'Casablanca', country: 'Morocco' }, { code: 'RAK', name: 'Marrakech Menara', city: 'Marrakech', country: 'Morocco' }, { code: 'TUN', name: 'Tunis Carthage Intl', city: 'Tunis', country: 'Tunisia' }, { code: 'NBO', name: 'Jomo Kenyatta Intl', city: 'Nairobi', country: 'Kenya' }, { code: 'MBA', name: 'Moi Intl', city: 'Mombasa', country: 'Kenya' }, { code: 'ADD', name: 'Bole Intl', city: 'Addis Ababa', country: 'Ethiopia' }, { code: 'EBB', name: 'Entebbe Intl', city: 'Kampala', country: 'Uganda' }, { code: 'DAR', name: 'Julius Nyerere Intl', city: 'Dar es Salaam', country: 'Tanzania' }, { code: 'ZNZ', name: 'Abeid Amani Karume Intl', city: 'Zanzibar', country: 'Tanzania' }, { code: 'JRO', name: 'Kilimanjaro Intl', city: 'Kilimanjaro', country: 'Tanzania' }, { code: 'KGL', name: 'Kigali Intl', city: 'Kigali', country: 'Rwanda' }, { code: 'ACC', name: 'Kotoka Intl', city: 'Accra', country: 'Ghana' }, { code: 'LOS', name: 'Murtala Muhammed Intl', city: 'Lagos', country: 'Nigeria' }, { code: 'ABV', name: 'Nnamdi Azikiwe Intl', city: 'Abuja', country: 'Nigeria' }, { code: 'DSS', name: 'Blaise Diagne Intl', city: 'Dakar', country: 'Senegal' }, { code: 'ABJ', name: 'Felix Houphouet-Boigny Intl', city: 'Abidjan', country: 'Ivory Coast' }, { code: 'ROB', name: 'Roberts Intl', city: 'Monrovia', country: 'Liberia' }, { code: 'FNA', name: 'Lungi Intl', city: 'Freetown', country: 'Sierra Leone' }, { code: 'DKR', name: 'Leopold Sedar Senghor Intl', city: 'Dakar', country: 'Senegal' }, { code: 'TIP', name: 'Tripoli Mitiga Intl', city: 'Tripoli', country: 'Libya' }, { code: 'KRT', name: 'Khartoum Intl', city: 'Khartoum', country: 'Sudan' }, { code: 'LUN', name: 'Kenneth Kaunda Intl', city: 'Lusaka', country: 'Zambia' }, { code: 'HRE', name: 'Robert Gabriel Mugabe Intl', city: 'Harare', country: 'Zimbabwe' }, { code: 'VFA', name: 'Victoria Falls Intl', city: 'Victoria Falls', country: 'Zimbabwe' }, { code: 'WDH', name: 'Hosea Kutako Intl', city: 'Windhoek', country: 'Namibia' }, { code: 'GBE', name: 'Sir Seretse Khama Intl', city: 'Gaborone', country: 'Botswana' }, { code: 'MPM', name: 'Maputo Intl', city: 'Maputo', country: 'Mozambique' }, { code: 'TNR', name: 'Antananarivo Ivato Intl', city: 'Antananarivo', country: 'Madagascar' }, { code: 'MRU', name: 'Sir Seewoosagur Ramgoolam Intl', city: 'Mauritius', country: 'Mauritius' }, { code: 'SEZ', name: 'Seychelles Intl', city: 'Victoria', country: 'Seychelles' }, { code: 'RUN', name: 'Roland Garros', city: 'Saint-Denis', country: 'Reunion' },
            // AUSTRALIA & NEW ZEALAND & OCEANIA
            { code: 'SYD', name: 'Sydney Kingsford Smith', city: 'Sydney', country: 'Australia' }, { code: 'MEL', name: 'Melbourne Tullamarine', city: 'Melbourne', country: 'Australia' }, { code: 'BNE', name: 'Brisbane', city: 'Brisbane', country: 'Australia' }, { code: 'PER', name: 'Perth', city: 'Perth', country: 'Australia' }, { code: 'ADL', name: 'Adelaide', city: 'Adelaide', country: 'Australia' }, { code: 'CBR', name: 'Canberra', city: 'Canberra', country: 'Australia' }, { code: 'OOL', name: 'Gold Coast', city: 'Gold Coast', country: 'Australia' }, { code: 'CNS', name: 'Cairns', city: 'Cairns', country: 'Australia' }, { code: 'DRW', name: 'Darwin Intl', city: 'Darwin', country: 'Australia' }, { code: 'HBA', name: 'Hobart Intl', city: 'Hobart', country: 'Australia' }, { code: 'TSV', name: 'Townsville', city: 'Townsville', country: 'Australia' }, { code: 'AKL', name: 'Auckland Intl', city: 'Auckland', country: 'New Zealand' }, { code: 'WLG', name: 'Wellington Intl', city: 'Wellington', country: 'New Zealand' }, { code: 'CHC', name: 'Christchurch Intl', city: 'Christchurch', country: 'New Zealand' }, { code: 'ZQN', name: 'Queenstown', city: 'Queenstown', country: 'New Zealand' }, { code: 'DUD', name: 'Dunedin Intl', city: 'Dunedin', country: 'New Zealand' }, { code: 'NAN', name: 'Nadi Intl', city: 'Nadi', country: 'Fiji' }, { code: 'SUV', name: 'Suva Nausori Intl', city: 'Suva', country: 'Fiji' }, { code: 'PPT', name: 'Faa a Intl', city: 'Papeete', country: 'French Polynesia' }, { code: 'NOU', name: 'La Tontouta Intl', city: 'Noumea', country: 'New Caledonia' }, { code: 'APW', name: 'Faleolo Intl', city: 'Apia', country: 'Samoa' }, { code: 'TBU', name: 'Fua amotu Intl', city: 'Nuku alofa', country: 'Tonga' }, { code: 'VLI', name: 'Bauerfield Intl', city: 'Port Vila', country: 'Vanuatu' }, { code: 'GUM', name: 'Antonio B Won Pat Intl', city: 'Guam', country: 'Guam' }, { code: 'POM', name: 'Jacksons Intl', city: 'Port Moresby', country: 'Papua New Guinea' },
            // SOUTH ASIA (Pakistan, Bangladesh, Nepal, etc)
            { code: 'KHI', name: 'Jinnah Intl', city: 'Karachi', country: 'Pakistan' }, { code: 'LHE', name: 'Allama Iqbal Intl', city: 'Lahore', country: 'Pakistan' }, { code: 'ISB', name: 'Islamabad Intl', city: 'Islamabad', country: 'Pakistan' }, { code: 'PEW', name: 'Peshawar Intl', city: 'Peshawar', country: 'Pakistan' }, { code: 'DAC', name: 'Hazrat Shahjalal Intl', city: 'Dhaka', country: 'Bangladesh' }, { code: 'CGP', name: 'Shah Amanat Intl', city: 'Chittagong', country: 'Bangladesh' }, { code: 'KTM', name: 'Tribhuvan Intl', city: 'Kathmandu', country: 'Nepal' }, { code: 'MLE', name: 'Velana Intl', city: 'Male', country: 'Maldives' }, { code: 'CMB', name: 'Bandaranaike Intl', city: 'Colombo', country: 'Sri Lanka' }, { code: 'HRI', name: 'Mattala Rajapaksa Intl', city: 'Hambantota', country: 'Sri Lanka' }, { code: 'PBH', name: 'Paro Intl', city: 'Paro', country: 'Bhutan' }, { code: 'GAN', name: 'Gan Intl', city: 'Addu City', country: 'Maldives' },
            // CENTRAL ASIA
            { code: 'TAS', name: 'Tashkent Intl', city: 'Tashkent', country: 'Uzbekistan' }, { code: 'ALA', name: 'Almaty Intl', city: 'Almaty', country: 'Kazakhstan' }, { code: 'NQZ', name: 'Nursultan Nazarbayev Intl', city: 'Astana', country: 'Kazakhstan' }, { code: 'FRU', name: 'Manas Intl', city: 'Bishkek', country: 'Kyrgyzstan' }, { code: 'DYU', name: 'Dushanbe Intl', city: 'Dushanbe', country: 'Tajikistan' }, { code: 'ASB', name: 'Ashgabat Intl', city: 'Ashgabat', country: 'Turkmenistan' }, { code: 'GYD', name: 'Heydar Aliyev Intl', city: 'Baku', country: 'Azerbaijan' }, { code: 'TBS', name: 'Tbilisi Intl', city: 'Tbilisi', country: 'Georgia' }, { code: 'EVN', name: 'Zvartnots Intl', city: 'Yerevan', country: 'Armenia' }
        ];

        let activeDropdown = null;

        function searchAirport(input, dropdownId) {
            const query = input.value.toLowerCase().trim();
            const dropdown = document.getElementById(dropdownId);

            if (query.length < 1) {
                dropdown.classList.remove('active');
                return;
            }

            const matches = airports.filter(airport =>
                airport.code.toLowerCase().includes(query) ||
                airport.city.toLowerCase().includes(query) ||
                airport.name.toLowerCase().includes(query) ||
                airport.country.toLowerCase().includes(query)
            ).slice(0, 8);

            displayAirportResults(matches, dropdown, input);
        }

        function showRecentAirports(dropdownId) {
            const dropdown = document.getElementById(dropdownId);
            const input = dropdown.previousElementSibling;

            if (input.value.trim().length > 0) return;

            // Show popular airports when focused with empty input
            const popular = airports.slice(0, 6);
            displayAirportResults(popular, dropdown, input, true);
        }

        function displayAirportResults(results, dropdown, input, isPopular = false) {
            if (results.length === 0) {
                dropdown.innerHTML = '<div class="airport-item" style="color:#888;justify-content:center;">No airports found</div>';
                dropdown.classList.add('active');
                return;
            }

            const header = isPopular ? '<div style="padding:8px 15px;background:#f8f9fa;color:#666;font-size:0.8rem;font-weight:600;">Popular Airports</div>' : '';

            dropdown.innerHTML = header + results.map(airport => `
                <div class="airport-item" onclick="selectAirport('${airport.code}', '${airport.city}', '${input.id}', '${dropdown.id}')">
                    <i class="fas fa-plane-departure airport-icon"></i>
                    <span class="airport-code">${airport.code}</span>
                    <div class="airport-info">
                        <div class="airport-name">${airport.city}</div>
                        <div class="airport-city">${airport.name}</div>
                    </div>
                </div>
            `).join('');

            dropdown.classList.add('active');
            activeDropdown = dropdown;
        }

        function selectAirport(code, city, inputId, dropdownId) {
            const input = document.getElementById(inputId);
            input.value = code;
            document.getElementById(dropdownId).classList.remove('active');
            activeDropdown = null;
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function (e) {
            if (!e.target.closest('.airport-input-container')) {
                document.querySelectorAll('.airport-autocomplete').forEach(d => d.classList.remove('active'));
                activeDropdown = null;
            }
        });

        // Keyboard navigation for dropdowns
        document.addEventListener('keydown', function (e) {
            if (!activeDropdown) return;

            const items = activeDropdown.querySelectorAll('.airport-item[onclick]');
            if (items.length === 0) return;

            let selectedIndex = Array.from(items).findIndex(item => item.classList.contains('selected'));

            if (e.key === 'ArrowDown') {
                e.preventDefault();
                items.forEach(item => item.classList.remove('selected'));
                selectedIndex = (selectedIndex + 1) % items.length;
                items[selectedIndex].classList.add('selected');
                items[selectedIndex].scrollIntoView({ block: 'nearest' });
            } else if (e.key === 'ArrowUp') {
                e.preventDefault();
                items.forEach(item => item.classList.remove('selected'));
                selectedIndex = selectedIndex <= 0 ? items.length - 1 : selectedIndex - 1;
                items[selectedIndex].classList.add('selected');
                items[selectedIndex].scrollIntoView({ block: 'nearest' });
            } else if (e.key === 'Enter' && selectedIndex >= 0) {
                e.preventDefault();
                items[selectedIndex].click();
            } else if (e.key === 'Escape') {
                activeDropdown.classList.remove('active');
                activeDropdown = null;
            }
        });

        // Parse SerpAPI flight results into our format
        function parseFlightResults(data, from, to) {
            const flights = [];

            // Check for best_flights or other_flights in the response
            const allFlights = [...(data.best_flights || []), ...(data.other_flights || [])];

            for (const flightGroup of allFlights.slice(0, 15)) { // Limit to 15 results
                if (flightGroup.flights && flightGroup.flights.length > 0) {
                    const firstLeg = flightGroup.flights[0];
                    const lastLeg = flightGroup.flights[flightGroup.flights.length - 1];
                    const price = flightGroup.price || 0;

                    // Get layover info
                    const layovers = flightGroup.layovers || [];
                    const layoverInfo = layovers.length > 0
                        ? layovers.map(l => `${l.name} (${Math.floor(l.duration / 60)}h ${l.duration % 60}m)`).join(', ')
                        : null;

                    flights.push({
                        airline: firstLeg.airline || 'Unknown Airline',
                        airlineLogo: firstLeg.airline_logo || flightGroup.airline_logo || null,
                        from: firstLeg.departure_airport?.id || from,
                        fromName: firstLeg.departure_airport?.name || from,
                        to: lastLeg.arrival_airport?.id || to,
                        toName: lastLeg.arrival_airport?.name || to,
                        departure: firstLeg.departure_airport?.time || 'N/A',
                        arrival: lastLeg.arrival_airport?.time || 'N/A',
                        duration: flightGroup.total_duration ? `${Math.floor(flightGroup.total_duration / 60)}h ${flightGroup.total_duration % 60}m` : 'N/A',
                        durationMins: flightGroup.total_duration || 999,
                        price: price ? `‚Çπ${price.toLocaleString('en-IN')}` : 'Price N/A',
                        priceNum: price,
                        stops: flightGroup.flights.length === 1 ? 'Non-stop' : `${flightGroup.flights.length - 1} stop(s)`,
                        stopsCount: flightGroup.flights.length - 1,
                        layoverInfo: layoverInfo,
                        flightNumber: firstLeg.flight_number || null,
                        travelClass: firstLeg.travel_class || null,
                        bookingToken: flightGroup.booking_token || null
                    });
                }
            }

            return flights;
        }

        // Search overlay helper functions
        let searchAbortController = null;
        let progressInterval = null;

        function showSearchOverlay(from, to, depart, passengers, travelClass) {
            const overlay = document.getElementById('search-overlay');
            const progressBar = document.getElementById('progress-bar');

            // Set route info
            document.getElementById('overlay-from').textContent = from;
            document.getElementById('overlay-to').textContent = to;
            document.getElementById('overlay-from-name').textContent = 'Departure';
            document.getElementById('overlay-to-name').textContent = 'Arrival';

            // Set search info
            const dateObj = new Date(depart);
            const formattedDate = dateObj.toLocaleDateString('en-IN', {
                weekday: 'short', day: 'numeric', month: 'short'
            });
            document.getElementById('overlay-date').textContent = formattedDate;
            document.getElementById('overlay-passengers').textContent =
                passengers == 1 ? '1 Passenger' : `${passengers} Passengers`;

            const classNames = { '1': 'Economy', '2': 'Premium Economy', '3': 'Business', '4': 'First Class' };
            document.getElementById('overlay-class').textContent = classNames[travelClass] || 'Economy';

            // Reset progress
            progressBar.style.width = '0%';
            updateSearchStatus('Searching for best flights...', 'Connecting to airlines');

            // Show overlay with animation
            overlay.classList.add('active');
            overlay.classList.remove('fade-out');
            document.body.style.overflow = 'hidden';

            // Start progress animation
            startProgressAnimation();
        }

        function hideSearchOverlay() {
            const overlay = document.getElementById('search-overlay');
            overlay.classList.add('fade-out');

            if (progressInterval) {
                clearInterval(progressInterval);
                progressInterval = null;
            }

            setTimeout(() => {
                overlay.classList.remove('active', 'fade-out');
                document.body.style.overflow = '';
            }, 400);
        }

        function updateSearchStatus(status, substatus) {
            document.getElementById('search-status').textContent = status;
            document.getElementById('search-substatus').textContent = substatus;
        }

        function updateProgress(percent) {
            document.getElementById('progress-bar').style.width = `${percent}%`;
        }

        function startProgressAnimation() {
            const stages = [
                { percent: 15, status: 'Connecting to airlines...', substatus: 'Establishing connections' },
                { percent: 30, status: 'Searching Air India, IndiGo...', substatus: 'Checking domestic flights' },
                { percent: 45, status: 'Checking Emirates, Qatar...', substatus: 'Searching international routes' },
                { percent: 60, status: 'Comparing prices...', substatus: 'Finding the best deals' },
                { percent: 75, status: 'Analyzing options...', substatus: 'Sorting by relevance' },
                { percent: 85, status: 'Finalizing results...', substatus: 'Almost there' }
            ];

            let stageIndex = 0;
            progressInterval = setInterval(() => {
                if (stageIndex < stages.length) {
                    const stage = stages[stageIndex];
                    updateProgress(stage.percent);
                    updateSearchStatus(stage.status, stage.substatus);
                    stageIndex++;
                }
            }, 800);
        }

        function cancelSearch() {
            if (searchAbortController) {
                searchAbortController.abort();
                searchAbortController = null;
            }
            hideSearchOverlay();
        }

        // SECURITY: Validate flight search inputs before submitting
        function validateFlightSearch(from, to, depart, returnDate) {
            const errors = [];

            if (!from) {
                errors.push('Departure airport is required');
            } else if (!isValidAirportCode(from)) {
                errors.push('Departure must be a valid 3-letter airport code (e.g., DEL)');
            }

            if (!to) {
                errors.push('Arrival airport is required');
            } else if (!isValidAirportCode(to)) {
                errors.push('Arrival must be a valid 3-letter airport code (e.g., DXB)');
            }

            if (!depart) {
                errors.push('Departure date is required');
            } else if (!isValidDate(depart)) {
                errors.push('Please select a valid departure date (today or future)');
            }

            if (returnDate && !isValidDate(returnDate)) {
                errors.push('Please select a valid return date');
            }

            if (returnDate && depart && new Date(returnDate) < new Date(depart)) {
                errors.push('Return date must be after departure date');
            }

            return errors;
        }

        async function searchFlights() {
            const from = sanitizeString(document.getElementById('flight-from').value, 10).toUpperCase();
            const to = sanitizeString(document.getElementById('flight-to').value, 10).toUpperCase();
            const depart = document.getElementById('flight-depart').value;
            const returnDate = document.getElementById('flight-return').value;
            const travelClass = document.getElementById('flight-class').value;
            const stops = document.getElementById('flight-stops').value;
            const passengers = document.getElementById('flight-passengers').value;
            const sortBy = document.getElementById('flight-sort').value;
            const resultsDiv = document.getElementById('flight-results');

            // SECURITY: Validate all inputs before sending to backend
            const validationErrors = validateFlightSearch(from, to, depart, returnDate);
            if (validationErrors.length > 0) {
                alert(validationErrors.join('\n'));
                return;
            }

            // Show full-page overlay
            showSearchOverlay(from, to, depart, passengers, travelClass);
            resultsDiv.innerHTML = '';

            let flights = [];
            searchAbortController = new AbortController();

            try {
                // SECURITY: All API calls go through secure backend - no client-side API keys
                console.log('Calling secure backend API for flights...');
                updateSearchStatus('Connecting to VOYA servers...', 'Fetching live prices');

                const response = await fetch(`${API_BASE_URL}/api/flights/search`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    signal: searchAbortController.signal,
                    body: JSON.stringify({
                        departure_id: from,
                        arrival_id: to,
                        outbound_date: depart,
                        return_date: returnDate || undefined,
                        currency: 'INR',
                        travel_class: travelClass,
                        stops: stops,
                        adults: passengers,
                        sort_by: sortBy
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    updateProgress(85);
                    updateSearchStatus('Processing results...', 'Found flight options');

                    if (data.flights && data.flights.length > 0) {
                        flights = data.flights.map(f => ({
                            airline: escapeHtml(f.airline),
                            airlineLogo: f.airline_logo || null,
                            from: escapeHtml(f.from),
                            to: escapeHtml(f.to),
                            departure: escapeHtml(f.departure_time),
                            arrival: escapeHtml(f.arrival_time),
                            duration: escapeHtml(f.duration),
                            price: escapeHtml(f.price_formatted),
                            priceNum: f.price || 0,
                            stops: escapeHtml(f.stops),
                            tripType: f.trip_type || 'One way',
                            bookingToken: f.booking_token || null,
                            // Return flight for round trips
                            returnFlight: f.return_flight ? {
                                airline: escapeHtml(f.return_flight.airline),
                                airlineLogo: f.return_flight.airline_logo || null,
                                from: escapeHtml(f.return_flight.from),
                                to: escapeHtml(f.return_flight.to),
                                departure: escapeHtml(f.return_flight.departure_time),
                                arrival: escapeHtml(f.return_flight.arrival_time),
                                duration: escapeHtml(f.return_flight.duration),
                                stops: escapeHtml(f.return_flight.stops)
                            } : null
                        }));
                    }
                } else {
                    // SECURITY: Handle error responses including rate limits
                    const errorMessage = await handleErrorResponse(response);
                    console.error('Flight search failed:', errorMessage);
                    hideSearchOverlay();
                    resultsDiv.innerHTML = `<div class="error-message"><strong>Error:</strong> ${escapeHtml(errorMessage)}</div>`;
                    searchAbortController = null;
                    return;
                }
            } catch (err) {
                if (err.name === 'AbortError') {
                    console.log('Search was cancelled');
                    return;
                }
                console.error('Flight search error:', err.message);
                hideSearchOverlay();
                resultsDiv.innerHTML = `<div class="error-message"><strong>Error:</strong> Unable to connect to server. Please check your internet connection and try again.</div>`;
                searchAbortController = null;
                return;
            }

            // Finalize and show results
            updateProgress(100);
            updateSearchStatus('Complete!', `Found ${flights.length} flights`);

            // Small delay to show completion state
            await new Promise(resolve => setTimeout(resolve, 600));

            hideSearchOverlay();
            displayFlights(flights, resultsDiv);

            // Automatically open full-page view after a short delay
            setTimeout(() => {
                openFullPageFlights(from, to);
            }, 500);

            searchAbortController = null;
        }

        function displayFlights(flights, container) {
            if (!flights || flights.length === 0) {
                container.innerHTML = '<div class="no-results"><i class="fas fa-plane" style="font-size:3rem;margin-bottom:15px;color:#ccc;"></i><br>No flights found for your search criteria.</div>';
                return;
            }

            // Helper function to format time nicely
            function formatFlightTime(timeStr) {
                if (!timeStr || timeStr === 'N/A') return { time: '--:--', date: '', period: '', fullDate: '', weekday: '' };
                const timeMatch = timeStr.match(/(\d{1,2}):(\d{2})\s*(AM|PM)?/i);
                const dateMatch = timeStr.match(/(\d{4}-\d{2}-\d{2})/);
                let time = '--:--', period = '', date = '', fullDate = '', weekday = '';
                if (timeMatch) {
                    let hours = parseInt(timeMatch[1]);
                    const mins = timeMatch[2];
                    period = timeMatch[3] ? timeMatch[3].toUpperCase() : '';
                    if (!period) { period = hours >= 12 ? 'PM' : 'AM'; hours = hours % 12 || 12; }
                    time = `${hours}:${mins}`;
                }
                if (dateMatch) {
                    const d = new Date(dateMatch[1]);
                    date = d.toLocaleDateString('en-IN', { day: 'numeric', month: 'short' });
                    fullDate = d.toLocaleDateString('en-IN', { weekday: 'short', day: 'numeric', month: 'short' });
                    weekday = d.toLocaleDateString('en-IN', { weekday: 'short' });
                }
                return { time, date, period, fullDate, weekday };
            }

            // MakeMyTrip-style section with header and table
            function renderFlightTableSection(legData, sectionType, airlineData, price = null) {
                const dep = formatFlightTime(legData.departure);
                const arr = formatFlightTime(legData.arrival);
                const stopsMatch = legData.stops?.match(/(\d+)/);
                const numStops = stopsMatch ? parseInt(stopsMatch[1]) : (legData.stops?.toLowerCase().includes('non') ? 0 : 0);
                const stopsColor = numStops === 0 ? '#28a745' : '#ff9800';
                const stopsText = numStops === 0 ? 'Non stop' : legData.stops;

                // Generate airplane symbols based on number of stops
                const stopPlanes = numStops > 0 ? '‚úàÔ∏è'.repeat(Math.min(numStops, 3)) : '';

                const isReturn = sectionType === 'return';
                const headerBg = '#003580'; // Dark blue header like MakeMyTrip
                const routeText = `${legData.from} ‚Üí ${legData.to}`;
                const dateText = dep.fullDate || dep.date || '';

                // Handle missing times - only for edge cases where API returns N/A
                const isMissingTime = dep.time === 'N/A' || legData.departure === 'N/A';
                const depTimeDisplay = isMissingTime ? 'N/A' : dep.time;
                const arrTimeDisplay = isMissingTime ? 'N/A' : arr.time;
                const timeStyle = isMissingTime ? 'font-size:1rem;font-weight:500;color:#888;' : 'font-size:1.3rem;font-weight:700;color:#222;';

                const airlineDisplay = airlineData?.logo
                    ? `<img src="${airlineData.logo}" alt="${airlineData.name}" style="height:24px;margin-right:8px;vertical-align:middle;border-radius:3px;">`
                    : `<i class="fas fa-plane" style="margin-right:8px;font-size:1rem;color:#f57c00;"></i>`;

                return `
                    <div style="flex:1;min-width:300px;border:1px solid #ddd;border-radius:8px;overflow:hidden;background:#fff;">
                        <!-- Section Header - Dark like MakeMyTrip -->
                        <div style="background:${headerBg};padding:12px 16px;color:#fff;">
                            <div style="display:flex;justify-content:space-between;align-items:center;">
                                <div style="font-size:1rem;font-weight:600;">${routeText}</div>
                                <div style="font-size:0.85rem;opacity:0.9;">${dateText}</div>
                            </div>
                        </div>
                        
                        <!-- Table Header Row -->
                        <div style="display:grid;grid-template-columns:1fr 1fr 1fr ${price ? '1fr' : ''};background:#f5f5f5;border-bottom:1px solid #e0e0e0;">
                            <div style="padding:10px 12px;font-size:0.75rem;font-weight:600;color:#666;text-transform:uppercase;">Departure</div>
                            <div style="padding:10px 12px;font-size:0.75rem;font-weight:600;color:#666;text-transform:uppercase;text-align:center;">Duration</div>
                            <div style="padding:10px 12px;font-size:0.75rem;font-weight:600;color:#666;text-transform:uppercase;text-align:right;">Arrival</div>
                            ${price ? '<div style="padding:10px 12px;font-size:0.75rem;font-weight:600;color:#666;text-transform:uppercase;text-align:right;">Price ‚Üë</div>' : ''}
                        </div>
                        
                        <!-- Flight Row -->
                        <div style="padding:16px;border-left:3px solid ${isReturn ? '#1976d2' : '#f57c00'};">
                            <!-- Airline Info -->
                            <div style="display:flex;align-items:center;margin-bottom:12px;">
                                ${airlineDisplay}
                                <span style="font-size:0.9rem;font-weight:500;color:#333;">${airlineData?.name || 'Airline'}</span>
                            </div>
                            
                            <!-- Time Row with Duration -->
                            <div style="display:grid;grid-template-columns:1fr 1fr 1fr ${price ? '1fr' : ''};align-items:center;">
                                <!-- Departure Time -->
                                <div>
                                    <div style="${timeStyle}">${depTimeDisplay}</div>
                                    <div style="font-size:0.75rem;color:#666;">${legData.from}</div>
                                </div>
                                
                                <!-- Duration & Stops -->
                                <div style="text-align:center;">
                                    <div style="font-size:0.8rem;color:#666;margin-bottom:4px;">${isMissingTime ? 'TBC' : legData.duration}</div>
                                    <div style="position:relative;height:2px;background:#ddd;margin:0 10px;">
                                        <div style="position:absolute;left:0;top:-2px;width:6px;height:6px;background:#003580;border-radius:50%;"></div>
                                        ${numStops > 0 ? `<div style="position:absolute;left:50%;top:-8px;transform:translateX(-50%);font-size:0.7rem;letter-spacing:2px;">${stopPlanes}</div>` : ''}
                                        <div style="position:absolute;right:0;top:-2px;width:6px;height:6px;background:#003580;border-radius:50%;"></div>
                                    </div>
                                    <div style="font-size:0.7rem;color:${stopsColor};margin-top:4px;font-weight:600;">${stopsText}</div>
                                </div>
                                
                                <!-- Arrival Time -->
                                <div style="text-align:right;">
                                    <div style="${timeStyle}">${arrTimeDisplay}</div>
                                    <div style="font-size:0.75rem;color:#666;">${legData.to}</div>
                                </div>
                                
                                ${price ? `
                                <!-- Price Column -->
                                <div style="text-align:right;">
                                    <div style="font-size:1.2rem;font-weight:700;color:#003580;">${price}</div>
                                    <div style="font-size:0.65rem;color:#888;">/adult</div>
                                </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>`;
            }

            const html = flights.map(flight => {
                const airlineDisplay = flight.airlineLogo
                    ? `<img src="${flight.airlineLogo}" alt="${flight.airline}" style="height:28px;margin-right:10px;vertical-align:middle;border-radius:4px;">`
                    : '<i class="fas fa-plane" style="margin-right:10px;font-size:1.2rem;color:var(--accent-blue);"></i>';

                const isRoundTrip = flight.tripType === 'Round trip' && flight.returnFlight;

                // One-way flight: simple single section
                if (!isRoundTrip) {
                    return `
                    <div style="background:#fff;border-radius:12px;box-shadow:0 2px 12px rgba(0,0,0,0.08);margin-bottom:16px;overflow:hidden;border:1px solid #e0e0e0;">
                        ${renderFlightTableSection({
                        from: flight.from,
                        to: flight.to,
                        departure: flight.departure,
                        arrival: flight.arrival,
                        duration: flight.duration,
                        stops: flight.stops
                    }, 'onward', { name: flight.airline, logo: flight.airlineLogo }, flight.price)}
                        
                        <div style="padding:12px 16px;background:#f8f9fa;border-top:1px solid #e0e0e0;display:flex;justify-content:flex-end;">
                            <button onclick="bookFlight('${flight.from}', '${flight.to}', '${flight.airline}', '${flight.bookingToken || ''}')" style="background:linear-gradient(135deg, #003580 0%, #1a73e8 100%);color:#fff;border:none;padding:10px 28px;border-radius:8px;font-weight:600;font-size:0.9rem;cursor:pointer;transition:all 0.3s ease;box-shadow:0 2px 8px rgba(0,53,128,0.3);">
                                <i class="fas fa-bolt" style="margin-right:6px;"></i>Book Now
                            </button>
                        </div>
                    </div>`;
                }

                // Round-trip: MakeMyTrip-style TWO SEPARATE SECTIONS side by side
                const returnAirline = flight.returnFlight.airline || flight.airline;
                const returnLogo = flight.returnFlight.airlineLogo || flight.airlineLogo;

                return `
                <div style="background:#fff;border-radius:12px;box-shadow:0 2px 12px rgba(0,0,0,0.08);margin-bottom:20px;overflow:hidden;border:1px solid #e0e0e0;">
                    
                    <!-- TWO SECTIONS SIDE BY SIDE -->
                    <div style="display:flex;flex-wrap:wrap;">
                        <!-- SECTION 1: Outbound (A ‚Üí B) -->
                        <div style="flex:1;min-width:320px;border-right:1px solid #e0e0e0;">
                            ${renderFlightTableSection({
                    from: flight.from,
                    to: flight.to,
                    departure: flight.departure,
                    arrival: flight.arrival,
                    duration: flight.duration,
                    stops: flight.stops
                }, 'onward', { name: flight.airline, logo: flight.airlineLogo }, null)}
                        </div>
                        
                        <!-- SECTION 2: Return (B ‚Üí A) -->
                        <div style="flex:1;min-width:320px;">
                            ${renderFlightTableSection({
                    from: flight.returnFlight.from,
                    to: flight.returnFlight.to,
                    departure: flight.returnFlight.departure,
                    arrival: flight.returnFlight.arrival,
                    duration: flight.returnFlight.duration,
                    stops: flight.returnFlight.stops
                }, 'return', { name: returnAirline, logo: returnLogo }, null)}
                        </div>
                    </div>
                    
                    <!-- Bottom Summary Bar -->
                    <div style="padding:14px 20px;background:linear-gradient(135deg, #fafafa 0%, #f0f0f0 100%);border-top:1px solid #e0e0e0;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:12px;">
                        <div style="display:flex;align-items:center;gap:20px;">
                            <div>
                                <span style="font-size:0.75rem;color:#888;">Departure</span>
                                <div style="font-size:0.85rem;font-weight:600;color:#333;">${flight.airline}</div>
                            </div>
                            <div>
                                <span style="font-size:0.75rem;color:#888;">Return</span>
                                <div style="font-size:0.85rem;font-weight:600;color:#333;">${returnAirline}</div>
                            </div>
                        </div>
                        <div style="display:flex;align-items:center;gap:20px;">
                            <div style="text-align:right;">
                                <div style="font-size:1.5rem;font-weight:700;color:#003580;">${flight.price}</div>
                                <div style="font-size:0.7rem;color:#888;">Total Price</div>
                            </div>
                            <div style="display:flex;flex-direction:column;gap:6px;">
                                <button onclick="bookFlight('${flight.from}', '${flight.to}', '${flight.airline}', '${flight.bookingToken || ''}')" style="background:linear-gradient(135deg, #ff6b35 0%, #f45c22 100%);color:#fff;border:none;padding:12px 32px;border-radius:6px;font-weight:600;font-size:0.95rem;cursor:pointer;transition:all 0.3s ease;box-shadow:0 2px 8px rgba(255,107,53,0.3);">
                                    BOOK NOW
                                </button>
                            </div>
                        </div>
                    </div>
                </div>`;
            }).join('');

            container.innerHTML = html;
        }

        // Parse SerpAPI hotel results into our format
        function parseHotelResults(data, destination) {
            const hotels = [];

            // Check for properties in the response
            const properties = data.properties || [];

            for (const hotel of properties.slice(0, 15)) { // Limit to 15 results
                const amenitiesList = hotel.amenities ? hotel.amenities.slice(0, 4).join(', ') : 'WiFi, AC';
                // Use extracted_lowest (numeric) for sorting, fall back to parsing lowest string
                const priceNum = hotel.rate_per_night?.extracted_lowest ||
                    (hotel.rate_per_night?.lowest ? parseInt(hotel.rate_per_night.lowest.toString().replace(/[^0-9]/g, '')) : 5000) || 5000;
                const ratingNum = hotel.overall_rating || 4.0;
                const thumbnail = hotel.thumbnail || (hotel.images?.[0]?.thumbnail) || null;

                hotels.push({
                    name: hotel.name || 'Hotel',
                    location: hotel.neighborhood || hotel.location || destination,
                    rating: `${ratingNum} ‚òÖ`,
                    ratingNum: ratingNum,
                    amenities: amenitiesList,
                    price: `‚Çπ${priceNum.toLocaleString('en-IN')}/night`,
                    priceNum: priceNum,
                    image: thumbnail ? `<img src="${thumbnail}" alt="${hotel.name}" style="width:60px;height:60px;object-fit:cover;border-radius:8px;">` : 'üè®',
                    hotelClass: hotel.extracted_hotel_class || hotel.hotel_class || null,
                    link: hotel.link || null
                });
            }

            return hotels;
        }

        // SECURITY: Validate hotel search inputs
        function validateHotelSearch(destination, checkin, checkout) {
            const errors = [];

            if (!destination) {
                errors.push('Destination is required');
            } else if (destination.length < 2 || destination.length > 100) {
                errors.push('Destination must be between 2 and 100 characters');
            }

            if (!checkin) {
                errors.push('Check-in date is required');
            } else if (!isValidDate(checkin)) {
                errors.push('Please select a valid check-in date (today or future)');
            }

            if (!checkout) {
                errors.push('Check-out date is required');
            } else if (!isValidDate(checkout)) {
                errors.push('Please select a valid check-out date');
            }

            if (checkin && checkout && new Date(checkout) <= new Date(checkin)) {
                errors.push('Check-out date must be after check-in date');
            }

            return errors;
        }

        async function searchHotels() {
            const destination = sanitizeString(document.getElementById('hotel-dest').value, 100);
            const checkin = document.getElementById('hotel-checkin').value;
            const checkout = document.getElementById('hotel-checkout').value;
            const guests = document.getElementById('hotel-guests').value;
            const rooms = document.getElementById('hotel-rooms').value;
            const sortBy = document.getElementById('hotel-sort').value;
            const resultsDiv = document.getElementById('hotel-results');
            const loader = document.getElementById('hotel-loader');

            // SECURITY: Validate all inputs before sending to backend
            const validationErrors = validateHotelSearch(destination, checkin, checkout);
            if (validationErrors.length > 0) {
                alert(validationErrors.join('\n'));
                return;
            }

            loader.style.display = 'block';
            resultsDiv.innerHTML = '';

            let hotels = [];

            try {
                // SECURITY: All API calls go through secure backend - no client-side API keys
                console.log('Calling secure backend API for hotels...');
                const response = await fetch(`${API_BASE_URL}/api/hotels/search`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        destination,
                        check_in_date: checkin,
                        check_out_date: checkout,
                        currency: 'INR',
                        adults: parseInt(guests),
                        sort_by: sortBy || undefined
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    if (data.hotels && data.hotels.length > 0) {
                        hotels = data.hotels.map(h => ({
                            name: escapeHtml(h.name),
                            location: escapeHtml(h.location),
                            rating: escapeHtml(h.rating_formatted),
                            ratingNum: h.rating || 0,
                            amenities: escapeHtml(h.amenities_formatted),
                            price: escapeHtml(h.price_formatted),
                            priceNum: h.price ? parseFloat(String(h.price).replace(/[^0-9.]/g, '')) : 0,
                            thumbnail: h.thumbnail || null,
                            link: h.link || null
                        }));
                    }
                } else {
                    // SECURITY: Handle error responses including rate limits
                    const errorMessage = await handleErrorResponse(response);
                    console.error('Hotel search failed:', errorMessage);
                    loader.style.display = 'none';
                    resultsDiv.innerHTML = `<div class="error-message"><strong>Error:</strong> ${escapeHtml(errorMessage)}</div>`;
                    return;
                }
            } catch (err) {
                console.error('Hotel search error:', err.message);
                loader.style.display = 'none';
                resultsDiv.innerHTML = `<div class="error-message"><strong>Error:</strong> Unable to connect to server. Please check your internet connection and try again.</div>`;
                return;
            }

            loader.style.display = 'none';
            displayHotels(hotels, resultsDiv, checkin, checkout);

            // Show success toast
            if (hotels.length > 0) {
                showToast(`‚úÖ Found ${hotels.length} hotels in ${destination}`, 'success');
            }

            // Auto-open full-page view for hotels (Trip.com style)
            setTimeout(() => {
                openFullPageHotels(destination);
            }, 500);
        }

        function displayHotels(hotels, container, checkin, checkout) {
            if (!hotels || hotels.length === 0) {
                container.innerHTML = '<div class="no-results"><i class="fas fa-hotel" style="font-size:3rem;margin-bottom:15px;color:#ccc;"></i><br>No hotels found for your search criteria.</div>';
                return;
            }

            const html = hotels.map(hotel => {
                const hotelImage = hotel.thumbnail
                    ? `<img src="${hotel.thumbnail}" alt="${hotel.name}" style="width:80px;height:80px;object-fit:cover;border-radius:8px;margin-right:15px;">`
                    : `<div style="width:80px;height:80px;background:#f0f0f0;border-radius:8px;display:flex;align-items:center;justify-content:center;margin-right:15px;"><i class="fas fa-hotel" style="font-size:2rem;color:#ccc;"></i></div>`;

                return `
                <div class="hotel-card">
                    <div class="hotel-header">
                        <div style="display:flex;align-items:center;">
                            ${hotelImage}
                            <div>
                                <h3 style="margin:0; color: var(--accent-blue);">${hotel.name}</h3>
                                <p style="margin:5px 0 0 0; color: var(--gray); font-size:0.9rem;"><i class="fas fa-map-marker-alt"></i> ${hotel.location}</p>
                            </div>
                        </div>
                        <div class="price-tag">${hotel.price}</div>
                    </div>
                    <div class="hotel-details">
                        <div class="detail-item">
                            <span class="detail-label">Rating</span>
                            <span class="detail-value">${hotel.rating}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Check-in</span>
                            <span class="detail-value">${checkin}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Check-out</span>
                            <span class="detail-value">${checkout}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Amenities</span>
                            <span class="detail-value">${hotel.amenities}</span>
                        </div>
                    </div>
                    <button class="btn-book" onclick="bookHotel('${encodeURIComponent(hotel.name)}', '${encodeURIComponent(hotel.location)}', '${hotel.link || ''}')">Book Now</button>
                </div>
            `}).join('');

            container.innerHTML = html;
        }

        // Booking functions for flights and hotels
        // Works like Skyscanner -        // Direct airline booking - bypass Google Flights completely
        function bookFlight(from, to, airline, bookingToken) {
            // Comprehensive map of airlines to their direct booking URLs (simplified homepage links)
            const airlineBookingUrls = {
                // Indian Airlines
                'IndiGo': () => `https://www.goindigo.in/`,
                'Air India': () => `https://www.airindia.com/`,
                'SpiceJet': () => `https://www.spicejet.com/`,
                'Vistara': () => `https://www.airvistara.com/`,
                'AirAsia': () => `https://www.airasia.co.in/`,
                'AirAsia India': () => `https://www.airasia.co.in/`,
                'Go First': () => `https://www.flygofirst.com/`,
                'Akasa Air': () => `https://www.akasaair.com/`,
                'Air India Express': () => `https://www.airindiaexpress.com/`,
                'Alliance Air': () => `https://www.allianceair.in/`,
                'Star Air': () => `https://www.starair.in/`,
                'Fly91': () => `https://www.fly91.com/`,

                // Middle East Airlines
                'Emirates': () => `https://www.emirates.com/in/english/`,
                'Etihad': () => `https://www.etihad.com/en-in/`,
                'Qatar Airways': () => `https://www.qatarairways.com/en-in/`,
                'Oman Air': () => `https://www.omanair.com/`,
                'Gulf Air': () => `https://www.gulfair.com/`,
                'Saudia': () => `https://www.saudia.com/`,
                'flydubai': () => `https://www.flydubai.com/`,
                'Air Arabia': () => `https://www.airarabia.com/`,
                'Kuwait Airways': () => `https://www.kuwaitairways.com/`,

                // Asian Airlines
                'Singapore Airlines': () => `https://www.singaporeair.com/`,
                'Thai Airways': () => `https://www.thaiairways.com/`,
                'Malaysia Airlines': () => `https://www.malaysiaairlines.com/`,
                'Cathay Pacific': () => `https://www.cathaypacific.com/`,
                'Japan Airlines': () => `https://www.jal.co.jp/en/`,
                'ANA': () => `https://www.ana.co.jp/en/`,
                'Korean Air': () => `https://www.koreanair.com/`,
                'China Eastern': () => `https://www.ceair.com/`,
                'China Southern': () => `https://www.csair.com/`,
                'Air China': () => `https://www.airchina.com.cn/`,
                'Vietnam Airlines': () => `https://www.vietnamairlines.com/`,
                'Thai Lion Air': () => `https://www.lionairthai.com/`,
                'Philippine Airlines': () => `https://www.philippineairlines.com/`,
                'SriLankan Airlines': () => `https://www.srilankan.com/`,
                'Garuda Indonesia': () => `https://www.garuda-indonesia.com/`,
                'Scoot': () => `https://www.flyscoot.com/`,

                // European Airlines
                'British Airways': () => `https://www.britishairways.com/`,
                'Lufthansa': () => `https://www.lufthansa.com/`,
                'Air France': () => `https://www.airfrance.in/`,
                'KLM': () => `https://www.klm.com/`,
                'Swiss': () => `https://www.swiss.com/`,
                'Turkish Airlines': () => `https://www.turkishairlines.com/`,
                'Finnair': () => `https://www.finnair.com/`,
                'Austrian': () => `https://www.austrian.com/`,
                'LOT Polish': () => `https://www.lot.com/`,
                'Virgin Atlantic': () => `https://www.virginatlantic.com/`,
                'Aeroflot': () => `https://www.aeroflot.ru/`,

                // American Airlines
                'United Airlines': () => `https://www.united.com/`,
                'American Airlines': () => `https://www.aa.com/`,
                'Delta': () => `https://www.delta.com/`,
                'Air Canada': () => `https://www.aircanada.com/`,

                // Australian Airlines
                'Qantas': () => `https://www.qantas.com/`,

                // African Airlines  
                'Ethiopian Airlines': () => `https://www.ethiopianairlines.com/`,
                'Kenya Airways': () => `https://www.kenya-airways.com/`,
                'South African Airways': () => `https://www.flysaa.com/`,
                'EgyptAir': () => `https://www.egyptair.com/`
            };

            // Find the matching airline booking URL (flexible matching)
            let bookingUrl = null;
            const airlineLower = airline.toLowerCase().trim();

            for (const [name, urlFn] of Object.entries(airlineBookingUrls)) {
                const nameLower = name.toLowerCase();
                // Check for partial matches
                if (airlineLower.includes(nameLower) || nameLower.includes(airlineLower) ||
                    airlineLower.replace(/\s+/g, '').includes(nameLower.replace(/\s+/g, '')) ||
                    nameLower.replace(/\s+/g, '').includes(airlineLower.replace(/\s+/g, ''))) {
                    bookingUrl = urlFn(from, to);
                    break;
                }
            }

            // Fallback: Search for the airline's official website
            if (!bookingUrl) {
                // Search for "[airline name] book flight official website"
                bookingUrl = `https://www.google.com/search?q=${encodeURIComponent(airline)}+official+website+book+flight&btnI=1`;
            }

            showToast(`Opening ${airline} booking page...`, 'success');
            window.open(bookingUrl, '_blank', 'noopener,noreferrer');
        }

        function showBookingOptionsModal(options, airline, from, to) {
            // Remove existing modal if any
            const existingModal = document.getElementById('booking-modal');
            if (existingModal) existingModal.remove();

            // Create modal HTML
            const modalHtml = `
                <div id="booking-modal" style="position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.8);z-index:9999;display:flex;align-items:center;justify-content:center;padding:20px;">
                    <div style="background:white;border-radius:12px;max-width:500px;width:100%;max-height:80vh;overflow-y:auto;color:#333;">
                        <div style="padding:20px;border-bottom:1px solid #eee;display:flex;justify-content:space-between;align-items:center;">
                            <h3 style="margin:0;color:#003580;">‚úàÔ∏è Book ${airline} - ${from} ‚Üí ${to}</h3>
                            <button onclick="closeBookingModal()" style="background:none;border:none;font-size:1.5rem;cursor:pointer;color:#666;">&times;</button>
                        </div>
                        <div style="padding:20px;">
                            <p style="color:#666;margin-bottom:15px;">Choose where to complete your booking:</p>
                            ${options.map((opt, index) => `
                                <div style="border:1px solid #e0e0e0;border-radius:8px;padding:15px;margin-bottom:10px;cursor:pointer;transition:all 0.2s;${opt.is_airline ? 'border-color:#28a745;background:#f8fff8;' : ''}" 
                                     onclick="openBookingUrl('${encodeURIComponent(opt.booking_url)}')"
                                     onmouseover="this.style.transform='translateY(-2px)';this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)'"
                                     onmouseout="this.style.transform='none';this.style.boxShadow='none'">
                                    <div style="display:flex;justify-content:space-between;align-items:center;">
                                        <div>
                                            <strong style="color:#333;">${opt.book_with}</strong>
                                            ${opt.is_airline ? '<span style="background:#28a745;color:white;font-size:0.7rem;padding:2px 6px;border-radius:4px;margin-left:8px;">‚úì Direct Airline</span>' : ''}
                                            ${opt.option_title ? `<div style="color:#666;font-size:0.85rem;margin-top:4px;">${opt.option_title}</div>` : ''}
                                        </div>
                                        <div style="text-align:right;">
                                            <div style="font-size:1.25rem;font-weight:bold;color:#003580;">${opt.price_formatted}</div>
                                        </div>
                                    </div>
                                    ${opt.baggage_prices && opt.baggage_prices.length > 0 ? `
                                        <div style="margin-top:8px;font-size:0.8rem;color:#888;">
                                            üß≥ ${opt.baggage_prices.slice(0, 2).join(' ‚Ä¢ ')}
                                        </div>
                                    ` : ''}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;

            document.body.insertAdjacentHTML('beforeend', modalHtml);
        }

        function closeBookingModal() {
            const modal = document.getElementById('booking-modal');
            if (modal) modal.remove();
        }

        function openBookingUrl(encodedUrl) {
            closeBookingModal();
            const url = decodeURIComponent(encodedUrl);
            window.open(url, '_blank', 'noopener,noreferrer');
        }

        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.id = 'toast-' + Date.now();
            toast.style.cssText = `position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:${type === 'info' ? '#003580' : '#28a745'};color:white;padding:12px 24px;border-radius:8px;z-index:10000;font-weight:500;box-shadow:0 4px 12px rgba(0,0,0,0.2);transition:opacity 0.3s ease;`;
            toast.innerHTML = `<i class="fas fa-external-link-alt" style="margin-right:8px;"></i>${message}`;
            document.body.appendChild(toast);

            // Auto-hide toast after 3 seconds
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, 3000);

            return toast.id;
        }

        function hideToast(toastId) {
            const toast = document.getElementById(toastId);
            if (toast) toast.remove();
        }

        /**
         * Search for flight booking when no direct link is available
         */
        function searchFlightBooking(airline, flightNumber, departureTime) {
            const searchQuery = `${decodeURIComponent(airline)} ${flightNumber || ''} flight booking ${departureTime || ''}`.trim();
            const bookingUrl = `https://www.google.com/travel/flights?q=${encodeURIComponent(searchQuery)}&hl=en&gl=in&curr=INR`;

            const newWindow = window.open(bookingUrl, '_blank', 'noopener,noreferrer');

            if (!newWindow || newWindow.closed) {
                showToast('Opening flight search...', 'info');
                window.location.href = bookingUrl;
            }
        }

        function bookHotel(hotelName, location, directLink) {
            let bookingUrl;

            if (directLink && directLink !== 'null' && directLink !== '') {
                // Use the direct link from SerpAPI
                bookingUrl = decodeURIComponent(directLink);
            } else {
                // Fallback: Search Google Hotels for this property
                const searchQuery = `${decodeURIComponent(hotelName)} ${decodeURIComponent(location)} hotel booking`;
                bookingUrl = `https://www.google.com/travel/hotels?q=${encodeURIComponent(searchQuery)}&hl=en&gl=in&curr=INR`;
            }

            // Open in new tab
            const newWindow = window.open(bookingUrl, '_blank', 'noopener,noreferrer');

            if (!newWindow || newWindow.closed || typeof newWindow.closed === 'undefined') {
                // Popup blocked - try alternate approach
                alert('Please allow popups for this site to complete your booking.\n\nAlternatively, click OK to open the booking page.');
                window.location.href = bookingUrl;
            }
        }

        // Store current itinerary
        window.currentItinerary = null;

        async function generateAITrip() {
            const dest = document.getElementById('ai-dest').value.trim();
            const days = document.getElementById('ai-days').value.trim();
            const prefs = document.getElementById('ai-prefs').value.trim();
            const resultsDiv = document.getElementById('ai-results');
            const loader = document.getElementById('ai-loader');
            const btn = document.getElementById('generate-btn');

            if (!dest) {
                alert("Please enter a destination");
                return;
            }

            loader.style.display = 'block';
            resultsDiv.innerHTML = '<p style="text-align:center;color:#888;padding:20px;">üîÑ Generating your personalized itinerary...</p>';
            btn.disabled = true;

            // Update button to show loading state
            const btnText = document.getElementById('generate-btn-text');
            const btnIcon = document.getElementById('generate-btn-icon');
            if (btnText) btnText.textContent = 'Generating...';
            if (btnIcon) {
                btnIcon.classList.remove('fa-magic');
                btnIcon.classList.add('fa-spinner', 'fa-spin');
            }

            try {
                // Generate single itinerary based on user preferences
                const prompt = `Create a ${days || '5'}-day travel itinerary for ${dest}. ${prefs ? 'Preferences: ' + prefs : ''} Provide day-by-day breakdown with recommendations.`;

                const response = await fetchWithFailover('/api/itinerary/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        destination: dest,
                        duration: days || '5 days',
                        preferences: prefs || ''
                    })
                });

                if (!response.ok) {
                    throw new Error(`Failed to generate itinerary: ${response.statusText}`);
                }

                const data = await response.json();
                window.currentItinerary = data.itinerary || data.message || "No content received.";

                loader.style.display = 'none';
                displayFormattedItinerary(window.currentItinerary, resultsDiv);

                // Automatically open full-page itinerary view
                setTimeout(() => {
                    openFullPageItinerary();
                }, 500);

                showToast('‚ú® Itinerary generated successfully!', 'success');

            } catch (error) {
                loader.style.display = 'none';
                resultsDiv.innerHTML = `<div class="error-message">
                    <strong>Error:</strong> ${error.message}<br>
                    <small>Please check your internet connection and try again.</small>
                </div>`;
            } finally {
                btn.disabled = false;
                // Restore button text
                const btnText = document.getElementById('generate-btn-text');
                const btnIcon = document.getElementById('generate-btn-icon');
                if (btnText) btnText.textContent = 'Generate Trip';
                if (btnIcon) {
                    btnIcon.classList.remove('fa-spinner', 'fa-spin');
                    btnIcon.classList.add('fa-magic');
                }
            }
        }

        function convertMarkdownToHTML(markdown) {
            if (!markdown) return '';

            // Split into lines for processing
            const lines = markdown.split('\n');
            let result = [];
            let inDayCard = false;
            let inList = false;
            let inTable = false;
            let tableRows = [];

            for (let i = 0; i < lines.length; i++) {
                let line = lines[i].trim();
                if (!line) continue;

                // Skip horizontal rules
                if (/^[\-\*\_]{3,}$/.test(line)) continue;

                // Check for Day headings (various formats)
                const dayMatch = line.match(/^#{1,4}\s*\*{0,2}\s*(Day\s*\d+[^*]*)\*{0,2}\s*$/i) ||
                    line.match(/^\*{0,2}\s*(Day\s*\d+[^*]*)\*{0,2}\s*$/i);

                if (dayMatch) {
                    // Close table if open
                    if (inTable && tableRows.length > 0) {
                        result.push(buildBudgetTable(tableRows));
                        tableRows = [];
                        inTable = false;
                    }
                    // Close previous day card if open
                    if (inDayCard) {
                        if (inList) { result.push('</ul>'); inList = false; }
                        result.push('</div>');
                    }
                    // Start new day card
                    result.push(`<div class="day-card"><h2>${dayMatch[1].trim()}</h2>`);
                    inDayCard = true;
                    continue;
                }

                // Check for table rows
                if (line.startsWith('|') && line.endsWith('|')) {
                    const cells = line.split('|').filter(c => c.trim());
                    // Skip separator rows (|---|---|---|)
                    if (cells.some(c => /^[\s\-:]+$/.test(c))) continue;

                    if (inList) { result.push('</ul>'); inList = false; }
                    inTable = true;
                    tableRows.push(cells.map(c => c.trim()));
                    continue;
                }

                // If we were in a table but hit a non-table line, close the table
                if (inTable && tableRows.length > 0) {
                    result.push(buildBudgetTable(tableRows));
                    tableRows = [];
                    inTable = false;
                }

                // Convert bold text
                line = line.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                // Convert italic text
                line = line.replace(/\*([^*\n]+)\*/g, '<em>$1</em>');
                // Clean any remaining asterisks
                line = line.replace(/\*/g, '');

                // Check for other headings
                if (line.startsWith('####')) {
                    if (inList) { result.push('</ul>'); inList = false; }
                    result.push(`<h4>${line.replace(/^####\s*/, '')}</h4>`);
                } else if (line.startsWith('###')) {
                    if (inList) { result.push('</ul>'); inList = false; }
                    result.push(`<h3>${line.replace(/^###\s*/, '')}</h3>`);
                } else if (line.startsWith('##')) {
                    if (inList) { result.push('</ul>'); inList = false; }
                    result.push(`<h3>${line.replace(/^##\s*/, '')}</h3>`);
                } else if (line.startsWith('#')) {
                    if (inList) { result.push('</ul>'); inList = false; }
                    result.push(`<h2>${line.replace(/^#\s*/, '')}</h2>`);
                }
                // Check for list items
                else if (/^[\*\-]\s+/.test(line)) {
                    if (!inList) {
                        result.push('<ul>');
                        inList = true;
                    }
                    result.push(`<li>${line.replace(/^[\*\-]\s+/, '')}</li>`);
                }
                // Tip cards
                else if (line.toLowerCase().includes('tip:') || line.toLowerCase().includes('pro tip')) {
                    if (inList) { result.push('</ul>'); inList = false; }
                    result.push(`<div class="tip-card">${line.replace(/\*{0,2}(?:Pro\s*)?Tip:?\*{0,2}/gi, '<strong>üí° Tip:</strong>')}</div>`);
                }
                // Regular paragraph
                else {
                    if (inList) { result.push('</ul>'); inList = false; }
                    // Clean up any remaining # symbols
                    line = line.replace(/^#+\s*/, '');
                    if (line) result.push(`<p>${line}</p>`);
                }
            }

            // Close any open elements
            if (inTable && tableRows.length > 0) {
                result.push(buildBudgetTable(tableRows));
            }
            if (inList) result.push('</ul>');
            if (inDayCard) result.push('</div>');

            return result.join('\n');
        }

        // Build a proper budget comparison table with 3 columns
        function buildBudgetTable(rows) {
            if (rows.length === 0) return '';

            let html = '<div class="budget-box"><h3 class="budget-title">üí∞ Budget Breakdown</h3>';
            html += '<table class="budget-table"><thead><tr>';

            // First row is header
            const headers = rows[0];
            // Ensure we have 4 columns: Category, Budget, Mid-Range, Luxury
            const columnHeaders = ['Category', 'Budget', 'Mid-Range', 'Luxury'];

            for (let i = 0; i < columnHeaders.length; i++) {
                const headerText = headers[i] || columnHeaders[i];
                html += `<th>${headerText}</th>`;
            }
            html += '</tr></thead><tbody>';

            // Data rows
            for (let i = 1; i < rows.length; i++) {
                html += '<tr>';
                for (let j = 0; j < 4; j++) {
                    const cellValue = rows[i][j] || '-';
                    // Add color coding for price cells
                    if (j === 1) {
                        html += `<td class="price-budget">${cellValue}</td>`;
                    } else if (j === 2) {
                        html += `<td class="price-midrange">${cellValue}</td>`;
                    } else if (j === 3) {
                        html += `<td class="price-luxury">${cellValue}</td>`;
                    } else {
                        html += `<td>${cellValue}</td>`;
                    }
                }
                html += '</tr>';
            }

            html += '</tbody></table></div>';
            return html;
        }

        // Global state for itinerary
        let currentTier = 'midrange';
        // Note: itineraryMap is already declared in the Interactive Map Integration section (line ~7197)
        let mapMarkers = [];

        // Tier-based pricing multipliers
        const tierPricing = {
            budget: { transport: 25, attractions: 40, stay: 50, total: 115 },
            midrange: { transport: 45, attractions: 80, stay: 120, total: 245 },
            luxury: { transport: 100, attractions: 150, stay: 300, total: 550 }
        };

        function displayFormattedItinerary(content, container) {
            const destination = document.getElementById('ai-dest').value.trim() || 'Your Destination';
            const duration = document.getElementById('ai-days').value.trim() || '5';
            const daysNum = parseInt(duration) || 5;

            // Store content globally for tier switching
            window.currentItineraryContent = content;
            window.currentDaysNum = daysNum;
            window.currentDestination = destination;

            // Parse the markdown to extract days and activities
            const parsedData = parseItineraryContent(content);
            window.parsedItineraryData = parsedData;

            // Generate day tabs
            let dayTabsHTML = '<div class="trip-day-tab active" data-day="0">Overview</div>';
            for (let i = 1; i <= daysNum; i++) {
                dayTabsHTML += `<div class="trip-day-tab" data-day="${i}">Day ${i}</div>`;
            }

            // Generate activities HTML
            const activitiesHTML = generateTripActivities(parsedData, daysNum);

            // Get current tier pricing
            const prices = tierPricing[currentTier];

            container.innerHTML = `
                <div class="itinerary-container">
                    <div class="itinerary-header">
                        <h1>‚úàÔ∏è ${destination}</h1>
                        <p>
                            <span class="meta-badge">üìÖ ${duration} Days</span>
                            <span class="meta-badge">‚ú® AI Generated</span>
                            <span class="meta-badge">üéØ Personalized</span>
                        </p>
                    </div>
                    
                    <div class="trip-itinerary-layout">
                        <!-- Budget Sidebar -->
                        <div class="trip-budget-sidebar">
                            <div class="trip-budget-header">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                                </svg>
                                <h3>AI Assistant</h3>
                            </div>
                            
                            <!-- Budget Tier Tabs -->
                            <div class="trip-tier-tabs">
                                <div class="trip-tier-tab ${currentTier === 'budget' ? 'active' : ''}" data-tier="budget">
                                    <span class="tier-icon">üí∞</span>
                                    Budget
                                    <span class="tier-price">~$${(tierPricing.budget.total * daysNum).toLocaleString()}</span>
                                </div>
                                <div class="trip-tier-tab ${currentTier === 'midrange' ? 'active' : ''}" data-tier="midrange">
                                    <span class="tier-icon">üíé</span>
                                    Mid-Range
                                    <span class="tier-price">~$${(tierPricing.midrange.total * daysNum).toLocaleString()}</span>
                                </div>
                                <div class="trip-tier-tab ${currentTier === 'luxury' ? 'active' : ''}" data-tier="luxury">
                                    <span class="tier-icon">üëë</span>
                                    Luxury
                                    <span class="tier-price">~$${(tierPricing.luxury.total * daysNum).toLocaleString()}</span>
                                </div>
                            </div>
                            
                            <div class="trip-budget-total" id="trip-budget-total">
                                <div class="label">Estimated Total</div>
                                <div class="amount">‚âà $${(prices.total * daysNum).toLocaleString()}</div>
                                <div class="per-person">1 traveler</div>
                            </div>
                            <div class="trip-budget-progress">
                                <div class="trip-budget-progress-bar"></div>
                            </div>
                            <div class="trip-budget-items" id="trip-budget-items">
                                <div class="trip-budget-item transport">
                                    <div class="icon">üöó</div>
                                    <div class="details">
                                        <div class="category">Transportation</div>
                                        <div class="price">$${(prices.transport * daysNum).toLocaleString()}</div>
                                    </div>
                                </div>
                                <div class="trip-budget-item attractions">
                                    <div class="icon">üé≠</div>
                                    <div class="details">
                                        <div class="category">Attractions</div>
                                        <div class="price">$${(prices.attractions * daysNum).toLocaleString()}</div>
                                    </div>
                                </div>
                                <div class="trip-budget-item stay">
                                    <div class="icon">üè®</div>
                                    <div class="details">
                                        <div class="category">Accommodation</div>
                                        <div class="price">$${(prices.stay * daysNum).toLocaleString()}</div>
                                    </div>
                                </div>
                            </div>
                            <div class="trip-ai-note">
                                <strong>‚ÑπÔ∏è</strong> This content is generated by AI. Costs are estimated. Please confirm at the time of booking.
                            </div>
                        </div>
                        
                        <!-- Main Itinerary Content -->
                        <div class="trip-itinerary-main">
                            <div class="trip-day-tabs">
                                ${dayTabsHTML}
                            </div>
                            <div class="trip-title-bar">
                                <h2>
                                    <span class="trip-year-badge">üóìÔ∏è 2026</span>
                                    ${destination} Immersion
                                </h2>
                            </div>
                            <div class="trip-activities" id="trip-activities-container">
                                ${activitiesHTML}
                            </div>
                        </div>
                        
                        <!-- Map Panel -->
                        <div class="trip-map-panel">
                            <div class="trip-map-header">
                                <h3>üìç ${destination}</h3>
                                <div class="trip-map-filters">
                                    <div class="trip-map-filter active" data-filter="overall">üó∫Ô∏è Overall</div>
                                    <div class="trip-map-filter" data-filter="attractions">üé≠ Attractions</div>
                                    <div class="trip-map-filter" data-filter="hotels">üè® Hotels</div>
                                    <div class="trip-map-filter" data-filter="food">üçΩÔ∏è Food</div>
                                </div>
                            </div>
                            <div class="trip-map-container">
                                <div id="itinerary-map"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="itinerary-actions">
                        <button class="btn-outline" onclick="saveTrip()" id="save-trip-btn">
                            <i class="fas fa-save"></i> Save Trip
                        </button>
                        <button class="btn-outline" onclick="copyItinerary()">
                            <i class="fas fa-copy"></i> Copy
                        </button>
                        <button class="btn-outline" onclick="downloadItinerary()">
                            <i class="fas fa-file-pdf"></i> Download PDF
                        </button>
                        <button class="btn-outline" onclick="printItinerary()">
                            <i class="fas fa-print"></i> Print
                        </button>
                        <button class="btn-main" onclick="generateAITrip()">
                            <i class="fas fa-magic"></i> Regenerate
                        </button>
                    </div>
                </div>
            `;

            // Add day tab click handlers
            document.querySelectorAll('.trip-day-tab').forEach(tab => {
                tab.addEventListener('click', function () {
                    document.querySelectorAll('.trip-day-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    const dayNum = parseInt(this.dataset.day);
                    filterActivitiesByDay(dayNum);
                });
            });

            // Add tier tab click handlers
            document.querySelectorAll('.trip-tier-tab').forEach(tab => {
                tab.addEventListener('click', function () {
                    const tier = this.dataset.tier;
                    switchBudgetTier(tier);
                });
            });

            // Initialize map
            initializeItineraryMap(destination, parsedData);

            // Add map filter click handlers
            document.querySelectorAll('.trip-map-filter').forEach(filter => {
                filter.addEventListener('click', function () {
                    const filterType = this.dataset.filter;
                    // Update active state
                    document.querySelectorAll('.trip-map-filter').forEach(f => f.classList.remove('active'));
                    this.classList.add('active');
                    // Apply filter
                    filterMapMarkers(filterType);
                });
            });
        }

        // Switch budget tier and update UI with different itinerary content
        function switchBudgetTier(tier) {
            currentTier = tier;
            const daysNum = window.currentDaysNum || 5;
            const prices = tierPricing[tier];
            const resultsDiv = document.getElementById('ai-results');

            // Update tier tab active states
            document.querySelectorAll('.trip-tier-tab').forEach(t => {
                t.classList.toggle('active', t.dataset.tier === tier);
            });

            // Check if we have a stored itinerary for this tier
            if (window.tierItineraries && window.tierItineraries[tier]) {
                // Re-render the entire itinerary with the tier-specific content
                displayFormattedItinerary(window.tierItineraries[tier], resultsDiv);
                showToast(`Switched to ${tier === 'budget' ? 'üí∞ Budget' : tier === 'midrange' ? 'üíé Mid-Range' : 'üëë Luxury'} itinerary!`, 'success');
            } else {
                // No stored content - just update prices
                const totalDiv = document.getElementById('trip-budget-total');
                if (totalDiv) {
                    totalDiv.innerHTML = `
                        <div class="label">Estimated Total</div>
                        <div class="amount">‚âà $${(prices.total * daysNum).toLocaleString()}</div>
                        <div class="per-person">1 traveler</div>
                    `;
                }

                const itemsDiv = document.getElementById('trip-budget-items');
                if (itemsDiv) {
                    itemsDiv.innerHTML = `
                        <div class="trip-budget-item transport">
                            <div class="icon">üöó</div>
                            <div class="details">
                                <div class="category">Transportation</div>
                                <div class="price">$${(prices.transport * daysNum).toLocaleString()}</div>
                            </div>
                        </div>
                        <div class="trip-budget-item attractions">
                            <div class="icon">üé≠</div>
                            <div class="details">
                                <div class="category">Attractions</div>
                                <div class="price">$${(prices.attractions * daysNum).toLocaleString()}</div>
                            </div>
                        </div>
                        <div class="trip-budget-item stay">
                            <div class="icon">üè®</div>
                            <div class="details">
                                <div class="category">Accommodation</div>
                                <div class="price">$${(prices.stay * daysNum).toLocaleString()}</div>
                            </div>
                        </div>
                    `;
                }
                showToast(`Switched to ${tier.charAt(0).toUpperCase() + tier.slice(1)} tier! Generate itinerary to see tier-specific activities.`, 'info');
            }
        }

        // ==================== FULL-PAGE ITINERARY VIEW FUNCTIONS ====================

        function openFullPageItinerary() {
            const fullPageDiv = document.getElementById('itinerary-fullpage');
            const contentDiv = document.getElementById('itinerary-fullpage-content');
            const navTitle = document.getElementById('itinerary-nav-title');
            const resultsDiv = document.getElementById('ai-results');

            if (!fullPageDiv || !contentDiv) return;

            // Set navigation title
            const destination = window.currentDestination || 'Your Destination';
            navTitle.textContent = `${destination} Itinerary`;

            // Create animated title card
            const titleCardHTML = createAnimatedTitleCard(destination);

            // Copy itinerary content from results div
            const itineraryContent = resultsDiv.innerHTML;

            // Insert into full-page view with title card
            contentDiv.innerHTML = titleCardHTML + itineraryContent;

            // Show full-page view
            fullPageDiv.classList.add('active');
            document.body.style.overflow = 'hidden'; // Prevent background scrolling

            // Re-initialize map in full-page view
            setTimeout(() => {
                if (window.parsedItineraryData && window.currentDestination) {
                    initializeItineraryMap(window.currentDestination, window.parsedItineraryData);
                }
            }, 300);

            // Re-attach event listeners
            attachItineraryEventListeners();
        }

        function closeFullPageItinerary() {
            const fullPageDiv = document.getElementById('itinerary-fullpage');
            if (fullPageDiv) {
                fullPageDiv.classList.remove('active');
                document.body.style.overflow = ''; // Restore scrolling
            }
        }

        // ==================== TRIP SAVING (SUPABASE) ====================

        async function saveTrip() {
            // Check if user is logged in
            if (!currentUser) {
                showToast('‚ö†Ô∏è Please sign in to save your trip', 'info');
                openSignInModal();
                return;
            }

            // Get current destination and itinerary
            const destination = document.getElementById('ai-dest')?.value?.trim() || 'Unknown';
            const tripData = window.tierItineraries[currentTier];

            if (!tripData) {
                showToast('‚ö†Ô∏è No itinerary to save. Please generate one first.', 'info');
                return;
            }

            const btn = document.getElementById('save-trip-btn');
            if (btn) {
                btn.disabled = true;
                btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
            }

            try {
                const response = await fetch(`${API_BASE_URL}/api/itinerary/save`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        user_id: currentUser.id,
                        destination: destination,
                        trip_data: {
                            tier: currentTier,
                            content: tripData,
                            allTiers: window.tierItineraries
                        },
                        start_date: null,
                        end_date: null
                    })
                });

                const data = await response.json();

                if (data.success) {
                    showToast('‚úÖ Trip saved successfully!', 'success');
                    if (btn) btn.innerHTML = '<i class="fas fa-check"></i> Saved!';
                } else {
                    throw new Error(data.error || 'Failed to save');
                }
            } catch (error) {
                console.error('Save trip error:', error);
                showToast('‚ùå Failed to save trip. Please try again.', 'error');
                if (btn) btn.innerHTML = '<i class="fas fa-save"></i> Save Trip';
            } finally {
                if (btn) {
                    btn.disabled = false;
                    setTimeout(() => {
                        btn.innerHTML = '<i class="fas fa-save"></i> Save Trip';
                    }, 2000);
                }
            }
        }

        async function loadMyTrips() {
            if (!currentUser) {
                showToast('‚ö†Ô∏è Please sign in to view your trips', 'info');
                openSignInModal();
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/api/itinerary/list`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: currentUser.id })
                });

                const data = await response.json();

                if (data.success) {
                    displaySavedTrips(data.itineraries);
                } else {
                    showToast('‚ùå Failed to load trips', 'error');
                }
            } catch (error) {
                console.error('Load trips error:', error);
                showToast('‚ùå Failed to load trips', 'error');
            }
        }

        function displaySavedTrips(itineraries) {
            if (!itineraries || itineraries.length === 0) {
                showToast('üì≠ No saved trips yet. Generate and save your first trip!', 'info');
                return;
            }

            // Create a simple modal to show saved trips
            const modal = document.createElement('div');
            modal.id = 'saved-trips-modal';
            modal.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);z-index:10001;display:flex;align-items:center;justify-content:center;';

            let tripsHTML = itineraries.map(trip => `
                <div style="background:#2a2a2a;padding:15px;margin:10px 0;border-radius:8px;cursor:pointer;" onclick="loadTrip('${trip.id}')">
                    <h4 style="margin:0;color:#fff;">üìç ${trip.destination}</h4>
                    <small style="color:#888;">Saved: ${new Date(trip.created_at).toLocaleDateString()}</small>
                </div>
            `).join('');

            modal.innerHTML = `
                <div style="background:#1a1a1a;padding:30px;border-radius:12px;max-width:500px;width:90%;max-height:70vh;overflow-y:auto;">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
                        <h3 style="margin:0;color:#fff;">üß≥ My Saved Trips</h3>
                        <button onclick="this.closest('#saved-trips-modal').remove()" style="background:none;border:none;color:#fff;font-size:24px;cursor:pointer;">&times;</button>
                    </div>
                    ${tripsHTML}
                </div>
            `;

            document.body.appendChild(modal);
            modal.onclick = (e) => { if (e.target === modal) modal.remove(); };
        }

        function createAnimatedTitleCard(destination) {
            // Create particles HTML
            let particlesHTML = '';
            for (let i = 0; i < 20; i++) {
                const left = Math.random() * 100;
                const delay = Math.random() * 10;
                const duration = 8 + Math.random() * 4;
                particlesHTML += `<div class="particle" style="left: ${left}%; animation-delay: ${delay}s; animation-duration: ${duration}s;"></div>`;
            }

            return `
                <div class="destination-title-card">
                    <div class="destination-particles">${particlesHTML}</div>
                    <div class="destination-title-overlay"></div>
                    <div class="destination-title-content">
                        <h1>${destination}</h1>
                        <div class="subtitle">Your AI-Powered Journey Awaits</div>
                    </div>
                </div>
            `;
        }

        function attachItineraryEventListeners() {
            // Re-attach tier tab listeners
            document.querySelectorAll('.trip-tier-tab').forEach(tab => {
                tab.addEventListener('click', function () {
                    const tier = this.getAttribute('data-tier');
                    if (tier && window.tierItineraries[tier]) {
                        switchTier(tier);
                        // Refresh full-page view
                        setTimeout(() => openFullPageItinerary(), 100);
                    }
                });
            });

            // Re-attach day tab listeners
            document.querySelectorAll('.trip-day-tab').forEach(tab => {
                tab.addEventListener('click', function () {
                    document.querySelectorAll('.trip-day-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    const day = parseInt(this.getAttribute('data-day'));
                    filterMapByDay(day);
                });
            });

            // Re-attach map filter listeners
            document.querySelectorAll('.trip-map-filter').forEach(filter => {
                filter.addEventListener('click', function () {
                    document.querySelectorAll('.trip-map-filter').forEach(f => f.classList.remove('active'));
                    this.classList.add('active');
                    const filterType = this.getAttribute('data-filter');
                    filterMapMarkers(filterType);
                });
            });
        }

        function downloadItineraryPDF() {
            const element = document.getElementById('itinerary-fullpage-content');
            if (!element) {
                showToast('No itinerary to download', 'warning');
                return;
            }

            const destination = window.currentDestination || 'itinerary';
            const filename = `${destination.replace(/\s+/g, '_')}_itinerary.pdf`;

            const opt = {
                margin: 10,
                filename: filename,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };

            html2pdf().set(opt).from(element).save();
            showToast('Downloading PDF...', 'success');
        }

        function shareItinerary() {
            const destination = window.currentDestination || 'destination';
            const shareText = `Check out my ${destination} itinerary created with VOYA AI Travel Planner!`;

            if (navigator.share) {
                navigator.share({
                    title: `${destination} Itinerary`,
                    text: shareText,
                    url: window.location.href
                }).catch(err => console.log('Share cancelled'));
            } else {
                // Fallback: copy to clipboard
                navigator.clipboard.writeText(shareText + '\n' + window.location.href)
                    .then(() => showToast('Link copied to clipboard!', 'success'))
                    .catch(() => showToast('Could not copy link', 'warning'));
            }
        }

        // ==================== FLIGHTS FULL-PAGE VIEW FUNCTIONS ====================

        function openFullPageFlights(from, to) {
            const fullPageDiv = document.getElementById('flights-fullpage');
            const contentDiv = document.getElementById('flights-fullpage-content');
            const navTitle = document.getElementById('flights-nav-title');
            const resultsDiv = document.getElementById('flight-results');

            if (!fullPageDiv || !contentDiv) return;

            // Set navigation title
            const route = from && to ? `${from} ‚Üí ${to}` : 'Flight Results';
            navTitle.textContent = route;

            // Show skeleton loaders first
            contentDiv.innerHTML = createFlightSkeletons();

            // Show full-page view
            fullPageDiv.classList.add('active');
            document.body.style.overflow = 'hidden';

            // After a short delay, load actual content with fade-in
            setTimeout(() => {
                const flightContent = resultsDiv.innerHTML;

                // Create compact search bar (Trip.com style)
                const compactSearchBar = `
                    <div class="compact-search-bar">
                        <div class="search-summary">
                            <div class="search-detail">
                                <i class="fas fa-plane-departure" style="color: #003580;"></i>
                                <span><strong>${from || 'Origin'}</strong></span>
                            </div>
                            <i class="fas fa-arrow-right" style="color: #999;"></i>
                            <div class="search-detail">
                                <i class="fas fa-plane-arrival" style="color: #003580;"></i>
                                <span><strong>${to || 'Destination'}</strong></span>
                            </div>
                        </div>
                        <button class="modify-search-btn" onclick="closeFullPageFlights()">
                            <i class="fas fa-edit"></i> Modify Search
                        </button>
                    </div>
                `;

                // Insert into full-page view with compact search bar
                contentDiv.innerHTML = `
                    ${compactSearchBar}
                    <div style="max-width: 1200px; margin: 0 auto; padding: 20px;" class="fade-in">
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 16px; padding: 40px; text-align: center; margin-bottom: 30px; color: white;">
                            <h1 style="font-size: 2.5rem; margin: 0 0 10px 0;">‚úàÔ∏è ${route}</h1>
                            <p style="font-size: 1.1rem; opacity: 0.9; margin: 0;">Browse and compare flight options</p>
                        </div>
                        <div class="results-loaded">${flightContent}</div>
                    </div>
                `;
            }, 800);
        }

        function createFlightSkeletons() {
            let skeletons = '<div class="skeleton-container">';
            for (let i = 0; i < 5; i++) {
                skeletons += `
                    <div class="skeleton-card">
                        <div class="skeleton-flight-card">
                            <div style="flex: 1;">
                                <div class="skeleton-line medium"></div>
                                <div class="skeleton-line short"></div>
                                <div class="skeleton-line long"></div>
                            </div>
                            <div class="skeleton-line short" style="width: 100px;"></div>
                        </div>
                    </div>
                `;
            }
            skeletons += '</div>';
            return skeletons;
        }

        function closeFullPageFlights() {
            const fullPageDiv = document.getElementById('flights-fullpage');
            if (fullPageDiv) {
                fullPageDiv.classList.remove('active');
                document.body.style.overflow = '';
            }
        }

        // ==================== HOTELS FULL-PAGE VIEW FUNCTIONS ====================

        function openFullPageHotels(destination) {
            const fullPageDiv = document.getElementById('hotels-fullpage');
            const contentDiv = document.getElementById('hotels-fullpage-content');
            const navTitle = document.getElementById('hotels-nav-title');
            const resultsDiv = document.getElementById('hotel-results');

            if (!fullPageDiv || !contentDiv) return;

            // Set navigation title
            const title = destination ? `Hotels in ${destination}` : 'Hotel Results';
            navTitle.textContent = title;

            // Show skeleton loaders first
            contentDiv.innerHTML = createHotelSkeletons();

            // Show full-page view
            fullPageDiv.classList.add('active');
            document.body.style.overflow = 'hidden';

            // After a short delay, load actual content with fade-in
            setTimeout(() => {
                const hotelContent = resultsDiv.innerHTML;

                // Create compact search bar (Trip.com style)
                const compactSearchBar = `
                    <div class="compact-search-bar">
                        <div class="search-summary">
                            <div class="search-detail">
                                <i class="fas fa-map-marker-alt" style="color: #003580;"></i>
                                <span><strong>${destination || 'Destination'}</strong></span>
                            </div>
                        </div>
                        <button class="modify-search-btn" onclick="closeFullPageHotels()">
                            <i class="fas fa-edit"></i> Modify Search
                        </button>
                    </div>
                `;

                // Insert into full-page view with compact search bar
                contentDiv.innerHTML = `
                    ${compactSearchBar}
                    <div style="max-width: 1200px; margin: 0 auto; padding: 20px;" class="fade-in">
                        <div style="background: linear-gradient(135deg, #f953c6 0%, #b91d73 100%); border-radius: 16px; padding: 40px; text-align: center; margin-bottom: 30px; color: white;">
                            <h1 style="font-size: 2.5rem; margin: 0 0 10px 0;">üè® ${title}</h1>
                            <p style="font-size: 1.1rem; opacity: 0.9; margin: 0;">Find your perfect accommodation</p>
                        </div>
                        <div class="results-loaded">${hotelContent}</div>
                    </div>
                `;
            }, 800);
        }

        function createHotelSkeletons() {
            let skeletons = '<div class="skeleton-container">';
            for (let i = 0; i < 5; i++) {
                skeletons += `
                    <div class="skeleton-card">
                        <div class="skeleton-hotel-card">
                            <div class="skeleton-image"></div>
                            <div style="flex: 1;">
                                <div class="skeleton-line medium"></div>
                                <div class="skeleton-line short"></div>
                                <div class="skeleton-line long"></div>
                                <div class="skeleton-line short"></div>
                            </div>
                        </div>
                    </div>
                `;
            }
            skeletons += '</div>';
            return skeletons;
        }

        function closeFullPageHotels() {
            const fullPageDiv = document.getElementById('hotels-fullpage');
            if (fullPageDiv) {
                fullPageDiv.classList.remove('active');
                document.body.style.overflow = '';
            }
        }

        // ==================== MAP STABILIZATION IMPROVEMENTS ====================

        // Cache for geocoded coordinates to prevent re-geocoding
        const geocodeCache = {};

        function getCachedCoordinates(locationKey) {
            return geocodeCache[locationKey] || null;
        }

        function setCachedCoordinates(locationKey, coords) {
            geocodeCache[locationKey] = coords;
        }

        // Geocode destination using Mapbox API (replaces old hardcoded coordinate lookup)
        async function getDestinationCoordinates(destination) {
            // Check cache first
            const destLower = destination.toLowerCase();
            const cached = getCachedCoordinates(destLower);
            if (cached) return cached;

            // Use Mapbox geocoding API
            try {
                const token = mapboxgl.accessToken || 'pk.eyJ1Ijoidm95YTIzMiIsImEiOiJjbWw2amN0a2wwZHAyM2ZyMHR3bWthamt2In0.weBsgObWVo4j33JNKpSTCA';
                const response = await fetch(
                    `https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(destination)}.json?access_token=${token}&limit=1`
                );
                if (response.ok) {
                    const data = await response.json();
                    if (data.features && data.features.length > 0) {
                        const [lng, lat] = data.features[0].center;
                        const coords = [lat, lng]; // Return as [lat, lng] for this function's callers
                        setCachedCoordinates(destLower, coords);
                        console.log(`‚úÖ Geocoded destination "${destination}" -> [${lat}, ${lng}]`);
                        return coords;
                    }
                }
            } catch (err) {
                console.warn(`Geocoding failed for destination "${destination}":`, err);
            }

            // Fallback: New Delhi
            console.warn(`Using fallback coords for "${destination}"`);
            return [28.6139, 77.2090];
        }

        // Global storage for categorized markers
        let categorizedMarkers = {
            attractions: [],
            hotels: [],
            food: []
        };
        let routePolylines = [];

        // Day-specific storage for filtering
        let dayMarkers = {};  // { 1: [marker, marker], 2: [marker], ... }
        let dayPolylines = {}; // { 1: [polyline], 2: [polyline], ... }
        let currentActiveDay = 0; // 0 = overview (all days)

        // Batch geocode all activities using backend API
        async function batchGeocodeActivities(parsedData, destination) {
            // Collect all activity descriptions
            const activities = [];
            for (const dayData of parsedData) {
                for (const activity of dayData.activities) {
                    activities.push({
                        description: activity.description,
                        day: dayData.day,
                        time: activity.time
                    });
                }
            }

            if (activities.length === 0) {
                return [];
            }

            try {
                // Call backend geocoding API
                const response = await fetch(`${API_BASE_URL}/api/geocode`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        activities: activities.map(a => a.description),
                        destination: destination
                    })
                });

                if (!response.ok) {
                    throw new Error(`Geocoding failed: ${response.status}`);
                }

                const data = await response.json();

                if (data.success && data.results) {
                    // Map results back to activities with day info
                    return activities.map((activity, index) => ({
                        ...activity,
                        geocode: data.results[index]
                    }));
                }

                throw new Error('Invalid geocoding response');
            } catch (err) {
                console.error('Batch geocoding error:', err);
                showToast('‚ö†Ô∏è Could not geocode some locations', 'warning');
                // Return activities with null geocodes
                return activities.map(activity => ({
                    ...activity,
                    geocode: { lat: null, lng: null, success: false }
                }));
            }
        }

        // Map generation counter to prevent race conditions
        let mapGenerationId = 0;

        // Initialize Mapbox map with progressive marker loading
        async function initializeItineraryMap(destination, parsedData) {
            // Increment generation ID
            mapGenerationId++;
            const currentGenerationId = mapGenerationId;

            // mapbox token
            mapboxgl.accessToken = 'pk.eyJ1Ijoidm95YTIzMiIsImEiOiJjbWwwZG85c2owOTQzM2VxczUxNHhwMXhsIn0.VimrSd-UaXdO4jAI6ShvyQ';

            // Default coordinates (will be geocoded based on destination)
            let defaultCoords = await getDestinationCoordinates(destination);
            // Fallback if geocoding fails (New Delhi)
            if (!defaultCoords) defaultCoords = [28.6139, 77.2090];
            // Swap for Mapbox (Lng, Lat)
            const mapboxCenter = [defaultCoords[1], defaultCoords[0]];

            // Create map IMMEDIATELY
            const mapContainer = document.getElementById('itinerary-map');
            if (window.itineraryMap) {
                window.itineraryMap.remove();
                window.itineraryMap = null;
            }

            window.itineraryMap = new mapboxgl.Map({
                container: 'itinerary-map',
                style: 'mapbox://styles/mapbox/streets-v12',
                center: mapboxCenter,
                zoom: 12,
                pitch: 45, // Add some 3D pitch for better view
                bearing: -17.6
            });

            // Add navigation controls
            window.itineraryMap.addControl(new mapboxgl.NavigationControl(), 'top-right');

            // Clear existing markers
            mapMarkers = [];
            categorizedMarkers = { attractions: [], hotels: [], food: [] };
            routePolylines = []; // Will store layer IDs for Mapbox
            dayMarkers = {};
            dayPolylines = {};
            currentActiveDay = 0;

            // Count total activities for progress
            const totalActivities = parsedData.reduce((sum, day) => sum + day.activities.length, 0);

            // Show initial loading message
            showToast(`üó∫Ô∏è Map ready! Loading ${totalActivities} locations...`, 'info');

            // Start geocoding and routing in background
            window.itineraryMap.on('load', () => {
                geocodeAndLoadMarkersProgressively(destination, parsedData, defaultCoords, totalActivities, currentGenerationId);

                // Add 3D buildings layer
                const layers = window.itineraryMap.getStyle().layers;
                const labelLayerId = layers.find(
                    (layer) => layer.type === 'symbol' && layer.layout['text-field']
                ).id;

                window.itineraryMap.addLayer(
                    {
                        'id': 'add-3d-buildings',
                        'source': 'composite',
                        'source-layer': 'building',
                        'filter': ['==', 'extrude', 'true'],
                        'type': 'fill-extrusion',
                        'minzoom': 15,
                        'paint': {
                            'fill-extrusion-color': '#aaa',
                            'fill-extrusion-height': [
                                'interpolate',
                                ['linear'],
                                ['zoom'],
                                15,
                                0,
                                15.05,
                                ['get', 'height']
                            ],
                            'fill-extrusion-base': [
                                'interpolate',
                                ['linear'],
                                ['zoom'],
                                15,
                                0,
                                15.05,
                                ['get', 'min_height']
                            ],
                            'fill-extrusion-opacity': 0.6
                        }
                    },
                    labelLayerId
                );
            });
        }

        // Progressive marker loading with Mapbox Geocoding and Directions
        async function geocodeAndLoadMarkersProgressively(destination, parsedData, defaultCoords, totalActivities, generationId) {
            const dayRoutes = {}; // Stores coordinates for each day
            let markerNum = 1;

            // Loop through days and activities
            for (const dayData of parsedData) {
                const dayCoords = []; // Store coordinates specifically for this day's route

                for (const activity of dayData.activities) {
                    if (mapGenerationId !== generationId) return;

                    // Geocode the location using Mapbox API
                    const query = `${activity.description}, ${destination}`;
                    let coords = null;

                    try {
                        const response = await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(query)}.json?access_token=${mapboxgl.accessToken}&limit=1`);
                        const data = await response.json();
                        if (data.features && data.features.length > 0) {
                            coords = data.features[0].center; // [lng, lat]
                        }
                    } catch (e) {
                        console.warn('Geocoding failed for', query);
                    }

                    // Fallback to random offset if geocoding fails
                    if (!coords) {
                        const offset = () => (Math.random() - 0.5) * 0.04;
                        coords = [defaultCoords[1] + offset(), defaultCoords[0] + offset()];
                    }

                    // Create custom marker element
                    const el = document.createElement('div');
                    el.className = 'trip-marker';
                    el.innerText = markerNum;
                    el.style.backgroundColor = '#003580';
                    el.style.color = 'white';
                    el.style.width = '30px';
                    el.style.height = '30px';
                    el.style.borderRadius = '50%';
                    el.style.display = 'flex';
                    el.style.alignItems = 'center';
                    el.style.justifyContent = 'center';
                    el.style.fontWeight = 'bold';
                    el.style.border = '2px solid white';
                    el.style.boxShadow = '0 2px 5px rgba(0,0,0,0.3)';
                    el.style.cursor = 'pointer';

                    // Create popup
                    const popup = new mapboxgl.Popup({ offset: 25 }).setHTML(`
                        <div class="map-popup-title" style="font-weight:bold;margin-bottom:5px;">${activity.description.split('.')[0]}</div>
                        <div class="map-popup-meta" style="font-size:0.85em;color:#666;">Day ${dayData.day} ¬∑ ${activity.time || 'Flexible'}</div>
                    `);

                    // Add marker to map
                    const marker = new mapboxgl.Marker(el)
                        .setLngLat(coords)
                        .setPopup(popup)
                        .addTo(window.itineraryMap);

                    // Store marker data
                    const markerData = {
                        marker,
                        activityNum: markerNum,
                        day: dayData.day,
                        category: 'attractions',
                        activity: activity,
                        lng: coords[0],
                        lat: coords[1]
                    };

                    mapMarkers.push(markerData);
                    categorizedMarkers.attractions.push(marker);

                    if (!dayMarkers[dayData.day]) dayMarkers[dayData.day] = [];
                    dayMarkers[dayData.day].push(marker);

                    dayCoords.push(coords); // Add to this day's route points
                    markerNum++;

                    // Small delay to prevent rate limiting and show animation
                    await new Promise(r => setTimeout(r, 100));
                }

                // If we have at least 2 points, fetch and draw route for the day
                if (dayCoords.length >= 2) {
                    await drawDayRoute(dayData.day, dayCoords, generationId);
                }
            }
        }

        // Helper to fetch and draw driving/walking route for a specific day
        async function drawDayRoute(day, coords, generationId) {
            if (mapGenerationId !== generationId) return;

            // Construct coordinate string for API: lng1,lat1;lng2,lat2;...
            const coordString = coords.map(c => c.join(',')).join(';');

            try {
                // Request driving route (can switch to 'walking' if preferred)
                const response = await fetch(`https://api.mapbox.com/directions/v5/mapbox/driving/${coordString}?geometries=geojson&access_token=${mapboxgl.accessToken}`);
                const data = await response.json();

                if (data.routes && data.routes.length > 0) {
                    const route = data.routes[0].geometry;
                    const dayColors = ['#0060FF', '#f953c6', '#00b894', '#fdcb6e', '#e17055', '#6c5ce7'];
                    const color = dayColors[(day - 1) % dayColors.length];
                    const layerId = `route-day-${day}`;

                    // Add route source and layer
                    if (window.itineraryMap.getSource(layerId)) {
                        window.itineraryMap.getSource(layerId).setData(route);
                    } else {
                        window.itineraryMap.addSource(layerId, {
                            'type': 'geojson',
                            'data': {
                                'type': 'Feature',
                                'properties': {},
                                'geometry': route
                            }
                        });

                        window.itineraryMap.addLayer({
                            'id': layerId,
                            'type': 'line',
                            'source': layerId,
                            'layout': {
                                'line-join': 'round',
                                'line-cap': 'round'
                            },
                            'paint': {
                                'line-color': color,
                                'line-width': 5,
                                'line-opacity': 0.8
                            }
                        });

                        // Add arrows or dashed line effect if needed
                        // For now just solid colored lines
                    }

                    if (!dayPolylines[day]) dayPolylines[day] = [];
                    dayPolylines[day].push(layerId);
                    routePolylines.push(layerId);
                }
            } catch (e) {
                console.warn(`Failed to fetch route for Day ${day}:`, e);
            }
        }

        // Filter map markers by category
        function filterMapMarkers(category) {
            if (!window.itineraryMap) return;

            // Hide all markers first
            Object.keys(categorizedMarkers).forEach(cat => {
                categorizedMarkers[cat].forEach(marker => {
                    if (marker.remove) marker.remove();
                });
            });

            // Handle "overall" filter - show all markers and routes
            if (category === 'overall') {
                Object.keys(categorizedMarkers).forEach(cat => {
                    categorizedMarkers[cat].forEach(marker => {
                        if (marker.addTo) marker.addTo(window.itineraryMap);
                    });
                });

                // Show all routes
                routePolylines.forEach(layerId => {
                    if (window.itineraryMap.getLayer && window.itineraryMap.getLayer(layerId)) {
                        window.itineraryMap.setLayoutProperty(layerId, 'visibility', 'visible');
                    }
                });

                // Fit bounds to all markers
                if (mapMarkers.length > 0) {
                    const bounds = new mapboxgl.LngLatBounds();
                    mapMarkers.forEach(m => {
                        if (m.marker && m.marker.getLngLat) {
                            bounds.extend(m.marker.getLngLat());
                        }
                    });
                    window.itineraryMap.fitBounds(bounds, { padding: 50 });
                }

                showToast('üó∫Ô∏è Showing complete overview', 'info');
                return;
            }

            // Show/hide route polylines
            routePolylines.forEach(layerId => {
                if (window.itineraryMap.getLayer && window.itineraryMap.getLayer(layerId)) {
                    window.itineraryMap.setLayoutProperty(layerId, 'visibility',
                        category === 'attractions' ? 'visible' : 'none');
                }
            });

            // Show markers for selected category
            if (categorizedMarkers[category]) {
                categorizedMarkers[category].forEach(marker => {
                    if (marker.addTo) marker.addTo(window.itineraryMap);
                });
            }

            showToast(`Showing ${category === 'attractions' ? 'üé≠ Attractions' : category === 'hotels' ? 'üè® Hotels' : 'üçΩÔ∏è Restaurants'}`, 'info');
        }

        // Focus map on a specific activity when its card is clicked
        function focusMapOnActivity(activityNum) {
            if (!window.itineraryMap) return;

            // Find the marker for this activity
            const markerData = mapMarkers.find(m => m.activityNum === activityNum);
            if (markerData && markerData.marker) {
                // Center map on this marker
                const lngLat = markerData.marker.getLngLat();
                window.itineraryMap.flyTo({
                    center: lngLat,
                    zoom: 15,
                    speed: 1.5
                });

                // Open the popup
                markerData.marker.togglePopup();

                // Highlight the marker briefly
                const markerEl = markerData.marker.getElement();
                if (markerEl) {
                    markerEl.style.transform = 'scale(1.3)';
                    markerEl.style.transition = 'transform 0.3s ease';
                    setTimeout(() => {
                        markerEl.style.transform = 'scale(1)';
                    }, 500);
                }
                showToast(`üìç Showing activity ${activityNum} on map`, 'info');
            }
        }

        // Filter activities and map by day
        function filterActivitiesByDay(dayNum) {
            currentActiveDay = dayNum;

            // Filter day section containers in DOM
            const daySections = document.querySelectorAll('.trip-day-section');
            daySections.forEach(section => {
                if (dayNum === 0) {
                    section.style.display = 'block';
                } else {
                    section.style.display = (parseInt(section.dataset.day) === dayNum) ? 'block' : 'none';
                }
            });

            // Filter activity cards in DOM
            const activityCards = document.querySelectorAll('.trip-activity-card');
            activityCards.forEach(card => {
                const cardDay = parseInt(card.dataset.day);
                if (dayNum === 0) {
                    card.style.display = 'flex';
                } else {
                    card.style.display = (cardDay === dayNum) ? 'flex' : 'none';
                }
            });

            // Filter map markers and routes
            if (!window.itineraryMap) return;

            // First, hide all markers
            mapMarkers.forEach(m => {
                if (m.marker && m.marker.remove) m.marker.remove();
            });

            // Hide all routes
            routePolylines.forEach(layerId => {
                if (window.itineraryMap.getLayer && window.itineraryMap.getLayer(layerId)) {
                    window.itineraryMap.setLayoutProperty(layerId, 'visibility', 'none');
                }
            });

            if (dayNum === 0) {
                // Overview - show all
                mapMarkers.forEach(m => {
                    if (m.marker && m.marker.addTo) m.marker.addTo(window.itineraryMap);
                });
                routePolylines.forEach(layerId => {
                    if (window.itineraryMap.getLayer && window.itineraryMap.getLayer(layerId)) {
                        window.itineraryMap.setLayoutProperty(layerId, 'visibility', 'visible');
                    }
                });

                // Fit to all markers
                if (mapMarkers.length > 0) {
                    const bounds = new mapboxgl.LngLatBounds();
                    mapMarkers.forEach(m => {
                        if (m.marker && m.marker.getLngLat) bounds.extend(m.marker.getLngLat());
                    });
                    window.itineraryMap.fitBounds(bounds, { padding: 50 });
                }
            } else {
                // Specific day - show only that day's markers
                if (dayMarkers[dayNum]) {
                    dayMarkers[dayNum].forEach(marker => {
                        if (marker.addTo) marker.addTo(window.itineraryMap);
                    });

                    // Fit to day's markers
                    const bounds = new mapboxgl.LngLatBounds();
                    dayMarkers[dayNum].forEach(m => {
                        if (m.getLngLat) bounds.extend(m.getLngLat());
                    });
                    if (!bounds.isEmpty()) {
                        window.itineraryMap.fitBounds(bounds, { padding: 50 });
                    }
                }

                // Show this day's routes
                if (dayPolylines[dayNum]) {
                    dayPolylines[dayNum].forEach(layerId => {
                        if (window.itineraryMap.getLayer && window.itineraryMap.getLayer(layerId)) {
                            window.itineraryMap.setLayoutProperty(layerId, 'visibility', 'visible');
                        }
                    });
                }
            }

            showToast(dayNum === 0 ? 'üìã Showing complete itinerary' : `üìÖ Day ${dayNum} route`, 'info');
        }

        // SECURITY: API keys are now stored in backend only
        // Frontend geocoding uses backend /api/geocode/single endpoint

        // Uses shared geocodeCache defined in Map Stabilization section

        // Get coordinates for any destination using backend geocoding API (secure)
        async function getDestinationCoordinates(destination, proximity = null) {
            // Check cache first
            const cacheKey = destination.toLowerCase().trim() + (proximity ? `_${proximity.join(',')}` : '');
            if (geocodeCache[cacheKey]) {
                return geocodeCache[cacheKey];
            }

            try {
                // Use backend API for geocoding (keeps API keys secure)
                const response = await fetch(`${API_BASE_URL}/api/geocode/single`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        location: destination,
                        destination: proximity ? null : destination
                    })
                });

                const data = await response.json();

                if (data.success && data.lat && data.lng) {
                    const coords = [data.lat, data.lng];
                    geocodeCache[cacheKey] = coords;
                    console.log(`üìç Geocoded ${destination} to [${data.lat}, ${data.lng}]`);
                    return coords;
                }
            } catch (error) {
                console.error('Geocoding error:', error);
            }

            // Fallback to Delhi, India if geocoding fails
            console.warn(`‚ö†Ô∏è Could not geocode ${destination}, using fallback`);
            return [28.6139, 77.2090];
        }


        // Parse itinerary content to extract structured data
        function parseItineraryContent(content) {
            const days = [];
            const lines = content.split('\n');
            let currentDay = null;
            let currentActivities = [];

            for (const line of lines) {
                const trimmed = line.trim();
                if (!trimmed) continue;

                // Check for day headings
                const dayMatch = trimmed.match(/^#{1,4}\s*\*{0,2}\s*Day\s*(\d+)[:\s-]*(.*?)\*{0,2}\s*$/i) ||
                    trimmed.match(/^\*{0,2}\s*Day\s*(\d+)[:\s-]*(.*?)\*{0,2}\s*$/i);

                if (dayMatch) {
                    if (currentDay !== null) {
                        days.push({ day: currentDay.day, title: currentDay.title, activities: currentActivities });
                    }
                    currentDay = { day: parseInt(dayMatch[1]), title: dayMatch[2] || '' };
                    currentActivities = [];
                    continue;
                }

                // Check for activities (list items or time-based entries)
                if (currentDay !== null && /^[\*\-]\s+/.test(trimmed)) {
                    const activityText = trimmed.replace(/^[\*\-]\s+/, '').replace(/\*\*/g, '');
                    const timeMatch = activityText.match(/^(Morning|Afternoon|Evening|Night|[\d:]+\s*(AM|PM)?)[:\s]*/i);
                    const time = timeMatch ? timeMatch[1] : '';
                    const description = timeMatch ? activityText.replace(timeMatch[0], '') : activityText;

                    currentActivities.push({
                        time: time,
                        description: description,
                        rating: (7.5 + Math.random() * 2).toFixed(1) // Random rating 7.5-9.5
                    });
                }
            }

            // Push last day
            if (currentDay !== null) {
                days.push({ day: currentDay.day, title: currentDay.title, activities: currentActivities });
            }

            return days;
        }

        // Generate Trip.com-style activity cards
        function generateTripActivities(parsedData, totalDays) {
            let html = '';
            let activityNum = 1;
            const icons = ['üèõÔ∏è', 'üé®', 'üçΩÔ∏è', 'üö∂', 'üå≥', 'üé≠', 'üõçÔ∏è', 'üåÖ', '‚òï', 'üè∞'];

            for (const dayData of parsedData) {
                html += `<div class="trip-day-section" data-day="${dayData.day}">`;
                html += `<h3 style="font-size:1rem; color:#1a1a2e; margin:20px 0 10px; font-weight:700;">Day ${dayData.day}: ${dayData.title || 'Exploration'}</h3>`;

                for (let i = 0; i < dayData.activities.length; i++) {
                    const activity = dayData.activities[i];
                    const icon = icons[activityNum % icons.length];
                    const showBestBadge = Math.random() > 0.6;

                    html += `
                        <div class="trip-activity-card" data-activity-num="${activityNum}" data-day="${dayData.day}" onclick="focusMapOnActivity(${activityNum})">
                            <div class="trip-activity-number">${activityNum}</div>
                            <div class="trip-activity-image">
                                <div class="trip-activity-placeholder">${icon}</div>
                            </div>
                            <div class="trip-activity-content">
                                <div class="trip-activity-header">
                                    <h4 class="trip-activity-title">${activity.description.split('.')[0] || activity.description}</h4>
                                    ${showBestBadge ? '<span class="trip-best-badge">üî• Trip.Best</span>' : ''}
                                    <span class="trip-rating">‚≠ê ${activity.rating}</span>
                                </div>
                                <div class="trip-activity-meta">
                                    ${activity.time ? `<span>üïê ${activity.time}</span>` : '<span>üïê Flexible</span>'}
                                    <span>‚è±Ô∏è Suggested: 1-2 hours</span>
                                </div>
                                <p class="trip-activity-description">${activity.description}</p>
                            </div>
                        </div>
                    `;

                    // Add transportation connector between activities (not after last one)
                    if (i < dayData.activities.length - 1) {
                        const walkTime = Math.floor(5 + Math.random() * 15);
                        html += `
                            <div class="trip-transport">
                                <div class="trip-transport-icon">üö∂</div>
                                <span class="trip-transport-text">${walkTime} minutes ¬∑ ${(walkTime * 80)}m</span>
                            </div>
                        `;
                    }

                    activityNum++;
                }

                html += '</div>';
            }

            // If no parsed data, show placeholder
            if (parsedData.length === 0) {
                html = `
                    <div class="trip-empty-day">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                        </svg>
                        <p>Your itinerary is being generated...</p>
                    </div>
                `;
            }

            return html;
        }

        // filterActivitiesByDay is defined earlier and handles both DOM filtering and map markers

        function printItinerary() {
            const content = document.querySelector('.itinerary-container');
            if (content) {
                const printWindow = window.open('', '_blank');
                printWindow.document.write(`
                    <html>
                    <head>
                        <title>VOYA AI - Travel Itinerary</title>
                        <style>
                            body { font-family: 'Segoe UI', sans-serif; padding: 20px; }
                            h1 { color: #003580; }
                            h2 { color: #1a73e8; margin-top: 20px; }
                            ul { margin: 10px 0; }
                            li { margin: 5px 0; }
                            .itinerary-actions { display: none; }
                        </style>
                    </head>
                    <body>${content.innerHTML}</body>
                    </html>
                `);
                printWindow.document.close();
                printWindow.print();
            }
        }

        function copyItinerary() {
            const container = document.querySelector('.itinerary-container');
            if (container) {
                const text = container.innerText;
                navigator.clipboard.writeText(text).then(() => {
                    alert('‚úÖ Itinerary copied to clipboard!');
                }).catch(err => {
                    alert('‚ùå Failed to copy: ' + err.message);
                });
            }
        }

        function downloadItinerary() {
            const container = document.querySelector('.itinerary-container');
            if (!container) {
                alert('No itinerary to download. Please generate one first.');
                return;
            }

            // Show loading state
            showToast('Generating PDF...', 'info');

            // Get destination for filename and header
            const destination = document.getElementById('ai-dest').value.trim() || 'Travel';
            const duration = document.getElementById('ai-days').value.trim() || '';
            const filename = `VOYA-${destination.replace(/[^a-zA-Z0-9]/g, '-')}-Itinerary.pdf`;

            // Create a complete standalone HTML document for PDF generation
            const pdfContent = document.createElement('div');
            pdfContent.id = 'pdf-export-container';

            // Build clean HTML content with all styles inline
            let cleanHTML = `
                <div style="font-family: Arial, sans-serif; padding: 25px; background: #ffffff; color: #333333; min-height: 100%;">
                    <div style="text-align: center; margin-bottom: 25px; padding-bottom: 15px; border-bottom: 3px solid #003580;">
                        <h1 style="color: #003580; font-size: 24px; margin: 0 0 8px 0; font-weight: bold;">VOYA AI Travel Itinerary</h1>
                        <p style="color: #666; font-size: 14px; margin: 0;">Your personalized travel plan for ${destination}${duration ? ' ‚Ä¢ ' + duration : ''}</p>
                    </div>
            `;

            // Clone the container content and process it
            const contentClone = container.cloneNode(true);

            // Remove action buttons from the clone
            const actions = contentClone.querySelector('.itinerary-actions');
            if (actions) actions.remove();

            // Remove the header from clone (we're adding our own)
            const headerClone = contentClone.querySelector('.itinerary-header');
            if (headerClone) headerClone.remove();

            // Process day cards
            const dayCards = contentClone.querySelectorAll('.day-card');
            dayCards.forEach((card, index) => {
                // Extract the day title
                const h2 = card.querySelector('h2');
                const dayTitle = h2 ? h2.textContent.replace('üìÖ', '').trim() : `Day ${index + 1}`;

                // Get all content except the h2
                let cardContent = '';
                Array.from(card.children).forEach(child => {
                    if (child.tagName !== 'H2') {
                        cardContent += child.outerHTML;
                    }
                });

                cleanHTML += `
                    <div style="background: #f8f9fa; border-left: 4px solid #003580; padding: 15px 20px; margin: 15px 0; border-radius: 6px; page-break-inside: avoid;">
                        <h2 style="color: #003580; font-size: 16px; margin: 0 0 12px 0; font-weight: bold; border-bottom: 1px solid #ddd; padding-bottom: 8px;">üìÖ ${dayTitle}</h2>
                        ${cardContent}
                    </div>
                `;
            });

            // If no day cards found, just use the raw content
            if (dayCards.length === 0) {
                cleanHTML += contentClone.innerHTML;
            }

            cleanHTML += '</div>';
            pdfContent.innerHTML = cleanHTML;

            // Apply inline styles to all elements for PDF compatibility
            pdfContent.querySelectorAll('h3').forEach(h => {
                h.style.cssText = 'color: #1a73e8; font-size: 14px; margin: 12px 0 8px 0; font-weight: bold;';
            });
            pdfContent.querySelectorAll('h4').forEach(h => {
                h.style.cssText = 'color: #333; font-size: 13px; margin: 10px 0 6px 0; font-weight: bold;';
            });
            pdfContent.querySelectorAll('ul').forEach(ul => {
                ul.style.cssText = 'margin: 8px 0; padding-left: 25px; list-style-type: disc;';
            });
            pdfContent.querySelectorAll('li').forEach(li => {
                li.style.cssText = 'margin: 4px 0; color: #444; line-height: 1.5; font-size: 12px; background: none; border: none; padding: 2px 0;';
            });
            pdfContent.querySelectorAll('p').forEach(p => {
                p.style.cssText = 'margin: 6px 0; color: #555; line-height: 1.5; font-size: 12px;';
            });
            pdfContent.querySelectorAll('.tip-card').forEach(tip => {
                tip.style.cssText = 'background: #fff3cd; border-left: 4px solid #ffc107; padding: 10px 15px; margin: 10px 0; border-radius: 4px; font-size: 12px;';
            });
            pdfContent.querySelectorAll('table').forEach(table => {
                table.style.cssText = 'width: 100%; border-collapse: collapse; margin: 12px 0; font-size: 11px;';
            });
            pdfContent.querySelectorAll('th').forEach(th => {
                th.style.cssText = 'border: 1px solid #ddd; padding: 8px; text-align: left; background: #003580; color: white; font-weight: bold;';
            });
            pdfContent.querySelectorAll('td').forEach(td => {
                td.style.cssText = 'border: 1px solid #ddd; padding: 8px; text-align: left;';
            });
            pdfContent.querySelectorAll('strong').forEach(s => {
                s.style.cssText = 'color: #003580; font-weight: bold;';
            });
            pdfContent.querySelectorAll('em').forEach(e => {
                e.style.cssText = 'color: #1a73e8; font-style: italic;';
            });

            // Position the content visibly but off-screen (visibility approach for better rendering)
            pdfContent.style.cssText = 'position: fixed; top: 0; left: 0; width: 210mm; background: white; z-index: -9999; visibility: visible;';
            document.body.appendChild(pdfContent);

            // PDF options with better settings for capturing
            const opt = {
                margin: [15, 15, 15, 15],
                filename: filename,
                image: { type: 'jpeg', quality: 0.95 },
                html2canvas: {
                    scale: 2,
                    useCORS: true,
                    logging: false,
                    backgroundColor: '#ffffff',
                    windowWidth: pdfContent.scrollWidth,
                    windowHeight: pdfContent.scrollHeight,
                    x: 0,
                    y: 0
                },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' },
                pagebreak: { mode: ['avoid-all', 'css', 'legacy'] }
            };

            // Wait a moment for styles to apply, then generate PDF
            setTimeout(() => {
                html2pdf().set(opt).from(pdfContent).save().then(() => {
                    document.body.removeChild(pdfContent);
                    showToast('PDF downloaded successfully!', 'success');
                }).catch(err => {
                    if (document.body.contains(pdfContent)) {
                        document.body.removeChild(pdfContent);
                    }
                    console.error('PDF generation error:', err);
                    // Fallback: Try direct print
                    alert('PDF generation encountered an issue. Opening print dialog instead.');
                    printItinerary();
                });
            }, 100);
        }

        // ==================== GOOGLE OAUTH AUTHENTICATION ====================

        // Google OAuth Configuration
        const GOOGLE_CLIENT_ID = '624000186446-n3uttrkq8qlitc7h2ho7k6cbd993s6od.apps.googleusercontent.com';
        // Note: API_BASE_URL is already declared above at line 3366

        // Current user state
        let currentUser = null;

        // Initialize auth state on page load
        document.addEventListener('DOMContentLoaded', () => {
            // Check for existing session
            const savedUser = localStorage.getItem('voya_user');
            if (savedUser) {
                try {
                    currentUser = JSON.parse(savedUser);
                    updateUIForLoggedInUser();
                } catch (e) {
                    localStorage.removeItem('voya_user');
                }
            }

            // Close user menu when clicking outside
            document.addEventListener('click', (e) => {
                const userMenu = document.getElementById('user-menu');
                const userAvatar = document.getElementById('user-avatar');
                if (userMenu && userAvatar && !userAvatar.contains(e.target) && !userMenu.contains(e.target)) {
                    userMenu.classList.remove('active');
                }
            });
        });

        // Open Sign In Modal
        function openSignInModal() {
            const modal = document.getElementById('signin-modal');
            if (modal) {
                modal.style.display = 'flex';
                modal.classList.add('active');
            }
        }

        // Close Sign In Modal
        function closeSignInModal() {
            const modal = document.getElementById('signin-modal');
            if (modal) {
                modal.style.display = 'none';
                modal.classList.remove('active');
            }
        }

        // Handle Google Sign In
        function handleGoogleSignIn() {
            // Check if Google Identity Services is loaded
            if (typeof google === 'undefined' || !google.accounts) {
                showToast('Google Sign-In is still loading. Please try again.', 'warning');
                return;
            }

            // Initialize Google Sign In
            google.accounts.id.initialize({
                client_id: GOOGLE_CLIENT_ID,
                callback: handleGoogleCredentialResponse,
                auto_select: false,
                cancel_on_tap_outside: true
            });

            // Show Google One Tap or prompt
            google.accounts.id.prompt((notification) => {
                if (notification.isNotDisplayed() || notification.isSkippedMoment()) {
                    // If One Tap is not displayed, use OAuth popup
                    initiateGoogleOAuthPopup();
                }
            });
        }

        // Initiate Google OAuth using the popup button approach
        function initiateGoogleOAuthPopup() {
            if (!GOOGLE_CLIENT_ID) {
                showToast('Google OAuth is not configured. Please set up Google Cloud credentials.', 'error');
                console.error('GOOGLE_CLIENT_ID is not set.');
                return;
            }

            // Create a temporary container for Google's button
            let googleBtnContainer = document.getElementById('google-btn-container');
            if (!googleBtnContainer) {
                googleBtnContainer = document.createElement('div');
                googleBtnContainer.id = 'google-btn-container';
                googleBtnContainer.style.cssText = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);z-index:3000;background:white;padding:40px;border-radius:16px;box-shadow:0 10px 40px rgba(0,0,0,0.3);';

                const closeBtn = document.createElement('button');
                closeBtn.innerHTML = '&times;';
                closeBtn.style.cssText = 'position:absolute;top:10px;right:10px;border:none;background:#f0f0f0;width:30px;height:30px;border-radius:50%;cursor:pointer;font-size:1.2rem;';
                closeBtn.onclick = () => googleBtnContainer.remove();
                googleBtnContainer.appendChild(closeBtn);

                const title = document.createElement('p');
                title.textContent = 'Sign in with your Google account';
                title.style.cssText = 'margin-bottom:20px;font-weight:600;color:#333;';
                googleBtnContainer.appendChild(title);

                const btnWrapper = document.createElement('div');
                btnWrapper.id = 'google-signin-wrapper';
                googleBtnContainer.appendChild(btnWrapper);

                document.body.appendChild(googleBtnContainer);
            }

            // Close the main modal
            closeSignInModal();

            // Render Google's official sign-in button
            google.accounts.id.renderButton(
                document.getElementById('google-signin-wrapper'),
                {
                    theme: 'outline',
                    size: 'large',
                    type: 'standard',
                    text: 'signin_with',
                    shape: 'rectangular',
                    logo_alignment: 'left',
                    width: 280
                }
            );
        }

        // Handle OAuth message from popup
        function handleOAuthMessage(event) {
            if (event.origin !== window.location.origin) return;

            if (event.data.type === 'google-auth-success') {
                handleGoogleCredentialResponse({ credential: event.data.token });
            }
        }

        // Handle Google Credential Response
        async function handleGoogleCredentialResponse(response) {
            closeSignInModal();

            try {
                // Decode JWT token to get user info
                const payload = decodeJwtPayload(response.credential);

                if (payload) {
                    currentUser = {
                        id: payload.sub,
                        email: payload.email,
                        name: payload.name,
                        picture: payload.picture,
                        token: response.credential
                    };

                    // Save to localStorage
                    localStorage.setItem('voya_user', JSON.stringify(currentUser));

                    // Update UI
                    updateUIForLoggedInUser();

                    showToast(`Welcome, ${currentUser.name}!`, 'success');

                    // Optional: Send to backend for validation
                    // await verifyTokenWithBackend(response.credential);
                }
            } catch (error) {
                console.error('Error processing Google sign in:', error);
                showToast('Sign in failed. Please try again.', 'error');
            }
        }

        // Decode JWT payload (base64)
        function decodeJwtPayload(token) {
            try {
                const base64Url = token.split('.')[1];
                const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                const jsonPayload = decodeURIComponent(atob(base64).split('').map(c => {
                    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                }).join(''));
                return JSON.parse(jsonPayload);
            } catch (e) {
                console.error('Error decoding JWT:', e);
                return null;
            }
        }

        // Update UI for logged in user
        function updateUIForLoggedInUser() {
            const signinBtn = document.getElementById('signin-btn');
            const userProfile = document.getElementById('user-profile');
            const userAvatar = document.getElementById('user-avatar');
            const userName = document.getElementById('user-name');

            if (currentUser && signinBtn && userProfile) {
                signinBtn.style.display = 'none';
                userProfile.style.display = 'block';

                if (userAvatar && currentUser.picture) {
                    userAvatar.style.backgroundImage = `url(${currentUser.picture})`;
                }

                if (userName) userName.textContent = currentUser.name || 'User';
            }
        }

        // Update UI for logged out user
        function updateUIForLoggedOutUser() {
            const signinBtn = document.getElementById('signin-btn');
            const userProfile = document.getElementById('user-profile');
            const userMenu = document.getElementById('user-menu');

            if (signinBtn && userProfile) {
                signinBtn.style.display = 'block';
                userProfile.style.display = 'none';
            }

            if (userMenu) {
                userMenu.classList.remove('active');
            }
        }

        // Toggle user menu dropdown
        function toggleUserMenu() {
            const userMenu = document.getElementById('user-menu');
            if (userMenu) {
                userMenu.classList.toggle('active');
            }
        }

        // Handle Sign Out
        function handleSignOut() {
            // Confirm before signing out
            if (!confirm('Are you sure you want to sign out?')) {
                return;
            }

            currentUser = null;
            localStorage.removeItem('voya_user');

            // Revoke Google session if available
            if (typeof google !== 'undefined' && google.accounts && google.accounts.id) {
                google.accounts.id.disableAutoSelect();
            }

            // Also call Supabase logout if we have a token
            const savedToken = localStorage.getItem('voya_token');
            if (savedToken) {
                fetch(`${API_BASE_URL}/api/auth/logout`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${savedToken}` }
                }).catch(() => { }); // Ignore errors
            }

            localStorage.removeItem('voya_token');
            localStorage.removeItem('voya_refresh_token');

            updateUIForLoggedOutUser();
            showToast('Signed out successfully', 'success');
        }

        // ==================== SUPABASE EMAIL/PASSWORD AUTHENTICATION ====================

        // Open Auth Overlay
        function openAuthOverlay(tab = 'login') {
            const overlay = document.getElementById('auth-overlay');
            if (overlay) {
                overlay.classList.add('active');
                switchAuthTab(tab);
                document.getElementById('auth-error').classList.remove('show');
                document.getElementById('auth-success').classList.remove('show');
            }
        }

        // Close Auth Overlay
        function closeAuthOverlay() {
            const overlay = document.getElementById('auth-overlay');
            if (overlay) {
                overlay.classList.remove('active');
                // Clear form inputs
                document.getElementById('login-email').value = '';
                document.getElementById('login-password').value = '';
                document.getElementById('signup-name').value = '';
                document.getElementById('signup-email').value = '';
                document.getElementById('signup-password').value = '';
            }
        }

        // Switch between Login and Signup tabs
        function switchAuthTab(tab) {
            const loginTab = document.getElementById('login-tab');
            const signupTab = document.getElementById('signup-tab');
            const loginForm = document.getElementById('login-form');
            const signupForm = document.getElementById('signup-form');
            const authHeader = document.querySelector('.auth-header h2');
            const authSubtext = document.querySelector('.auth-header p');
            const footerText = document.getElementById('auth-footer-text');

            if (tab === 'login') {
                loginTab.classList.add('active');
                signupTab.classList.remove('active');
                loginForm.classList.add('active');
                signupForm.classList.remove('active');
                // Update header and footer
                if (authHeader) authHeader.textContent = 'Welcome back';
                if (authSubtext) authSubtext.textContent = 'Continue your adventure with VOYA AI';
                if (footerText) footerText.innerHTML = 'Don\'t have an account? <a href="#" onclick="switchAuthTab(\'signup\'); return false;">Sign up</a>';
            } else {
                signupTab.classList.add('active');
                loginTab.classList.remove('active');
                signupForm.classList.add('active');
                loginForm.classList.remove('active');
                // Update header and footer
                if (authHeader) authHeader.textContent = 'Create Account';
                if (authSubtext) authSubtext.textContent = 'Start your journey with VOYA AI today';
                if (footerText) footerText.innerHTML = 'Already have an account? <a href="#" onclick="switchAuthTab(\'login\'); return false;">Sign in</a>';
            }

            // Clear messages
            document.getElementById('auth-error').classList.remove('show');
            document.getElementById('auth-success').classList.remove('show');
        }

        // Show auth error
        function showAuthError(message) {
            const errorEl = document.getElementById('auth-error');
            errorEl.textContent = message;
            errorEl.classList.add('show');
            document.getElementById('auth-success').classList.remove('show');
        }

        // Show auth success
        function showAuthSuccess(message) {
            const successEl = document.getElementById('auth-success');
            successEl.textContent = message;
            successEl.classList.add('show');
            document.getElementById('auth-error').classList.remove('show');
        }

        // Handle Supabase Signup
        async function handleSupabaseSignup(e) {
            e.preventDefault();

            const name = document.getElementById('signup-name').value.trim();
            const email = document.getElementById('signup-email').value.trim();
            const password = document.getElementById('signup-password').value;

            // Validation
            if (!name || !email || !password) {
                showAuthError('Please fill in all fields');
                return;
            }

            if (password.length < 8) {
                showAuthError('Password must be at least 8 characters');
                return;
            }

            const submitBtn = document.getElementById('signup-submit');
            const originalContent = submitBtn.innerHTML;
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin" style="margin-right: 8px;"></i> Creating account...';

            try {
                const response = await fetchWithFailover('/api/auth/signup', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password, name })
                });

                const data = await response.json();

                if (!response.ok || !data.success) {
                    throw new Error(data.error || 'Signup failed');
                }

                if (data.session) {
                    // Immediate login (email already confirmed or confirmation disabled)
                    currentUser = data.user;
                    localStorage.setItem('voya_user', JSON.stringify(currentUser));
                    localStorage.setItem('voya_token', data.session.access_token);
                    localStorage.setItem('voya_refresh_token', data.session.refresh_token);
                    updateUIForLoggedInUser();
                    closeAuthOverlay();
                    showToast(`Welcome, ${currentUser.name}! üéâ`, 'success');
                } else {
                    // Email confirmation required
                    showAuthSuccess('Account created! Please check your email to confirm.');
                }
            } catch (err) {
                showAuthError(err.message || 'Signup failed. Please try again.');
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="fas fa-user-plus" style="margin-right: 8px;"></i> Create Account';
            }
        }

        // Handle Supabase Login
        async function handleSupabaseLogin(e) {
            e.preventDefault();

            const email = document.getElementById('login-email').value.trim();
            const password = document.getElementById('login-password').value;

            if (!email || !password) {
                showAuthError('Please enter email and password');
                return;
            }

            const submitBtn = document.getElementById('login-submit');
            const originalContent = submitBtn.innerHTML;
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin" style="margin-right: 8px;"></i> Signing in...';

            try {
                const response = await fetchWithFailover('/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();

                if (!response.ok || !data.success) {
                    throw new Error(data.error || 'Login failed');
                }

                currentUser = data.user;
                localStorage.setItem('voya_user', JSON.stringify(currentUser));
                localStorage.setItem('voya_token', data.token);
                localStorage.setItem('voya_refresh_token', data.refresh_token);

                updateUIForLoggedInUser();
                closeAuthOverlay();
                showToast(`Welcome back, ${currentUser.name}! üåç`, 'success');
            } catch (err) {
                showAuthError(err.message || 'Login failed. Please try again.');
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="fas fa-sign-in-alt" style="margin-right: 8px;"></i> Sign In';
            }
        }

        // Get auth token for API requests
        function getAuthToken() {
            return localStorage.getItem('voya_token') || null;
        }

        // Refresh auth token
        async function refreshAuthToken() {
            const refreshToken = localStorage.getItem('voya_refresh_token');
            if (!refreshToken) return false;

            try {
                const response = await fetchWithFailover('/api/auth/refresh', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ refresh_token: refreshToken })
                });

                const data = await response.json();
                if (data.success && data.token) {
                    localStorage.setItem('voya_token', data.token);
                    localStorage.setItem('voya_refresh_token', data.refresh_token);
                    return true;
                }
            } catch (err) {
                console.error('Token refresh failed:', err);
            }

            return false;
        }

        // Make authenticated API request
        async function authenticatedFetch(endpoint, options = {}) {
            const token = getAuthToken();
            if (!token) {
                throw new Error('Not authenticated');
            }

            options.headers = {
                ...options.headers,
                'Authorization': `Bearer ${token}`
            };

            const response = await fetchWithFailover(endpoint, options);

            // If 401, try to refresh token
            if (response.status === 401) {
                const refreshed = await refreshAuthToken();
                if (refreshed) {
                    options.headers['Authorization'] = `Bearer ${getAuthToken()}`;
                    return fetchWithFailover(endpoint, options);
                } else {
                    // Token refresh failed, log out
                    handleSignOut();
                    throw new Error('Session expired. Please sign in again.');
                }
            }

            return response;
        }

        // View saved trips (placeholder)
        function viewSavedTrips() {
            if (!currentUser) {
                openSignInModal();
                return;
            }

            showToast('My Trips feature coming soon!', 'info');
            toggleUserMenu();
        }

        // Check if user is logged in
        function isUserLoggedIn() {
            return currentUser !== null;
        }

        // Get current user
        function getCurrentUser() {
            return currentUser;
        }

        // ==================== BLOG SYSTEM ====================
        let blogArticles = [];

        /**
         * Load blog articles from API
         */
        async function loadBlogArticles() {
            const loader = document.getElementById('blog-loader');
            const container = document.getElementById('blog-articles');

            if (loader) loader.style.display = 'block';
            if (container) container.innerHTML = '';

            try {
                const response = await fetch(`${API_BASE_URL}/api/blog/list`, {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' }
                });

                if (!response.ok) {
                    throw new Error('Failed to load blog articles');
                }

                const data = await response.json();
                blogArticles = data.articles || [];

                if (blogArticles.length === 0) {
                    container.innerHTML = '<p style="text-align:center;color:#78716C;padding:40px;">No articles yet. Click "New Article" to generate one!</p>';
                } else {
                    container.innerHTML = blogArticles.map(article => renderBlogCard(article)).join('');
                }

            } catch (error) {
                console.error('Blog load error:', error);
                container.innerHTML = '<p style="text-align:center;color:#dc2626;padding:40px;">Failed to load articles. Please try again.</p>';
            } finally {
                if (loader) loader.style.display = 'none';
            }
        }

        /**
         * Generate a new blog article
         */
        async function generateNewBlog() {
            const loader = document.getElementById('blog-loader');
            if (loader) loader.style.display = 'block';

            try {
                const response = await fetch(`${API_BASE_URL}/api/blog/generate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({})
                });

                if (!response.ok) {
                    throw new Error('Failed to generate article');
                }

                const data = await response.json();
                showToast(`New article: "${data.article.title}"`, 'success');

                // Reload articles to show the new one
                await loadBlogArticles();

            } catch (error) {
                console.error('Blog generation error:', error);
                showToast('Failed to generate article. Please try again.', 'error');
                if (loader) loader.style.display = 'none';
            }
        }

        /**
         * Render a blog article card
         */
        function renderBlogCard(article) {
            const date = new Date(article.createdAt).toLocaleDateString('en-US', {
                month: 'short', day: 'numeric', year: 'numeric'
            });
            const categoryColors = {
                destinations: '#3b82f6',
                tips: '#10b981',
                guides: '#8b5cf6',
                news: '#f59e0b'
            };
            const color = categoryColors[article.category] || '#D4AF37';

            return `
                <div class="blog-card" onclick="openBlogArticle('${article.id}')"
                     style="background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 4px 20px rgba(0,0,0,0.08);cursor:pointer;transition:all 0.3s ease;">
                    <div style="height:160px;background:url('${article.imageUrl}') center/cover;position:relative;">
                        <span style="position:absolute;top:12px;left:12px;background:${color};color:#fff;padding:4px 12px;border-radius:20px;font-size:0.75rem;text-transform:uppercase;">${article.category}</span>
                    </div>
                    <div style="padding:20px;">
                        <h3 style="margin:0 0 8px;font-size:1.1rem;color:#1C1917;font-family:'Playfair Display',serif;line-height:1.3;">${escapeHtml(article.title)}</h3>
                        <p style="margin:0 0 12px;color:#78716C;font-size:0.85rem;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;">${escapeHtml(article.excerpt)}</p>
                        <div style="display:flex;justify-content:space-between;align-items:center;color:#a8a29e;font-size:0.75rem;">
                            <span><i class="fas fa-calendar"></i> ${date}</span>
                            <span style="color:#D4AF37;">Read more ‚Üí</span>
                        </div>
                    </div>
                </div>
            `;
        }

        /**
         * Open a blog article in modal
         */
        function openBlogArticle(articleId) {
            const article = blogArticles.find(a => a.id === articleId);
            if (!article) return;

            const modal = document.getElementById('blog-modal');
            const content = document.getElementById('blog-modal-content');

            if (modal && content) {
                const date = new Date(article.createdAt).toLocaleDateString('en-US', {
                    weekday: 'long', month: 'long', day: 'numeric', year: 'numeric'
                });

                // Convert markdown to simple HTML (basic conversion)
                let htmlContent = article.content
                    .replace(/^## (.+)$/gm, '<h2 style="color:#1C1917;margin:25px 0 15px;font-family:\'Playfair Display\',serif;">$1</h2>')
                    .replace(/^### (.+)$/gm, '<h3 style="color:#1C1917;margin:20px 0 10px;">$1</h3>')
                    .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
                    .replace(/\n\n/g, '</p><p style="color:#57534E;line-height:1.8;margin:0 0 15px;">')
                    .replace(/\n/g, '<br>');
                htmlContent = '<p style="color:#57534E;line-height:1.8;margin:0 0 15px;">' + htmlContent + '</p>';

                content.innerHTML = `
                    <div style="margin-bottom:20px;">
                        <span style="background:linear-gradient(135deg,#D4AF37,#C5A059);color:#fff;padding:4px 12px;border-radius:20px;font-size:0.75rem;text-transform:uppercase;">${article.category}</span>
                        <span style="color:#a8a29e;font-size:0.85rem;margin-left:15px;">${date}</span>
                    </div>
                    <h1 style="font-family:'Playfair Display',serif;color:#1C1917;font-size:2rem;margin:0 0 20px;line-height:1.3;">${escapeHtml(article.title)}</h1>
                    <img src="${article.imageUrl}" alt="" style="width:100%;height:300px;object-fit:cover;border-radius:12px;margin-bottom:25px;">
                    <div class="blog-content">${htmlContent}</div>
                    ${article.tags && article.tags.length ? `
                        <div style="margin-top:25px;padding-top:20px;border-top:1px solid #e5e5e5;">
                            ${article.tags.map(tag => `<span style="display:inline-block;background:#f5f5f4;color:#57534E;padding:4px 12px;border-radius:15px;font-size:0.8rem;margin-right:8px;">#${tag}</span>`).join('')}
                        </div>
                    ` : ''}
                `;

                modal.style.display = 'block';
                document.body.style.overflow = 'hidden';
            }
        }

        /**
         * Close blog modal
         */
        function closeBlogModal() {
            const modal = document.getElementById('blog-modal');
            if (modal) {
                modal.style.display = 'none';
                document.body.style.overflow = '';
            }
        }

        // Load blogs when switching to blog tab
        const originalSwitchTab = window.switchTab;
        window.switchTab = function (event, tabId) {
            if (typeof originalSwitchTab === 'function') {
                originalSwitchTab(event, tabId);
            } else {
                // Fallback tab switching
                document.querySelectorAll('.tab-content').forEach(tab => tab.style.display = 'none');
                document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                const targetTab = document.getElementById(tabId);
                if (targetTab) targetTab.style.display = 'block';
                if (event && event.target) event.target.classList.add('active');
            }

            // Load blogs when blog tab is selected
            if (tabId === 'blog' && blogArticles.length === 0) {
                loadBlogArticles();
            }
        };


    </script>




    <!-- ==================== PREMIUM AUTH OVERLAY ==================== -->
    <div id="auth-overlay" class="auth-overlay" onclick="if(event.target === this) closeAuthOverlay()">
        <div class="auth-container">
            <!-- Left Side - Hero -->
            <div class="auth-hero">
                <div class="auth-hero-float"></div>
                <div class="auth-hero-float"></div>
                <div class="auth-hero-float"></div>

                <div class="auth-hero-content">
                    <div class="auth-hero-logo">
                        <div class="logo-icon">üåç</div>
                        <span class="logo-text">VOYA</span>
                        <span class="logo-ai">AI</span>
                    </div>

                    <h1 class="auth-hero-quote">
                        Your Journey<br><span>Begins Here.</span>
                    </h1>

                    <p class="auth-hero-tagline">
                        Join millions of travelers who plan smarter with AI-powered itineraries, flight deals, and
                        personalized recommendations.
                    </p>

                    <div class="auth-hero-features">
                        <div class="auth-hero-feature">
                            <i class="fas fa-check-circle"></i>
                            <span>AI Itineraries</span>
                        </div>
                        <div class="auth-hero-feature">
                            <i class="fas fa-check-circle"></i>
                            <span>Best Deals</span>
                        </div>
                        <div class="auth-hero-feature">
                            <i class="fas fa-check-circle"></i>
                            <span>24/7 Support</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Side - Auth Panel -->
            <div class="auth-panel">
                <button class="auth-close" onclick="closeAuthOverlay()">√ó</button>

                <div class="auth-header">
                    <h2>Welcome back</h2>
                    <p>Continue your adventure with VOYA AI</p>
                </div>

                <!-- Auth Tabs -->
                <div class="auth-tabs">
                    <button id="login-tab" class="auth-tab active" onclick="switchAuthTab('login')">Sign In</button>
                    <button id="signup-tab" class="auth-tab" onclick="switchAuthTab('signup')">Create Account</button>
                </div>

                <!-- Error/Success Messages -->
                <div id="auth-error" class="auth-error"></div>
                <div id="auth-success" class="auth-success"></div>

                <!-- Login Form -->
                <form id="login-form" class="auth-form active" onsubmit="handleSupabaseLogin(event)">
                    <div class="auth-input-group">
                        <label for="login-email">Email Address</label>
                        <div class="auth-input-wrapper">
                            <input type="email" id="login-email" placeholder="you@example.com" required>
                            <i class="fas fa-envelope"></i>
                        </div>
                    </div>
                    <div class="auth-input-group">
                        <label for="login-password">Password</label>
                        <div class="auth-input-wrapper">
                            <input type="password" id="login-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                            <i class="fas fa-lock"></i>
                        </div>
                    </div>
                    <a href="#" class="auth-forgot-link"
                        onclick="showToast('Password reset coming soon!', 'info'); return false;">Forgot password?</a>
                    <button type="submit" id="login-submit" class="auth-submit">
                        <i class="fas fa-sign-in-alt" style="margin-right: 8px;"></i> Sign In
                    </button>
                </form>

                <!-- Signup Form -->
                <form id="signup-form" class="auth-form" onsubmit="handleSupabaseSignup(event)">
                    <div class="auth-input-group">
                        <label for="signup-name">Full Name</label>
                        <div class="auth-input-wrapper">
                            <input type="text" id="signup-name" placeholder="John Doe" required>
                            <i class="fas fa-user"></i>
                        </div>
                    </div>
                    <div class="auth-input-group">
                        <label for="signup-email">Email Address</label>
                        <div class="auth-input-wrapper">
                            <input type="email" id="signup-email" placeholder="you@example.com" required>
                            <i class="fas fa-envelope"></i>
                        </div>
                    </div>
                    <div class="auth-input-group">
                        <label for="signup-password">Password</label>
                        <div class="auth-input-wrapper">
                            <input type="password" id="signup-password" placeholder="Min. 8 characters" required>
                            <i class="fas fa-lock"></i>
                        </div>
                    </div>
                    <button type="submit" id="signup-submit" class="auth-submit">
                        <i class="fas fa-user-plus" style="margin-right: 8px;"></i> Create Account
                    </button>
                </form>

                <!-- Divider -->
                <div class="auth-divider">
                    <span>or continue with</span>
                </div>

                <!-- Google Sign In -->
                <button class="google-signin-btn" onclick="handleGoogleSignIn()">
                    <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
                        <path
                            d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"
                            fill="#4285F4" />
                        <path
                            d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"
                            fill="#34A853" />
                        <path
                            d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"
                            fill="#FBBC05" />
                        <path
                            d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"
                            fill="#EA4335" />
                    </svg>
                    Continue with Google
                </button>

                <div class="auth-footer">
                    <p id="auth-footer-text">Don't have an account? <a href="#"
                            onclick="switchAuthTab('signup'); return false;">Sign up</a></p>
                </div>
            </div>
        </div>
    </div>

</body>

</html>
