<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VOYA üåç AI | Travel Smarter</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-bg: #1a1a1a;
            --card-bg: #ffffff;
            --accent-blue: #003580;
            --text-dark: #333333;
            --text-light: #f4f4f4;
            --gray: #666;
            --success: #28a745;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            background-color: var(--primary-bg);
            color: var(--text-light);
            line-height: 1.6;
        }

        header {
            height: 70px;
            background: rgba(0, 0, 0, 0.8);
            padding: 1rem 5%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid #333;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: #fff;
            text-decoration: none;
        }

        nav a {
            color: #ccc;
            text-decoration: none;
            margin: 0 15px;
            font-size: 0.9rem;
            transition: 0.3s;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .btn-signin {
            background: var(--accent-blue);
            color: white;
            border: none;
            padding: 10px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-signin:hover {
            background: #002a66;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 53, 128, 0.4);
        }

        .hero {
            text-align: center;
            padding: 80px 20px 120px;
            background: linear-gradient(to bottom, #1a1a1a, #2c3e50);
        }

        .hero h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            color: #fff;
        }

        .hero p {
            color: #bbb;
            font-size: 1.1rem;
        }

        .container {
            max-width: 1200px;
            margin: 50px auto;
            padding: 0 20px;
        }

        .tabs-nav {
            display: flex;
            align-items: center;
            min-height: 60px;
            background: #fff;
            border-radius: 12px 12px 0 0;
            overflow: hidden;
            border-bottom: 2px solid #eee;
        }

        .tab-btn {
            flex: 1;
            padding: 18px 15px;
            border: none;
            background: white;
            color: var(--gray);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            height: 100%;
            font-size: 0.95rem;
        }

        .tab-btn:hover {
            background: #f0f0f0;
            color: var(--accent-blue);
        }

        .tab-btn.active {
            color: var(--accent-blue);
            border-bottom: 3px solid var(--accent-blue);
            background: #f8f9fa;
        }

        /* Trip Type Toggle Buttons (Google Flights Style) */
        .trip-type-btn {
            padding: 10px 18px;
            border: 2px solid #e0e0e0;
            background: #fff;
            color: #666;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            border-radius: 20px;
            font-size: 0.9rem;
        }

        .trip-type-btn:hover {
            border-color: var(--accent-blue);
            color: var(--accent-blue);
            background: #f8f9fa;
        }

        .trip-type-btn.active {
            border-color: var(--accent-blue);
            background: var(--accent-blue);
            color: #fff;
        }

        .multicity-leg {
            padding: 15px 0;
            border-bottom: 1px solid #eee;
        }

        .multicity-leg:last-child {
            border-bottom: none;
        }

        .tab-content {
            background: white;
            color: var(--text-dark);
            padding: 30px;
            border-radius: 0 0 12px 12px;
            display: none;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .search-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        label {
            font-size: 0.85rem;
            font-weight: bold;
            color: var(--gray);
        }

        input,
        select,
        textarea {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 3px rgba(0, 53, 128, 0.1);
        }

        .btn-main {
            background: var(--accent-blue);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            transition: 0.2s;
        }

        .btn-main:hover {
            background: #002a66;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 53, 128, 0.3);
        }

        .btn-main:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .results-area {
            margin-top: 30px;
            color: var(--text-dark);
            height: auto;
            overflow: visible;
        }

        .flight-card,
        .hotel-card {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .flight-card:hover,
        .hotel-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        .flight-header,
        .hotel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #ddd;
        }

        .price-tag {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--accent-blue);
        }

        .flight-details,
        .hotel-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .detail-label {
            font-size: 0.85rem;
            color: var(--gray);
            font-weight: 600;
        }

        .detail-value {
            font-size: 1rem;
            color: var(--text-dark);
            font-weight: 500;
        }

        .btn-book {
            background: var(--success);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        .btn-book:hover {
            background: #218838;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
        }

        .error-message {
            background: #fff3cd;
            border: 1px solid #ffc107;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .no-results {
            text-align: center;
            padding: 40px;
            color: var(--gray);
            background: #f8f9fa;
            border-radius: 8px;
            margin-top: 20px;
        }

        .loader {
            display: none;
            text-align: center;
            padding: 60px 40px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            margin-top: 20px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #e0e0e0;
            border-top: 4px solid var(--accent-blue);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        .loader p {
            color: var(--accent-blue);
            font-weight: 600;
            font-size: 1rem;
            animation: pulse 1.5s ease-in-out infinite;
        }

        .loader-dots {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 15px;
        }

        .loader-dots span {
            width: 10px;
            height: 10px;
            background: var(--accent-blue);
            border-radius: 50%;
            animation: bounce 1.4s infinite ease-in-out both;
        }

        .loader-dots span:nth-child(1) {
            animation-delay: -0.32s;
        }

        .loader-dots span:nth-child(2) {
            animation-delay: -0.16s;
        }

        .loader-dots span:nth-child(3) {
            animation-delay: 0;
        }

        @keyframes bounce {

            0%,
            80%,
            100% {
                transform: scale(0);
            }

            40% {
                transform: scale(1);
            }
        }

        /* Itinerary Premium Card Styling */
        .itinerary-container {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border-radius: 16px;
            padding: 30px;
            margin-top: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .itinerary-header {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #003580 0%, #1a73e8 100%);
            border-radius: 12px;
            margin-bottom: 25px;
            color: white;
        }

        .itinerary-header h1 {
            margin: 0;
            font-size: 1.8rem;
            font-weight: 700;
        }

        .itinerary-header p {
            margin: 8px 0 0;
            opacity: 0.9;
            font-size: 1rem;
        }

        .day-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            border-left: 5px solid #003580;
            transition: all 0.3s ease;
        }

        .day-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
        }

        .day-card h2 {
            color: #003580;
            font-size: 1.3rem;
            margin: 0 0 15px 0;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .day-card h2::before {
            content: 'üìÖ';
            font-size: 1.2rem;
        }

        .day-card h3 {
            color: #1a73e8;
            font-size: 1.1rem;
            margin: 15px 0 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .activity-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 12px 15px;
            margin: 10px 0;
            border-left: 3px solid #28a745;
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .activity-item::before {
            content: '‚úì';
            color: #28a745;
            font-weight: bold;
            font-size: 1rem;
        }

        .activity-item p {
            margin: 0;
            color: #333;
            line-height: 1.5;
        }

        .tip-card {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeeba 100%);
            border-radius: 10px;
            padding: 15px 20px;
            margin: 15px 0;
            border-left: 4px solid #ffc107;
        }

        .tip-card::before {
            content: 'üí° Pro Tip: ';
            font-weight: bold;
            color: #856404;
        }

        .budget-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin: 20px 0;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .budget-table thead {
            background: linear-gradient(135deg, #003580 0%, #1a73e8 100%);
            color: white;
        }

        .budget-table th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .budget-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e0e0e0;
            background: white;
        }

        .budget-table tr:last-child td {
            border-bottom: none;
        }

        .budget-table tr:hover td {
            background: #f8f9fa;
        }

        .budget-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .budget-badge.budget {
            background: #d4edda;
            color: #155724;
        }

        .budget-badge.midrange {
            background: #fff3cd;
            color: #856404;
        }

        .budget-badge.luxury {
            background: #f8d7da;
            color: #721c24;
        }

        .itinerary-section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .itinerary-section h2 {
            color: #003580;
            margin: 0 0 15px 0;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .itinerary-container ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .itinerary-container li {
            background: #f8f9fa;
            padding: 10px 15px;
            margin: 8px 0;
            border-radius: 8px;
            border-left: 3px solid #1a73e8;
            color: #333;
        }

        .itinerary-container p {
            color: #555;
            line-height: 1.7;
            margin: 10px 0;
        }

        .itinerary-actions {
            display: flex;
            gap: 12px;
            margin-top: 25px;
            padding-top: 25px;
            border-top: 2px solid #e0e0e0;
            flex-wrap: wrap;
        }

        .btn-outline {
            background: white;
            border: 2px solid var(--accent-blue);
            color: var(--accent-blue);
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-outline:hover {
            background: var(--accent-blue);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 53, 128, 0.3);
        }

        /* Full-Page Search Overlay - Trip.com/Skyscanner Style */
        .search-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #0a1628 0%, #1a2d4a 50%, #0d1929 100%);
            z-index: 10000;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .search-overlay.active {
            display: flex;
            opacity: 1;
        }

        .search-overlay.fade-out {
            opacity: 0;
        }

        /* Starfield background effect */
        .search-overlay::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image:
                radial-gradient(1px 1px at 20% 30%, rgba(255, 255, 255, 0.5) 1px, transparent 0),
                radial-gradient(1px 1px at 40% 70%, rgba(255, 255, 255, 0.4) 1px, transparent 0),
                radial-gradient(1px 1px at 50% 50%, rgba(255, 255, 255, 0.3) 1px, transparent 0),
                radial-gradient(1px 1px at 80% 20%, rgba(255, 255, 255, 0.5) 1px, transparent 0);
            background-size: 200px 200px;
            animation: twinkle 4s infinite;
        }

        @keyframes twinkle {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.7;
            }
        }

        .overlay-content {
            position: relative;
            z-index: 1;
            text-align: center;
            padding: 40px;
            max-width: 700px;
            width: 100%;
        }

        /* Route display with flight path */
        .route-display {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 50px;
        }

        .airport-code {
            font-size: 3.5rem;
            font-weight: 800;
            color: #fff;
            letter-spacing: 2px;
            text-shadow: 0 0 30px rgba(0, 150, 255, 0.5);
        }

        .airport-name {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.6);
            margin-top: 5px;
        }

        .flight-path-container {
            position: relative;
            width: 200px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .flight-path-line {
            position: absolute;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg,
                    transparent 0%,
                    rgba(0, 150, 255, 0.8) 20%,
                    rgba(0, 150, 255, 0.8) 80%,
                    transparent 100%);
        }

        .flight-path-dashes {
            position: absolute;
            width: 100%;
            height: 2px;
            background: repeating-linear-gradient(90deg,
                    transparent,
                    transparent 8px,
                    rgba(255, 255, 255, 0.4) 8px,
                    rgba(255, 255, 255, 0.4) 16px);
            animation: dashMove 1s linear infinite;
        }

        @keyframes dashMove {
            from {
                background-position: 0 0;
            }

            to {
                background-position: 24px 0;
            }
        }

        .airplane-icon {
            position: absolute;
            width: 40px;
            height: 40px;
            left: -20px;
            top: 50%;
            margin-top: -20px;
            animation: flyPlane 3s ease-in-out infinite;
            filter: drop-shadow(0 0 10px rgba(0, 150, 255, 0.8));
        }

        .airplane-icon svg {
            width: 100%;
            height: 100%;
            fill: #fff;
        }

        @keyframes flyPlane {
            0% {
                left: -20px;
                transform: translateY(0) rotate(0deg);
            }

            25% {
                left: calc(25% - 10px);
                transform: translateY(-8px) rotate(-3deg);
            }

            50% {
                left: calc(50% - 20px);
                transform: translateY(-12px) rotate(0deg);
            }

            75% {
                left: calc(75% - 10px);
                transform: translateY(-6px) rotate(3deg);
            }

            100% {
                left: calc(100% - 20px);
                transform: translateY(0) rotate(0deg);
            }
        }

        /* Search info badges */
        .search-info {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }

        .info-badge {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 10px 20px;
            border-radius: 30px;
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .info-badge i {
            color: #00a8ff;
        }

        /* Progress section */
        .search-progress {
            margin-bottom: 40px;
        }

        .progress-bar-container {
            width: 100%;
            max-width: 400px;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin: 0 auto 20px;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #0096ff, #00d4ff, #00ff88);
            background-size: 200% 100%;
            border-radius: 10px;
            width: 0%;
            transition: width 0.3s ease;
            animation: gradientShift 2s linear infinite;
        }

        @keyframes gradientShift {
            0% {
                background-position: 0% 50%;
            }

            100% {
                background-position: 200% 50%;
            }
        }

        .search-status-text {
            font-size: 1.2rem;
            color: #fff;
            font-weight: 500;
            margin-bottom: 8px;
            animation: pulseText 2s ease-in-out infinite;
        }

        @keyframes pulseText {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.7;
            }
        }

        .search-substatus {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.5);
        }

        /* Partner logos carousel */
        .partners-section {
            margin-top: 30px;
        }

        .partners-label {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.5);
            margin-bottom: 15px;
        }

        .partners-logos {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
            animation: fadeInUp 0.5s ease;
        }

        .partner-logo {
            width: 80px;
            height: 40px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            color: #333;
            font-weight: 700;
            opacity: 0;
            animation: logoFade 0.5s ease forwards;
        }

        .partner-logo:nth-child(1) {
            animation-delay: 0.1s;
        }

        .partner-logo:nth-child(2) {
            animation-delay: 0.2s;
        }

        .partner-logo:nth-child(3) {
            animation-delay: 0.3s;
        }

        .partner-logo:nth-child(4) {
            animation-delay: 0.4s;
        }

        .partner-logo:nth-child(5) {
            animation-delay: 0.5s;
        }

        @keyframes logoFade {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Cloud decorations */
        .cloud {
            position: absolute;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 50%;
            filter: blur(40px);
        }

        .cloud-1 {
            width: 300px;
            height: 150px;
            top: 10%;
            left: 5%;
            animation: floatCloud 20s ease-in-out infinite;
        }

        .cloud-2 {
            width: 400px;
            height: 200px;
            bottom: 15%;
            right: 5%;
            animation: floatCloud 25s ease-in-out infinite reverse;
        }

        .cloud-3 {
            width: 250px;
            height: 120px;
            top: 40%;
            right: 15%;
            animation: floatCloud 18s ease-in-out infinite;
        }

        @keyframes floatCloud {

            0%,
            100% {
                transform: translateX(0) translateY(0);
            }

            25% {
                transform: translateX(20px) translateY(-10px);
            }

            50% {
                transform: translateX(0) translateY(10px);
            }

            75% {
                transform: translateX(-20px) translateY(-5px);
            }
        }

        /* Cancel button */
        .overlay-cancel {
            position: absolute;
            top: 30px;
            right: 30px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: rgba(255, 255, 255, 0.7);
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            z-index: 1;
        }

        .overlay-cancel:hover {
            background: rgba(255, 255, 255, 0.2);
            color: #fff;
        }

        /* Airport Autocomplete Styles */
        .airport-input-container {
            position: relative;
            width: 100%;
        }

        .airport-autocomplete {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 250px;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
            display: none;
        }

        .airport-autocomplete.active {
            display: block;
        }

        .airport-item {
            padding: 12px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            border-bottom: 1px solid #f0f0f0;
            transition: background 0.2s ease;
        }

        .airport-item:last-child {
            border-bottom: none;
        }

        .airport-item:hover {
            background: #f5f8ff;
        }

        .airport-item.selected {
            background: #e8f0fe;
        }

        .airport-code {
            font-weight: 700;
            color: var(--accent-blue);
            font-size: 1.1rem;
            min-width: 45px;
        }

        .airport-info {
            flex: 1;
        }

        .airport-name {
            font-weight: 500;
            color: #333;
            font-size: 0.9rem;
        }

        .airport-city {
            font-size: 0.8rem;
            color: #888;
            margin-top: 2px;
        }

        .airport-icon {
            color: #ccc;
            font-size: 1.2rem;
        }

        @media (max-width: 768px) {
            .tabs-nav {
                flex-direction: column;
                min-height: auto;
            }

            .tab-btn {
                width: 100%;
                padding: 15px;
            }

            .search-grid {
                grid-template-columns: 1fr;
            }

            .hero h1 {
                font-size: 2rem;
            }

            .container {
                padding: 0 15px;
            }
        }
    </style>
</head>

<body>

    <!-- Full-Page Search Overlay -->
    <div id="search-overlay" class="search-overlay">
        <!-- Decorative clouds -->
        <div class="cloud cloud-1"></div>
        <div class="cloud cloud-2"></div>
        <div class="cloud cloud-3"></div>

        <!-- Cancel button -->
        <button class="overlay-cancel" onclick="cancelSearch()">
            <i class="fas fa-times"></i> Cancel
        </button>

        <div class="overlay-content">
            <!-- Route display with animated plane -->
            <div class="route-display">
                <div class="airport-info">
                    <div class="airport-code" id="overlay-from">DEL</div>
                    <div class="airport-name" id="overlay-from-name">Departure</div>
                </div>

                <div class="flight-path-container">
                    <div class="flight-path-line"></div>
                    <div class="flight-path-dashes"></div>
                    <div class="airplane-icon">
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path transform="rotate(90 12 12)"
                                d="M21 16v-2l-8-5V3.5c0-.83-.67-1.5-1.5-1.5S10 2.67 10 3.5V9l-8 5v2l8-2.5V19l-2 1.5V22l3.5-1 3.5 1v-1.5L13 19v-5.5l8 2.5z" />
                        </svg>
                    </div>
                </div>

                <div class="airport-info">
                    <div class="airport-code" id="overlay-to">DXB</div>
                    <div class="airport-name" id="overlay-to-name">Arrival</div>
                </div>
            </div>

            <!-- Search info badges -->
            <div class="search-info" id="overlay-info">
                <div class="info-badge">
                    <i class="fas fa-calendar"></i>
                    <span id="overlay-date">Date</span>
                </div>
                <div class="info-badge">
                    <i class="fas fa-users"></i>
                    <span id="overlay-passengers">1 Passenger</span>
                </div>
                <div class="info-badge">
                    <i class="fas fa-chair"></i>
                    <span id="overlay-class">Economy</span>
                </div>
            </div>

            <!-- Progress section -->
            <div class="search-progress">
                <div class="progress-bar-container">
                    <div class="progress-bar-fill" id="progress-bar"></div>
                </div>
                <div class="search-status-text" id="search-status">Searching for best flights...</div>
                <div class="search-substatus" id="search-substatus">Connecting to airlines</div>
            </div>

            <!-- Partner logos -->
            <div class="partners-section">
                <div class="partners-label">Searching 100+ airlines and travel sites</div>
                <div class="partners-logos" id="partners-logos">
                    <div class="partner-logo">Air India</div>
                    <div class="partner-logo">IndiGo</div>
                    <div class="partner-logo">SpiceJet</div>
                    <div class="partner-logo">Emirates</div>
                    <div class="partner-logo">Vistara</div>
                </div>
            </div>
        </div>
    </div>

    <header>
        <a href="#" class="logo">VOYA üåç AI</a>
        <div class="header-actions">
            <button class="btn-signin">Sign In</button>
        </div>
    </header>

    <section class="hero">
        <h1>Travel Smarter with AI</h1>
        <p>Plan your perfect journey in seconds</p>
    </section>

    <div class="container">
        <div class="tabs-nav">
            <button class="tab-btn" onclick="switchTab(event, 'flights')">
                <i class="fas fa-plane"></i> Flights
            </button>
            <button class="tab-btn" onclick="switchTab(event, 'hotels')">
                <i class="fas fa-hotel"></i> Hotels
            </button>
            <button class="tab-btn active" onclick="switchTab(event, 'ai-itinerary')">
                <i class="fas fa-robot"></i> AI Itinerary
            </button>
        </div>

        <!-- Flights Tab -->
        <div id="flights" class="tab-content">
            <!-- Trip Type Toggle (Google Flights Style) -->
            <div style="display:flex;gap:10px;margin-bottom:20px;flex-wrap:wrap;">
                <button type="button" class="trip-type-btn active" data-trip="roundtrip"
                    onclick="selectTripType('roundtrip')">
                    <i class="fas fa-exchange-alt"></i> Round Trip
                </button>
                <button type="button" class="trip-type-btn" data-trip="oneway" onclick="selectTripType('oneway')">
                    <i class="fas fa-long-arrow-alt-right"></i> One Way
                </button>
                <button type="button" class="trip-type-btn" data-trip="multicity" onclick="selectTripType('multicity')">
                    <i class="fas fa-route"></i> Multi-city
                </button>
            </div>
            <input type="hidden" id="flight-trip-type" value="roundtrip">

            <!-- Standard Search (One Way / Round Trip) -->
            <div id="standard-search">
                <!-- From / To Row -->
                <div class="search-grid" style="grid-template-columns: 1fr 1fr; margin-bottom: 15px;">
                    <div class="input-group">
                        <label>From</label>
                        <div class="airport-input-container">
                            <input type="text" id="flight-from" placeholder="City or airport" autocomplete="off"
                                oninput="searchAirport(this, 'from-dropdown')"
                                onfocus="showRecentAirports('from-dropdown')"
                                style="font-size:1.1rem;padding:14px 16px;font-weight:500;">
                            <div id="from-dropdown" class="airport-autocomplete"></div>
                        </div>
                    </div>
                    <div class="input-group">
                        <label>To</label>
                        <div class="airport-input-container">
                            <input type="text" id="flight-to" placeholder="City or airport" autocomplete="off"
                                oninput="searchAirport(this, 'to-dropdown')" onfocus="showRecentAirports('to-dropdown')"
                                style="font-size:1.1rem;padding:14px 16px;font-weight:500;">
                            <div id="to-dropdown" class="airport-autocomplete"></div>
                        </div>
                    </div>
                </div>
                <!-- Date Row - Separate side by side -->
                <div class="search-grid" style="grid-template-columns: 1fr 1fr; margin-bottom: 20px;">
                    <div class="input-group">
                        <label>Departure</label>
                        <input type="date" id="flight-depart">
                    </div>
                    <div class="input-group" id="return-date-group">
                        <label>Return</label>
                        <input type="date" id="flight-return">
                    </div>
                </div>
            </div>

            <!-- Multi-city Search -->
            <div id="multicity-search" style="display:none;">
                <div id="multicity-legs">
                    <div class="multicity-leg" data-leg="1">
                        <div class="search-grid">
                            <div class="input-group">
                                <label>Flight 1 - From</label>
                                <input type="text" id="mc-from-1" placeholder="City or airport" autocomplete="off">
                            </div>
                            <div class="input-group">
                                <label>To</label>
                                <input type="text" id="mc-to-1" placeholder="City or airport" autocomplete="off">
                            </div>
                            <div class="input-group">
                                <label>Date</label>
                                <input type="date" id="mc-date-1">
                            </div>
                            <div class="input-group" style="display:flex;align-items:flex-end;">
                                <span style="color:#999;font-size:0.85rem;">Leg 1</span>
                            </div>
                        </div>
                    </div>
                    <div class="multicity-leg" data-leg="2">
                        <div class="search-grid">
                            <div class="input-group">
                                <label>Flight 2 - From</label>
                                <input type="text" id="mc-from-2" placeholder="City or airport" autocomplete="off">
                            </div>
                            <div class="input-group">
                                <label>To</label>
                                <input type="text" id="mc-to-2" placeholder="City or airport" autocomplete="off">
                            </div>
                            <div class="input-group">
                                <label>Date</label>
                                <input type="date" id="mc-date-2">
                            </div>
                            <div class="input-group" style="display:flex;align-items:flex-end;">
                                <button type="button" onclick="addMulticityLeg()"
                                    style="background:var(--accent-blue);color:#fff;border:none;padding:8px 12px;border-radius:6px;cursor:pointer;font-size:0.85rem;">
                                    <i class="fas fa-plus"></i> Add Flight
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <p style="color:#888;font-size:0.85rem;margin-top:10px;">
                    <i class="fas fa-info-circle"></i> Multi-city searches will open Google Flights in a new tab.
                </p>
            </div>

            <!-- Flight Filters -->
            <div class="search-grid" style="margin-bottom: 20px;">
                <div class="input-group">
                    <label>Travel Class</label>
                    <select id="flight-class">
                        <option value="1">Economy</option>
                        <option value="2">Premium Economy</option>
                        <option value="3">Business</option>
                        <option value="4">First Class</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Stops</label>
                    <select id="flight-stops">
                        <option value="0">Any stops</option>
                        <option value="1">Non-stop</option>
                        <option value="2">1 Stop</option>
                        <option value="3">2+ Stops</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Passengers</label>
                    <select id="flight-passengers">
                        <option value="1">1 Adult</option>
                        <option value="2">2 Adults</option>
                        <option value="3">3 Adults</option>
                        <option value="4">4 Adults</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Show</label>
                    <select id="flight-sort">
                        <option value="1">Best</option>
                        <option value="2">Cheapest</option>
                        <option value="3">Fastest</option>
                    </select>
                </div>
            </div>

            <button class="btn-main" onclick="handleFlightSearch()">
                <i class="fas fa-search"></i> Search Flights
            </button>

            <div id="flight-loader" class="loader">
                <div class="spinner"></div>
                <p>Searching for best flight deals...</p>
                <div class="loader-dots">
                    <span></span><span></span><span></span>
                </div>
            </div>

            <div id="flight-results" class="results-area"></div>
        </div>

        <!-- Hotels Tab -->
        <div id="hotels" class="tab-content">
            <div class="search-grid">
                <div class="input-group" style="grid-column: span 2;">
                    <label>Destination</label>
                    <input type="text" id="hotel-dest" placeholder="e.g., Dubai, Paris, New York">
                </div>
                <div class="input-group">
                    <label>Check-in</label>
                    <input type="date" id="hotel-checkin">
                </div>
                <div class="input-group">
                    <label>Check-out</label>
                    <input type="date" id="hotel-checkout">
                </div>
            </div>

            <!-- Hotel Filters -->
            <div class="search-grid" style="margin-bottom: 20px;">
                <div class="input-group">
                    <label>Guests</label>
                    <select id="hotel-guests">
                        <option value="1">1 Guest</option>
                        <option value="2" selected>2 Guests</option>
                        <option value="3">3 Guests</option>
                        <option value="4">4 Guests</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Rooms</label>
                    <select id="hotel-rooms">
                        <option value="1" selected>1 Room</option>
                        <option value="2">2 Rooms</option>
                        <option value="3">3 Rooms</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Min Rating</label>
                    <select id="hotel-rating">
                        <option value="">Any Rating</option>
                        <option value="7">3.5+ Stars</option>
                        <option value="8">4.0+ Stars</option>
                        <option value="9">4.5+ Stars</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Sort By</label>
                    <select id="hotel-sort">
                        <option value="">Relevance</option>
                        <option value="3">Price (Low to High)</option>
                        <option value="8">Rating (High to Low)</option>
                        <option value="13">Most Reviewed</option>
                    </select>
                </div>
            </div>

            <button class="btn-main" onclick="searchHotels()">
                <i class="fas fa-search"></i> Search Hotels
            </button>

            <div id="hotel-loader" class="loader">
                <div class="spinner"></div>
                <p>Finding best hotel deals...</p>
                <div class="loader-dots">
                    <span></span><span></span><span></span>
                </div>
            </div>

            <div id="hotel-results" class="results-area"></div>
        </div>

        <!-- AI Itinerary Tab -->
        <div id="ai-itinerary" class="tab-content" style="display: block;">
            <div class="search-grid">
                <div class="input-group" style="grid-column: span 2;">
                    <label>Destination</label>
                    <input type="text" id="ai-dest" placeholder="e.g., Japan, Bali, Dubai">
                </div>
                <div class="input-group">
                    <label>Duration</label>
                    <input type="text" id="ai-days" placeholder="e.g. 5 days or 1 week">
                </div>
            </div>
            <div class="input-group" style="margin-bottom: 20px;">
                <label>Preferences</label>
                <textarea id="ai-prefs" rows="3" placeholder="Focus on food and culture..."></textarea>
            </div>
            <button class="btn-main" id="generate-btn" onclick="generateAITrip()">Generate Trip</button>

            <div id="ai-loader" class="loader">
                <div class="spinner"></div>
                <p>AI is crafting your perfect journey...</p>
                <div class="loader-dots">
                    <span></span><span></span><span></span>
                </div>
            </div>

            <div id="ai-results" class="results-area"></div>
        </div>
    </div>

    <script>
        // ====================================================================================
        // VOYA AI Frontend - Security Hardened
        // SECURITY: No API keys should EVER be stored in client-side code
        // All API calls go through the secure backend
        // ====================================================================================

        // API Configuration - Secure backend endpoint
        const API_BASE_URL = 'https://v7zixtn6d5c4xae376p7oezlbm0vkdop.lambda-url.eu-north-1.on.aws';

        // ==================== SECURITY: INPUT VALIDATION UTILITIES ====================

        /**
         * SECURITY: Escape HTML to prevent XSS attacks
         * @param {string} str - String to escape
         * @returns {string} - Escaped string safe for HTML display
         */
        function escapeHtml(str) {
            if (!str) return '';
            const div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML;
        }

        /**
         * SECURITY: Validate airport code (exactly 3 letters A-Z)
         * @param {string} code - Airport code to validate
         * @returns {boolean} - True if valid
         */
        function isValidAirportCode(code) {
            if (!code || typeof code !== 'string') return false;
            return /^[A-Za-z]{3}$/.test(code.trim());
        }

        /**
         * SECURITY: Validate date in YYYY-MM-DD format and not in distant past/future
         * @param {string} dateStr - Date string to validate
         * @returns {boolean} - True if valid
         */
        function isValidDate(dateStr) {
            if (!dateStr || typeof dateStr !== 'string') return false;
            if (!/^\d{4}-\d{2}-\d{2}$/.test(dateStr)) return false;
            const date = new Date(dateStr);
            if (isNaN(date.getTime())) return false;
            // Allow dates within -1 day to +1 year from now
            const minDate = new Date();
            minDate.setDate(minDate.getDate() - 1);
            const maxDate = new Date();
            maxDate.setFullYear(maxDate.getFullYear() + 1);
            return date >= minDate && date <= maxDate;
        }

        /**
         * SECURITY: Sanitize and limit string length
         * @param {string} str - String to sanitize
         * @param {number} maxLength - Maximum allowed length
         * @returns {string} - Sanitized string
         */
        function sanitizeString(str, maxLength = 100) {
            if (!str || typeof str !== 'string') return '';
            return str.trim().slice(0, maxLength);
        }

        /**
         * SECURITY: Handle rate limit (429) responses gracefully
         * @param {Response} response - Fetch response object
         * @returns {string|null} - Error message if rate limited, null otherwise
         */
        function handleRateLimitResponse(response) {
            if (response.status === 429) {
                const retryAfter = response.headers.get('Retry-After') || '60';
                return `Too many requests. Please wait ${retryAfter} seconds before trying again.`;
            }
            return null;
        }

        /**
         * SECURITY: Handle API error responses with user-friendly messages
         * @param {Response} response - Fetch response object
         * @returns {Promise<string>} - User-friendly error message
         */
        async function handleErrorResponse(response) {
            // Check for rate limiting first
            const rateLimitError = handleRateLimitResponse(response);
            if (rateLimitError) return rateLimitError;

            try {
                const data = await response.json();
                if (data.details && Array.isArray(data.details)) {
                    return data.details.join(', ');
                }
                return data.message || data.error || 'An error occurred. Please try again.';
            } catch {
                return 'An unexpected error occurred. Please try again.';
            }
        }

        function switchTab(event, tabName) {
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.style.display = 'none');

            const selectedTab = document.getElementById(tabName);
            if (selectedTab) {
                selectedTab.style.display = 'block';
            }

            const buttons = document.querySelectorAll('.tab-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            if (event && event.currentTarget) {
                event.currentTarget.classList.add('active');
            }
        }

        // ==================== TRIP TYPE SELECTION ====================

        /**
         * Select trip type: oneway, roundtrip, or multicity
         * Updates UI to show/hide relevant fields
         */
        function selectTripType(tripType) {
            // Update hidden input
            document.getElementById('flight-trip-type').value = tripType;

            // Update button states
            document.querySelectorAll('.trip-type-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.trip === tripType) {
                    btn.classList.add('active');
                }
            });

            // Show/hide relevant sections
            const standardSearch = document.getElementById('standard-search');
            const multicitySearch = document.getElementById('multicity-search');
            const returnDateGroup = document.getElementById('return-date-group');

            if (tripType === 'multicity') {
                standardSearch.style.display = 'none';
                multicitySearch.style.display = 'block';
            } else {
                standardSearch.style.display = 'block';
                multicitySearch.style.display = 'none';

                // Show/hide return date based on trip type
                if (tripType === 'oneway') {
                    returnDateGroup.style.display = 'none';
                    document.getElementById('flight-return').value = ''; // Clear return date
                } else {
                    returnDateGroup.style.display = 'block';
                }
            }
        }

        /**
         * Add a new flight leg for multi-city search
         */
        let multicityLegCount = 2;
        function addMulticityLeg() {
            if (multicityLegCount >= 5) {
                alert('Maximum 5 flight legs allowed');
                return;
            }

            multicityLegCount++;
            const legsContainer = document.getElementById('multicity-legs');

            const newLeg = document.createElement('div');
            newLeg.className = 'multicity-leg';
            newLeg.dataset.leg = multicityLegCount;
            newLeg.innerHTML = `
                <div class="search-grid">
                    <div class="input-group">
                        <label>Flight ${multicityLegCount} - From</label>
                        <input type="text" id="mc-from-${multicityLegCount}" placeholder="City or airport" autocomplete="off">
                    </div>
                    <div class="input-group">
                        <label>To</label>
                        <input type="text" id="mc-to-${multicityLegCount}" placeholder="City or airport" autocomplete="off">
                    </div>
                    <div class="input-group">
                        <label>Date</label>
                        <input type="date" id="mc-date-${multicityLegCount}">
                    </div>
                    <div class="input-group" style="display:flex;align-items:flex-end;">
                        <button type="button" onclick="removeMulticityLeg(${multicityLegCount})" style="background:#dc3545;color:#fff;border:none;padding:8px 12px;border-radius:6px;cursor:pointer;font-size:0.85rem;">
                            <i class="fas fa-times"></i> Remove
                        </button>
                    </div>
                </div>
            `;
            legsContainer.appendChild(newLeg);
        }

        /**
         * Remove a multi-city leg
         */
        function removeMulticityLeg(legNum) {
            const leg = document.querySelector(`.multicity-leg[data-leg="${legNum}"]`);
            if (leg) {
                leg.remove();
            }
        }

        /**
         * Search multi-city flights (opens Google Flights)
         */
        function searchMulticity() {
            // Collect all multi-city legs
            const legs = [];
            document.querySelectorAll('.multicity-leg').forEach(leg => {
                const legNum = leg.dataset.leg;
                const from = document.getElementById(`mc-from-${legNum}`)?.value?.trim().toUpperCase() || '';
                const to = document.getElementById(`mc-to-${legNum}`)?.value?.trim().toUpperCase() || '';
                const date = document.getElementById(`mc-date-${legNum}`)?.value || '';

                if (from && to && date) {
                    legs.push({ from, to, date });
                }
            });

            if (legs.length < 2) {
                alert('Please fill in at least 2 flight legs for multi-city search');
                return;
            }

            // Build Google Flights multi-city URL
            // Format: /m/<from>.<to>.<date>/<from>.<to>.<date>...
            const flightLegs = legs.map(l => `${l.from}.${l.to}.${l.date.replace(/-/g, '')}`).join('/');
            const googleFlightsUrl = `https://www.google.com/travel/flights?hl=en&tfs=/m/${flightLegs}`;

            window.open(googleFlightsUrl, '_blank');
        }

        /**
         * Handle flight search button click - routes to appropriate search function
         */
        function handleFlightSearch() {
            const tripType = document.getElementById('flight-trip-type').value;

            if (tripType === 'multicity') {
                searchMulticity();
            } else {
                searchFlights();
            }
        }

        // Comprehensive Airports Database (300+ airports worldwide)
        const airports = [
            // INDIA - All Major Airports
            { code: 'DEL', name: 'Indira Gandhi Intl', city: 'New Delhi', country: 'India' }, { code: 'BOM', name: 'Chhatrapati Shivaji Intl', city: 'Mumbai', country: 'India' }, { code: 'BLR', name: 'Kempegowda Intl', city: 'Bangalore', country: 'India' }, { code: 'MAA', name: 'Chennai Intl', city: 'Chennai', country: 'India' }, { code: 'CCU', name: 'Netaji Subhash Chandra Bose Intl', city: 'Kolkata', country: 'India' }, { code: 'HYD', name: 'Rajiv Gandhi Intl', city: 'Hyderabad', country: 'India' }, { code: 'COK', name: 'Cochin Intl', city: 'Kochi', country: 'India' }, { code: 'GOI', name: 'Goa Intl (Dabolim)', city: 'Goa', country: 'India' }, { code: 'AMD', name: 'Sardar Vallabhbhai Patel Intl', city: 'Ahmedabad', country: 'India' }, { code: 'PNQ', name: 'Pune Airport', city: 'Pune', country: 'India' }, { code: 'JAI', name: 'Jaipur Intl', city: 'Jaipur', country: 'India' }, { code: 'LKO', name: 'Chaudhary Charan Singh Intl', city: 'Lucknow', country: 'India' }, { code: 'GAU', name: 'Lokpriya Gopinath Bordoloi Intl', city: 'Guwahati', country: 'India' }, { code: 'SXR', name: 'Sheikh ul-Alam Intl', city: 'Srinagar', country: 'India' }, { code: 'IXC', name: 'Chandigarh Intl', city: 'Chandigarh', country: 'India' }, { code: 'TRV', name: 'Trivandrum Intl', city: 'Thiruvananthapuram', country: 'India' }, { code: 'VNS', name: 'Lal Bahadur Shastri Intl', city: 'Varanasi', country: 'India' }, { code: 'IXB', name: 'Bagdogra Airport', city: 'Siliguri', country: 'India' }, { code: 'IXM', name: 'Madurai Airport', city: 'Madurai', country: 'India' }, { code: 'IXE', name: 'Mangalore Intl', city: 'Mangalore', country: 'India' }, { code: 'NAG', name: 'Dr. Babasaheb Ambedkar Intl', city: 'Nagpur', country: 'India' }, { code: 'PAT', name: 'Jay Prakash Narayan Intl', city: 'Patna', country: 'India' }, { code: 'BBI', name: 'Biju Patnaik Intl', city: 'Bhubaneswar', country: 'India' }, { code: 'IXR', name: 'Birsa Munda Airport', city: 'Ranchi', country: 'India' }, { code: 'RAJ', name: 'Rajkot Airport', city: 'Rajkot', country: 'India' }, { code: 'BDQ', name: 'Vadodara Airport', city: 'Vadodara', country: 'India' }, { code: 'STV', name: 'Surat Airport', city: 'Surat', country: 'India' }, { code: 'IDR', name: 'Devi Ahilyabai Holkar Airport', city: 'Indore', country: 'India' }, { code: 'BHO', name: 'Raja Bhoj Airport', city: 'Bhopal', country: 'India' }, { code: 'RPR', name: 'Swami Vivekananda Airport', city: 'Raipur', country: 'India' }, { code: 'VTZ', name: 'Visakhapatnam Airport', city: 'Visakhapatnam', country: 'India' }, { code: 'CJB', name: 'Coimbatore Intl', city: 'Coimbatore', country: 'India' }, { code: 'TRZ', name: 'Tiruchirappalli Intl', city: 'Tiruchirappalli', country: 'India' }, { code: 'IXA', name: 'Agartala Airport', city: 'Agartala', country: 'India' }, { code: 'IMF', name: 'Imphal Airport', city: 'Imphal', country: 'India' }, { code: 'DIB', name: 'Dibrugarh Airport', city: 'Dibrugarh', country: 'India' }, { code: 'JDH', name: 'Jodhpur Airport', city: 'Jodhpur', country: 'India' }, { code: 'UDR', name: 'Maharana Pratap Airport', city: 'Udaipur', country: 'India' }, { code: 'IXJ', name: 'Jammu Airport', city: 'Jammu', country: 'India' }, { code: 'ATQ', name: 'Sri Guru Ram Dass Jee Intl', city: 'Amritsar', country: 'India' }, { code: 'DED', name: 'Jolly Grant Airport', city: 'Dehradun', country: 'India' }, { code: 'IXL', name: 'Kushok Bakula Rimpochee Airport', city: 'Leh', country: 'India' }, { code: 'GOX', name: 'Manohar Intl (Mopa)', city: 'North Goa', country: 'India' },
            // UAE & MIDDLE EAST
            { code: 'DXB', name: 'Dubai Intl', city: 'Dubai', country: 'UAE' }, { code: 'AUH', name: 'Abu Dhabi Intl', city: 'Abu Dhabi', country: 'UAE' }, { code: 'SHJ', name: 'Sharjah Intl', city: 'Sharjah', country: 'UAE' }, { code: 'DWC', name: 'Al Maktoum Intl', city: 'Dubai', country: 'UAE' }, { code: 'DOH', name: 'Hamad Intl', city: 'Doha', country: 'Qatar' }, { code: 'MCT', name: 'Muscat Intl', city: 'Muscat', country: 'Oman' }, { code: 'SLL', name: 'Salalah Airport', city: 'Salalah', country: 'Oman' }, { code: 'BAH', name: 'Bahrain Intl', city: 'Manama', country: 'Bahrain' }, { code: 'KWI', name: 'Kuwait Intl', city: 'Kuwait City', country: 'Kuwait' }, { code: 'RUH', name: 'King Khalid Intl', city: 'Riyadh', country: 'Saudi Arabia' }, { code: 'JED', name: 'King Abdulaziz Intl', city: 'Jeddah', country: 'Saudi Arabia' }, { code: 'DMM', name: 'King Fahd Intl', city: 'Dammam', country: 'Saudi Arabia' }, { code: 'MED', name: 'Prince Mohammad Bin Abdulaziz Intl', city: 'Medina', country: 'Saudi Arabia' }, { code: 'TLV', name: 'Ben Gurion Intl', city: 'Tel Aviv', country: 'Israel' }, { code: 'AMM', name: 'Queen Alia Intl', city: 'Amman', country: 'Jordan' }, { code: 'BEY', name: 'Beirut Rafic Hariri Intl', city: 'Beirut', country: 'Lebanon' }, { code: 'BGW', name: 'Baghdad Intl', city: 'Baghdad', country: 'Iraq' }, { code: 'IKA', name: 'Imam Khomeini Intl', city: 'Tehran', country: 'Iran' },
            // SOUTHEAST ASIA
            { code: 'SIN', name: 'Singapore Changi', city: 'Singapore', country: 'Singapore' }, { code: 'BKK', name: 'Suvarnabhumi', city: 'Bangkok', country: 'Thailand' }, { code: 'DMK', name: 'Don Mueang Intl', city: 'Bangkok', country: 'Thailand' }, { code: 'HKT', name: 'Phuket Intl', city: 'Phuket', country: 'Thailand' }, { code: 'CNX', name: 'Chiang Mai Intl', city: 'Chiang Mai', country: 'Thailand' }, { code: 'KUL', name: 'Kuala Lumpur Intl', city: 'Kuala Lumpur', country: 'Malaysia' }, { code: 'PEN', name: 'Penang Intl', city: 'Penang', country: 'Malaysia' }, { code: 'LGK', name: 'Langkawi Intl', city: 'Langkawi', country: 'Malaysia' }, { code: 'BKI', name: 'Kota Kinabalu Intl', city: 'Kota Kinabalu', country: 'Malaysia' }, { code: 'KCH', name: 'Kuching Intl', city: 'Kuching', country: 'Malaysia' }, { code: 'CGK', name: 'Soekarno-Hatta Intl', city: 'Jakarta', country: 'Indonesia' }, { code: 'DPS', name: 'Ngurah Rai Intl', city: 'Bali', country: 'Indonesia' }, { code: 'SUB', name: 'Juanda Intl', city: 'Surabaya', country: 'Indonesia' }, { code: 'YIA', name: 'Yogyakarta Intl', city: 'Yogyakarta', country: 'Indonesia' }, { code: 'UPG', name: 'Sultan Hasanuddin Intl', city: 'Makassar', country: 'Indonesia' }, { code: 'MNL', name: 'Ninoy Aquino Intl', city: 'Manila', country: 'Philippines' }, { code: 'CEB', name: 'Mactan-Cebu Intl', city: 'Cebu', country: 'Philippines' }, { code: 'CRK', name: 'Clark Intl', city: 'Angeles', country: 'Philippines' }, { code: 'SGN', name: 'Tan Son Nhat Intl', city: 'Ho Chi Minh City', country: 'Vietnam' }, { code: 'HAN', name: 'Noi Bai Intl', city: 'Hanoi', country: 'Vietnam' }, { code: 'DAD', name: 'Da Nang Intl', city: 'Da Nang', country: 'Vietnam' }, { code: 'CXR', name: 'Cam Ranh Intl', city: 'Nha Trang', country: 'Vietnam' }, { code: 'PQC', name: 'Phu Quoc Intl', city: 'Phu Quoc', country: 'Vietnam' }, { code: 'RGN', name: 'Yangon Intl', city: 'Yangon', country: 'Myanmar' }, { code: 'REP', name: 'Siem Reap Intl', city: 'Siem Reap', country: 'Cambodia' }, { code: 'PNH', name: 'Phnom Penh Intl', city: 'Phnom Penh', country: 'Cambodia' }, { code: 'VTE', name: 'Wattay Intl', city: 'Vientiane', country: 'Laos' }, { code: 'BWN', name: 'Brunei Intl', city: 'Bandar Seri Begawan', country: 'Brunei' },
            // EAST ASIA
            { code: 'HKG', name: 'Hong Kong Intl', city: 'Hong Kong', country: 'China' }, { code: 'PEK', name: 'Beijing Capital Intl', city: 'Beijing', country: 'China' }, { code: 'PKX', name: 'Beijing Daxing Intl', city: 'Beijing', country: 'China' }, { code: 'PVG', name: 'Shanghai Pudong Intl', city: 'Shanghai', country: 'China' }, { code: 'SHA', name: 'Shanghai Hongqiao Intl', city: 'Shanghai', country: 'China' }, { code: 'CAN', name: 'Guangzhou Baiyun Intl', city: 'Guangzhou', country: 'China' }, { code: 'SZX', name: 'Shenzhen Bao an Intl', city: 'Shenzhen', country: 'China' }, { code: 'CTU', name: 'Chengdu Shuangliu Intl', city: 'Chengdu', country: 'China' }, { code: 'CKG', name: 'Chongqing Jiangbei Intl', city: 'Chongqing', country: 'China' }, { code: 'XIY', name: 'Xi an Xianyang Intl', city: 'Xi an', country: 'China' }, { code: 'KMG', name: 'Kunming Changshui Intl', city: 'Kunming', country: 'China' }, { code: 'HGH', name: 'Hangzhou Xiaoshan Intl', city: 'Hangzhou', country: 'China' }, { code: 'NKG', name: 'Nanjing Lukou Intl', city: 'Nanjing', country: 'China' }, { code: 'WUH', name: 'Wuhan Tianhe Intl', city: 'Wuhan', country: 'China' }, { code: 'TSN', name: 'Tianjin Binhai Intl', city: 'Tianjin', country: 'China' }, { code: 'SYX', name: 'Sanya Phoenix Intl', city: 'Sanya', country: 'China' }, { code: 'TAO', name: 'Qingdao Jiaodong Intl', city: 'Qingdao', country: 'China' }, { code: 'DLC', name: 'Dalian Zhoushuizi Intl', city: 'Dalian', country: 'China' }, { code: 'XMN', name: 'Xiamen Gaoqi Intl', city: 'Xiamen', country: 'China' }, { code: 'FOC', name: 'Fuzhou Changle Intl', city: 'Fuzhou', country: 'China' }, { code: 'MFM', name: 'Macau Intl', city: 'Macau', country: 'China' }, { code: 'TPE', name: 'Taiwan Taoyuan Intl', city: 'Taipei', country: 'Taiwan' }, { code: 'TSA', name: 'Taipei Songshan', city: 'Taipei', country: 'Taiwan' }, { code: 'KHH', name: 'Kaohsiung Intl', city: 'Kaohsiung', country: 'Taiwan' }, { code: 'NRT', name: 'Narita Intl', city: 'Tokyo', country: 'Japan' }, { code: 'HND', name: 'Tokyo Haneda', city: 'Tokyo', country: 'Japan' }, { code: 'KIX', name: 'Kansai Intl', city: 'Osaka', country: 'Japan' }, { code: 'ITM', name: 'Osaka Itami', city: 'Osaka', country: 'Japan' }, { code: 'NGO', name: 'Chubu Centrair Intl', city: 'Nagoya', country: 'Japan' }, { code: 'FUK', name: 'Fukuoka Airport', city: 'Fukuoka', country: 'Japan' }, { code: 'CTS', name: 'New Chitose', city: 'Sapporo', country: 'Japan' }, { code: 'OKA', name: 'Naha Airport', city: 'Okinawa', country: 'Japan' }, { code: 'ICN', name: 'Incheon Intl', city: 'Seoul', country: 'South Korea' }, { code: 'GMP', name: 'Gimpo Intl', city: 'Seoul', country: 'South Korea' }, { code: 'PUS', name: 'Gimhae Intl', city: 'Busan', country: 'South Korea' }, { code: 'CJU', name: 'Jeju Intl', city: 'Jeju', country: 'South Korea' }, { code: 'ULN', name: 'Chinggis Khaan Intl', city: 'Ulaanbaatar', country: 'Mongolia' },
            // EUROPE
            { code: 'LHR', name: 'Heathrow', city: 'London', country: 'UK' }, { code: 'LGW', name: 'Gatwick', city: 'London', country: 'UK' }, { code: 'STN', name: 'Stansted', city: 'London', country: 'UK' }, { code: 'LTN', name: 'Luton', city: 'London', country: 'UK' }, { code: 'MAN', name: 'Manchester', city: 'Manchester', country: 'UK' }, { code: 'EDI', name: 'Edinburgh', city: 'Edinburgh', country: 'UK' }, { code: 'BHX', name: 'Birmingham', city: 'Birmingham', country: 'UK' }, { code: 'GLA', name: 'Glasgow', city: 'Glasgow', country: 'UK' }, { code: 'BRS', name: 'Bristol', city: 'Bristol', country: 'UK' }, { code: 'NCL', name: 'Newcastle', city: 'Newcastle', country: 'UK' }, { code: 'CDG', name: 'Charles de Gaulle', city: 'Paris', country: 'France' }, { code: 'ORY', name: 'Paris Orly', city: 'Paris', country: 'France' }, { code: 'NCE', name: 'Nice Cote d Azur', city: 'Nice', country: 'France' }, { code: 'LYS', name: 'Lyon Saint-Exupery', city: 'Lyon', country: 'France' }, { code: 'MRS', name: 'Marseille Provence', city: 'Marseille', country: 'France' }, { code: 'TLS', name: 'Toulouse Blagnac', city: 'Toulouse', country: 'France' }, { code: 'FRA', name: 'Frankfurt', city: 'Frankfurt', country: 'Germany' }, { code: 'MUC', name: 'Munich', city: 'Munich', country: 'Germany' }, { code: 'DUS', name: 'Dusseldorf', city: 'Dusseldorf', country: 'Germany' }, { code: 'TXL', name: 'Berlin Tegel', city: 'Berlin', country: 'Germany' }, { code: 'BER', name: 'Berlin Brandenburg', city: 'Berlin', country: 'Germany' }, { code: 'HAM', name: 'Hamburg', city: 'Hamburg', country: 'Germany' }, { code: 'CGN', name: 'Cologne Bonn', city: 'Cologne', country: 'Germany' }, { code: 'STR', name: 'Stuttgart', city: 'Stuttgart', country: 'Germany' }, { code: 'AMS', name: 'Amsterdam Schiphol', city: 'Amsterdam', country: 'Netherlands' }, { code: 'BRU', name: 'Brussels', city: 'Brussels', country: 'Belgium' }, { code: 'FCO', name: 'Rome Fiumicino', city: 'Rome', country: 'Italy' }, { code: 'MXP', name: 'Milan Malpensa', city: 'Milan', country: 'Italy' }, { code: 'LIN', name: 'Milan Linate', city: 'Milan', country: 'Italy' }, { code: 'VCE', name: 'Venice Marco Polo', city: 'Venice', country: 'Italy' }, { code: 'NAP', name: 'Naples', city: 'Naples', country: 'Italy' }, { code: 'BGY', name: 'Milan Bergamo', city: 'Bergamo', country: 'Italy' }, { code: 'MAD', name: 'Madrid Barajas', city: 'Madrid', country: 'Spain' }, { code: 'BCN', name: 'Barcelona El Prat', city: 'Barcelona', country: 'Spain' }, { code: 'PMI', name: 'Palma de Mallorca', city: 'Palma', country: 'Spain' }, { code: 'AGP', name: 'Malaga', city: 'Malaga', country: 'Spain' }, { code: 'ALC', name: 'Alicante', city: 'Alicante', country: 'Spain' }, { code: 'VLC', name: 'Valencia', city: 'Valencia', country: 'Spain' }, { code: 'SVQ', name: 'Seville', city: 'Seville', country: 'Spain' }, { code: 'IBZ', name: 'Ibiza', city: 'Ibiza', country: 'Spain' }, { code: 'TFS', name: 'Tenerife South', city: 'Tenerife', country: 'Spain' }, { code: 'LPA', name: 'Gran Canaria', city: 'Las Palmas', country: 'Spain' }, { code: 'LIS', name: 'Lisbon Portela', city: 'Lisbon', country: 'Portugal' }, { code: 'OPO', name: 'Porto', city: 'Porto', country: 'Portugal' }, { code: 'FAO', name: 'Faro', city: 'Faro', country: 'Portugal' }, { code: 'ATH', name: 'Athens Intl', city: 'Athens', country: 'Greece' }, { code: 'SKG', name: 'Thessaloniki', city: 'Thessaloniki', country: 'Greece' }, { code: 'HER', name: 'Heraklion', city: 'Crete', country: 'Greece' }, { code: 'RHO', name: 'Rhodes', city: 'Rhodes', country: 'Greece' }, { code: 'JMK', name: 'Mykonos', city: 'Mykonos', country: 'Greece' }, { code: 'JTR', name: 'Santorini', city: 'Santorini', country: 'Greece' }, { code: 'IST', name: 'Istanbul', city: 'Istanbul', country: 'Turkey' }, { code: 'SAW', name: 'Sabiha Gokcen', city: 'Istanbul', country: 'Turkey' }, { code: 'AYT', name: 'Antalya', city: 'Antalya', country: 'Turkey' }, { code: 'ADB', name: 'Izmir Adnan Menderes', city: 'Izmir', country: 'Turkey' }, { code: 'ESB', name: 'Ankara Esenboga', city: 'Ankara', country: 'Turkey' }, { code: 'DLM', name: 'Dalaman', city: 'Dalaman', country: 'Turkey' }, { code: 'BJV', name: 'Bodrum Milas', city: 'Bodrum', country: 'Turkey' }, { code: 'ZRH', name: 'Zurich', city: 'Zurich', country: 'Switzerland' }, { code: 'GVA', name: 'Geneva', city: 'Geneva', country: 'Switzerland' }, { code: 'BSL', name: 'Basel', city: 'Basel', country: 'Switzerland' }, { code: 'VIE', name: 'Vienna', city: 'Vienna', country: 'Austria' }, { code: 'SZG', name: 'Salzburg', city: 'Salzburg', country: 'Austria' }, { code: 'INN', name: 'Innsbruck', city: 'Innsbruck', country: 'Austria' }, { code: 'CPH', name: 'Copenhagen', city: 'Copenhagen', country: 'Denmark' }, { code: 'OSL', name: 'Oslo Gardermoen', city: 'Oslo', country: 'Norway' }, { code: 'BGO', name: 'Bergen', city: 'Bergen', country: 'Norway' }, { code: 'ARN', name: 'Stockholm Arlanda', city: 'Stockholm', country: 'Sweden' }, { code: 'GOT', name: 'Gothenburg Landvetter', city: 'Gothenburg', country: 'Sweden' }, { code: 'HEL', name: 'Helsinki Vantaa', city: 'Helsinki', country: 'Finland' }, { code: 'DUB', name: 'Dublin', city: 'Dublin', country: 'Ireland' }, { code: 'SNN', name: 'Shannon', city: 'Shannon', country: 'Ireland' }, { code: 'ORK', name: 'Cork', city: 'Cork', country: 'Ireland' }, { code: 'PRG', name: 'Prague Vaclav Havel', city: 'Prague', country: 'Czech Republic' }, { code: 'WAW', name: 'Warsaw Chopin', city: 'Warsaw', country: 'Poland' }, { code: 'KRK', name: 'Krakow', city: 'Krakow', country: 'Poland' }, { code: 'BUD', name: 'Budapest Ferenc Liszt', city: 'Budapest', country: 'Hungary' }, { code: 'OTP', name: 'Bucharest Henri Coanda', city: 'Bucharest', country: 'Romania' }, { code: 'SOF', name: 'Sofia', city: 'Sofia', country: 'Bulgaria' }, { code: 'ZAG', name: 'Zagreb', city: 'Zagreb', country: 'Croatia' }, { code: 'SPU', name: 'Split', city: 'Split', country: 'Croatia' }, { code: 'DBV', name: 'Dubrovnik', city: 'Dubrovnik', country: 'Croatia' }, { code: 'BEG', name: 'Belgrade Nikola Tesla', city: 'Belgrade', country: 'Serbia' }, { code: 'LJU', name: 'Ljubljana', city: 'Ljubljana', country: 'Slovenia' }, { code: 'TIA', name: 'Tirana', city: 'Tirana', country: 'Albania' }, { code: 'SKP', name: 'Skopje', city: 'Skopje', country: 'North Macedonia' }, { code: 'KBP', name: 'Kyiv Boryspil', city: 'Kyiv', country: 'Ukraine' }, { code: 'SVO', name: 'Moscow Sheremetyevo', city: 'Moscow', country: 'Russia' }, { code: 'DME', name: 'Moscow Domodedovo', city: 'Moscow', country: 'Russia' }, { code: 'LED', name: 'St Petersburg Pulkovo', city: 'St Petersburg', country: 'Russia' }, { code: 'RIX', name: 'Riga', city: 'Riga', country: 'Latvia' }, { code: 'VNO', name: 'Vilnius', city: 'Vilnius', country: 'Lithuania' }, { code: 'TLL', name: 'Tallinn', city: 'Tallinn', country: 'Estonia' }, { code: 'KEF', name: 'Keflavik', city: 'Reykjavik', country: 'Iceland' },
            // NORTH AMERICA - USA
            { code: 'JFK', name: 'John F Kennedy Intl', city: 'New York', country: 'USA' }, { code: 'EWR', name: 'Newark Liberty Intl', city: 'Newark', country: 'USA' }, { code: 'LGA', name: 'LaGuardia', city: 'New York', country: 'USA' }, { code: 'LAX', name: 'Los Angeles Intl', city: 'Los Angeles', country: 'USA' }, { code: 'SFO', name: 'San Francisco Intl', city: 'San Francisco', country: 'USA' }, { code: 'ORD', name: 'O Hare Intl', city: 'Chicago', country: 'USA' }, { code: 'MDW', name: 'Midway Intl', city: 'Chicago', country: 'USA' }, { code: 'ATL', name: 'Hartsfield-Jackson Atlanta Intl', city: 'Atlanta', country: 'USA' }, { code: 'DFW', name: 'Dallas Fort Worth Intl', city: 'Dallas', country: 'USA' }, { code: 'DEN', name: 'Denver Intl', city: 'Denver', country: 'USA' }, { code: 'SEA', name: 'Seattle-Tacoma Intl', city: 'Seattle', country: 'USA' }, { code: 'MIA', name: 'Miami Intl', city: 'Miami', country: 'USA' }, { code: 'FLL', name: 'Fort Lauderdale-Hollywood Intl', city: 'Fort Lauderdale', country: 'USA' }, { code: 'MCO', name: 'Orlando Intl', city: 'Orlando', country: 'USA' }, { code: 'TPA', name: 'Tampa Intl', city: 'Tampa', country: 'USA' }, { code: 'BOS', name: 'Boston Logan Intl', city: 'Boston', country: 'USA' }, { code: 'PHL', name: 'Philadelphia Intl', city: 'Philadelphia', country: 'USA' }, { code: 'IAD', name: 'Washington Dulles Intl', city: 'Washington DC', country: 'USA' }, { code: 'DCA', name: 'Ronald Reagan Washington National', city: 'Washington DC', country: 'USA' }, { code: 'BWI', name: 'Baltimore Washington Intl', city: 'Baltimore', country: 'USA' }, { code: 'DTW', name: 'Detroit Metro Wayne County', city: 'Detroit', country: 'USA' }, { code: 'MSP', name: 'Minneapolis-St Paul Intl', city: 'Minneapolis', country: 'USA' }, { code: 'CLT', name: 'Charlotte Douglas Intl', city: 'Charlotte', country: 'USA' }, { code: 'PHX', name: 'Phoenix Sky Harbor Intl', city: 'Phoenix', country: 'USA' }, { code: 'LAS', name: 'Harry Reid Intl', city: 'Las Vegas', country: 'USA' }, { code: 'SAN', name: 'San Diego Intl', city: 'San Diego', country: 'USA' }, { code: 'SJC', name: 'San Jose Intl', city: 'San Jose', country: 'USA' }, { code: 'OAK', name: 'Oakland Intl', city: 'Oakland', country: 'USA' }, { code: 'PDX', name: 'Portland Intl', city: 'Portland', country: 'USA' }, { code: 'SLC', name: 'Salt Lake City Intl', city: 'Salt Lake City', country: 'USA' }, { code: 'AUS', name: 'Austin-Bergstrom Intl', city: 'Austin', country: 'USA' }, { code: 'IAH', name: 'George Bush Intercontinental', city: 'Houston', country: 'USA' }, { code: 'HOU', name: 'William P Hobby', city: 'Houston', country: 'USA' }, { code: 'MSY', name: 'Louis Armstrong New Orleans Intl', city: 'New Orleans', country: 'USA' }, { code: 'RDU', name: 'Raleigh-Durham Intl', city: 'Raleigh', country: 'USA' }, { code: 'BNA', name: 'Nashville Intl', city: 'Nashville', country: 'USA' }, { code: 'STL', name: 'St Louis Lambert Intl', city: 'St Louis', country: 'USA' }, { code: 'MCI', name: 'Kansas City Intl', city: 'Kansas City', country: 'USA' }, { code: 'IND', name: 'Indianapolis Intl', city: 'Indianapolis', country: 'USA' }, { code: 'CMH', name: 'John Glenn Columbus Intl', city: 'Columbus', country: 'USA' }, { code: 'CLE', name: 'Cleveland Hopkins Intl', city: 'Cleveland', country: 'USA' }, { code: 'PIT', name: 'Pittsburgh Intl', city: 'Pittsburgh', country: 'USA' }, { code: 'CVG', name: 'Cincinnati Northern Kentucky Intl', city: 'Cincinnati', country: 'USA' }, { code: 'MKE', name: 'General Mitchell Intl', city: 'Milwaukee', country: 'USA' }, { code: 'SMF', name: 'Sacramento Intl', city: 'Sacramento', country: 'USA' }, { code: 'SNA', name: 'John Wayne Airport', city: 'Orange County', country: 'USA' }, { code: 'BUR', name: 'Hollywood Burbank', city: 'Burbank', country: 'USA' }, { code: 'HNL', name: 'Daniel K Inouye Intl', city: 'Honolulu', country: 'USA' }, { code: 'OGG', name: 'Kahului', city: 'Maui', country: 'USA' }, { code: 'ANC', name: 'Ted Stevens Anchorage Intl', city: 'Anchorage', country: 'USA' },
            // CANADA
            { code: 'YYZ', name: 'Toronto Pearson Intl', city: 'Toronto', country: 'Canada' }, { code: 'YVR', name: 'Vancouver Intl', city: 'Vancouver', country: 'Canada' }, { code: 'YUL', name: 'Montreal Trudeau Intl', city: 'Montreal', country: 'Canada' }, { code: 'YYC', name: 'Calgary Intl', city: 'Calgary', country: 'Canada' }, { code: 'YEG', name: 'Edmonton Intl', city: 'Edmonton', country: 'Canada' }, { code: 'YOW', name: 'Ottawa Macdonald-Cartier Intl', city: 'Ottawa', country: 'Canada' }, { code: 'YWG', name: 'Winnipeg Richardson Intl', city: 'Winnipeg', country: 'Canada' }, { code: 'YHZ', name: 'Halifax Stanfield Intl', city: 'Halifax', country: 'Canada' }, { code: 'YQB', name: 'Quebec Jean Lesage Intl', city: 'Quebec City', country: 'Canada' }, { code: 'YXE', name: 'Saskatoon John G Diefenbaker Intl', city: 'Saskatoon', country: 'Canada' }, { code: 'YQR', name: 'Regina Intl', city: 'Regina', country: 'Canada' }, { code: 'YYJ', name: 'Victoria Intl', city: 'Victoria', country: 'Canada' }, { code: 'YKA', name: 'Kamloops', city: 'Kamloops', country: 'Canada' }, { code: 'YXX', name: 'Abbotsford Intl', city: 'Abbotsford', country: 'Canada' },
            // MEXICO & CENTRAL AMERICA
            { code: 'MEX', name: 'Mexico City Intl', city: 'Mexico City', country: 'Mexico' }, { code: 'CUN', name: 'Cancun Intl', city: 'Cancun', country: 'Mexico' }, { code: 'GDL', name: 'Guadalajara Intl', city: 'Guadalajara', country: 'Mexico' }, { code: 'SJD', name: 'Los Cabos Intl', city: 'San Jose del Cabo', country: 'Mexico' }, { code: 'PVR', name: 'Puerto Vallarta Intl', city: 'Puerto Vallarta', country: 'Mexico' }, { code: 'MTY', name: 'Monterrey Intl', city: 'Monterrey', country: 'Mexico' }, { code: 'TIJ', name: 'Tijuana Intl', city: 'Tijuana', country: 'Mexico' }, { code: 'PTY', name: 'Tocumen Intl', city: 'Panama City', country: 'Panama' }, { code: 'SJO', name: 'Juan Santamaria Intl', city: 'San Jose', country: 'Costa Rica' }, { code: 'LIR', name: 'Daniel Oduber Quiros Intl', city: 'Liberia', country: 'Costa Rica' }, { code: 'SAL', name: 'El Salvador Intl', city: 'San Salvador', country: 'El Salvador' }, { code: 'GUA', name: 'La Aurora Intl', city: 'Guatemala City', country: 'Guatemala' }, { code: 'MGA', name: 'Augusto C Sandino Intl', city: 'Managua', country: 'Nicaragua' }, { code: 'TGU', name: 'Toncontin Intl', city: 'Tegucigalpa', country: 'Honduras' }, { code: 'BZE', name: 'Philip S W Goldson Intl', city: 'Belize City', country: 'Belize' },
            // CARIBBEAN
            { code: 'MBJ', name: 'Sangster Intl', city: 'Montego Bay', country: 'Jamaica' }, { code: 'KIN', name: 'Norman Manley Intl', city: 'Kingston', country: 'Jamaica' }, { code: 'NAS', name: 'Lynden Pindling Intl', city: 'Nassau', country: 'Bahamas' }, { code: 'PUJ', name: 'Punta Cana Intl', city: 'Punta Cana', country: 'Dominican Republic' }, { code: 'SDQ', name: 'Las Americas Intl', city: 'Santo Domingo', country: 'Dominican Republic' }, { code: 'SJU', name: 'Luis Munoz Marin Intl', city: 'San Juan', country: 'Puerto Rico' }, { code: 'HAV', name: 'Jose Marti Intl', city: 'Havana', country: 'Cuba' }, { code: 'AUA', name: 'Queen Beatrix Intl', city: 'Oranjestad', country: 'Aruba' }, { code: 'CUR', name: 'Curacao Intl', city: 'Willemstad', country: 'Curacao' }, { code: 'SXM', name: 'Princess Juliana Intl', city: 'St Maarten', country: 'Sint Maarten' }, { code: 'BGI', name: 'Grantley Adams Intl', city: 'Bridgetown', country: 'Barbados' }, { code: 'POS', name: 'Piarco Intl', city: 'Port of Spain', country: 'Trinidad and Tobago' }, { code: 'GCM', name: 'Owen Roberts Intl', city: 'Grand Cayman', country: 'Cayman Islands' }, { code: 'UVF', name: 'Hewanorra Intl', city: 'St Lucia', country: 'Saint Lucia' }, { code: 'ANU', name: 'V C Bird Intl', city: 'St Johns', country: 'Antigua and Barbuda' }, { code: 'TAB', name: 'Tobago A N R Robinson Intl', city: 'Tobago', country: 'Trinidad and Tobago' },
            // SOUTH AMERICA
            { code: 'GRU', name: 'Sao Paulo Guarulhos Intl', city: 'Sao Paulo', country: 'Brazil' }, { code: 'GIG', name: 'Rio de Janeiro Galeao Intl', city: 'Rio de Janeiro', country: 'Brazil' }, { code: 'BSB', name: 'Brasilia Intl', city: 'Brasilia', country: 'Brazil' }, { code: 'CNF', name: 'Belo Horizonte Confins Intl', city: 'Belo Horizonte', country: 'Brazil' }, { code: 'SSA', name: 'Salvador Intl', city: 'Salvador', country: 'Brazil' }, { code: 'REC', name: 'Recife Guararapes Intl', city: 'Recife', country: 'Brazil' }, { code: 'FOR', name: 'Fortaleza Pinto Martins Intl', city: 'Fortaleza', country: 'Brazil' }, { code: 'POA', name: 'Porto Alegre Salgado Filho Intl', city: 'Porto Alegre', country: 'Brazil' }, { code: 'CWB', name: 'Curitiba Afonso Pena Intl', city: 'Curitiba', country: 'Brazil' }, { code: 'MAO', name: 'Eduardo Gomes Intl', city: 'Manaus', country: 'Brazil' }, { code: 'FLN', name: 'Florianopolis Intl', city: 'Florianopolis', country: 'Brazil' }, { code: 'VCP', name: 'Viracopos Intl', city: 'Campinas', country: 'Brazil' }, { code: 'EZE', name: 'Buenos Aires Ezeiza Intl', city: 'Buenos Aires', country: 'Argentina' }, { code: 'AEP', name: 'Buenos Aires Aeroparque', city: 'Buenos Aires', country: 'Argentina' }, { code: 'COR', name: 'Cordoba Intl', city: 'Cordoba', country: 'Argentina' }, { code: 'MDZ', name: 'Mendoza Intl', city: 'Mendoza', country: 'Argentina' }, { code: 'IGR', name: 'Iguazu Intl', city: 'Puerto Iguazu', country: 'Argentina' }, { code: 'BRC', name: 'San Carlos de Bariloche', city: 'Bariloche', country: 'Argentina' }, { code: 'SCL', name: 'Santiago Arturo Merino Benitez Intl', city: 'Santiago', country: 'Chile' }, { code: 'LIM', name: 'Lima Jorge Chavez Intl', city: 'Lima', country: 'Peru' }, { code: 'CUZ', name: 'Alejandro Velasco Astete Intl', city: 'Cusco', country: 'Peru' }, { code: 'BOG', name: 'Bogota El Dorado Intl', city: 'Bogota', country: 'Colombia' }, { code: 'MDE', name: 'Medellin Jose Maria Cordova Intl', city: 'Medellin', country: 'Colombia' }, { code: 'CTG', name: 'Cartagena Rafael Nunez Intl', city: 'Cartagena', country: 'Colombia' }, { code: 'CLO', name: 'Cali Alfonso Bonilla Aragon Intl', city: 'Cali', country: 'Colombia' }, { code: 'UIO', name: 'Quito Mariscal Sucre Intl', city: 'Quito', country: 'Ecuador' }, { code: 'GYE', name: 'Guayaquil Jose Joaquin de Olmedo Intl', city: 'Guayaquil', country: 'Ecuador' }, { code: 'GPS', name: 'Galapagos Seymour', city: 'Galapagos', country: 'Ecuador' }, { code: 'CCS', name: 'Caracas Simon Bolivar Intl', city: 'Caracas', country: 'Venezuela' }, { code: 'LPB', name: 'La Paz El Alto Intl', city: 'La Paz', country: 'Bolivia' }, { code: 'VVI', name: 'Santa Cruz Viru Viru Intl', city: 'Santa Cruz', country: 'Bolivia' }, { code: 'ASU', name: 'Asuncion Silvio Pettirossi Intl', city: 'Asuncion', country: 'Paraguay' }, { code: 'MVD', name: 'Montevideo Carrasco Intl', city: 'Montevideo', country: 'Uruguay' }, { code: 'PBM', name: 'Paramaribo Johan Adolf Pengel Intl', city: 'Paramaribo', country: 'Suriname' }, { code: 'GEO', name: 'Georgetown Cheddi Jagan Intl', city: 'Georgetown', country: 'Guyana' },
            // AFRICA
            { code: 'JNB', name: 'O R Tambo Intl', city: 'Johannesburg', country: 'South Africa' }, { code: 'CPT', name: 'Cape Town Intl', city: 'Cape Town', country: 'South Africa' }, { code: 'DUR', name: 'King Shaka Intl', city: 'Durban', country: 'South Africa' }, { code: 'CAI', name: 'Cairo Intl', city: 'Cairo', country: 'Egypt' }, { code: 'HRG', name: 'Hurghada Intl', city: 'Hurghada', country: 'Egypt' }, { code: 'SSH', name: 'Sharm El Sheikh Intl', city: 'Sharm El Sheikh', country: 'Egypt' }, { code: 'LXR', name: 'Luxor Intl', city: 'Luxor', country: 'Egypt' }, { code: 'ALG', name: 'Algiers Houari Boumediene', city: 'Algiers', country: 'Algeria' }, { code: 'CMN', name: 'Casablanca Mohammed V Intl', city: 'Casablanca', country: 'Morocco' }, { code: 'RAK', name: 'Marrakech Menara', city: 'Marrakech', country: 'Morocco' }, { code: 'TUN', name: 'Tunis Carthage Intl', city: 'Tunis', country: 'Tunisia' }, { code: 'NBO', name: 'Jomo Kenyatta Intl', city: 'Nairobi', country: 'Kenya' }, { code: 'MBA', name: 'Moi Intl', city: 'Mombasa', country: 'Kenya' }, { code: 'ADD', name: 'Bole Intl', city: 'Addis Ababa', country: 'Ethiopia' }, { code: 'EBB', name: 'Entebbe Intl', city: 'Kampala', country: 'Uganda' }, { code: 'DAR', name: 'Julius Nyerere Intl', city: 'Dar es Salaam', country: 'Tanzania' }, { code: 'ZNZ', name: 'Abeid Amani Karume Intl', city: 'Zanzibar', country: 'Tanzania' }, { code: 'JRO', name: 'Kilimanjaro Intl', city: 'Kilimanjaro', country: 'Tanzania' }, { code: 'KGL', name: 'Kigali Intl', city: 'Kigali', country: 'Rwanda' }, { code: 'ACC', name: 'Kotoka Intl', city: 'Accra', country: 'Ghana' }, { code: 'LOS', name: 'Murtala Muhammed Intl', city: 'Lagos', country: 'Nigeria' }, { code: 'ABV', name: 'Nnamdi Azikiwe Intl', city: 'Abuja', country: 'Nigeria' }, { code: 'DSS', name: 'Blaise Diagne Intl', city: 'Dakar', country: 'Senegal' }, { code: 'ABJ', name: 'Felix Houphouet-Boigny Intl', city: 'Abidjan', country: 'Ivory Coast' }, { code: 'ROB', name: 'Roberts Intl', city: 'Monrovia', country: 'Liberia' }, { code: 'FNA', name: 'Lungi Intl', city: 'Freetown', country: 'Sierra Leone' }, { code: 'DKR', name: 'Leopold Sedar Senghor Intl', city: 'Dakar', country: 'Senegal' }, { code: 'TIP', name: 'Tripoli Mitiga Intl', city: 'Tripoli', country: 'Libya' }, { code: 'KRT', name: 'Khartoum Intl', city: 'Khartoum', country: 'Sudan' }, { code: 'LUN', name: 'Kenneth Kaunda Intl', city: 'Lusaka', country: 'Zambia' }, { code: 'HRE', name: 'Robert Gabriel Mugabe Intl', city: 'Harare', country: 'Zimbabwe' }, { code: 'VFA', name: 'Victoria Falls Intl', city: 'Victoria Falls', country: 'Zimbabwe' }, { code: 'WDH', name: 'Hosea Kutako Intl', city: 'Windhoek', country: 'Namibia' }, { code: 'GBE', name: 'Sir Seretse Khama Intl', city: 'Gaborone', country: 'Botswana' }, { code: 'MPM', name: 'Maputo Intl', city: 'Maputo', country: 'Mozambique' }, { code: 'TNR', name: 'Antananarivo Ivato Intl', city: 'Antananarivo', country: 'Madagascar' }, { code: 'MRU', name: 'Sir Seewoosagur Ramgoolam Intl', city: 'Mauritius', country: 'Mauritius' }, { code: 'SEZ', name: 'Seychelles Intl', city: 'Victoria', country: 'Seychelles' }, { code: 'RUN', name: 'Roland Garros', city: 'Saint-Denis', country: 'Reunion' },
            // AUSTRALIA & NEW ZEALAND & OCEANIA
            { code: 'SYD', name: 'Sydney Kingsford Smith', city: 'Sydney', country: 'Australia' }, { code: 'MEL', name: 'Melbourne Tullamarine', city: 'Melbourne', country: 'Australia' }, { code: 'BNE', name: 'Brisbane', city: 'Brisbane', country: 'Australia' }, { code: 'PER', name: 'Perth', city: 'Perth', country: 'Australia' }, { code: 'ADL', name: 'Adelaide', city: 'Adelaide', country: 'Australia' }, { code: 'CBR', name: 'Canberra', city: 'Canberra', country: 'Australia' }, { code: 'OOL', name: 'Gold Coast', city: 'Gold Coast', country: 'Australia' }, { code: 'CNS', name: 'Cairns', city: 'Cairns', country: 'Australia' }, { code: 'DRW', name: 'Darwin Intl', city: 'Darwin', country: 'Australia' }, { code: 'HBA', name: 'Hobart Intl', city: 'Hobart', country: 'Australia' }, { code: 'TSV', name: 'Townsville', city: 'Townsville', country: 'Australia' }, { code: 'AKL', name: 'Auckland Intl', city: 'Auckland', country: 'New Zealand' }, { code: 'WLG', name: 'Wellington Intl', city: 'Wellington', country: 'New Zealand' }, { code: 'CHC', name: 'Christchurch Intl', city: 'Christchurch', country: 'New Zealand' }, { code: 'ZQN', name: 'Queenstown', city: 'Queenstown', country: 'New Zealand' }, { code: 'DUD', name: 'Dunedin Intl', city: 'Dunedin', country: 'New Zealand' }, { code: 'NAN', name: 'Nadi Intl', city: 'Nadi', country: 'Fiji' }, { code: 'SUV', name: 'Suva Nausori Intl', city: 'Suva', country: 'Fiji' }, { code: 'PPT', name: 'Faa a Intl', city: 'Papeete', country: 'French Polynesia' }, { code: 'NOU', name: 'La Tontouta Intl', city: 'Noumea', country: 'New Caledonia' }, { code: 'APW', name: 'Faleolo Intl', city: 'Apia', country: 'Samoa' }, { code: 'TBU', name: 'Fua amotu Intl', city: 'Nuku alofa', country: 'Tonga' }, { code: 'VLI', name: 'Bauerfield Intl', city: 'Port Vila', country: 'Vanuatu' }, { code: 'GUM', name: 'Antonio B Won Pat Intl', city: 'Guam', country: 'Guam' }, { code: 'POM', name: 'Jacksons Intl', city: 'Port Moresby', country: 'Papua New Guinea' },
            // SOUTH ASIA (Pakistan, Bangladesh, Nepal, etc)
            { code: 'KHI', name: 'Jinnah Intl', city: 'Karachi', country: 'Pakistan' }, { code: 'LHE', name: 'Allama Iqbal Intl', city: 'Lahore', country: 'Pakistan' }, { code: 'ISB', name: 'Islamabad Intl', city: 'Islamabad', country: 'Pakistan' }, { code: 'PEW', name: 'Peshawar Intl', city: 'Peshawar', country: 'Pakistan' }, { code: 'DAC', name: 'Hazrat Shahjalal Intl', city: 'Dhaka', country: 'Bangladesh' }, { code: 'CGP', name: 'Shah Amanat Intl', city: 'Chittagong', country: 'Bangladesh' }, { code: 'KTM', name: 'Tribhuvan Intl', city: 'Kathmandu', country: 'Nepal' }, { code: 'MLE', name: 'Velana Intl', city: 'Male', country: 'Maldives' }, { code: 'CMB', name: 'Bandaranaike Intl', city: 'Colombo', country: 'Sri Lanka' }, { code: 'HRI', name: 'Mattala Rajapaksa Intl', city: 'Hambantota', country: 'Sri Lanka' }, { code: 'PBH', name: 'Paro Intl', city: 'Paro', country: 'Bhutan' }, { code: 'GAN', name: 'Gan Intl', city: 'Addu City', country: 'Maldives' },
            // CENTRAL ASIA
            { code: 'TAS', name: 'Tashkent Intl', city: 'Tashkent', country: 'Uzbekistan' }, { code: 'ALA', name: 'Almaty Intl', city: 'Almaty', country: 'Kazakhstan' }, { code: 'NQZ', name: 'Nursultan Nazarbayev Intl', city: 'Astana', country: 'Kazakhstan' }, { code: 'FRU', name: 'Manas Intl', city: 'Bishkek', country: 'Kyrgyzstan' }, { code: 'DYU', name: 'Dushanbe Intl', city: 'Dushanbe', country: 'Tajikistan' }, { code: 'ASB', name: 'Ashgabat Intl', city: 'Ashgabat', country: 'Turkmenistan' }, { code: 'GYD', name: 'Heydar Aliyev Intl', city: 'Baku', country: 'Azerbaijan' }, { code: 'TBS', name: 'Tbilisi Intl', city: 'Tbilisi', country: 'Georgia' }, { code: 'EVN', name: 'Zvartnots Intl', city: 'Yerevan', country: 'Armenia' }
        ];

        let activeDropdown = null;

        function searchAirport(input, dropdownId) {
            const query = input.value.toLowerCase().trim();
            const dropdown = document.getElementById(dropdownId);

            if (query.length < 1) {
                dropdown.classList.remove('active');
                return;
            }

            const matches = airports.filter(airport =>
                airport.code.toLowerCase().includes(query) ||
                airport.city.toLowerCase().includes(query) ||
                airport.name.toLowerCase().includes(query) ||
                airport.country.toLowerCase().includes(query)
            ).slice(0, 8);

            displayAirportResults(matches, dropdown, input);
        }

        function showRecentAirports(dropdownId) {
            const dropdown = document.getElementById(dropdownId);
            const input = dropdown.previousElementSibling;

            if (input.value.trim().length > 0) return;

            // Show popular airports when focused with empty input
            const popular = airports.slice(0, 6);
            displayAirportResults(popular, dropdown, input, true);
        }

        function displayAirportResults(results, dropdown, input, isPopular = false) {
            if (results.length === 0) {
                dropdown.innerHTML = '<div class="airport-item" style="color:#888;justify-content:center;">No airports found</div>';
                dropdown.classList.add('active');
                return;
            }

            const header = isPopular ? '<div style="padding:8px 15px;background:#f8f9fa;color:#666;font-size:0.8rem;font-weight:600;">Popular Airports</div>' : '';

            dropdown.innerHTML = header + results.map(airport => `
                <div class="airport-item" onclick="selectAirport('${airport.code}', '${airport.city}', '${input.id}', '${dropdown.id}')">
                    <i class="fas fa-plane-departure airport-icon"></i>
                    <span class="airport-code">${airport.code}</span>
                    <div class="airport-info">
                        <div class="airport-name">${airport.city}</div>
                        <div class="airport-city">${airport.name}</div>
                    </div>
                </div>
            `).join('');

            dropdown.classList.add('active');
            activeDropdown = dropdown;
        }

        function selectAirport(code, city, inputId, dropdownId) {
            const input = document.getElementById(inputId);
            input.value = code;
            document.getElementById(dropdownId).classList.remove('active');
            activeDropdown = null;
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function (e) {
            if (!e.target.closest('.airport-input-container')) {
                document.querySelectorAll('.airport-autocomplete').forEach(d => d.classList.remove('active'));
                activeDropdown = null;
            }
        });

        // Keyboard navigation for dropdowns
        document.addEventListener('keydown', function (e) {
            if (!activeDropdown) return;

            const items = activeDropdown.querySelectorAll('.airport-item[onclick]');
            if (items.length === 0) return;

            let selectedIndex = Array.from(items).findIndex(item => item.classList.contains('selected'));

            if (e.key === 'ArrowDown') {
                e.preventDefault();
                items.forEach(item => item.classList.remove('selected'));
                selectedIndex = (selectedIndex + 1) % items.length;
                items[selectedIndex].classList.add('selected');
                items[selectedIndex].scrollIntoView({ block: 'nearest' });
            } else if (e.key === 'ArrowUp') {
                e.preventDefault();
                items.forEach(item => item.classList.remove('selected'));
                selectedIndex = selectedIndex <= 0 ? items.length - 1 : selectedIndex - 1;
                items[selectedIndex].classList.add('selected');
                items[selectedIndex].scrollIntoView({ block: 'nearest' });
            } else if (e.key === 'Enter' && selectedIndex >= 0) {
                e.preventDefault();
                items[selectedIndex].click();
            } else if (e.key === 'Escape') {
                activeDropdown.classList.remove('active');
                activeDropdown = null;
            }
        });

        // Parse SerpAPI flight results into our format
        function parseFlightResults(data, from, to) {
            const flights = [];

            // Check for best_flights or other_flights in the response
            const allFlights = [...(data.best_flights || []), ...(data.other_flights || [])];

            for (const flightGroup of allFlights.slice(0, 15)) { // Limit to 15 results
                if (flightGroup.flights && flightGroup.flights.length > 0) {
                    const firstLeg = flightGroup.flights[0];
                    const lastLeg = flightGroup.flights[flightGroup.flights.length - 1];
                    const price = flightGroup.price || 0;

                    // Get layover info
                    const layovers = flightGroup.layovers || [];
                    const layoverInfo = layovers.length > 0
                        ? layovers.map(l => `${l.name} (${Math.floor(l.duration / 60)}h ${l.duration % 60}m)`).join(', ')
                        : null;

                    flights.push({
                        airline: firstLeg.airline || 'Unknown Airline',
                        airlineLogo: firstLeg.airline_logo || flightGroup.airline_logo || null,
                        from: firstLeg.departure_airport?.id || from,
                        fromName: firstLeg.departure_airport?.name || from,
                        to: lastLeg.arrival_airport?.id || to,
                        toName: lastLeg.arrival_airport?.name || to,
                        departure: firstLeg.departure_airport?.time || 'N/A',
                        arrival: lastLeg.arrival_airport?.time || 'N/A',
                        duration: flightGroup.total_duration ? `${Math.floor(flightGroup.total_duration / 60)}h ${flightGroup.total_duration % 60}m` : 'N/A',
                        durationMins: flightGroup.total_duration || 999,
                        price: price ? `‚Çπ${price.toLocaleString('en-IN')}` : 'Price N/A',
                        priceNum: price,
                        stops: flightGroup.flights.length === 1 ? 'Non-stop' : `${flightGroup.flights.length - 1} stop(s)`,
                        stopsCount: flightGroup.flights.length - 1,
                        layoverInfo: layoverInfo,
                        flightNumber: firstLeg.flight_number || null,
                        travelClass: firstLeg.travel_class || null,
                        bookingToken: flightGroup.booking_token || null
                    });
                }
            }

            return flights;
        }

        // Search overlay helper functions
        let searchAbortController = null;
        let progressInterval = null;

        function showSearchOverlay(from, to, depart, passengers, travelClass) {
            const overlay = document.getElementById('search-overlay');
            const progressBar = document.getElementById('progress-bar');

            // Set route info
            document.getElementById('overlay-from').textContent = from;
            document.getElementById('overlay-to').textContent = to;
            document.getElementById('overlay-from-name').textContent = 'Departure';
            document.getElementById('overlay-to-name').textContent = 'Arrival';

            // Set search info
            const dateObj = new Date(depart);
            const formattedDate = dateObj.toLocaleDateString('en-IN', {
                weekday: 'short', day: 'numeric', month: 'short'
            });
            document.getElementById('overlay-date').textContent = formattedDate;
            document.getElementById('overlay-passengers').textContent =
                passengers == 1 ? '1 Passenger' : `${passengers} Passengers`;

            const classNames = { '1': 'Economy', '2': 'Premium Economy', '3': 'Business', '4': 'First Class' };
            document.getElementById('overlay-class').textContent = classNames[travelClass] || 'Economy';

            // Reset progress
            progressBar.style.width = '0%';
            updateSearchStatus('Searching for best flights...', 'Connecting to airlines');

            // Show overlay with animation
            overlay.classList.add('active');
            overlay.classList.remove('fade-out');
            document.body.style.overflow = 'hidden';

            // Start progress animation
            startProgressAnimation();
        }

        function hideSearchOverlay() {
            const overlay = document.getElementById('search-overlay');
            overlay.classList.add('fade-out');

            if (progressInterval) {
                clearInterval(progressInterval);
                progressInterval = null;
            }

            setTimeout(() => {
                overlay.classList.remove('active', 'fade-out');
                document.body.style.overflow = '';
            }, 400);
        }

        function updateSearchStatus(status, substatus) {
            document.getElementById('search-status').textContent = status;
            document.getElementById('search-substatus').textContent = substatus;
        }

        function updateProgress(percent) {
            document.getElementById('progress-bar').style.width = `${percent}%`;
        }

        function startProgressAnimation() {
            const stages = [
                { percent: 15, status: 'Connecting to airlines...', substatus: 'Establishing connections' },
                { percent: 30, status: 'Searching Air India, IndiGo...', substatus: 'Checking domestic flights' },
                { percent: 45, status: 'Checking Emirates, Qatar...', substatus: 'Searching international routes' },
                { percent: 60, status: 'Comparing prices...', substatus: 'Finding the best deals' },
                { percent: 75, status: 'Analyzing options...', substatus: 'Sorting by relevance' },
                { percent: 85, status: 'Finalizing results...', substatus: 'Almost there' }
            ];

            let stageIndex = 0;
            progressInterval = setInterval(() => {
                if (stageIndex < stages.length) {
                    const stage = stages[stageIndex];
                    updateProgress(stage.percent);
                    updateSearchStatus(stage.status, stage.substatus);
                    stageIndex++;
                }
            }, 800);
        }

        function cancelSearch() {
            if (searchAbortController) {
                searchAbortController.abort();
                searchAbortController = null;
            }
            hideSearchOverlay();
        }

        // SECURITY: Validate flight search inputs before submitting
        function validateFlightSearch(from, to, depart, returnDate) {
            const errors = [];

            if (!from) {
                errors.push('Departure airport is required');
            } else if (!isValidAirportCode(from)) {
                errors.push('Departure must be a valid 3-letter airport code (e.g., DEL)');
            }

            if (!to) {
                errors.push('Arrival airport is required');
            } else if (!isValidAirportCode(to)) {
                errors.push('Arrival must be a valid 3-letter airport code (e.g., DXB)');
            }

            if (!depart) {
                errors.push('Departure date is required');
            } else if (!isValidDate(depart)) {
                errors.push('Please select a valid departure date (today or future)');
            }

            if (returnDate && !isValidDate(returnDate)) {
                errors.push('Please select a valid return date');
            }

            if (returnDate && depart && new Date(returnDate) < new Date(depart)) {
                errors.push('Return date must be after departure date');
            }

            return errors;
        }

        async function searchFlights() {
            const from = sanitizeString(document.getElementById('flight-from').value, 10).toUpperCase();
            const to = sanitizeString(document.getElementById('flight-to').value, 10).toUpperCase();
            const depart = document.getElementById('flight-depart').value;
            const returnDate = document.getElementById('flight-return').value;
            const travelClass = document.getElementById('flight-class').value;
            const stops = document.getElementById('flight-stops').value;
            const passengers = document.getElementById('flight-passengers').value;
            const sortBy = document.getElementById('flight-sort').value;
            const resultsDiv = document.getElementById('flight-results');

            // SECURITY: Validate all inputs before sending to backend
            const validationErrors = validateFlightSearch(from, to, depart, returnDate);
            if (validationErrors.length > 0) {
                alert(validationErrors.join('\n'));
                return;
            }

            // Show full-page overlay
            showSearchOverlay(from, to, depart, passengers, travelClass);
            resultsDiv.innerHTML = '';

            let flights = [];
            searchAbortController = new AbortController();

            try {
                // SECURITY: All API calls go through secure backend - no client-side API keys
                console.log('Calling secure backend API for flights...');
                updateSearchStatus('Connecting to VOYA servers...', 'Fetching live prices');

                const response = await fetch(`${API_BASE_URL}/api/flights/search`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    signal: searchAbortController.signal,
                    body: JSON.stringify({
                        departure_id: from,
                        arrival_id: to,
                        outbound_date: depart,
                        return_date: returnDate || undefined,
                        currency: 'INR',
                        travel_class: travelClass,
                        stops: stops,
                        adults: passengers,
                        sort_by: sortBy
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    updateProgress(85);
                    updateSearchStatus('Processing results...', 'Found flight options');

                    if (data.flights && data.flights.length > 0) {
                        flights = data.flights.map(f => ({
                            airline: escapeHtml(f.airline),
                            airlineLogo: f.airline_logo || null,
                            from: escapeHtml(f.from),
                            to: escapeHtml(f.to),
                            departure: escapeHtml(f.departure_time),
                            arrival: escapeHtml(f.arrival_time),
                            duration: escapeHtml(f.duration),
                            price: escapeHtml(f.price_formatted),
                            priceNum: f.price || 0,
                            stops: escapeHtml(f.stops),
                            tripType: f.trip_type || 'One way',
                            bookingToken: f.booking_token || null,
                            // Return flight for round trips
                            returnFlight: f.return_flight ? {
                                airline: escapeHtml(f.return_flight.airline),
                                airlineLogo: f.return_flight.airline_logo || null,
                                from: escapeHtml(f.return_flight.from),
                                to: escapeHtml(f.return_flight.to),
                                departure: escapeHtml(f.return_flight.departure_time),
                                arrival: escapeHtml(f.return_flight.arrival_time),
                                duration: escapeHtml(f.return_flight.duration),
                                stops: escapeHtml(f.return_flight.stops)
                            } : null
                        }));
                    }
                } else {
                    // SECURITY: Handle error responses including rate limits
                    const errorMessage = await handleErrorResponse(response);
                    console.error('Flight search failed:', errorMessage);
                    hideSearchOverlay();
                    resultsDiv.innerHTML = `<div class="error-message"><strong>Error:</strong> ${escapeHtml(errorMessage)}</div>`;
                    searchAbortController = null;
                    return;
                }
            } catch (err) {
                if (err.name === 'AbortError') {
                    console.log('Search was cancelled');
                    return;
                }
                console.error('Flight search error:', err.message);
                hideSearchOverlay();
                resultsDiv.innerHTML = `<div class="error-message"><strong>Error:</strong> Unable to connect to server. Please check your internet connection and try again.</div>`;
                searchAbortController = null;
                return;
            }

            // Finalize and show results
            updateProgress(100);
            updateSearchStatus('Complete!', `Found ${flights.length} flights`);

            // Small delay to show completion state
            await new Promise(resolve => setTimeout(resolve, 600));

            hideSearchOverlay();
            displayFlights(flights, resultsDiv);

            searchAbortController = null;
        }

        function displayFlights(flights, container) {
            if (!flights || flights.length === 0) {
                container.innerHTML = '<div class="no-results"><i class="fas fa-plane" style="font-size:3rem;margin-bottom:15px;color:#ccc;"></i><br>No flights found for your search criteria.</div>';
                return;
            }

            // Helper function to format time nicely
            function formatFlightTime(timeStr) {
                if (!timeStr || timeStr === 'N/A') return { time: '--:--', date: '', period: '', fullDate: '', weekday: '' };
                const timeMatch = timeStr.match(/(\d{1,2}):(\d{2})\s*(AM|PM)?/i);
                const dateMatch = timeStr.match(/(\d{4}-\d{2}-\d{2})/);
                let time = '--:--', period = '', date = '', fullDate = '', weekday = '';
                if (timeMatch) {
                    let hours = parseInt(timeMatch[1]);
                    const mins = timeMatch[2];
                    period = timeMatch[3] ? timeMatch[3].toUpperCase() : '';
                    if (!period) { period = hours >= 12 ? 'PM' : 'AM'; hours = hours % 12 || 12; }
                    time = `${hours}:${mins}`;
                }
                if (dateMatch) {
                    const d = new Date(dateMatch[1]);
                    date = d.toLocaleDateString('en-IN', { day: 'numeric', month: 'short' });
                    fullDate = d.toLocaleDateString('en-IN', { weekday: 'short', day: 'numeric', month: 'short' });
                    weekday = d.toLocaleDateString('en-IN', { weekday: 'short' });
                }
                return { time, date, period, fullDate, weekday };
            }

            // MakeMyTrip-style section with header and table
            function renderFlightTableSection(legData, sectionType, airlineData, price = null) {
                const dep = formatFlightTime(legData.departure);
                const arr = formatFlightTime(legData.arrival);
                const stopsMatch = legData.stops?.match(/(\d+)/);
                const numStops = stopsMatch ? parseInt(stopsMatch[1]) : (legData.stops?.toLowerCase().includes('non') ? 0 : 0);
                const stopsColor = numStops === 0 ? '#28a745' : '#ff9800';
                const stopsText = numStops === 0 ? 'Non stop' : legData.stops;

                const isReturn = sectionType === 'return';
                const headerBg = '#003580'; // Dark blue header like MakeMyTrip
                const routeText = `${legData.from} ‚Üí ${legData.to}`;
                const dateText = dep.fullDate || dep.date || '';

                // Handle missing times - only for edge cases where API returns N/A
                const isMissingTime = dep.time === 'N/A' || legData.departure === 'N/A';
                const depTimeDisplay = isMissingTime ? 'N/A' : dep.time;
                const arrTimeDisplay = isMissingTime ? 'N/A' : arr.time;
                const timeStyle = isMissingTime ? 'font-size:1rem;font-weight:500;color:#888;' : 'font-size:1.3rem;font-weight:700;color:#222;';

                const airlineDisplay = airlineData?.logo
                    ? `<img src="${airlineData.logo}" alt="${airlineData.name}" style="height:24px;margin-right:8px;vertical-align:middle;border-radius:3px;">`
                    : `<i class="fas fa-plane" style="margin-right:8px;font-size:1rem;color:#f57c00;"></i>`;

                return `
                    <div style="flex:1;min-width:300px;border:1px solid #ddd;border-radius:8px;overflow:hidden;background:#fff;">
                        <!-- Section Header - Dark like MakeMyTrip -->
                        <div style="background:${headerBg};padding:12px 16px;color:#fff;">
                            <div style="display:flex;justify-content:space-between;align-items:center;">
                                <div style="font-size:1rem;font-weight:600;">${routeText}</div>
                                <div style="font-size:0.85rem;opacity:0.9;">${dateText}</div>
                            </div>
                        </div>
                        
                        <!-- Table Header Row -->
                        <div style="display:grid;grid-template-columns:1fr 1fr 1fr ${price ? '1fr' : ''};background:#f5f5f5;border-bottom:1px solid #e0e0e0;">
                            <div style="padding:10px 12px;font-size:0.75rem;font-weight:600;color:#666;text-transform:uppercase;">Departure</div>
                            <div style="padding:10px 12px;font-size:0.75rem;font-weight:600;color:#666;text-transform:uppercase;text-align:center;">Duration</div>
                            <div style="padding:10px 12px;font-size:0.75rem;font-weight:600;color:#666;text-transform:uppercase;text-align:right;">Arrival</div>
                            ${price ? '<div style="padding:10px 12px;font-size:0.75rem;font-weight:600;color:#666;text-transform:uppercase;text-align:right;">Price ‚Üë</div>' : ''}
                        </div>
                        
                        <!-- Flight Row -->
                        <div style="padding:16px;border-left:3px solid ${isReturn ? '#1976d2' : '#f57c00'};">
                            <!-- Airline Info -->
                            <div style="display:flex;align-items:center;margin-bottom:12px;">
                                ${airlineDisplay}
                                <span style="font-size:0.9rem;font-weight:500;color:#333;">${airlineData?.name || 'Airline'}</span>
                            </div>
                            
                            <!-- Time Row with Duration -->
                            <div style="display:grid;grid-template-columns:1fr 1fr 1fr ${price ? '1fr' : ''};align-items:center;">
                                <!-- Departure Time -->
                                <div>
                                    <div style="${timeStyle}">${depTimeDisplay}</div>
                                    <div style="font-size:0.75rem;color:#666;">${legData.from}</div>
                                </div>
                                
                                <!-- Duration & Stops -->
                                <div style="text-align:center;">
                                    <div style="font-size:0.8rem;color:#666;margin-bottom:4px;">${isMissingTime ? 'TBC' : legData.duration}</div>
                                    <div style="position:relative;height:2px;background:#ddd;margin:0 10px;">
                                        <div style="position:absolute;left:0;top:-2px;width:6px;height:6px;background:#003580;border-radius:50%;"></div>
                                        <div style="position:absolute;right:0;top:-2px;width:6px;height:6px;background:#003580;border-radius:50%;"></div>
                                    </div>
                                    <div style="font-size:0.7rem;color:${stopsColor};margin-top:4px;font-weight:600;">${stopsText}</div>
                                </div>
                                
                                <!-- Arrival Time -->
                                <div style="text-align:right;">
                                    <div style="${timeStyle}">${arrTimeDisplay}</div>
                                    <div style="font-size:0.75rem;color:#666;">${legData.to}</div>
                                </div>
                                
                                ${price ? `
                                <!-- Price Column -->
                                <div style="text-align:right;">
                                    <div style="font-size:1.2rem;font-weight:700;color:#003580;">${price}</div>
                                    <div style="font-size:0.65rem;color:#888;">/adult</div>
                                </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>`;
            }

            const html = flights.map(flight => {
                const airlineDisplay = flight.airlineLogo
                    ? `<img src="${flight.airlineLogo}" alt="${flight.airline}" style="height:28px;margin-right:10px;vertical-align:middle;border-radius:4px;">`
                    : '<i class="fas fa-plane" style="margin-right:10px;font-size:1.2rem;color:var(--accent-blue);"></i>';

                const isRoundTrip = flight.tripType === 'Round trip' && flight.returnFlight;

                // One-way flight: simple single section
                if (!isRoundTrip) {
                    return `
                    <div style="background:#fff;border-radius:12px;box-shadow:0 2px 12px rgba(0,0,0,0.08);margin-bottom:16px;overflow:hidden;border:1px solid #e0e0e0;">
                        ${renderFlightTableSection({
                        from: flight.from,
                        to: flight.to,
                        departure: flight.departure,
                        arrival: flight.arrival,
                        duration: flight.duration,
                        stops: flight.stops
                    }, 'onward', { name: flight.airline, logo: flight.airlineLogo }, flight.price)}
                        
                        <div style="padding:12px 16px;background:#f8f9fa;border-top:1px solid #e0e0e0;display:flex;justify-content:flex-end;">
                            <button onclick="bookFlight('${flight.from}', '${flight.to}', '${flight.airline}', '${flight.bookingToken || ''}')" style="background:linear-gradient(135deg, #003580 0%, #1a73e8 100%);color:#fff;border:none;padding:10px 28px;border-radius:8px;font-weight:600;font-size:0.9rem;cursor:pointer;transition:all 0.3s ease;box-shadow:0 2px 8px rgba(0,53,128,0.3);">
                                <i class="fas fa-bolt" style="margin-right:6px;"></i>Book Now
                            </button>
                        </div>
                    </div>`;
                }

                // Round-trip: MakeMyTrip-style TWO SEPARATE SECTIONS side by side
                const returnAirline = flight.returnFlight.airline || flight.airline;
                const returnLogo = flight.returnFlight.airlineLogo || flight.airlineLogo;

                return `
                <div style="background:#fff;border-radius:12px;box-shadow:0 2px 12px rgba(0,0,0,0.08);margin-bottom:20px;overflow:hidden;border:1px solid #e0e0e0;">
                    
                    <!-- TWO SECTIONS SIDE BY SIDE -->
                    <div style="display:flex;flex-wrap:wrap;">
                        <!-- SECTION 1: Outbound (A ‚Üí B) -->
                        <div style="flex:1;min-width:320px;border-right:1px solid #e0e0e0;">
                            ${renderFlightTableSection({
                    from: flight.from,
                    to: flight.to,
                    departure: flight.departure,
                    arrival: flight.arrival,
                    duration: flight.duration,
                    stops: flight.stops
                }, 'onward', { name: flight.airline, logo: flight.airlineLogo }, null)}
                        </div>
                        
                        <!-- SECTION 2: Return (B ‚Üí A) -->
                        <div style="flex:1;min-width:320px;">
                            ${renderFlightTableSection({
                    from: flight.returnFlight.from,
                    to: flight.returnFlight.to,
                    departure: flight.returnFlight.departure,
                    arrival: flight.returnFlight.arrival,
                    duration: flight.returnFlight.duration,
                    stops: flight.returnFlight.stops
                }, 'return', { name: returnAirline, logo: returnLogo }, null)}
                        </div>
                    </div>
                    
                    <!-- Bottom Summary Bar -->
                    <div style="padding:14px 20px;background:linear-gradient(135deg, #fafafa 0%, #f0f0f0 100%);border-top:1px solid #e0e0e0;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:12px;">
                        <div style="display:flex;align-items:center;gap:20px;">
                            <div>
                                <span style="font-size:0.75rem;color:#888;">Departure</span>
                                <div style="font-size:0.85rem;font-weight:600;color:#333;">${flight.airline}</div>
                            </div>
                            <div>
                                <span style="font-size:0.75rem;color:#888;">Return</span>
                                <div style="font-size:0.85rem;font-weight:600;color:#333;">${returnAirline}</div>
                            </div>
                        </div>
                        <div style="display:flex;align-items:center;gap:20px;">
                            <div style="text-align:right;">
                                <div style="font-size:1.5rem;font-weight:700;color:#003580;">${flight.price}</div>
                                <div style="font-size:0.7rem;color:#888;">Total Price</div>
                            </div>
                            <div style="display:flex;flex-direction:column;gap:6px;">
                                <button onclick="bookFlight('${flight.from}', '${flight.to}', '${flight.airline}', '${flight.bookingToken || ''}')" style="background:linear-gradient(135deg, #ff6b35 0%, #f45c22 100%);color:#fff;border:none;padding:12px 32px;border-radius:6px;font-weight:600;font-size:0.95rem;cursor:pointer;transition:all 0.3s ease;box-shadow:0 2px 8px rgba(255,107,53,0.3);">
                                    BOOK NOW
                                </button>
                            </div>
                        </div>
                    </div>
                </div>`;
            }).join('');

            container.innerHTML = html;
        }

        // Parse SerpAPI hotel results into our format
        function parseHotelResults(data, destination) {
            const hotels = [];

            // Check for properties in the response
            const properties = data.properties || [];

            for (const hotel of properties.slice(0, 15)) { // Limit to 15 results
                const amenitiesList = hotel.amenities ? hotel.amenities.slice(0, 4).join(', ') : 'WiFi, AC';
                // Use extracted_lowest (numeric) for sorting, fall back to parsing lowest string
                const priceNum = hotel.rate_per_night?.extracted_lowest ||
                    (hotel.rate_per_night?.lowest ? parseInt(hotel.rate_per_night.lowest.toString().replace(/[^0-9]/g, '')) : 5000) || 5000;
                const ratingNum = hotel.overall_rating || 4.0;
                const thumbnail = hotel.thumbnail || (hotel.images?.[0]?.thumbnail) || null;

                hotels.push({
                    name: hotel.name || 'Hotel',
                    location: hotel.neighborhood || hotel.location || destination,
                    rating: `${ratingNum} ‚òÖ`,
                    ratingNum: ratingNum,
                    amenities: amenitiesList,
                    price: `‚Çπ${priceNum.toLocaleString('en-IN')}/night`,
                    priceNum: priceNum,
                    image: thumbnail ? `<img src="${thumbnail}" alt="${hotel.name}" style="width:60px;height:60px;object-fit:cover;border-radius:8px;">` : 'üè®',
                    hotelClass: hotel.extracted_hotel_class || hotel.hotel_class || null,
                    link: hotel.link || null
                });
            }

            return hotels;
        }

        // SECURITY: Validate hotel search inputs
        function validateHotelSearch(destination, checkin, checkout) {
            const errors = [];

            if (!destination) {
                errors.push('Destination is required');
            } else if (destination.length < 2 || destination.length > 100) {
                errors.push('Destination must be between 2 and 100 characters');
            }

            if (!checkin) {
                errors.push('Check-in date is required');
            } else if (!isValidDate(checkin)) {
                errors.push('Please select a valid check-in date (today or future)');
            }

            if (!checkout) {
                errors.push('Check-out date is required');
            } else if (!isValidDate(checkout)) {
                errors.push('Please select a valid check-out date');
            }

            if (checkin && checkout && new Date(checkout) <= new Date(checkin)) {
                errors.push('Check-out date must be after check-in date');
            }

            return errors;
        }

        async function searchHotels() {
            const destination = sanitizeString(document.getElementById('hotel-dest').value, 100);
            const checkin = document.getElementById('hotel-checkin').value;
            const checkout = document.getElementById('hotel-checkout').value;
            const guests = document.getElementById('hotel-guests').value;
            const rooms = document.getElementById('hotel-rooms').value;
            const minRating = document.getElementById('hotel-rating').value;
            const sortBy = document.getElementById('hotel-sort').value;
            const resultsDiv = document.getElementById('hotel-results');
            const loader = document.getElementById('hotel-loader');

            // SECURITY: Validate all inputs before sending to backend
            const validationErrors = validateHotelSearch(destination, checkin, checkout);
            if (validationErrors.length > 0) {
                alert(validationErrors.join('\n'));
                return;
            }

            loader.style.display = 'block';
            resultsDiv.innerHTML = '';

            let hotels = [];

            try {
                // SECURITY: All API calls go through secure backend - no client-side API keys
                console.log('Calling secure backend API for hotels...');
                const response = await fetch(`${API_BASE_URL}/api/hotels/search`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        destination,
                        check_in_date: checkin,
                        check_out_date: checkout,
                        currency: 'INR',
                        adults: parseInt(guests),
                        sort_by: sortBy || undefined,
                        rating: minRating || undefined
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    if (data.hotels && data.hotels.length > 0) {
                        hotels = data.hotels.map(h => ({
                            name: escapeHtml(h.name),
                            location: escapeHtml(h.location),
                            rating: escapeHtml(h.rating_formatted),
                            ratingNum: h.rating || 0,
                            amenities: escapeHtml(h.amenities_formatted),
                            price: escapeHtml(h.price_formatted),
                            priceNum: h.price ? parseFloat(String(h.price).replace(/[^0-9.]/g, '')) : 0,
                            image: 'üè®',
                            link: h.link || null
                        }));
                    }
                } else {
                    // SECURITY: Handle error responses including rate limits
                    const errorMessage = await handleErrorResponse(response);
                    console.error('Hotel search failed:', errorMessage);
                    loader.style.display = 'none';
                    resultsDiv.innerHTML = `<div class="error-message"><strong>Error:</strong> ${escapeHtml(errorMessage)}</div>`;
                    return;
                }
            } catch (err) {
                console.error('Hotel search error:', err.message);
                loader.style.display = 'none';
                resultsDiv.innerHTML = `<div class="error-message"><strong>Error:</strong> Unable to connect to server. Please check your internet connection and try again.</div>`;
                return;
            }

            loader.style.display = 'none';
            displayHotels(hotels, resultsDiv, checkin, checkout);
        }

        function displayHotels(hotels, container, checkin, checkout) {
            if (!hotels || hotels.length === 0) {
                container.innerHTML = '<div class="no-results"><i class="fas fa-hotel" style="font-size:3rem;margin-bottom:15px;color:#ccc;"></i><br>No hotels found for your search criteria.</div>';
                return;
            }

            const html = hotels.map(hotel => `
                <div class="hotel-card">
                    <div class="hotel-header">
                        <div>
                            <h3 style="margin:0; color: var(--accent-blue);">${hotel.image} ${hotel.name}</h3>
                            <p style="margin:5px 0 0 0; color: var(--gray); font-size:0.9rem;"><i class="fas fa-map-marker-alt"></i> ${hotel.location}</p>
                        </div>
                        <div class="price-tag">${hotel.price}</div>
                    </div>
                    <div class="hotel-details">
                        <div class="detail-item">
                            <span class="detail-label">Rating</span>
                            <span class="detail-value">${hotel.rating}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Check-in</span>
                            <span class="detail-value">${checkin}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Check-out</span>
                            <span class="detail-value">${checkout}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Amenities</span>
                            <span class="detail-value">${hotel.amenities}</span>
                        </div>
                    </div>
                    <button class="btn-book" onclick="bookHotel('${encodeURIComponent(hotel.name)}', '${encodeURIComponent(hotel.location)}', '${hotel.link || ''}')">Book Now</button>
                </div>
            `).join('');

            container.innerHTML = html;
        }

        // Booking functions for flights and hotels
        // Works like Skyscanner - opens Google Flights booking page with all partner options
        function bookFlight(from, to, airline, bookingToken) {
            if (!bookingToken) {
                // No booking token - search on the airline's website directly
                const airlineWebsites = {
                    'IndiGo': 'https://www.goindigo.in/',
                    'Air India': 'https://www.airindia.com/',
                    'SpiceJet': 'https://www.spicejet.com/',
                    'Vistara': 'https://www.airvistara.com/',
                    'AirAsia India': 'https://www.airasia.co.in/',
                    'Go First': 'https://www.flygofirst.com/',
                    'Akasa Air': 'https://www.akasaair.com/'
                };
                const airlineUrl = airlineWebsites[airline] || `https://www.google.com/search?q=${encodeURIComponent(airline)}+book+flight+${encodeURIComponent(from)}+to+${encodeURIComponent(to)}`;
                window.open(airlineUrl, '_blank', 'noopener,noreferrer');
                return;
            }

            // Show loading message
            const loadingToast = showToast('Fetching booking options from ' + airline + '...', 'info');

            // Fetch booking options from our backend API
            fetch(`${API_BASE_URL}/api/flights/booking`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ booking_token: bookingToken })
            })
                .then(res => res.json())
                .then(data => {
                    hideToast(loadingToast);

                    if (data.booking_options && data.booking_options.length > 0) {
                        // Find the airline's direct booking option first, otherwise use first available
                        const airlineOption = data.booking_options.find(opt => opt.is_airline) || data.booking_options[0];

                        if (airlineOption.booking_url) {
                            // Redirect directly to the booking URL
                            window.open(airlineOption.booking_url, '_blank', 'noopener,noreferrer');
                        } else {
                            // Show all options in a modal
                            showBookingOptionsModal(data.booking_options, airline, from, to);
                        }
                    } else {
                        // Fallback to airline website search
                        alert('Could not get booking options. Opening airline website...');
                        const searchUrl = `https://www.google.com/search?q=${encodeURIComponent(airline)}+book+flight+${encodeURIComponent(from)}+to+${encodeURIComponent(to)}`;
                        window.open(searchUrl, '_blank', 'noopener,noreferrer');
                    }
                })
                .catch(err => {
                    hideToast(loadingToast);
                    console.error('Booking API error:', err);
                    // Fallback to Google Flights
                    const bookingUrl = `https://www.google.com/travel/flights?q=flights%20from%20${encodeURIComponent(from)}%20to%20${encodeURIComponent(to)}&hl=en&gl=in&curr=INR`;
                    window.open(bookingUrl, '_blank', 'noopener,noreferrer');
                });
        }

        function showBookingOptionsModal(options, airline, from, to) {
            // Remove existing modal if any
            const existingModal = document.getElementById('booking-modal');
            if (existingModal) existingModal.remove();

            // Create modal HTML
            const modalHtml = `
                <div id="booking-modal" style="position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.8);z-index:9999;display:flex;align-items:center;justify-content:center;padding:20px;">
                    <div style="background:white;border-radius:12px;max-width:500px;width:100%;max-height:80vh;overflow-y:auto;color:#333;">
                        <div style="padding:20px;border-bottom:1px solid #eee;display:flex;justify-content:space-between;align-items:center;">
                            <h3 style="margin:0;color:#003580;">‚úàÔ∏è Book ${airline} - ${from} ‚Üí ${to}</h3>
                            <button onclick="closeBookingModal()" style="background:none;border:none;font-size:1.5rem;cursor:pointer;color:#666;">&times;</button>
                        </div>
                        <div style="padding:20px;">
                            <p style="color:#666;margin-bottom:15px;">Choose where to complete your booking:</p>
                            ${options.map((opt, index) => `
                                <div style="border:1px solid #e0e0e0;border-radius:8px;padding:15px;margin-bottom:10px;cursor:pointer;transition:all 0.2s;${opt.is_airline ? 'border-color:#28a745;background:#f8fff8;' : ''}" 
                                     onclick="openBookingUrl('${encodeURIComponent(opt.booking_url)}')"
                                     onmouseover="this.style.transform='translateY(-2px)';this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)'"
                                     onmouseout="this.style.transform='none';this.style.boxShadow='none'">
                                    <div style="display:flex;justify-content:space-between;align-items:center;">
                                        <div>
                                            <strong style="color:#333;">${opt.book_with}</strong>
                                            ${opt.is_airline ? '<span style="background:#28a745;color:white;font-size:0.7rem;padding:2px 6px;border-radius:4px;margin-left:8px;">‚úì Direct Airline</span>' : ''}
                                            ${opt.option_title ? `<div style="color:#666;font-size:0.85rem;margin-top:4px;">${opt.option_title}</div>` : ''}
                                        </div>
                                        <div style="text-align:right;">
                                            <div style="font-size:1.25rem;font-weight:bold;color:#003580;">${opt.price_formatted}</div>
                                        </div>
                                    </div>
                                    ${opt.baggage_prices && opt.baggage_prices.length > 0 ? `
                                        <div style="margin-top:8px;font-size:0.8rem;color:#888;">
                                            üß≥ ${opt.baggage_prices.slice(0, 2).join(' ‚Ä¢ ')}
                                        </div>
                                    ` : ''}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;

            document.body.insertAdjacentHTML('beforeend', modalHtml);
        }

        function closeBookingModal() {
            const modal = document.getElementById('booking-modal');
            if (modal) modal.remove();
        }

        function openBookingUrl(encodedUrl) {
            closeBookingModal();
            const url = decodeURIComponent(encodedUrl);
            window.open(url, '_blank', 'noopener,noreferrer');
        }

        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.id = 'toast-' + Date.now();
            toast.style.cssText = `position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:${type === 'info' ? '#003580' : '#28a745'};color:white;padding:12px 24px;border-radius:8px;z-index:10000;font-weight:500;box-shadow:0 4px 12px rgba(0,0,0,0.2);`;
            toast.innerHTML = `<i class="fas fa-spinner fa-spin" style="margin-right:8px;"></i>${message}`;
            document.body.appendChild(toast);
            return toast.id;
        }

        function hideToast(toastId) {
            const toast = document.getElementById(toastId);
            if (toast) toast.remove();
        }

        function bookHotel(hotelName, location, directLink) {
            let bookingUrl;

            if (directLink && directLink !== 'null' && directLink !== '') {
                // Use the direct link from SerpAPI
                bookingUrl = decodeURIComponent(directLink);
            } else {
                // Fallback: Search Google Hotels for this property
                const searchQuery = `${decodeURIComponent(hotelName)} ${decodeURIComponent(location)} hotel booking`;
                bookingUrl = `https://www.google.com/travel/hotels?q=${encodeURIComponent(searchQuery)}&hl=en&gl=in&curr=INR`;
            }

            // Open in new tab
            const newWindow = window.open(bookingUrl, '_blank', 'noopener,noreferrer');

            if (!newWindow || newWindow.closed || typeof newWindow.closed === 'undefined') {
                // Popup blocked - try alternate approach
                alert('Please allow popups for this site to complete your booking.\n\nAlternatively, click OK to open the booking page.');
                window.location.href = bookingUrl;
            }
        }

        async function generateAITrip() {
            const dest = document.getElementById('ai-dest').value.trim();
            const days = document.getElementById('ai-days').value.trim();
            const prefs = document.getElementById('ai-prefs').value.trim();
            const resultsDiv = document.getElementById('ai-results');
            const loader = document.getElementById('ai-loader');
            const btn = document.getElementById('generate-btn');

            if (!dest) {
                alert("Please enter a destination");
                return;
            }

            loader.style.display = 'block';
            resultsDiv.innerHTML = '';
            btn.disabled = true;

            try {
                const response = await fetch("https://v7zixtn6d5c4xae376p7oezlbm0vkdop.lambda-url.eu-north-1.on.aws/api/itinerary/generate", {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        destination: dest,
                        duration: days || '5 days',
                        preferences: prefs || 'general sightseeing'
                    })
                });

                if (!response.ok) {
                    throw new Error(`Server error: ${response.status}`);
                }

                const data = await response.json();
                const content = data.itinerary || data.message || "No content received.";

                loader.style.display = 'none';
                displayFormattedItinerary(content, resultsDiv);

            } catch (error) {
                loader.style.display = 'none';
                resultsDiv.innerHTML = `<div class="error-message">
                    <strong>Error:</strong> ${error.message}<br>
                    <small>Please check your internet connection and try again.</small>
                </div>`;
            } finally {
                btn.disabled = false;
            }
        }

        function convertMarkdownToHTML(markdown) {
            if (!markdown) return '';

            let html = markdown;

            // Remove horizontal rules
            html = html.replace(/^[\-\*\_]{3,}$/gm, '');

            // Convert markdown tables to HTML tables with budget styling
            html = html.replace(/\|(.+)\|/g, function (match) {
                const cells = match.split('|').filter(cell => cell.trim());
                if (cells.some(cell => cell.includes('---'))) {
                    return ''; // Skip separator rows
                }
                const isHeader = cells.some(cell =>
                    cell.toLowerCase().includes('category') ||
                    cell.toLowerCase().includes('budget') ||
                    cell.toLowerCase().includes('‚Çπ')
                );
                const cellTag = isHeader && cells[0].toLowerCase().includes('category') ? 'th' : 'td';
                const row = cells.map(cell => `<${cellTag}>${cell.trim()}</${cellTag}>`).join('');
                return `<tr>${row}</tr>`;
            });

            // Wrap table rows in table structure
            html = html.replace(/(<tr>.*?<\/tr>(?:\s*<tr>.*?<\/tr>)*)/gs, function (match) {
                if (match.includes('<th>')) {
                    return `<table class="budget-table"><thead>${match.split('</tr>')[0]}</tr></thead><tbody>${match.split('</tr>').slice(1).join('</tr>')}</tbody></table>`;
                }
                return `<table class="budget-table"><tbody>${match}</tbody></table>`;
            });

            // Convert headings - detect Day patterns for card wrapping
            html = html.replace(/^## (Day \d+.*$)/gm, '</div><div class="day-card"><h2>$1</h2>');
            html = html.replace(/^## (.*$)/gm, '<div class="itinerary-section"><h2>$1</h2>');
            html = html.replace(/^### (.*$)/gm, '<h3>$1</h3>');
            html = html.replace(/^#### (.*$)/gm, '<h4>$1</h4>');
            html = html.replace(/^# (.*$)/gm, '<div class="itinerary-header"><h1>$1</h1></div>');

            // Bold text
            html = html.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');

            // Convert list items
            html = html.replace(/^\s*[\*\-]\s+(.*)$/gm, '<li>$1</li>');
            html = html.replace(/(<li>.*?<\/li>(?:\s*<li>.*?<\/li>)*)/gs, '<ul>$1</ul>');

            // Process remaining lines
            const lines = html.split('\n');
            let result = [];
            let inDayCard = false;

            for (let line of lines) {
                line = line.trim();
                if (!line) continue;

                // Check if entering a day card
                if (line.includes('class="day-card"')) {
                    inDayCard = true;
                }

                // Detect tip/pro-tip lines
                if (line.toLowerCase().includes('tip:') || line.toLowerCase().includes('pro tip')) {
                    line = `<div class="tip-card">${line.replace(/\*\*?(?:Pro )?Tip:?\*\*?/gi, '')}</div>`;
                }

                if (line.startsWith('<') || line.startsWith('</')) {
                    result.push(line);
                } else {
                    result.push('<p>' + line + '</p>');
                }
            }

            // Close any open day cards
            let finalHtml = result.join('\n');

            // Clean up empty divs and fix structure
            finalHtml = finalHtml.replace(/<\/div><div class="day-card">/g, '</div>\n<div class="day-card">');
            finalHtml = finalHtml.replace(/^<\/div>/, ''); // Remove leading close div

            // Add closing div for last day card if needed
            const dayCardCount = (finalHtml.match(/<div class="day-card">/g) || []).length;
            const closeDivCount = (finalHtml.match(/<\/div>/g) || []).length;
            if (dayCardCount > 0) {
                finalHtml += '</div>';
            }

            return finalHtml;
        }

        function displayFormattedItinerary(content, container) {
            const htmlContent = convertMarkdownToHTML(content);
            const destination = document.getElementById('ai-dest').value.trim() || 'Your Destination';
            const duration = document.getElementById('ai-days').value.trim() || '5 days';

            container.innerHTML = `
                <div class="itinerary-container">
                    <div class="itinerary-header">
                        <h1>üåç ${destination} Adventure</h1>
                        <p>üìÖ ${duration} ‚Ä¢ ‚ú® Personalized Itinerary</p>
                    </div>
                    ${htmlContent}
                    <div class="itinerary-actions">
                        <button class="btn-outline" onclick="copyItinerary()">
                            <i class="fas fa-copy"></i> Copy
                        </button>
                        <button class="btn-outline" onclick="downloadItinerary()">
                            <i class="fas fa-download"></i> Download
                        </button>
                        <button class="btn-outline" onclick="printItinerary()">
                            <i class="fas fa-print"></i> Print
                        </button>
                        <button class="btn-main" onclick="generateAITrip()">
                            <i class="fas fa-sync"></i> Generate New
                        </button>
                    </div>
                </div>
            `;
        }

        function printItinerary() {
            const content = document.querySelector('.itinerary-container');
            if (content) {
                const printWindow = window.open('', '_blank');
                printWindow.document.write(`
                    <html>
                    <head>
                        <title>VOYA AI - Travel Itinerary</title>
                        <style>
                            body { font-family: 'Segoe UI', sans-serif; padding: 20px; }
                            h1 { color: #003580; }
                            h2 { color: #1a73e8; margin-top: 20px; }
                            ul { margin: 10px 0; }
                            li { margin: 5px 0; }
                            .itinerary-actions { display: none; }
                        </style>
                    </head>
                    <body>${content.innerHTML}</body>
                    </html>
                `);
                printWindow.document.close();
                printWindow.print();
            }
        }

        function copyItinerary() {
            const container = document.querySelector('.itinerary-container');
            if (container) {
                const text = container.innerText;
                navigator.clipboard.writeText(text).then(() => {
                    alert('‚úÖ Itinerary copied to clipboard!');
                }).catch(err => {
                    alert('‚ùå Failed to copy: ' + err.message);
                });
            }
        }

        function downloadItinerary() {
            const container = document.querySelector('.itinerary-container');
            if (container) {
                const text = container.innerText;
                const blob = new Blob([text], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'voya-itinerary.txt';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }
        }
    </script>
</body>

</html>
